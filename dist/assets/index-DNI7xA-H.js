(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}})();var bp={exports:{}},Dc={};var ny;function Kw(){if(ny)return Dc;ny=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(s,a,l){var i=null;if(l!==void 0&&(i=""+l),a.key!==void 0&&(i=""+a.key),"key"in a){l={};for(var p in a)p!=="key"&&(l[p]=a[p])}else l=a;return a=l.ref,{$$typeof:e,type:s,key:i,ref:a!==void 0?a:null,props:l}}return Dc.Fragment=t,Dc.jsx=n,Dc.jsxs=n,Dc}var ry;function Jw(){return ry||(ry=1,bp.exports=Kw()),bp.exports}var f=Jw(),Sp={exports:{}},ft={};var iy;function Zw(){if(iy)return ft;iy=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),i=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),v=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.for("react.activity"),y=Symbol.iterator;function x(H){return H===null||typeof H!="object"?null:(H=y&&H[y]||H["@@iterator"],typeof H=="function"?H:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,E={};function R(H,Z,te){this.props=H,this.context=Z,this.refs=E,this.updater=te||T}R.prototype.isReactComponent={},R.prototype.setState=function(H,Z){if(typeof H!="object"&&typeof H!="function"&&H!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,H,Z,"setState")},R.prototype.forceUpdate=function(H){this.updater.enqueueForceUpdate(this,H,"forceUpdate")};function P(){}P.prototype=R.prototype;function B(H,Z,te){this.props=H,this.context=Z,this.refs=E,this.updater=te||T}var X=B.prototype=new P;X.constructor=B,_(X,R.prototype),X.isPureReactComponent=!0;var Q=Array.isArray;function K(){}var k={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function N(H,Z,te){var fe=te.ref;return{$$typeof:e,type:H,key:Z,ref:fe!==void 0?fe:null,props:te}}function U(H,Z){return N(H.type,Z,H.props)}function z(H){return typeof H=="object"&&H!==null&&H.$$typeof===e}function q(H){var Z={"=":"=0",":":"=2"};return"$"+H.replace(/[=:]/g,function(te){return Z[te]})}var D=/\/+/g;function de(H,Z){return typeof H=="object"&&H!==null&&H.key!=null?q(""+H.key):Z.toString(36)}function je(H){switch(H.status){case"fulfilled":return H.value;case"rejected":throw H.reason;default:switch(typeof H.status=="string"?H.then(K,K):(H.status="pending",H.then(function(Z){H.status==="pending"&&(H.status="fulfilled",H.value=Z)},function(Z){H.status==="pending"&&(H.status="rejected",H.reason=Z)})),H.status){case"fulfilled":return H.value;case"rejected":throw H.reason}}throw H}function W(H,Z,te,fe,F){var O=typeof H;(O==="undefined"||O==="boolean")&&(H=null);var xe=!1;if(H===null)xe=!0;else switch(O){case"bigint":case"string":case"number":xe=!0;break;case"object":switch(H.$$typeof){case e:case t:xe=!0;break;case u:return xe=H._init,W(xe(H._payload),Z,te,fe,F)}}if(xe)return F=F(H),xe=fe===""?"."+de(H,0):fe,Q(F)?(te="",xe!=null&&(te=xe.replace(D,"$&/")+"/"),W(F,Z,te,"",function(De){return De})):F!=null&&(z(F)&&(F=U(F,te+(F.key==null||H&&H.key===F.key?"":(""+F.key).replace(D,"$&/")+"/")+xe)),Z.push(F)),1;xe=0;var Le=fe===""?".":fe+":";if(Q(H))for(var Oe=0;Oe<H.length;Oe++)fe=H[Oe],O=Le+de(fe,Oe),xe+=W(fe,Z,te,O,F);else if(Oe=x(H),typeof Oe=="function")for(H=Oe.call(H),Oe=0;!(fe=H.next()).done;)fe=fe.value,O=Le+de(fe,Oe++),xe+=W(fe,Z,te,O,F);else if(O==="object"){if(typeof H.then=="function")return W(je(H),Z,te,fe,F);throw Z=String(H),Error("Objects are not valid as a React child (found: "+(Z==="[object Object]"?"object with keys {"+Object.keys(H).join(", ")+"}":Z)+"). If you meant to render a collection of children, use an array instead.")}return xe}function J(H,Z,te){if(H==null)return H;var fe=[],F=0;return W(H,fe,"","",function(O){return Z.call(te,O,F++)}),fe}function ve(H){if(H._status===-1){var Z=H._result;Z=Z(),Z.then(function(te){(H._status===0||H._status===-1)&&(H._status=1,H._result=te)},function(te){(H._status===0||H._status===-1)&&(H._status=2,H._result=te)}),H._status===-1&&(H._status=0,H._result=Z)}if(H._status===1)return H._result.default;throw H._result}var Se=typeof reportError=="function"?reportError:function(H){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof H=="object"&&H!==null&&typeof H.message=="string"?String(H.message):String(H),error:H});if(!window.dispatchEvent(Z))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",H);return}console.error(H)},Re={map:J,forEach:function(H,Z,te){J(H,function(){Z.apply(this,arguments)},te)},count:function(H){var Z=0;return J(H,function(){Z++}),Z},toArray:function(H){return J(H,function(Z){return Z})||[]},only:function(H){if(!z(H))throw Error("React.Children.only expected to receive a single React element child.");return H}};return ft.Activity=h,ft.Children=Re,ft.Component=R,ft.Fragment=n,ft.Profiler=a,ft.PureComponent=B,ft.StrictMode=s,ft.Suspense=g,ft.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,ft.__COMPILER_RUNTIME={__proto__:null,c:function(H){return k.H.useMemoCache(H)}},ft.cache=function(H){return function(){return H.apply(null,arguments)}},ft.cacheSignal=function(){return null},ft.cloneElement=function(H,Z,te){if(H==null)throw Error("The argument must be a React element, but you passed "+H+".");var fe=_({},H.props),F=H.key;if(Z!=null)for(O in Z.key!==void 0&&(F=""+Z.key),Z)!I.call(Z,O)||O==="key"||O==="__self"||O==="__source"||O==="ref"&&Z.ref===void 0||(fe[O]=Z[O]);var O=arguments.length-2;if(O===1)fe.children=te;else if(1<O){for(var xe=Array(O),Le=0;Le<O;Le++)xe[Le]=arguments[Le+2];fe.children=xe}return N(H.type,F,fe)},ft.createContext=function(H){return H={$$typeof:i,_currentValue:H,_currentValue2:H,_threadCount:0,Provider:null,Consumer:null},H.Provider=H,H.Consumer={$$typeof:l,_context:H},H},ft.createElement=function(H,Z,te){var fe,F={},O=null;if(Z!=null)for(fe in Z.key!==void 0&&(O=""+Z.key),Z)I.call(Z,fe)&&fe!=="key"&&fe!=="__self"&&fe!=="__source"&&(F[fe]=Z[fe]);var xe=arguments.length-2;if(xe===1)F.children=te;else if(1<xe){for(var Le=Array(xe),Oe=0;Oe<xe;Oe++)Le[Oe]=arguments[Oe+2];F.children=Le}if(H&&H.defaultProps)for(fe in xe=H.defaultProps,xe)F[fe]===void 0&&(F[fe]=xe[fe]);return N(H,O,F)},ft.createRef=function(){return{current:null}},ft.forwardRef=function(H){return{$$typeof:p,render:H}},ft.isValidElement=z,ft.lazy=function(H){return{$$typeof:u,_payload:{_status:-1,_result:H},_init:ve}},ft.memo=function(H,Z){return{$$typeof:v,type:H,compare:Z===void 0?null:Z}},ft.startTransition=function(H){var Z=k.T,te={};k.T=te;try{var fe=H(),F=k.S;F!==null&&F(te,fe),typeof fe=="object"&&fe!==null&&typeof fe.then=="function"&&fe.then(K,Se)}catch(O){Se(O)}finally{Z!==null&&te.types!==null&&(Z.types=te.types),k.T=Z}},ft.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},ft.use=function(H){return k.H.use(H)},ft.useActionState=function(H,Z,te){return k.H.useActionState(H,Z,te)},ft.useCallback=function(H,Z){return k.H.useCallback(H,Z)},ft.useContext=function(H){return k.H.useContext(H)},ft.useDebugValue=function(){},ft.useDeferredValue=function(H,Z){return k.H.useDeferredValue(H,Z)},ft.useEffect=function(H,Z){return k.H.useEffect(H,Z)},ft.useEffectEvent=function(H){return k.H.useEffectEvent(H)},ft.useId=function(){return k.H.useId()},ft.useImperativeHandle=function(H,Z,te){return k.H.useImperativeHandle(H,Z,te)},ft.useInsertionEffect=function(H,Z){return k.H.useInsertionEffect(H,Z)},ft.useLayoutEffect=function(H,Z){return k.H.useLayoutEffect(H,Z)},ft.useMemo=function(H,Z){return k.H.useMemo(H,Z)},ft.useOptimistic=function(H,Z){return k.H.useOptimistic(H,Z)},ft.useReducer=function(H,Z,te){return k.H.useReducer(H,Z,te)},ft.useRef=function(H){return k.H.useRef(H)},ft.useState=function(H){return k.H.useState(H)},ft.useSyncExternalStore=function(H,Z,te){return k.H.useSyncExternalStore(H,Z,te)},ft.useTransition=function(){return k.H.useTransition()},ft.version="19.2.4",ft}var sy;function Sm(){return sy||(sy=1,Sp.exports=Zw()),Sp.exports}var M=Sm(),wp={exports:{}},Nc={},_p={exports:{}},xp={};var ay;function e_(){return ay||(ay=1,(function(e){function t(W,J){var ve=W.length;W.push(J);e:for(;0<ve;){var Se=ve-1>>>1,Re=W[Se];if(0<a(Re,J))W[Se]=J,W[ve]=Re,ve=Se;else break e}}function n(W){return W.length===0?null:W[0]}function s(W){if(W.length===0)return null;var J=W[0],ve=W.pop();if(ve!==J){W[0]=ve;e:for(var Se=0,Re=W.length,H=Re>>>1;Se<H;){var Z=2*(Se+1)-1,te=W[Z],fe=Z+1,F=W[fe];if(0>a(te,ve))fe<Re&&0>a(F,te)?(W[Se]=F,W[fe]=ve,Se=fe):(W[Se]=te,W[Z]=ve,Se=Z);else if(fe<Re&&0>a(F,ve))W[Se]=F,W[fe]=ve,Se=fe;else break e}}return J}function a(W,J){var ve=W.sortIndex-J.sortIndex;return ve!==0?ve:W.id-J.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var i=Date,p=i.now();e.unstable_now=function(){return i.now()-p}}var g=[],v=[],u=1,h=null,y=3,x=!1,T=!1,_=!1,E=!1,R=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;function X(W){for(var J=n(v);J!==null;){if(J.callback===null)s(v);else if(J.startTime<=W)s(v),J.sortIndex=J.expirationTime,t(g,J);else break;J=n(v)}}function Q(W){if(_=!1,X(W),!T)if(n(g)!==null)T=!0,K||(K=!0,q());else{var J=n(v);J!==null&&je(Q,J.startTime-W)}}var K=!1,k=-1,I=5,N=-1;function U(){return E?!0:!(e.unstable_now()-N<I)}function z(){if(E=!1,K){var W=e.unstable_now();N=W;var J=!0;try{e:{T=!1,_&&(_=!1,P(k),k=-1),x=!0;var ve=y;try{t:{for(X(W),h=n(g);h!==null&&!(h.expirationTime>W&&U());){var Se=h.callback;if(typeof Se=="function"){h.callback=null,y=h.priorityLevel;var Re=Se(h.expirationTime<=W);if(W=e.unstable_now(),typeof Re=="function"){h.callback=Re,X(W),J=!0;break t}h===n(g)&&s(g),X(W)}else s(g);h=n(g)}if(h!==null)J=!0;else{var H=n(v);H!==null&&je(Q,H.startTime-W),J=!1}}break e}finally{h=null,y=ve,x=!1}J=void 0}}finally{J?q():K=!1}}}var q;if(typeof B=="function")q=function(){B(z)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,de=D.port2;D.port1.onmessage=z,q=function(){de.postMessage(null)}}else q=function(){R(z,0)};function je(W,J){k=R(function(){W(e.unstable_now())},J)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(W){W.callback=null},e.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<W?Math.floor(1e3/W):5},e.unstable_getCurrentPriorityLevel=function(){return y},e.unstable_next=function(W){switch(y){case 1:case 2:case 3:var J=3;break;default:J=y}var ve=y;y=J;try{return W()}finally{y=ve}},e.unstable_requestPaint=function(){E=!0},e.unstable_runWithPriority=function(W,J){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var ve=y;y=W;try{return J()}finally{y=ve}},e.unstable_scheduleCallback=function(W,J,ve){var Se=e.unstable_now();switch(typeof ve=="object"&&ve!==null?(ve=ve.delay,ve=typeof ve=="number"&&0<ve?Se+ve:Se):ve=Se,W){case 1:var Re=-1;break;case 2:Re=250;break;case 5:Re=1073741823;break;case 4:Re=1e4;break;default:Re=5e3}return Re=ve+Re,W={id:u++,callback:J,priorityLevel:W,startTime:ve,expirationTime:Re,sortIndex:-1},ve>Se?(W.sortIndex=ve,t(v,W),n(g)===null&&W===n(v)&&(_?(P(k),k=-1):_=!0,je(Q,ve-Se))):(W.sortIndex=Re,t(g,W),T||x||(T=!0,K||(K=!0,q()))),W},e.unstable_shouldYield=U,e.unstable_wrapCallback=function(W){var J=y;return function(){var ve=y;y=J;try{return W.apply(this,arguments)}finally{y=ve}}}})(xp)),xp}var oy;function t_(){return oy||(oy=1,_p.exports=e_()),_p.exports}var Tp={exports:{}},Gn={};var ly;function n_(){if(ly)return Gn;ly=1;var e=Sm();function t(g){var v="https://react.dev/errors/"+g;if(1<arguments.length){v+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)v+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+g+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var s={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},a=Symbol.for("react.portal");function l(g,v,u){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:h==null?null:""+h,children:g,containerInfo:v,implementation:u}}var i=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function p(g,v){if(g==="font")return"";if(typeof v=="string")return v==="use-credentials"?v:""}return Gn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Gn.createPortal=function(g,v){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!v||v.nodeType!==1&&v.nodeType!==9&&v.nodeType!==11)throw Error(t(299));return l(g,v,null,u)},Gn.flushSync=function(g){var v=i.T,u=s.p;try{if(i.T=null,s.p=2,g)return g()}finally{i.T=v,s.p=u,s.d.f()}},Gn.preconnect=function(g,v){typeof g=="string"&&(v?(v=v.crossOrigin,v=typeof v=="string"?v==="use-credentials"?v:"":void 0):v=null,s.d.C(g,v))},Gn.prefetchDNS=function(g){typeof g=="string"&&s.d.D(g)},Gn.preinit=function(g,v){if(typeof g=="string"&&v&&typeof v.as=="string"){var u=v.as,h=p(u,v.crossOrigin),y=typeof v.integrity=="string"?v.integrity:void 0,x=typeof v.fetchPriority=="string"?v.fetchPriority:void 0;u==="style"?s.d.S(g,typeof v.precedence=="string"?v.precedence:void 0,{crossOrigin:h,integrity:y,fetchPriority:x}):u==="script"&&s.d.X(g,{crossOrigin:h,integrity:y,fetchPriority:x,nonce:typeof v.nonce=="string"?v.nonce:void 0})}},Gn.preinitModule=function(g,v){if(typeof g=="string")if(typeof v=="object"&&v!==null){if(v.as==null||v.as==="script"){var u=p(v.as,v.crossOrigin);s.d.M(g,{crossOrigin:u,integrity:typeof v.integrity=="string"?v.integrity:void 0,nonce:typeof v.nonce=="string"?v.nonce:void 0})}}else v==null&&s.d.M(g)},Gn.preload=function(g,v){if(typeof g=="string"&&typeof v=="object"&&v!==null&&typeof v.as=="string"){var u=v.as,h=p(u,v.crossOrigin);s.d.L(g,u,{crossOrigin:h,integrity:typeof v.integrity=="string"?v.integrity:void 0,nonce:typeof v.nonce=="string"?v.nonce:void 0,type:typeof v.type=="string"?v.type:void 0,fetchPriority:typeof v.fetchPriority=="string"?v.fetchPriority:void 0,referrerPolicy:typeof v.referrerPolicy=="string"?v.referrerPolicy:void 0,imageSrcSet:typeof v.imageSrcSet=="string"?v.imageSrcSet:void 0,imageSizes:typeof v.imageSizes=="string"?v.imageSizes:void 0,media:typeof v.media=="string"?v.media:void 0})}},Gn.preloadModule=function(g,v){if(typeof g=="string")if(v){var u=p(v.as,v.crossOrigin);s.d.m(g,{as:typeof v.as=="string"&&v.as!=="script"?v.as:void 0,crossOrigin:u,integrity:typeof v.integrity=="string"?v.integrity:void 0})}else s.d.m(g)},Gn.requestFormReset=function(g){s.d.r(g)},Gn.unstable_batchedUpdates=function(g,v){return g(v)},Gn.useFormState=function(g,v,u){return i.H.useFormState(g,v,u)},Gn.useFormStatus=function(){return i.H.useHostTransitionStatus()},Gn.version="19.2.4",Gn}var cy;function r_(){if(cy)return Tp.exports;cy=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Tp.exports=n_(),Tp.exports}var uy;function i_(){if(uy)return Nc;uy=1;var e=t_(),t=Sm(),n=r_();function s(r){var o="https://react.dev/errors/"+r;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function l(r){var o=r,d=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,(o.flags&4098)!==0&&(d=o.return),r=o.return;while(r)}return o.tag===3?d:null}function i(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function p(r){if(r.tag===31){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function g(r){if(l(r)!==r)throw Error(s(188))}function v(r){var o=r.alternate;if(!o){if(o=l(r),o===null)throw Error(s(188));return o!==r?null:r}for(var d=r,m=o;;){var S=d.return;if(S===null)break;var w=S.alternate;if(w===null){if(m=S.return,m!==null){d=m;continue}break}if(S.child===w.child){for(w=S.child;w;){if(w===d)return g(S),r;if(w===m)return g(S),o;w=w.sibling}throw Error(s(188))}if(d.return!==m.return)d=S,m=w;else{for(var A=!1,L=S.child;L;){if(L===d){A=!0,d=S,m=w;break}if(L===m){A=!0,m=S,d=w;break}L=L.sibling}if(!A){for(L=w.child;L;){if(L===d){A=!0,d=w,m=S;break}if(L===m){A=!0,m=w,d=S;break}L=L.sibling}if(!A)throw Error(s(189))}}if(d.alternate!==m)throw Error(s(190))}if(d.tag!==3)throw Error(s(188));return d.stateNode.current===d?r:o}function u(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r;for(r=r.child;r!==null;){if(o=u(r),o!==null)return o;r=r.sibling}return null}var h=Object.assign,y=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),P=Symbol.for("react.consumer"),B=Symbol.for("react.context"),X=Symbol.for("react.forward_ref"),Q=Symbol.for("react.suspense"),K=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),U=Symbol.for("react.memo_cache_sentinel"),z=Symbol.iterator;function q(r){return r===null||typeof r!="object"?null:(r=z&&r[z]||r["@@iterator"],typeof r=="function"?r:null)}var D=Symbol.for("react.client.reference");function de(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===D?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case _:return"Fragment";case R:return"Profiler";case E:return"StrictMode";case Q:return"Suspense";case K:return"SuspenseList";case N:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case T:return"Portal";case B:return r.displayName||"Context";case P:return(r._context.displayName||"Context")+".Consumer";case X:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case k:return o=r.displayName||null,o!==null?o:de(r.type)||"Memo";case I:o=r._payload,r=r._init;try{return de(r(o))}catch{}}return null}var je=Array.isArray,W=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ve={pending:!1,data:null,method:null,action:null},Se=[],Re=-1;function H(r){return{current:r}}function Z(r){0>Re||(r.current=Se[Re],Se[Re]=null,Re--)}function te(r,o){Re++,Se[Re]=r.current,r.current=o}var fe=H(null),F=H(null),O=H(null),xe=H(null);function Le(r,o){switch(te(O,o),te(F,r),te(fe,null),o.nodeType){case 9:case 11:r=(r=o.documentElement)&&(r=r.namespaceURI)?Ev(r):0;break;default:if(r=o.tagName,o=o.namespaceURI)o=Ev(o),r=Cv(o,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}Z(fe),te(fe,r)}function Oe(){Z(fe),Z(F),Z(O)}function De(r){r.memoizedState!==null&&te(xe,r);var o=fe.current,d=Cv(o,r.type);o!==d&&(te(F,r),te(fe,d))}function re(r){F.current===r&&(Z(fe),Z(F)),xe.current===r&&(Z(xe),Mc._currentValue=ve)}var Ie,Xe;function se(r){if(Ie===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);Ie=o&&o[1]||"",Xe=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ie+r+Xe}var Ue=!1;function $(r,o){if(!r||Ue)return"";Ue=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(o){var Ae=function(){throw Error()};if(Object.defineProperty(Ae.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ae,[])}catch(pe){var ue=pe}Reflect.construct(r,[],Ae)}else{try{Ae.call()}catch(pe){ue=pe}r.call(Ae.prototype)}}else{try{throw Error()}catch(pe){ue=pe}(Ae=r())&&typeof Ae.catch=="function"&&Ae.catch(function(){})}}catch(pe){if(pe&&ue&&typeof pe.stack=="string")return[pe.stack,ue.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var S=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");S&&S.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=m.DetermineComponentFrameRoot(),A=w[0],L=w[1];if(A&&L){var G=A.split(`
`),oe=L.split(`
`);for(S=m=0;m<G.length&&!G[m].includes("DetermineComponentFrameRoot");)m++;for(;S<oe.length&&!oe[S].includes("DetermineComponentFrameRoot");)S++;if(m===G.length||S===oe.length)for(m=G.length-1,S=oe.length-1;1<=m&&0<=S&&G[m]!==oe[S];)S--;for(;1<=m&&0<=S;m--,S--)if(G[m]!==oe[S]){if(m!==1||S!==1)do if(m--,S--,0>S||G[m]!==oe[S]){var ye=`
`+G[m].replace(" at new "," at ");return r.displayName&&ye.includes("<anonymous>")&&(ye=ye.replace("<anonymous>",r.displayName)),ye}while(1<=m&&0<=S);break}}}finally{Ue=!1,Error.prepareStackTrace=d}return(d=r?r.displayName||r.name:"")?se(d):""}function ee(r,o){switch(r.tag){case 26:case 27:case 5:return se(r.type);case 16:return se("Lazy");case 13:return r.child!==o&&o!==null?se("Suspense Fallback"):se("Suspense");case 19:return se("SuspenseList");case 0:case 15:return $(r.type,!1);case 11:return $(r.type.render,!1);case 1:return $(r.type,!0);case 31:return se("Activity");default:return""}}function ge(r){try{var o="",d=null;do o+=ee(r,d),d=r,r=r.return;while(r);return o}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var me=Object.prototype.hasOwnProperty,we=e.unstable_scheduleCallback,Ce=e.unstable_cancelCallback,Te=e.unstable_shouldYield,Pe=e.unstable_requestPaint,Ge=e.unstable_now,ce=e.unstable_getCurrentPriorityLevel,ze=e.unstable_ImmediatePriority,Je=e.unstable_UserBlockingPriority,dt=e.unstable_NormalPriority,nt=e.unstable_LowPriority,Vt=e.unstable_IdlePriority,nn=e.log,Wn=e.unstable_setDisableYieldValue,Ft=null,Ne=null;function ke(r){if(typeof nn=="function"&&Wn(r),Ne&&typeof Ne.setStrictMode=="function")try{Ne.setStrictMode(Ft,r)}catch{}}var $e=Math.clz32?Math.clz32:qe,Ye=Math.log,Ze=Math.LN2;function qe(r){return r>>>=0,r===0?32:31-(Ye(r)/Ze|0)|0}var xt=256,Pn=262144,rn=4194304;function He(r){var o=r&42;if(o!==0)return o;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Nt(r,o,d){var m=r.pendingLanes;if(m===0)return 0;var S=0,w=r.suspendedLanes,A=r.pingedLanes;r=r.warmLanes;var L=m&134217727;return L!==0?(m=L&~w,m!==0?S=He(m):(A&=L,A!==0?S=He(A):d||(d=L&~r,d!==0&&(S=He(d))))):(L=m&~w,L!==0?S=He(L):A!==0?S=He(A):d||(d=m&~r,d!==0&&(S=He(d)))),S===0?0:o!==0&&o!==S&&(o&w)===0&&(w=S&-S,d=o&-o,w>=d||w===32&&(d&4194048)!==0)?o:S}function Jt(r,o){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&o)===0}function ur(r,o){switch(r){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Oi(){var r=rn;return rn<<=1,(rn&62914560)===0&&(rn=4194304),r}function di(r){for(var o=[],d=0;31>d;d++)o.push(r);return o}function va(r,o){r.pendingLanes|=o,o!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Th(r,o,d,m,S,w){var A=r.pendingLanes;r.pendingLanes=d,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=d,r.entangledLanes&=d,r.errorRecoveryDisabledLanes&=d,r.shellSuspendCounter=0;var L=r.entanglements,G=r.expirationTimes,oe=r.hiddenUpdates;for(d=A&~d;0<d;){var ye=31-$e(d),Ae=1<<ye;L[ye]=0,G[ye]=-1;var ue=oe[ye];if(ue!==null)for(oe[ye]=null,ye=0;ye<ue.length;ye++){var pe=ue[ye];pe!==null&&(pe.lane&=-536870913)}d&=~Ae}m!==0&&ya(r,m,0),w!==0&&S===0&&r.tag!==0&&(r.suspendedLanes|=w&~(A&~o))}function ya(r,o,d){r.pendingLanes|=o,r.suspendedLanes&=~o;var m=31-$e(o);r.entangledLanes|=o,r.entanglements[m]=r.entanglements[m]|1073741824|d&261930}function Nl(r,o){var d=r.entangledLanes|=o;for(r=r.entanglements;d;){var m=31-$e(d),S=1<<m;S&o|r[m]&o&&(r[m]|=o),d&=~S}}function Ll(r,o){var d=o&-o;return d=(d&42)!==0?1:ba(d),(d&(r.suspendedLanes|o))!==0?0:d}function ba(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Vi(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Mu(){var r=J.p;return r!==0?r:(r=window.event,r===void 0?32:Xv(r.type))}function $r(r,o){var d=J.p;try{return J.p=r,o()}finally{J.p=d}}var Wr=Math.random().toString(36).slice(2),gn="__reactFiber$"+Wr,Rn="__reactProps$"+Wr,fi="__reactContainer$"+Wr,oo="__reactEvents$"+Wr,Eh="__reactListeners$"+Wr,Ru="__reactHandles$"+Wr,ku="__reactResources$"+Wr,hi="__reactMarker$"+Wr;function lo(r){delete r[gn],delete r[Rn],delete r[oo],delete r[Eh],delete r[Ru]}function pi(r){var o=r[gn];if(o)return o;for(var d=r.parentNode;d;){if(o=d[fi]||d[gn]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(r=Dv(r);r!==null;){if(d=r[gn])return d;r=Dv(r)}return o}r=d,d=r.parentNode}return null}function Ar(r){if(r=r[gn]||r[fi]){var o=r.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return r}return null}function dr(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r.stateNode;throw Error(s(33))}function mi(r){var o=r[ku];return o||(o=r[ku]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function vn(r){r[hi]=!0}var Pl=new Set,zl={};function gi(r,o){vi(r,o),vi(r+"Capture",o)}function vi(r,o){for(zl[r]=o,r=0;r<o.length;r++)Pl.add(o[r])}var Ol=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Vl={},Bl={};function Iu(r){return me.call(Bl,r)?!0:me.call(Vl,r)?!1:Ol.test(r)?Bl[r]=!0:(Vl[r]=!0,!1)}function co(r,o,d){if(Iu(o))if(d===null)r.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":r.removeAttribute(o);return;case"boolean":var m=o.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){r.removeAttribute(o);return}}r.setAttribute(o,""+d)}}function fr(r,o,d){if(d===null)r.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(o);return}r.setAttribute(o,""+d)}}function yn(r,o,d,m){if(m===null)r.removeAttribute(d);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(d);return}r.setAttributeNS(o,d,""+m)}}function kn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function vs(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Ul(r,o,d){var m=Object.getOwnPropertyDescriptor(r.constructor.prototype,o);if(!r.hasOwnProperty(o)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var S=m.get,w=m.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return S.call(this)},set:function(A){d=""+A,w.call(this,A)}}),Object.defineProperty(r,o,{enumerable:m.enumerable}),{getValue:function(){return d},setValue:function(A){d=""+A},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function Lt(r){if(!r._valueTracker){var o=vs(r)?"checked":"value";r._valueTracker=Ul(r,o,""+r[o])}}function Sa(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var d=o.getValue(),m="";return r&&(m=vs(r)?r.checked?"true":"false":r.value),r=m,r!==d?(o.setValue(r),!0):!1}function yi(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var wa=/[\n"\\]/g;function tr(r){return r.replace(wa,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function uo(r,o,d,m,S,w,A,L){r.name="",A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?r.type=A:r.removeAttribute("type"),o!=null?A==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+kn(o)):r.value!==""+kn(o)&&(r.value=""+kn(o)):A!=="submit"&&A!=="reset"||r.removeAttribute("value"),o!=null?ql(r,A,kn(o)):d!=null?ql(r,A,kn(d)):m!=null&&r.removeAttribute("value"),S==null&&w!=null&&(r.defaultChecked=!!w),S!=null&&(r.checked=S&&typeof S!="function"&&typeof S!="symbol"),L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?r.name=""+kn(L):r.removeAttribute("name")}function Du(r,o,d,m,S,w,A,L){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(r.type=w),o!=null||d!=null){if(!(w!=="submit"&&w!=="reset"||o!=null)){Lt(r);return}d=d!=null?""+kn(d):"",o=o!=null?""+kn(o):d,L||o===r.value||(r.value=o),r.defaultValue=o}m=m??S,m=typeof m!="function"&&typeof m!="symbol"&&!!m,r.checked=L?r.checked:!!m,r.defaultChecked=!!m,A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(r.name=A),Lt(r)}function ql(r,o,d){o==="number"&&yi(r.ownerDocument)===r||r.defaultValue===""+d||(r.defaultValue=""+d)}function ys(r,o,d,m){if(r=r.options,o){o={};for(var S=0;S<d.length;S++)o["$"+d[S]]=!0;for(d=0;d<r.length;d++)S=o.hasOwnProperty("$"+r[d].value),r[d].selected!==S&&(r[d].selected=S),S&&m&&(r[d].defaultSelected=!0)}else{for(d=""+kn(d),o=null,S=0;S<r.length;S++){if(r[S].value===d){r[S].selected=!0,m&&(r[S].defaultSelected=!0);return}o!==null||r[S].disabled||(o=r[S])}o!==null&&(o.selected=!0)}}function Nu(r,o,d){if(o!=null&&(o=""+kn(o),o!==r.value&&(r.value=o),d==null)){r.defaultValue!==o&&(r.defaultValue=o);return}r.defaultValue=d!=null?""+kn(d):""}function bs(r,o,d,m){if(o==null){if(m!=null){if(d!=null)throw Error(s(92));if(je(m)){if(1<m.length)throw Error(s(93));m=m[0]}d=m}d==null&&(d=""),o=d}d=kn(o),r.defaultValue=d,m=r.textContent,m===d&&m!==""&&m!==null&&(r.value=m),Lt(r)}function nr(r,o){if(o){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=o;return}}r.textContent=o}var Lu=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Hl(r,o,d){var m=o.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?m?r.setProperty(o,""):o==="float"?r.cssFloat="":r[o]="":m?r.setProperty(o,d):typeof d!="number"||d===0||Lu.has(o)?o==="float"?r.cssFloat=d:r[o]=(""+d).trim():r[o]=d+"px"}function Fl(r,o,d){if(o!=null&&typeof o!="object")throw Error(s(62));if(r=r.style,d!=null){for(var m in d)!d.hasOwnProperty(m)||o!=null&&o.hasOwnProperty(m)||(m.indexOf("--")===0?r.setProperty(m,""):m==="float"?r.cssFloat="":r[m]="");for(var S in o)m=o[S],o.hasOwnProperty(S)&&d[S]!==m&&Hl(r,S,m)}else for(var w in o)o.hasOwnProperty(w)&&Hl(r,w,o[w])}function fo(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Pu=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ss=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ho(r){return Ss.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Gr(){}var $l=null;function jr(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var ws=null,bi=null;function _a(r){var o=Ar(r);if(o&&(r=o.stateNode)){var d=r[Rn]||null;e:switch(r=o.stateNode,o.type){case"input":if(uo(r,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),o=d.name,d.type==="radio"&&o!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+tr(""+o)+'"][type="radio"]'),o=0;o<d.length;o++){var m=d[o];if(m!==r&&m.form===r.form){var S=m[Rn]||null;if(!S)throw Error(s(90));uo(m,S.value,S.defaultValue,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name)}}for(o=0;o<d.length;o++)m=d[o],m.form===r.form&&Sa(m)}break e;case"textarea":Nu(r,d.value,d.defaultValue);break e;case"select":o=d.value,o!=null&&ys(r,!!d.multiple,o,!1)}}}var po=!1;function _s(r,o,d){if(po)return r(o,d);po=!0;try{var m=r(o);return m}finally{if(po=!1,(ws!==null||bi!==null)&&(Md(),ws&&(o=ws,r=bi,bi=ws=null,_a(o),r)))for(o=0;o<r.length;o++)_a(r[o])}}function Qr(r,o){var d=r.stateNode;if(d===null)return null;var m=d[Rn]||null;if(m===null)return null;d=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(r=r.type,m=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!m;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(s(231,o,typeof d));return d}var Mr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),xa=!1;if(Mr)try{var Bt={};Object.defineProperty(Bt,"passive",{get:function(){xa=!0}}),window.addEventListener("test",Bt,Bt),window.removeEventListener("test",Bt,Bt)}catch{xa=!1}var Si=null,Wl=null,Ta=null;function Gl(){if(Ta)return Ta;var r,o=Wl,d=o.length,m,S="value"in Si?Si.value:Si.textContent,w=S.length;for(r=0;r<d&&o[r]===S[r];r++);var A=d-r;for(m=1;m<=A&&o[d-m]===S[w-m];m++);return Ta=S.slice(r,1<m?1-m:void 0)}function Ea(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function Bi(){return!0}function Xr(){return!1}function zn(r){function o(d,m,S,w,A){this._reactName=d,this._targetInst=S,this.type=m,this.nativeEvent=w,this.target=A,this.currentTarget=null;for(var L in r)r.hasOwnProperty(L)&&(d=r[L],this[L]=d?d(w):w[L]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Bi:Xr,this.isPropagationStopped=Xr,this}return h(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Bi)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Bi)},persist:function(){},isPersistent:Bi}),o}var Ui={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wi=zn(Ui),xs=h({},Ui,{view:0,detail:0}),Ql=zn(xs),Ts,mo,_i,go=h({},xs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Es,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==_i&&(_i&&r.type==="mousemove"?(Ts=r.screenX-_i.screenX,mo=r.screenY-_i.screenY):mo=Ts=0,_i=r),Ts)},movementY:function(r){return"movementY"in r?r.movementY:mo}}),Xl=zn(go),Ca=h({},go,{dataTransfer:0}),zu=zn(Ca),Ou=h({},xs,{relatedTarget:0}),Aa=zn(Ou),Yl=h({},Ui,{animationName:0,elapsedTime:0,pseudoElement:0}),Vu=zn(Yl),vo=h({},Ui,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Bu=zn(vo),Uu=h({},Ui,{data:0}),xi=zn(Uu),qu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Hu={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Fu={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $u(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=Fu[r])?!!o[r]:!1}function Es(){return $u}var Kn=h({},xs,{key:function(r){if(r.key){var o=qu[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=Ea(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Hu[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Es,charCode:function(r){return r.type==="keypress"?Ea(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Ea(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Wu=zn(Kn),Gu=h({},go,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qi=zn(Gu),b=h({},xs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Es}),C=zn(b),j=h({},Ui,{propertyName:0,elapsedTime:0,pseudoElement:0}),V=zn(j),ie=h({},go,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),he=zn(ie),Ve=h({},Ui,{newState:0,oldState:0}),ht=zn(Ve),dn=[9,13,27,32],It=Mr&&"CompositionEvent"in window,Zt=null;Mr&&"documentMode"in document&&(Zt=document.documentMode);var Rr=Mr&&"TextEvent"in window&&!Zt,Ti=Mr&&(!It||Zt&&8<Zt&&11>=Zt),Yr=" ",Kr=!1;function ja(r,o){switch(r){case"keyup":return dn.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yo(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var bo=!1;function wS(r,o){switch(r){case"compositionend":return yo(o);case"keypress":return o.which!==32?null:(Kr=!0,Yr);case"textInput":return r=o.data,r===Yr&&Kr?null:r;default:return null}}function _S(r,o){if(bo)return r==="compositionend"||!It&&ja(r,o)?(r=Gl(),Ta=Wl=Si=null,bo=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Ti&&o.locale!=="ko"?null:o.data;default:return null}}var xS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Pg(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!xS[r.type]:o==="textarea"}function zg(r,o,d,m){ws?bi?bi.push(m):bi=[m]:ws=m,o=Pd(o,"onChange"),0<o.length&&(d=new wi("onChange","change",null,d,m),r.push({event:d,listeners:o}))}var Kl=null,Jl=null;function TS(r){bv(r,0)}function Qu(r){var o=dr(r);if(Sa(o))return r}function Og(r,o){if(r==="change")return o}var Vg=!1;if(Mr){var Ch;if(Mr){var Ah="oninput"in document;if(!Ah){var Bg=document.createElement("div");Bg.setAttribute("oninput","return;"),Ah=typeof Bg.oninput=="function"}Ch=Ah}else Ch=!1;Vg=Ch&&(!document.documentMode||9<document.documentMode)}function Ug(){Kl&&(Kl.detachEvent("onpropertychange",qg),Jl=Kl=null)}function qg(r){if(r.propertyName==="value"&&Qu(Jl)){var o=[];zg(o,Jl,r,jr(r)),_s(TS,o)}}function ES(r,o,d){r==="focusin"?(Ug(),Kl=o,Jl=d,Kl.attachEvent("onpropertychange",qg)):r==="focusout"&&Ug()}function CS(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Qu(Jl)}function AS(r,o){if(r==="click")return Qu(o)}function jS(r,o){if(r==="input"||r==="change")return Qu(o)}function MS(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var hr=typeof Object.is=="function"?Object.is:MS;function Zl(r,o){if(hr(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var d=Object.keys(r),m=Object.keys(o);if(d.length!==m.length)return!1;for(m=0;m<d.length;m++){var S=d[m];if(!me.call(o,S)||!hr(r[S],o[S]))return!1}return!0}function Hg(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Fg(r,o){var d=Hg(r);r=0;for(var m;d;){if(d.nodeType===3){if(m=r+d.textContent.length,r<=o&&m>=o)return{node:d,offset:o-r};r=m}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Hg(d)}}function $g(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?$g(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function Wg(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var o=yi(r.document);o instanceof r.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)r=o.contentWindow;else break;o=yi(r.document)}return o}function jh(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}var RS=Mr&&"documentMode"in document&&11>=document.documentMode,So=null,Mh=null,ec=null,Rh=!1;function Gg(r,o,d){var m=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Rh||So==null||So!==yi(m)||(m=So,"selectionStart"in m&&jh(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),ec&&Zl(ec,m)||(ec=m,m=Pd(Mh,"onSelect"),0<m.length&&(o=new wi("onSelect","select",null,o,d),r.push({event:o,listeners:m}),o.target=So)))}function Ma(r,o){var d={};return d[r.toLowerCase()]=o.toLowerCase(),d["Webkit"+r]="webkit"+o,d["Moz"+r]="moz"+o,d}var wo={animationend:Ma("Animation","AnimationEnd"),animationiteration:Ma("Animation","AnimationIteration"),animationstart:Ma("Animation","AnimationStart"),transitionrun:Ma("Transition","TransitionRun"),transitionstart:Ma("Transition","TransitionStart"),transitioncancel:Ma("Transition","TransitionCancel"),transitionend:Ma("Transition","TransitionEnd")},kh={},Qg={};Mr&&(Qg=document.createElement("div").style,"AnimationEvent"in window||(delete wo.animationend.animation,delete wo.animationiteration.animation,delete wo.animationstart.animation),"TransitionEvent"in window||delete wo.transitionend.transition);function Ra(r){if(kh[r])return kh[r];if(!wo[r])return r;var o=wo[r],d;for(d in o)if(o.hasOwnProperty(d)&&d in Qg)return kh[r]=o[d];return r}var Xg=Ra("animationend"),Yg=Ra("animationiteration"),Kg=Ra("animationstart"),kS=Ra("transitionrun"),IS=Ra("transitionstart"),DS=Ra("transitioncancel"),Jg=Ra("transitionend"),Zg=new Map,Ih="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ih.push("scrollEnd");function Jr(r,o){Zg.set(r,o),gi(o,[r])}var Xu=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},kr=[],_o=0,Dh=0;function Yu(){for(var r=_o,o=Dh=_o=0;o<r;){var d=kr[o];kr[o++]=null;var m=kr[o];kr[o++]=null;var S=kr[o];kr[o++]=null;var w=kr[o];if(kr[o++]=null,m!==null&&S!==null){var A=m.pending;A===null?S.next=S:(S.next=A.next,A.next=S),m.pending=S}w!==0&&e1(d,S,w)}}function Ku(r,o,d,m){kr[_o++]=r,kr[_o++]=o,kr[_o++]=d,kr[_o++]=m,Dh|=m,r.lanes|=m,r=r.alternate,r!==null&&(r.lanes|=m)}function Nh(r,o,d,m){return Ku(r,o,d,m),Ju(r)}function ka(r,o){return Ku(r,null,null,o),Ju(r)}function e1(r,o,d){r.lanes|=d;var m=r.alternate;m!==null&&(m.lanes|=d);for(var S=!1,w=r.return;w!==null;)w.childLanes|=d,m=w.alternate,m!==null&&(m.childLanes|=d),w.tag===22&&(r=w.stateNode,r===null||r._visibility&1||(S=!0)),r=w,w=w.return;return r.tag===3?(w=r.stateNode,S&&o!==null&&(S=31-$e(d),r=w.hiddenUpdates,m=r[S],m===null?r[S]=[o]:m.push(o),o.lane=d|536870912),w):null}function Ju(r){if(50<_c)throw _c=0,H0=null,Error(s(185));for(var o=r.return;o!==null;)r=o,o=r.return;return r.tag===3?r.stateNode:null}var xo={};function NS(r,o,d,m){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pr(r,o,d,m){return new NS(r,o,d,m)}function Lh(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Hi(r,o){var d=r.alternate;return d===null?(d=pr(r.tag,o,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=o,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&65011712,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,o=r.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d.refCleanup=r.refCleanup,d}function t1(r,o){r.flags&=65011714;var d=r.alternate;return d===null?(r.childLanes=0,r.lanes=o,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=d.childLanes,r.lanes=d.lanes,r.child=d.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=d.memoizedProps,r.memoizedState=d.memoizedState,r.updateQueue=d.updateQueue,r.type=d.type,o=d.dependencies,r.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),r}function Zu(r,o,d,m,S,w){var A=0;if(m=r,typeof r=="function")Lh(r)&&(A=1);else if(typeof r=="string")A=Vw(r,d,fe.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case N:return r=pr(31,d,o,S),r.elementType=N,r.lanes=w,r;case _:return Ia(d.children,S,w,o);case E:A=8,S|=24;break;case R:return r=pr(12,d,o,S|2),r.elementType=R,r.lanes=w,r;case Q:return r=pr(13,d,o,S),r.elementType=Q,r.lanes=w,r;case K:return r=pr(19,d,o,S),r.elementType=K,r.lanes=w,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case B:A=10;break e;case P:A=9;break e;case X:A=11;break e;case k:A=14;break e;case I:A=16,m=null;break e}A=29,d=Error(s(130,r===null?"null":typeof r,"")),m=null}return o=pr(A,d,o,S),o.elementType=r,o.type=m,o.lanes=w,o}function Ia(r,o,d,m){return r=pr(7,r,m,o),r.lanes=d,r}function Ph(r,o,d){return r=pr(6,r,null,o),r.lanes=d,r}function n1(r){var o=pr(18,null,null,0);return o.stateNode=r,o}function zh(r,o,d){return o=pr(4,r.children!==null?r.children:[],r.key,o),o.lanes=d,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}var r1=new WeakMap;function Ir(r,o){if(typeof r=="object"&&r!==null){var d=r1.get(r);return d!==void 0?d:(o={value:r,source:o,stack:ge(o)},r1.set(r,o),o)}return{value:r,source:o,stack:ge(o)}}var To=[],Eo=0,ed=null,tc=0,Dr=[],Nr=0,Cs=null,Ei=1,Ci="";function Fi(r,o){To[Eo++]=tc,To[Eo++]=ed,ed=r,tc=o}function i1(r,o,d){Dr[Nr++]=Ei,Dr[Nr++]=Ci,Dr[Nr++]=Cs,Cs=r;var m=Ei;r=Ci;var S=32-$e(m)-1;m&=~(1<<S),d+=1;var w=32-$e(o)+S;if(30<w){var A=S-S%5;w=(m&(1<<A)-1).toString(32),m>>=A,S-=A,Ei=1<<32-$e(o)+S|d<<S|m,Ci=w+r}else Ei=1<<w|d<<S|m,Ci=r}function Oh(r){r.return!==null&&(Fi(r,1),i1(r,1,0))}function Vh(r){for(;r===ed;)ed=To[--Eo],To[Eo]=null,tc=To[--Eo],To[Eo]=null;for(;r===Cs;)Cs=Dr[--Nr],Dr[Nr]=null,Ci=Dr[--Nr],Dr[Nr]=null,Ei=Dr[--Nr],Dr[Nr]=null}function s1(r,o){Dr[Nr++]=Ei,Dr[Nr++]=Ci,Dr[Nr++]=Cs,Ei=o.id,Ci=o.overflow,Cs=r}var On=null,Gt=null,Tt=!1,As=null,Lr=!1,Bh=Error(s(519));function js(r){var o=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw nc(Ir(o,r)),Bh}function a1(r){var o=r.stateNode,d=r.type,m=r.memoizedProps;switch(o[gn]=r,o[Rn]=m,d){case"dialog":vt("cancel",o),vt("close",o);break;case"iframe":case"object":case"embed":vt("load",o);break;case"video":case"audio":for(d=0;d<Tc.length;d++)vt(Tc[d],o);break;case"source":vt("error",o);break;case"img":case"image":case"link":vt("error",o),vt("load",o);break;case"details":vt("toggle",o);break;case"input":vt("invalid",o),Du(o,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":vt("invalid",o);break;case"textarea":vt("invalid",o),bs(o,m.value,m.defaultValue,m.children)}d=m.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||o.textContent===""+d||m.suppressHydrationWarning===!0||xv(o.textContent,d)?(m.popover!=null&&(vt("beforetoggle",o),vt("toggle",o)),m.onScroll!=null&&vt("scroll",o),m.onScrollEnd!=null&&vt("scrollend",o),m.onClick!=null&&(o.onclick=Gr),o=!0):o=!1,o||js(r,!0)}function o1(r){for(On=r.return;On;)switch(On.tag){case 5:case 31:case 13:Lr=!1;return;case 27:case 3:Lr=!0;return;default:On=On.return}}function Co(r){if(r!==On)return!1;if(!Tt)return o1(r),Tt=!0,!1;var o=r.tag,d;if((d=o!==3&&o!==27)&&((d=o===5)&&(d=r.type,d=!(d!=="form"&&d!=="button")||ip(r.type,r.memoizedProps)),d=!d),d&&Gt&&js(r),o1(r),o===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(s(317));Gt=Iv(r)}else if(o===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(s(317));Gt=Iv(r)}else o===27?(o=Gt,qs(r.type)?(r=cp,cp=null,Gt=r):Gt=o):Gt=On?zr(r.stateNode.nextSibling):null;return!0}function Da(){Gt=On=null,Tt=!1}function Uh(){var r=As;return r!==null&&(ar===null?ar=r:ar.push.apply(ar,r),As=null),r}function nc(r){As===null?As=[r]:As.push(r)}var qh=H(null),Na=null,$i=null;function Ms(r,o,d){te(qh,o._currentValue),o._currentValue=d}function Wi(r){r._currentValue=qh.current,Z(qh)}function Hh(r,o,d){for(;r!==null;){var m=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),r===d)break;r=r.return}}function Fh(r,o,d,m){var S=r.child;for(S!==null&&(S.return=r);S!==null;){var w=S.dependencies;if(w!==null){var A=S.child;w=w.firstContext;e:for(;w!==null;){var L=w;w=S;for(var G=0;G<o.length;G++)if(L.context===o[G]){w.lanes|=d,L=w.alternate,L!==null&&(L.lanes|=d),Hh(w.return,d,r),m||(A=null);break e}w=L.next}}else if(S.tag===18){if(A=S.return,A===null)throw Error(s(341));A.lanes|=d,w=A.alternate,w!==null&&(w.lanes|=d),Hh(A,d,r),A=null}else A=S.child;if(A!==null)A.return=S;else for(A=S;A!==null;){if(A===r){A=null;break}if(S=A.sibling,S!==null){S.return=A.return,A=S;break}A=A.return}S=A}}function Ao(r,o,d,m){r=null;for(var S=o,w=!1;S!==null;){if(!w){if((S.flags&524288)!==0)w=!0;else if((S.flags&262144)!==0)break}if(S.tag===10){var A=S.alternate;if(A===null)throw Error(s(387));if(A=A.memoizedProps,A!==null){var L=S.type;hr(S.pendingProps.value,A.value)||(r!==null?r.push(L):r=[L])}}else if(S===xe.current){if(A=S.alternate,A===null)throw Error(s(387));A.memoizedState.memoizedState!==S.memoizedState.memoizedState&&(r!==null?r.push(Mc):r=[Mc])}S=S.return}r!==null&&Fh(o,r,d,m),o.flags|=262144}function td(r){for(r=r.firstContext;r!==null;){if(!hr(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function La(r){Na=r,$i=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Vn(r){return l1(Na,r)}function nd(r,o){return Na===null&&La(r),l1(r,o)}function l1(r,o){var d=o._currentValue;if(o={context:o,memoizedValue:d,next:null},$i===null){if(r===null)throw Error(s(308));$i=o,r.dependencies={lanes:0,firstContext:o},r.flags|=524288}else $i=$i.next=o;return d}var LS=typeof AbortController<"u"?AbortController:function(){var r=[],o=this.signal={aborted:!1,addEventListener:function(d,m){r.push(m)}};this.abort=function(){o.aborted=!0,r.forEach(function(d){return d()})}},PS=e.unstable_scheduleCallback,zS=e.unstable_NormalPriority,bn={$$typeof:B,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function $h(){return{controller:new LS,data:new Map,refCount:0}}function rc(r){r.refCount--,r.refCount===0&&PS(zS,function(){r.controller.abort()})}var ic=null,Wh=0,jo=0,Mo=null;function OS(r,o){if(ic===null){var d=ic=[];Wh=0,jo=X0(),Mo={status:"pending",value:void 0,then:function(m){d.push(m)}}}return Wh++,o.then(c1,c1),o}function c1(){if(--Wh===0&&ic!==null){Mo!==null&&(Mo.status="fulfilled");var r=ic;ic=null,jo=0,Mo=null;for(var o=0;o<r.length;o++)(0,r[o])()}}function VS(r,o){var d=[],m={status:"pending",value:null,reason:null,then:function(S){d.push(S)}};return r.then(function(){m.status="fulfilled",m.value=o;for(var S=0;S<d.length;S++)(0,d[S])(o)},function(S){for(m.status="rejected",m.reason=S,S=0;S<d.length;S++)(0,d[S])(void 0)}),m}var u1=W.S;W.S=function(r,o){G2=Ge(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&OS(r,o),u1!==null&&u1(r,o)};var Pa=H(null);function Gh(){var r=Pa.current;return r!==null?r:$t.pooledCache}function rd(r,o){o===null?te(Pa,Pa.current):te(Pa,o.pool)}function d1(){var r=Gh();return r===null?null:{parent:bn._currentValue,pool:r}}var Ro=Error(s(460)),Qh=Error(s(474)),id=Error(s(542)),sd={then:function(){}};function f1(r){return r=r.status,r==="fulfilled"||r==="rejected"}function h1(r,o,d){switch(d=r[d],d===void 0?r.push(o):d!==o&&(o.then(Gr,Gr),o=d),o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,m1(r),r;default:if(typeof o.status=="string")o.then(Gr,Gr);else{if(r=$t,r!==null&&100<r.shellSuspendCounter)throw Error(s(482));r=o,r.status="pending",r.then(function(m){if(o.status==="pending"){var S=o;S.status="fulfilled",S.value=m}},function(m){if(o.status==="pending"){var S=o;S.status="rejected",S.reason=m}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,m1(r),r}throw Oa=o,Ro}}function za(r){try{var o=r._init;return o(r._payload)}catch(d){throw d!==null&&typeof d=="object"&&typeof d.then=="function"?(Oa=d,Ro):d}}var Oa=null;function p1(){if(Oa===null)throw Error(s(459));var r=Oa;return Oa=null,r}function m1(r){if(r===Ro||r===id)throw Error(s(483))}var ko=null,sc=0;function ad(r){var o=sc;return sc+=1,ko===null&&(ko=[]),h1(ko,r,o)}function ac(r,o){o=o.props.ref,r.ref=o!==void 0?o:null}function od(r,o){throw o.$$typeof===y?Error(s(525)):(r=Object.prototype.toString.call(o),Error(s(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r)))}function g1(r){function o(ne,Y){if(r){var ae=ne.deletions;ae===null?(ne.deletions=[Y],ne.flags|=16):ae.push(Y)}}function d(ne,Y){if(!r)return null;for(;Y!==null;)o(ne,Y),Y=Y.sibling;return null}function m(ne){for(var Y=new Map;ne!==null;)ne.key!==null?Y.set(ne.key,ne):Y.set(ne.index,ne),ne=ne.sibling;return Y}function S(ne,Y){return ne=Hi(ne,Y),ne.index=0,ne.sibling=null,ne}function w(ne,Y,ae){return ne.index=ae,r?(ae=ne.alternate,ae!==null?(ae=ae.index,ae<Y?(ne.flags|=67108866,Y):ae):(ne.flags|=67108866,Y)):(ne.flags|=1048576,Y)}function A(ne){return r&&ne.alternate===null&&(ne.flags|=67108866),ne}function L(ne,Y,ae,Ee){return Y===null||Y.tag!==6?(Y=Ph(ae,ne.mode,Ee),Y.return=ne,Y):(Y=S(Y,ae),Y.return=ne,Y)}function G(ne,Y,ae,Ee){var tt=ae.type;return tt===_?ye(ne,Y,ae.props.children,Ee,ae.key):Y!==null&&(Y.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===I&&za(tt)===Y.type)?(Y=S(Y,ae.props),ac(Y,ae),Y.return=ne,Y):(Y=Zu(ae.type,ae.key,ae.props,null,ne.mode,Ee),ac(Y,ae),Y.return=ne,Y)}function oe(ne,Y,ae,Ee){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==ae.containerInfo||Y.stateNode.implementation!==ae.implementation?(Y=zh(ae,ne.mode,Ee),Y.return=ne,Y):(Y=S(Y,ae.children||[]),Y.return=ne,Y)}function ye(ne,Y,ae,Ee,tt){return Y===null||Y.tag!==7?(Y=Ia(ae,ne.mode,Ee,tt),Y.return=ne,Y):(Y=S(Y,ae),Y.return=ne,Y)}function Ae(ne,Y,ae){if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return Y=Ph(""+Y,ne.mode,ae),Y.return=ne,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case x:return ae=Zu(Y.type,Y.key,Y.props,null,ne.mode,ae),ac(ae,Y),ae.return=ne,ae;case T:return Y=zh(Y,ne.mode,ae),Y.return=ne,Y;case I:return Y=za(Y),Ae(ne,Y,ae)}if(je(Y)||q(Y))return Y=Ia(Y,ne.mode,ae,null),Y.return=ne,Y;if(typeof Y.then=="function")return Ae(ne,ad(Y),ae);if(Y.$$typeof===B)return Ae(ne,nd(ne,Y),ae);od(ne,Y)}return null}function ue(ne,Y,ae,Ee){var tt=Y!==null?Y.key:null;if(typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint")return tt!==null?null:L(ne,Y,""+ae,Ee);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case x:return ae.key===tt?G(ne,Y,ae,Ee):null;case T:return ae.key===tt?oe(ne,Y,ae,Ee):null;case I:return ae=za(ae),ue(ne,Y,ae,Ee)}if(je(ae)||q(ae))return tt!==null?null:ye(ne,Y,ae,Ee,null);if(typeof ae.then=="function")return ue(ne,Y,ad(ae),Ee);if(ae.$$typeof===B)return ue(ne,Y,nd(ne,ae),Ee);od(ne,ae)}return null}function pe(ne,Y,ae,Ee,tt){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return ne=ne.get(ae)||null,L(Y,ne,""+Ee,tt);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case x:return ne=ne.get(Ee.key===null?ae:Ee.key)||null,G(Y,ne,Ee,tt);case T:return ne=ne.get(Ee.key===null?ae:Ee.key)||null,oe(Y,ne,Ee,tt);case I:return Ee=za(Ee),pe(ne,Y,ae,Ee,tt)}if(je(Ee)||q(Ee))return ne=ne.get(ae)||null,ye(Y,ne,Ee,tt,null);if(typeof Ee.then=="function")return pe(ne,Y,ae,ad(Ee),tt);if(Ee.$$typeof===B)return pe(ne,Y,ae,nd(Y,Ee),tt);od(Y,Ee)}return null}function Qe(ne,Y,ae,Ee){for(var tt=null,Rt=null,Ke=Y,mt=Y=0,bt=null;Ke!==null&&mt<ae.length;mt++){Ke.index>mt?(bt=Ke,Ke=null):bt=Ke.sibling;var kt=ue(ne,Ke,ae[mt],Ee);if(kt===null){Ke===null&&(Ke=bt);break}r&&Ke&&kt.alternate===null&&o(ne,Ke),Y=w(kt,Y,mt),Rt===null?tt=kt:Rt.sibling=kt,Rt=kt,Ke=bt}if(mt===ae.length)return d(ne,Ke),Tt&&Fi(ne,mt),tt;if(Ke===null){for(;mt<ae.length;mt++)Ke=Ae(ne,ae[mt],Ee),Ke!==null&&(Y=w(Ke,Y,mt),Rt===null?tt=Ke:Rt.sibling=Ke,Rt=Ke);return Tt&&Fi(ne,mt),tt}for(Ke=m(Ke);mt<ae.length;mt++)bt=pe(Ke,ne,mt,ae[mt],Ee),bt!==null&&(r&&bt.alternate!==null&&Ke.delete(bt.key===null?mt:bt.key),Y=w(bt,Y,mt),Rt===null?tt=bt:Rt.sibling=bt,Rt=bt);return r&&Ke.forEach(function(Gs){return o(ne,Gs)}),Tt&&Fi(ne,mt),tt}function st(ne,Y,ae,Ee){if(ae==null)throw Error(s(151));for(var tt=null,Rt=null,Ke=Y,mt=Y=0,bt=null,kt=ae.next();Ke!==null&&!kt.done;mt++,kt=ae.next()){Ke.index>mt?(bt=Ke,Ke=null):bt=Ke.sibling;var Gs=ue(ne,Ke,kt.value,Ee);if(Gs===null){Ke===null&&(Ke=bt);break}r&&Ke&&Gs.alternate===null&&o(ne,Ke),Y=w(Gs,Y,mt),Rt===null?tt=Gs:Rt.sibling=Gs,Rt=Gs,Ke=bt}if(kt.done)return d(ne,Ke),Tt&&Fi(ne,mt),tt;if(Ke===null){for(;!kt.done;mt++,kt=ae.next())kt=Ae(ne,kt.value,Ee),kt!==null&&(Y=w(kt,Y,mt),Rt===null?tt=kt:Rt.sibling=kt,Rt=kt);return Tt&&Fi(ne,mt),tt}for(Ke=m(Ke);!kt.done;mt++,kt=ae.next())kt=pe(Ke,ne,mt,kt.value,Ee),kt!==null&&(r&&kt.alternate!==null&&Ke.delete(kt.key===null?mt:kt.key),Y=w(kt,Y,mt),Rt===null?tt=kt:Rt.sibling=kt,Rt=kt);return r&&Ke.forEach(function(Yw){return o(ne,Yw)}),Tt&&Fi(ne,mt),tt}function Ht(ne,Y,ae,Ee){if(typeof ae=="object"&&ae!==null&&ae.type===_&&ae.key===null&&(ae=ae.props.children),typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case x:e:{for(var tt=ae.key;Y!==null;){if(Y.key===tt){if(tt=ae.type,tt===_){if(Y.tag===7){d(ne,Y.sibling),Ee=S(Y,ae.props.children),Ee.return=ne,ne=Ee;break e}}else if(Y.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===I&&za(tt)===Y.type){d(ne,Y.sibling),Ee=S(Y,ae.props),ac(Ee,ae),Ee.return=ne,ne=Ee;break e}d(ne,Y);break}else o(ne,Y);Y=Y.sibling}ae.type===_?(Ee=Ia(ae.props.children,ne.mode,Ee,ae.key),Ee.return=ne,ne=Ee):(Ee=Zu(ae.type,ae.key,ae.props,null,ne.mode,Ee),ac(Ee,ae),Ee.return=ne,ne=Ee)}return A(ne);case T:e:{for(tt=ae.key;Y!==null;){if(Y.key===tt)if(Y.tag===4&&Y.stateNode.containerInfo===ae.containerInfo&&Y.stateNode.implementation===ae.implementation){d(ne,Y.sibling),Ee=S(Y,ae.children||[]),Ee.return=ne,ne=Ee;break e}else{d(ne,Y);break}else o(ne,Y);Y=Y.sibling}Ee=zh(ae,ne.mode,Ee),Ee.return=ne,ne=Ee}return A(ne);case I:return ae=za(ae),Ht(ne,Y,ae,Ee)}if(je(ae))return Qe(ne,Y,ae,Ee);if(q(ae)){if(tt=q(ae),typeof tt!="function")throw Error(s(150));return ae=tt.call(ae),st(ne,Y,ae,Ee)}if(typeof ae.then=="function")return Ht(ne,Y,ad(ae),Ee);if(ae.$$typeof===B)return Ht(ne,Y,nd(ne,ae),Ee);od(ne,ae)}return typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint"?(ae=""+ae,Y!==null&&Y.tag===6?(d(ne,Y.sibling),Ee=S(Y,ae),Ee.return=ne,ne=Ee):(d(ne,Y),Ee=Ph(ae,ne.mode,Ee),Ee.return=ne,ne=Ee),A(ne)):d(ne,Y)}return function(ne,Y,ae,Ee){try{sc=0;var tt=Ht(ne,Y,ae,Ee);return ko=null,tt}catch(Ke){if(Ke===Ro||Ke===id)throw Ke;var Rt=pr(29,Ke,null,ne.mode);return Rt.lanes=Ee,Rt.return=ne,Rt}}}var Va=g1(!0),v1=g1(!1),Rs=!1;function Xh(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Yh(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function ks(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Is(r,o,d){var m=r.updateQueue;if(m===null)return null;if(m=m.shared,(Dt&2)!==0){var S=m.pending;return S===null?o.next=o:(o.next=S.next,S.next=o),m.pending=o,o=Ju(r),e1(r,null,d),o}return Ku(r,m,o,d),Ju(r)}function oc(r,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194048)!==0)){var m=o.lanes;m&=r.pendingLanes,d|=m,o.lanes=d,Nl(r,d)}}function Kh(r,o){var d=r.updateQueue,m=r.alternate;if(m!==null&&(m=m.updateQueue,d===m)){var S=null,w=null;if(d=d.firstBaseUpdate,d!==null){do{var A={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};w===null?S=w=A:w=w.next=A,d=d.next}while(d!==null);w===null?S=w=o:w=w.next=o}else S=w=o;d={baseState:m.baseState,firstBaseUpdate:S,lastBaseUpdate:w,shared:m.shared,callbacks:m.callbacks},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=o:r.next=o,d.lastBaseUpdate=o}var Jh=!1;function lc(){if(Jh){var r=Mo;if(r!==null)throw r}}function cc(r,o,d,m){Jh=!1;var S=r.updateQueue;Rs=!1;var w=S.firstBaseUpdate,A=S.lastBaseUpdate,L=S.shared.pending;if(L!==null){S.shared.pending=null;var G=L,oe=G.next;G.next=null,A===null?w=oe:A.next=oe,A=G;var ye=r.alternate;ye!==null&&(ye=ye.updateQueue,L=ye.lastBaseUpdate,L!==A&&(L===null?ye.firstBaseUpdate=oe:L.next=oe,ye.lastBaseUpdate=G))}if(w!==null){var Ae=S.baseState;A=0,ye=oe=G=null,L=w;do{var ue=L.lane&-536870913,pe=ue!==L.lane;if(pe?(yt&ue)===ue:(m&ue)===ue){ue!==0&&ue===jo&&(Jh=!0),ye!==null&&(ye=ye.next={lane:0,tag:L.tag,payload:L.payload,callback:null,next:null});e:{var Qe=r,st=L;ue=o;var Ht=d;switch(st.tag){case 1:if(Qe=st.payload,typeof Qe=="function"){Ae=Qe.call(Ht,Ae,ue);break e}Ae=Qe;break e;case 3:Qe.flags=Qe.flags&-65537|128;case 0:if(Qe=st.payload,ue=typeof Qe=="function"?Qe.call(Ht,Ae,ue):Qe,ue==null)break e;Ae=h({},Ae,ue);break e;case 2:Rs=!0}}ue=L.callback,ue!==null&&(r.flags|=64,pe&&(r.flags|=8192),pe=S.callbacks,pe===null?S.callbacks=[ue]:pe.push(ue))}else pe={lane:ue,tag:L.tag,payload:L.payload,callback:L.callback,next:null},ye===null?(oe=ye=pe,G=Ae):ye=ye.next=pe,A|=ue;if(L=L.next,L===null){if(L=S.shared.pending,L===null)break;pe=L,L=pe.next,pe.next=null,S.lastBaseUpdate=pe,S.shared.pending=null}}while(!0);ye===null&&(G=Ae),S.baseState=G,S.firstBaseUpdate=oe,S.lastBaseUpdate=ye,w===null&&(S.shared.lanes=0),zs|=A,r.lanes=A,r.memoizedState=Ae}}function y1(r,o){if(typeof r!="function")throw Error(s(191,r));r.call(o)}function b1(r,o){var d=r.callbacks;if(d!==null)for(r.callbacks=null,r=0;r<d.length;r++)y1(d[r],o)}var Io=H(null),ld=H(0);function S1(r,o){r=ts,te(ld,r),te(Io,o),ts=r|o.baseLanes}function Zh(){te(ld,ts),te(Io,Io.current)}function e0(){ts=ld.current,Z(Io),Z(ld)}var mr=H(null),Pr=null;function Ds(r){var o=r.alternate;te(fn,fn.current&1),te(mr,r),Pr===null&&(o===null||Io.current!==null||o.memoizedState!==null)&&(Pr=r)}function t0(r){te(fn,fn.current),te(mr,r),Pr===null&&(Pr=r)}function w1(r){r.tag===22?(te(fn,fn.current),te(mr,r),Pr===null&&(Pr=r)):Ns()}function Ns(){te(fn,fn.current),te(mr,mr.current)}function gr(r){Z(mr),Pr===r&&(Pr=null),Z(fn)}var fn=H(0);function cd(r){for(var o=r;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||op(d)||lp(d)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Gi=0,pt=null,Ut=null,Sn=null,ud=!1,Do=!1,Ba=!1,dd=0,uc=0,No=null,BS=0;function ln(){throw Error(s(321))}function n0(r,o){if(o===null)return!1;for(var d=0;d<o.length&&d<r.length;d++)if(!hr(r[d],o[d]))return!1;return!0}function r0(r,o,d,m,S,w){return Gi=w,pt=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,W.H=r===null||r.memoizedState===null?i2:y0,Ba=!1,w=d(m,S),Ba=!1,Do&&(w=x1(o,d,m,S)),_1(r),w}function _1(r){W.H=hc;var o=Ut!==null&&Ut.next!==null;if(Gi=0,Sn=Ut=pt=null,ud=!1,uc=0,No=null,o)throw Error(s(300));r===null||wn||(r=r.dependencies,r!==null&&td(r)&&(wn=!0))}function x1(r,o,d,m){pt=r;var S=0;do{if(Do&&(No=null),uc=0,Do=!1,25<=S)throw Error(s(301));if(S+=1,Sn=Ut=null,r.updateQueue!=null){var w=r.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}W.H=s2,w=o(d,m)}while(Do);return w}function US(){var r=W.H,o=r.useState()[0];return o=typeof o.then=="function"?dc(o):o,r=r.useState()[0],(Ut!==null?Ut.memoizedState:null)!==r&&(pt.flags|=1024),o}function i0(){var r=dd!==0;return dd=0,r}function s0(r,o,d){o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~d}function a0(r){if(ud){for(r=r.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}ud=!1}Gi=0,Sn=Ut=pt=null,Do=!1,uc=dd=0,No=null}function Jn(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Sn===null?pt.memoizedState=Sn=r:Sn=Sn.next=r,Sn}function hn(){if(Ut===null){var r=pt.alternate;r=r!==null?r.memoizedState:null}else r=Ut.next;var o=Sn===null?pt.memoizedState:Sn.next;if(o!==null)Sn=o,Ut=r;else{if(r===null)throw pt.alternate===null?Error(s(467)):Error(s(310));Ut=r,r={memoizedState:Ut.memoizedState,baseState:Ut.baseState,baseQueue:Ut.baseQueue,queue:Ut.queue,next:null},Sn===null?pt.memoizedState=Sn=r:Sn=Sn.next=r}return Sn}function fd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function dc(r){var o=uc;return uc+=1,No===null&&(No=[]),r=h1(No,r,o),o=pt,(Sn===null?o.memoizedState:Sn.next)===null&&(o=o.alternate,W.H=o===null||o.memoizedState===null?i2:y0),r}function hd(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return dc(r);if(r.$$typeof===B)return Vn(r)}throw Error(s(438,String(r)))}function o0(r){var o=null,d=pt.updateQueue;if(d!==null&&(o=d.memoCache),o==null){var m=pt.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(o={data:m.data.map(function(S){return S.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),d===null&&(d=fd(),pt.updateQueue=d),d.memoCache=o,d=o.data[o.index],d===void 0)for(d=o.data[o.index]=Array(r),m=0;m<r;m++)d[m]=U;return o.index++,d}function Qi(r,o){return typeof o=="function"?o(r):o}function pd(r){var o=hn();return l0(o,Ut,r)}function l0(r,o,d){var m=r.queue;if(m===null)throw Error(s(311));m.lastRenderedReducer=d;var S=r.baseQueue,w=m.pending;if(w!==null){if(S!==null){var A=S.next;S.next=w.next,w.next=A}o.baseQueue=S=w,m.pending=null}if(w=r.baseState,S===null)r.memoizedState=w;else{o=S.next;var L=A=null,G=null,oe=o,ye=!1;do{var Ae=oe.lane&-536870913;if(Ae!==oe.lane?(yt&Ae)===Ae:(Gi&Ae)===Ae){var ue=oe.revertLane;if(ue===0)G!==null&&(G=G.next={lane:0,revertLane:0,gesture:null,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null}),Ae===jo&&(ye=!0);else if((Gi&ue)===ue){oe=oe.next,ue===jo&&(ye=!0);continue}else Ae={lane:0,revertLane:oe.revertLane,gesture:null,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null},G===null?(L=G=Ae,A=w):G=G.next=Ae,pt.lanes|=ue,zs|=ue;Ae=oe.action,Ba&&d(w,Ae),w=oe.hasEagerState?oe.eagerState:d(w,Ae)}else ue={lane:Ae,revertLane:oe.revertLane,gesture:oe.gesture,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null},G===null?(L=G=ue,A=w):G=G.next=ue,pt.lanes|=Ae,zs|=Ae;oe=oe.next}while(oe!==null&&oe!==o);if(G===null?A=w:G.next=L,!hr(w,r.memoizedState)&&(wn=!0,ye&&(d=Mo,d!==null)))throw d;r.memoizedState=w,r.baseState=A,r.baseQueue=G,m.lastRenderedState=w}return S===null&&(m.lanes=0),[r.memoizedState,m.dispatch]}function c0(r){var o=hn(),d=o.queue;if(d===null)throw Error(s(311));d.lastRenderedReducer=r;var m=d.dispatch,S=d.pending,w=o.memoizedState;if(S!==null){d.pending=null;var A=S=S.next;do w=r(w,A.action),A=A.next;while(A!==S);hr(w,o.memoizedState)||(wn=!0),o.memoizedState=w,o.baseQueue===null&&(o.baseState=w),d.lastRenderedState=w}return[w,m]}function T1(r,o,d){var m=pt,S=hn(),w=Tt;if(w){if(d===void 0)throw Error(s(407));d=d()}else d=o();var A=!hr((Ut||S).memoizedState,d);if(A&&(S.memoizedState=d,wn=!0),S=S.queue,f0(A1.bind(null,m,S,r),[r]),S.getSnapshot!==o||A||Sn!==null&&Sn.memoizedState.tag&1){if(m.flags|=2048,Lo(9,{destroy:void 0},C1.bind(null,m,S,d,o),null),$t===null)throw Error(s(349));w||(Gi&127)!==0||E1(m,o,d)}return d}function E1(r,o,d){r.flags|=16384,r={getSnapshot:o,value:d},o=pt.updateQueue,o===null?(o=fd(),pt.updateQueue=o,o.stores=[r]):(d=o.stores,d===null?o.stores=[r]:d.push(r))}function C1(r,o,d,m){o.value=d,o.getSnapshot=m,j1(o)&&M1(r)}function A1(r,o,d){return d(function(){j1(o)&&M1(r)})}function j1(r){var o=r.getSnapshot;r=r.value;try{var d=o();return!hr(r,d)}catch{return!0}}function M1(r){var o=ka(r,2);o!==null&&or(o,r,2)}function u0(r){var o=Jn();if(typeof r=="function"){var d=r;if(r=d(),Ba){ke(!0);try{d()}finally{ke(!1)}}}return o.memoizedState=o.baseState=r,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qi,lastRenderedState:r},o}function R1(r,o,d,m){return r.baseState=d,l0(r,Ut,typeof m=="function"?m:Qi)}function qS(r,o,d,m,S){if(vd(r))throw Error(s(485));if(r=o.action,r!==null){var w={payload:S,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(A){w.listeners.push(A)}};W.T!==null?d(!0):w.isTransition=!1,m(w),d=o.pending,d===null?(w.next=o.pending=w,k1(o,w)):(w.next=d.next,o.pending=d.next=w)}}function k1(r,o){var d=o.action,m=o.payload,S=r.state;if(o.isTransition){var w=W.T,A={};W.T=A;try{var L=d(S,m),G=W.S;G!==null&&G(A,L),I1(r,o,L)}catch(oe){d0(r,o,oe)}finally{w!==null&&A.types!==null&&(w.types=A.types),W.T=w}}else try{w=d(S,m),I1(r,o,w)}catch(oe){d0(r,o,oe)}}function I1(r,o,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(m){D1(r,o,m)},function(m){return d0(r,o,m)}):D1(r,o,d)}function D1(r,o,d){o.status="fulfilled",o.value=d,N1(o),r.state=d,o=r.pending,o!==null&&(d=o.next,d===o?r.pending=null:(d=d.next,o.next=d,k1(r,d)))}function d0(r,o,d){var m=r.pending;if(r.pending=null,m!==null){m=m.next;do o.status="rejected",o.reason=d,N1(o),o=o.next;while(o!==m)}r.action=null}function N1(r){r=r.listeners;for(var o=0;o<r.length;o++)(0,r[o])()}function L1(r,o){return o}function P1(r,o){if(Tt){var d=$t.formState;if(d!==null){e:{var m=pt;if(Tt){if(Gt){t:{for(var S=Gt,w=Lr;S.nodeType!==8;){if(!w){S=null;break t}if(S=zr(S.nextSibling),S===null){S=null;break t}}w=S.data,S=w==="F!"||w==="F"?S:null}if(S){Gt=zr(S.nextSibling),m=S.data==="F!";break e}}js(m)}m=!1}m&&(o=d[0])}}return d=Jn(),d.memoizedState=d.baseState=o,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:L1,lastRenderedState:o},d.queue=m,d=t2.bind(null,pt,m),m.dispatch=d,m=u0(!1),w=v0.bind(null,pt,!1,m.queue),m=Jn(),S={state:o,dispatch:null,action:r,pending:null},m.queue=S,d=qS.bind(null,pt,S,w,d),S.dispatch=d,m.memoizedState=r,[o,d,!1]}function z1(r){var o=hn();return O1(o,Ut,r)}function O1(r,o,d){if(o=l0(r,o,L1)[0],r=pd(Qi)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var m=dc(o)}catch(A){throw A===Ro?id:A}else m=o;o=hn();var S=o.queue,w=S.dispatch;return d!==o.memoizedState&&(pt.flags|=2048,Lo(9,{destroy:void 0},HS.bind(null,S,d),null)),[m,w,r]}function HS(r,o){r.action=o}function V1(r){var o=hn(),d=Ut;if(d!==null)return O1(o,d,r);hn(),o=o.memoizedState,d=hn();var m=d.queue.dispatch;return d.memoizedState=r,[o,m,!1]}function Lo(r,o,d,m){return r={tag:r,create:d,deps:m,inst:o,next:null},o=pt.updateQueue,o===null&&(o=fd(),pt.updateQueue=o),d=o.lastEffect,d===null?o.lastEffect=r.next=r:(m=d.next,d.next=r,r.next=m,o.lastEffect=r),r}function B1(){return hn().memoizedState}function md(r,o,d,m){var S=Jn();pt.flags|=r,S.memoizedState=Lo(1|o,{destroy:void 0},d,m===void 0?null:m)}function gd(r,o,d,m){var S=hn();m=m===void 0?null:m;var w=S.memoizedState.inst;Ut!==null&&m!==null&&n0(m,Ut.memoizedState.deps)?S.memoizedState=Lo(o,w,d,m):(pt.flags|=r,S.memoizedState=Lo(1|o,w,d,m))}function U1(r,o){md(8390656,8,r,o)}function f0(r,o){gd(2048,8,r,o)}function FS(r){pt.flags|=4;var o=pt.updateQueue;if(o===null)o=fd(),pt.updateQueue=o,o.events=[r];else{var d=o.events;d===null?o.events=[r]:d.push(r)}}function q1(r){var o=hn().memoizedState;return FS({ref:o,nextImpl:r}),function(){if((Dt&2)!==0)throw Error(s(440));return o.impl.apply(void 0,arguments)}}function H1(r,o){return gd(4,2,r,o)}function F1(r,o){return gd(4,4,r,o)}function $1(r,o){if(typeof o=="function"){r=r();var d=o(r);return function(){typeof d=="function"?d():o(null)}}if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function W1(r,o,d){d=d!=null?d.concat([r]):null,gd(4,4,$1.bind(null,o,r),d)}function h0(){}function G1(r,o){var d=hn();o=o===void 0?null:o;var m=d.memoizedState;return o!==null&&n0(o,m[1])?m[0]:(d.memoizedState=[r,o],r)}function Q1(r,o){var d=hn();o=o===void 0?null:o;var m=d.memoizedState;if(o!==null&&n0(o,m[1]))return m[0];if(m=r(),Ba){ke(!0);try{r()}finally{ke(!1)}}return d.memoizedState=[m,o],m}function p0(r,o,d){return d===void 0||(Gi&1073741824)!==0&&(yt&261930)===0?r.memoizedState=o:(r.memoizedState=d,r=X2(),pt.lanes|=r,zs|=r,d)}function X1(r,o,d,m){return hr(d,o)?d:Io.current!==null?(r=p0(r,d,m),hr(r,o)||(wn=!0),r):(Gi&42)===0||(Gi&1073741824)!==0&&(yt&261930)===0?(wn=!0,r.memoizedState=d):(r=X2(),pt.lanes|=r,zs|=r,o)}function Y1(r,o,d,m,S){var w=J.p;J.p=w!==0&&8>w?w:8;var A=W.T,L={};W.T=L,v0(r,!1,o,d);try{var G=S(),oe=W.S;if(oe!==null&&oe(L,G),G!==null&&typeof G=="object"&&typeof G.then=="function"){var ye=VS(G,m);fc(r,o,ye,br(r))}else fc(r,o,m,br(r))}catch(Ae){fc(r,o,{then:function(){},status:"rejected",reason:Ae},br())}finally{J.p=w,A!==null&&L.types!==null&&(A.types=L.types),W.T=A}}function $S(){}function m0(r,o,d,m){if(r.tag!==5)throw Error(s(476));var S=K1(r).queue;Y1(r,S,o,ve,d===null?$S:function(){return J1(r),d(m)})}function K1(r){var o=r.memoizedState;if(o!==null)return o;o={memoizedState:ve,baseState:ve,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qi,lastRenderedState:ve},next:null};var d={};return o.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qi,lastRenderedState:d},next:null},r.memoizedState=o,r=r.alternate,r!==null&&(r.memoizedState=o),o}function J1(r){var o=K1(r);o.next===null&&(o=r.alternate.memoizedState),fc(r,o.next.queue,{},br())}function g0(){return Vn(Mc)}function Z1(){return hn().memoizedState}function e2(){return hn().memoizedState}function WS(r){for(var o=r.return;o!==null;){switch(o.tag){case 24:case 3:var d=br();r=ks(d);var m=Is(o,r,d);m!==null&&(or(m,o,d),oc(m,o,d)),o={cache:$h()},r.payload=o;return}o=o.return}}function GS(r,o,d){var m=br();d={lane:m,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},vd(r)?n2(o,d):(d=Nh(r,o,d,m),d!==null&&(or(d,r,m),r2(d,o,m)))}function t2(r,o,d){var m=br();fc(r,o,d,m)}function fc(r,o,d,m){var S={lane:m,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null};if(vd(r))n2(o,S);else{var w=r.alternate;if(r.lanes===0&&(w===null||w.lanes===0)&&(w=o.lastRenderedReducer,w!==null))try{var A=o.lastRenderedState,L=w(A,d);if(S.hasEagerState=!0,S.eagerState=L,hr(L,A))return Ku(r,o,S,0),$t===null&&Yu(),!1}catch{}if(d=Nh(r,o,S,m),d!==null)return or(d,r,m),r2(d,o,m),!0}return!1}function v0(r,o,d,m){if(m={lane:2,revertLane:X0(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},vd(r)){if(o)throw Error(s(479))}else o=Nh(r,d,m,2),o!==null&&or(o,r,2)}function vd(r){var o=r.alternate;return r===pt||o!==null&&o===pt}function n2(r,o){Do=ud=!0;var d=r.pending;d===null?o.next=o:(o.next=d.next,d.next=o),r.pending=o}function r2(r,o,d){if((d&4194048)!==0){var m=o.lanes;m&=r.pendingLanes,d|=m,o.lanes=d,Nl(r,d)}}var hc={readContext:Vn,use:hd,useCallback:ln,useContext:ln,useEffect:ln,useImperativeHandle:ln,useLayoutEffect:ln,useInsertionEffect:ln,useMemo:ln,useReducer:ln,useRef:ln,useState:ln,useDebugValue:ln,useDeferredValue:ln,useTransition:ln,useSyncExternalStore:ln,useId:ln,useHostTransitionStatus:ln,useFormState:ln,useActionState:ln,useOptimistic:ln,useMemoCache:ln,useCacheRefresh:ln};hc.useEffectEvent=ln;var i2={readContext:Vn,use:hd,useCallback:function(r,o){return Jn().memoizedState=[r,o===void 0?null:o],r},useContext:Vn,useEffect:U1,useImperativeHandle:function(r,o,d){d=d!=null?d.concat([r]):null,md(4194308,4,$1.bind(null,o,r),d)},useLayoutEffect:function(r,o){return md(4194308,4,r,o)},useInsertionEffect:function(r,o){md(4,2,r,o)},useMemo:function(r,o){var d=Jn();o=o===void 0?null:o;var m=r();if(Ba){ke(!0);try{r()}finally{ke(!1)}}return d.memoizedState=[m,o],m},useReducer:function(r,o,d){var m=Jn();if(d!==void 0){var S=d(o);if(Ba){ke(!0);try{d(o)}finally{ke(!1)}}}else S=o;return m.memoizedState=m.baseState=S,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:S},m.queue=r,r=r.dispatch=GS.bind(null,pt,r),[m.memoizedState,r]},useRef:function(r){var o=Jn();return r={current:r},o.memoizedState=r},useState:function(r){r=u0(r);var o=r.queue,d=t2.bind(null,pt,o);return o.dispatch=d,[r.memoizedState,d]},useDebugValue:h0,useDeferredValue:function(r,o){var d=Jn();return p0(d,r,o)},useTransition:function(){var r=u0(!1);return r=Y1.bind(null,pt,r.queue,!0,!1),Jn().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,o,d){var m=pt,S=Jn();if(Tt){if(d===void 0)throw Error(s(407));d=d()}else{if(d=o(),$t===null)throw Error(s(349));(yt&127)!==0||E1(m,o,d)}S.memoizedState=d;var w={value:d,getSnapshot:o};return S.queue=w,U1(A1.bind(null,m,w,r),[r]),m.flags|=2048,Lo(9,{destroy:void 0},C1.bind(null,m,w,d,o),null),d},useId:function(){var r=Jn(),o=$t.identifierPrefix;if(Tt){var d=Ci,m=Ei;d=(m&~(1<<32-$e(m)-1)).toString(32)+d,o="_"+o+"R_"+d,d=dd++,0<d&&(o+="H"+d.toString(32)),o+="_"}else d=BS++,o="_"+o+"r_"+d.toString(32)+"_";return r.memoizedState=o},useHostTransitionStatus:g0,useFormState:P1,useActionState:P1,useOptimistic:function(r){var o=Jn();o.memoizedState=o.baseState=r;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=d,o=v0.bind(null,pt,!0,d),d.dispatch=o,[r,o]},useMemoCache:o0,useCacheRefresh:function(){return Jn().memoizedState=WS.bind(null,pt)},useEffectEvent:function(r){var o=Jn(),d={impl:r};return o.memoizedState=d,function(){if((Dt&2)!==0)throw Error(s(440));return d.impl.apply(void 0,arguments)}}},y0={readContext:Vn,use:hd,useCallback:G1,useContext:Vn,useEffect:f0,useImperativeHandle:W1,useInsertionEffect:H1,useLayoutEffect:F1,useMemo:Q1,useReducer:pd,useRef:B1,useState:function(){return pd(Qi)},useDebugValue:h0,useDeferredValue:function(r,o){var d=hn();return X1(d,Ut.memoizedState,r,o)},useTransition:function(){var r=pd(Qi)[0],o=hn().memoizedState;return[typeof r=="boolean"?r:dc(r),o]},useSyncExternalStore:T1,useId:Z1,useHostTransitionStatus:g0,useFormState:z1,useActionState:z1,useOptimistic:function(r,o){var d=hn();return R1(d,Ut,r,o)},useMemoCache:o0,useCacheRefresh:e2};y0.useEffectEvent=q1;var s2={readContext:Vn,use:hd,useCallback:G1,useContext:Vn,useEffect:f0,useImperativeHandle:W1,useInsertionEffect:H1,useLayoutEffect:F1,useMemo:Q1,useReducer:c0,useRef:B1,useState:function(){return c0(Qi)},useDebugValue:h0,useDeferredValue:function(r,o){var d=hn();return Ut===null?p0(d,r,o):X1(d,Ut.memoizedState,r,o)},useTransition:function(){var r=c0(Qi)[0],o=hn().memoizedState;return[typeof r=="boolean"?r:dc(r),o]},useSyncExternalStore:T1,useId:Z1,useHostTransitionStatus:g0,useFormState:V1,useActionState:V1,useOptimistic:function(r,o){var d=hn();return Ut!==null?R1(d,Ut,r,o):(d.baseState=r,[r,d.queue.dispatch])},useMemoCache:o0,useCacheRefresh:e2};s2.useEffectEvent=q1;function b0(r,o,d,m){o=r.memoizedState,d=d(m,o),d=d==null?o:h({},o,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var S0={enqueueSetState:function(r,o,d){r=r._reactInternals;var m=br(),S=ks(m);S.payload=o,d!=null&&(S.callback=d),o=Is(r,S,m),o!==null&&(or(o,r,m),oc(o,r,m))},enqueueReplaceState:function(r,o,d){r=r._reactInternals;var m=br(),S=ks(m);S.tag=1,S.payload=o,d!=null&&(S.callback=d),o=Is(r,S,m),o!==null&&(or(o,r,m),oc(o,r,m))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var d=br(),m=ks(d);m.tag=2,o!=null&&(m.callback=o),o=Is(r,m,d),o!==null&&(or(o,r,d),oc(o,r,d))}};function a2(r,o,d,m,S,w,A){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(m,w,A):o.prototype&&o.prototype.isPureReactComponent?!Zl(d,m)||!Zl(S,w):!0}function o2(r,o,d,m){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,m),o.state!==r&&S0.enqueueReplaceState(o,o.state,null)}function Ua(r,o){var d=o;if("ref"in o){d={};for(var m in o)m!=="ref"&&(d[m]=o[m])}if(r=r.defaultProps){d===o&&(d=h({},d));for(var S in r)d[S]===void 0&&(d[S]=r[S])}return d}function l2(r){Xu(r)}function c2(r){console.error(r)}function u2(r){Xu(r)}function yd(r,o){try{var d=r.onUncaughtError;d(o.value,{componentStack:o.stack})}catch(m){setTimeout(function(){throw m})}}function d2(r,o,d){try{var m=r.onCaughtError;m(d.value,{componentStack:d.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(S){setTimeout(function(){throw S})}}function w0(r,o,d){return d=ks(d),d.tag=3,d.payload={element:null},d.callback=function(){yd(r,o)},d}function f2(r){return r=ks(r),r.tag=3,r}function h2(r,o,d,m){var S=d.type.getDerivedStateFromError;if(typeof S=="function"){var w=m.value;r.payload=function(){return S(w)},r.callback=function(){d2(o,d,m)}}var A=d.stateNode;A!==null&&typeof A.componentDidCatch=="function"&&(r.callback=function(){d2(o,d,m),typeof S!="function"&&(Os===null?Os=new Set([this]):Os.add(this));var L=m.stack;this.componentDidCatch(m.value,{componentStack:L!==null?L:""})})}function QS(r,o,d,m,S){if(d.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(o=d.alternate,o!==null&&Ao(o,d,S,!0),d=mr.current,d!==null){switch(d.tag){case 31:case 13:return Pr===null?Rd():d.alternate===null&&cn===0&&(cn=3),d.flags&=-257,d.flags|=65536,d.lanes=S,m===sd?d.flags|=16384:(o=d.updateQueue,o===null?d.updateQueue=new Set([m]):o.add(m),W0(r,m,S)),!1;case 22:return d.flags|=65536,m===sd?d.flags|=16384:(o=d.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([m])},d.updateQueue=o):(d=o.retryQueue,d===null?o.retryQueue=new Set([m]):d.add(m)),W0(r,m,S)),!1}throw Error(s(435,d.tag))}return W0(r,m,S),Rd(),!1}if(Tt)return o=mr.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=S,m!==Bh&&(r=Error(s(422),{cause:m}),nc(Ir(r,d)))):(m!==Bh&&(o=Error(s(423),{cause:m}),nc(Ir(o,d))),r=r.current.alternate,r.flags|=65536,S&=-S,r.lanes|=S,m=Ir(m,d),S=w0(r.stateNode,m,S),Kh(r,S),cn!==4&&(cn=2)),!1;var w=Error(s(520),{cause:m});if(w=Ir(w,d),wc===null?wc=[w]:wc.push(w),cn!==4&&(cn=2),o===null)return!0;m=Ir(m,d),d=o;do{switch(d.tag){case 3:return d.flags|=65536,r=S&-S,d.lanes|=r,r=w0(d.stateNode,m,r),Kh(d,r),!1;case 1:if(o=d.type,w=d.stateNode,(d.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Os===null||!Os.has(w))))return d.flags|=65536,S&=-S,d.lanes|=S,S=f2(S),h2(S,r,d,m),Kh(d,S),!1}d=d.return}while(d!==null);return!1}var _0=Error(s(461)),wn=!1;function Bn(r,o,d,m){o.child=r===null?v1(o,null,d,m):Va(o,r.child,d,m)}function p2(r,o,d,m,S){d=d.render;var w=o.ref;if("ref"in m){var A={};for(var L in m)L!=="ref"&&(A[L]=m[L])}else A=m;return La(o),m=r0(r,o,d,A,w,S),L=i0(),r!==null&&!wn?(s0(r,o,S),Xi(r,o,S)):(Tt&&L&&Oh(o),o.flags|=1,Bn(r,o,m,S),o.child)}function m2(r,o,d,m,S){if(r===null){var w=d.type;return typeof w=="function"&&!Lh(w)&&w.defaultProps===void 0&&d.compare===null?(o.tag=15,o.type=w,g2(r,o,w,m,S)):(r=Zu(d.type,null,m,o,o.mode,S),r.ref=o.ref,r.return=o,o.child=r)}if(w=r.child,!R0(r,S)){var A=w.memoizedProps;if(d=d.compare,d=d!==null?d:Zl,d(A,m)&&r.ref===o.ref)return Xi(r,o,S)}return o.flags|=1,r=Hi(w,m),r.ref=o.ref,r.return=o,o.child=r}function g2(r,o,d,m,S){if(r!==null){var w=r.memoizedProps;if(Zl(w,m)&&r.ref===o.ref)if(wn=!1,o.pendingProps=m=w,R0(r,S))(r.flags&131072)!==0&&(wn=!0);else return o.lanes=r.lanes,Xi(r,o,S)}return x0(r,o,d,m,S)}function v2(r,o,d,m){var S=m.children,w=r!==null?r.memoizedState:null;if(r===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((o.flags&128)!==0){if(w=w!==null?w.baseLanes|d:d,r!==null){for(m=o.child=r.child,S=0;m!==null;)S=S|m.lanes|m.childLanes,m=m.sibling;m=S&~w}else m=0,o.child=null;return y2(r,o,w,d,m)}if((d&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},r!==null&&rd(o,w!==null?w.cachePool:null),w!==null?S1(o,w):Zh(),w1(o);else return m=o.lanes=536870912,y2(r,o,w!==null?w.baseLanes|d:d,d,m)}else w!==null?(rd(o,w.cachePool),S1(o,w),Ns(),o.memoizedState=null):(r!==null&&rd(o,null),Zh(),Ns());return Bn(r,o,S,d),o.child}function pc(r,o){return r!==null&&r.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function y2(r,o,d,m,S){var w=Gh();return w=w===null?null:{parent:bn._currentValue,pool:w},o.memoizedState={baseLanes:d,cachePool:w},r!==null&&rd(o,null),Zh(),w1(o),r!==null&&Ao(r,o,m,!0),o.childLanes=S,null}function bd(r,o){return o=wd({mode:o.mode,children:o.children},r.mode),o.ref=r.ref,r.child=o,o.return=r,o}function b2(r,o,d){return Va(o,r.child,null,d),r=bd(o,o.pendingProps),r.flags|=2,gr(o),o.memoizedState=null,r}function XS(r,o,d){var m=o.pendingProps,S=(o.flags&128)!==0;if(o.flags&=-129,r===null){if(Tt){if(m.mode==="hidden")return r=bd(o,m),o.lanes=536870912,pc(null,r);if(t0(o),(r=Gt)?(r=kv(r,Lr),r=r!==null&&r.data==="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:Cs!==null?{id:Ei,overflow:Ci}:null,retryLane:536870912,hydrationErrors:null},d=n1(r),d.return=o,o.child=d,On=o,Gt=null)):r=null,r===null)throw js(o);return o.lanes=536870912,null}return bd(o,m)}var w=r.memoizedState;if(w!==null){var A=w.dehydrated;if(t0(o),S)if(o.flags&256)o.flags&=-257,o=b2(r,o,d);else if(o.memoizedState!==null)o.child=r.child,o.flags|=128,o=null;else throw Error(s(558));else if(wn||Ao(r,o,d,!1),S=(d&r.childLanes)!==0,wn||S){if(m=$t,m!==null&&(A=Ll(m,d),A!==0&&A!==w.retryLane))throw w.retryLane=A,ka(r,A),or(m,r,A),_0;Rd(),o=b2(r,o,d)}else r=w.treeContext,Gt=zr(A.nextSibling),On=o,Tt=!0,As=null,Lr=!1,r!==null&&s1(o,r),o=bd(o,m),o.flags|=4096;return o}return r=Hi(r.child,{mode:m.mode,children:m.children}),r.ref=o.ref,o.child=r,r.return=o,r}function Sd(r,o){var d=o.ref;if(d===null)r!==null&&r.ref!==null&&(o.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(s(284));(r===null||r.ref!==d)&&(o.flags|=4194816)}}function x0(r,o,d,m,S){return La(o),d=r0(r,o,d,m,void 0,S),m=i0(),r!==null&&!wn?(s0(r,o,S),Xi(r,o,S)):(Tt&&m&&Oh(o),o.flags|=1,Bn(r,o,d,S),o.child)}function S2(r,o,d,m,S,w){return La(o),o.updateQueue=null,d=x1(o,m,d,S),_1(r),m=i0(),r!==null&&!wn?(s0(r,o,w),Xi(r,o,w)):(Tt&&m&&Oh(o),o.flags|=1,Bn(r,o,d,w),o.child)}function w2(r,o,d,m,S){if(La(o),o.stateNode===null){var w=xo,A=d.contextType;typeof A=="object"&&A!==null&&(w=Vn(A)),w=new d(m,w),o.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=S0,o.stateNode=w,w._reactInternals=o,w=o.stateNode,w.props=m,w.state=o.memoizedState,w.refs={},Xh(o),A=d.contextType,w.context=typeof A=="object"&&A!==null?Vn(A):xo,w.state=o.memoizedState,A=d.getDerivedStateFromProps,typeof A=="function"&&(b0(o,d,A,m),w.state=o.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(A=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),A!==w.state&&S0.enqueueReplaceState(w,w.state,null),cc(o,m,w,S),lc(),w.state=o.memoizedState),typeof w.componentDidMount=="function"&&(o.flags|=4194308),m=!0}else if(r===null){w=o.stateNode;var L=o.memoizedProps,G=Ua(d,L);w.props=G;var oe=w.context,ye=d.contextType;A=xo,typeof ye=="object"&&ye!==null&&(A=Vn(ye));var Ae=d.getDerivedStateFromProps;ye=typeof Ae=="function"||typeof w.getSnapshotBeforeUpdate=="function",L=o.pendingProps!==L,ye||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(L||oe!==A)&&o2(o,w,m,A),Rs=!1;var ue=o.memoizedState;w.state=ue,cc(o,m,w,S),lc(),oe=o.memoizedState,L||ue!==oe||Rs?(typeof Ae=="function"&&(b0(o,d,Ae,m),oe=o.memoizedState),(G=Rs||a2(o,d,G,m,ue,oe,A))?(ye||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(o.flags|=4194308)):(typeof w.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=oe),w.props=m,w.state=oe,w.context=A,m=G):(typeof w.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{w=o.stateNode,Yh(r,o),A=o.memoizedProps,ye=Ua(d,A),w.props=ye,Ae=o.pendingProps,ue=w.context,oe=d.contextType,G=xo,typeof oe=="object"&&oe!==null&&(G=Vn(oe)),L=d.getDerivedStateFromProps,(oe=typeof L=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(A!==Ae||ue!==G)&&o2(o,w,m,G),Rs=!1,ue=o.memoizedState,w.state=ue,cc(o,m,w,S),lc();var pe=o.memoizedState;A!==Ae||ue!==pe||Rs||r!==null&&r.dependencies!==null&&td(r.dependencies)?(typeof L=="function"&&(b0(o,d,L,m),pe=o.memoizedState),(ye=Rs||a2(o,d,ye,m,ue,pe,G)||r!==null&&r.dependencies!==null&&td(r.dependencies))?(oe||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(m,pe,G),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(m,pe,G)),typeof w.componentDidUpdate=="function"&&(o.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof w.componentDidUpdate!="function"||A===r.memoizedProps&&ue===r.memoizedState||(o.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||A===r.memoizedProps&&ue===r.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=pe),w.props=m,w.state=pe,w.context=G,m=ye):(typeof w.componentDidUpdate!="function"||A===r.memoizedProps&&ue===r.memoizedState||(o.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||A===r.memoizedProps&&ue===r.memoizedState||(o.flags|=1024),m=!1)}return w=m,Sd(r,o),m=(o.flags&128)!==0,w||m?(w=o.stateNode,d=m&&typeof d.getDerivedStateFromError!="function"?null:w.render(),o.flags|=1,r!==null&&m?(o.child=Va(o,r.child,null,S),o.child=Va(o,null,d,S)):Bn(r,o,d,S),o.memoizedState=w.state,r=o.child):r=Xi(r,o,S),r}function _2(r,o,d,m){return Da(),o.flags|=256,Bn(r,o,d,m),o.child}var T0={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function E0(r){return{baseLanes:r,cachePool:d1()}}function C0(r,o,d){return r=r!==null?r.childLanes&~d:0,o&&(r|=yr),r}function x2(r,o,d){var m=o.pendingProps,S=!1,w=(o.flags&128)!==0,A;if((A=w)||(A=r!==null&&r.memoizedState===null?!1:(fn.current&2)!==0),A&&(S=!0,o.flags&=-129),A=(o.flags&32)!==0,o.flags&=-33,r===null){if(Tt){if(S?Ds(o):Ns(),(r=Gt)?(r=kv(r,Lr),r=r!==null&&r.data!=="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:Cs!==null?{id:Ei,overflow:Ci}:null,retryLane:536870912,hydrationErrors:null},d=n1(r),d.return=o,o.child=d,On=o,Gt=null)):r=null,r===null)throw js(o);return lp(r)?o.lanes=32:o.lanes=536870912,null}var L=m.children;return m=m.fallback,S?(Ns(),S=o.mode,L=wd({mode:"hidden",children:L},S),m=Ia(m,S,d,null),L.return=o,m.return=o,L.sibling=m,o.child=L,m=o.child,m.memoizedState=E0(d),m.childLanes=C0(r,A,d),o.memoizedState=T0,pc(null,m)):(Ds(o),A0(o,L))}var G=r.memoizedState;if(G!==null&&(L=G.dehydrated,L!==null)){if(w)o.flags&256?(Ds(o),o.flags&=-257,o=j0(r,o,d)):o.memoizedState!==null?(Ns(),o.child=r.child,o.flags|=128,o=null):(Ns(),L=m.fallback,S=o.mode,m=wd({mode:"visible",children:m.children},S),L=Ia(L,S,d,null),L.flags|=2,m.return=o,L.return=o,m.sibling=L,o.child=m,Va(o,r.child,null,d),m=o.child,m.memoizedState=E0(d),m.childLanes=C0(r,A,d),o.memoizedState=T0,o=pc(null,m));else if(Ds(o),lp(L)){if(A=L.nextSibling&&L.nextSibling.dataset,A)var oe=A.dgst;A=oe,m=Error(s(419)),m.stack="",m.digest=A,nc({value:m,source:null,stack:null}),o=j0(r,o,d)}else if(wn||Ao(r,o,d,!1),A=(d&r.childLanes)!==0,wn||A){if(A=$t,A!==null&&(m=Ll(A,d),m!==0&&m!==G.retryLane))throw G.retryLane=m,ka(r,m),or(A,r,m),_0;op(L)||Rd(),o=j0(r,o,d)}else op(L)?(o.flags|=192,o.child=r.child,o=null):(r=G.treeContext,Gt=zr(L.nextSibling),On=o,Tt=!0,As=null,Lr=!1,r!==null&&s1(o,r),o=A0(o,m.children),o.flags|=4096);return o}return S?(Ns(),L=m.fallback,S=o.mode,G=r.child,oe=G.sibling,m=Hi(G,{mode:"hidden",children:m.children}),m.subtreeFlags=G.subtreeFlags&65011712,oe!==null?L=Hi(oe,L):(L=Ia(L,S,d,null),L.flags|=2),L.return=o,m.return=o,m.sibling=L,o.child=m,pc(null,m),m=o.child,L=r.child.memoizedState,L===null?L=E0(d):(S=L.cachePool,S!==null?(G=bn._currentValue,S=S.parent!==G?{parent:G,pool:G}:S):S=d1(),L={baseLanes:L.baseLanes|d,cachePool:S}),m.memoizedState=L,m.childLanes=C0(r,A,d),o.memoizedState=T0,pc(r.child,m)):(Ds(o),d=r.child,r=d.sibling,d=Hi(d,{mode:"visible",children:m.children}),d.return=o,d.sibling=null,r!==null&&(A=o.deletions,A===null?(o.deletions=[r],o.flags|=16):A.push(r)),o.child=d,o.memoizedState=null,d)}function A0(r,o){return o=wd({mode:"visible",children:o},r.mode),o.return=r,r.child=o}function wd(r,o){return r=pr(22,r,null,o),r.lanes=0,r}function j0(r,o,d){return Va(o,r.child,null,d),r=A0(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function T2(r,o,d){r.lanes|=o;var m=r.alternate;m!==null&&(m.lanes|=o),Hh(r.return,o,d)}function M0(r,o,d,m,S,w){var A=r.memoizedState;A===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:d,tailMode:S,treeForkCount:w}:(A.isBackwards=o,A.rendering=null,A.renderingStartTime=0,A.last=m,A.tail=d,A.tailMode=S,A.treeForkCount=w)}function E2(r,o,d){var m=o.pendingProps,S=m.revealOrder,w=m.tail;m=m.children;var A=fn.current,L=(A&2)!==0;if(L?(A=A&1|2,o.flags|=128):A&=1,te(fn,A),Bn(r,o,m,d),m=Tt?tc:0,!L&&r!==null&&(r.flags&128)!==0)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&T2(r,d,o);else if(r.tag===19)T2(r,d,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(S){case"forwards":for(d=o.child,S=null;d!==null;)r=d.alternate,r!==null&&cd(r)===null&&(S=d),d=d.sibling;d=S,d===null?(S=o.child,o.child=null):(S=d.sibling,d.sibling=null),M0(o,!1,S,d,w,m);break;case"backwards":case"unstable_legacy-backwards":for(d=null,S=o.child,o.child=null;S!==null;){if(r=S.alternate,r!==null&&cd(r)===null){o.child=S;break}r=S.sibling,S.sibling=d,d=S,S=r}M0(o,!0,d,null,w,m);break;case"together":M0(o,!1,null,null,void 0,m);break;default:o.memoizedState=null}return o.child}function Xi(r,o,d){if(r!==null&&(o.dependencies=r.dependencies),zs|=o.lanes,(d&o.childLanes)===0)if(r!==null){if(Ao(r,o,d,!1),(d&o.childLanes)===0)return null}else return null;if(r!==null&&o.child!==r.child)throw Error(s(153));if(o.child!==null){for(r=o.child,d=Hi(r,r.pendingProps),o.child=d,d.return=o;r.sibling!==null;)r=r.sibling,d=d.sibling=Hi(r,r.pendingProps),d.return=o;d.sibling=null}return o.child}function R0(r,o){return(r.lanes&o)!==0?!0:(r=r.dependencies,!!(r!==null&&td(r)))}function YS(r,o,d){switch(o.tag){case 3:Le(o,o.stateNode.containerInfo),Ms(o,bn,r.memoizedState.cache),Da();break;case 27:case 5:De(o);break;case 4:Le(o,o.stateNode.containerInfo);break;case 10:Ms(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,t0(o),null;break;case 13:var m=o.memoizedState;if(m!==null)return m.dehydrated!==null?(Ds(o),o.flags|=128,null):(d&o.child.childLanes)!==0?x2(r,o,d):(Ds(o),r=Xi(r,o,d),r!==null?r.sibling:null);Ds(o);break;case 19:var S=(r.flags&128)!==0;if(m=(d&o.childLanes)!==0,m||(Ao(r,o,d,!1),m=(d&o.childLanes)!==0),S){if(m)return E2(r,o,d);o.flags|=128}if(S=o.memoizedState,S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),te(fn,fn.current),m)break;return null;case 22:return o.lanes=0,v2(r,o,d,o.pendingProps);case 24:Ms(o,bn,r.memoizedState.cache)}return Xi(r,o,d)}function C2(r,o,d){if(r!==null)if(r.memoizedProps!==o.pendingProps)wn=!0;else{if(!R0(r,d)&&(o.flags&128)===0)return wn=!1,YS(r,o,d);wn=(r.flags&131072)!==0}else wn=!1,Tt&&(o.flags&1048576)!==0&&i1(o,tc,o.index);switch(o.lanes=0,o.tag){case 16:e:{var m=o.pendingProps;if(r=za(o.elementType),o.type=r,typeof r=="function")Lh(r)?(m=Ua(r,m),o.tag=1,o=w2(null,o,r,m,d)):(o.tag=0,o=x0(null,o,r,m,d));else{if(r!=null){var S=r.$$typeof;if(S===X){o.tag=11,o=p2(null,o,r,m,d);break e}else if(S===k){o.tag=14,o=m2(null,o,r,m,d);break e}}throw o=de(r)||r,Error(s(306,o,""))}}return o;case 0:return x0(r,o,o.type,o.pendingProps,d);case 1:return m=o.type,S=Ua(m,o.pendingProps),w2(r,o,m,S,d);case 3:e:{if(Le(o,o.stateNode.containerInfo),r===null)throw Error(s(387));m=o.pendingProps;var w=o.memoizedState;S=w.element,Yh(r,o),cc(o,m,null,d);var A=o.memoizedState;if(m=A.cache,Ms(o,bn,m),m!==w.cache&&Fh(o,[bn],d,!0),lc(),m=A.element,w.isDehydrated)if(w={element:m,isDehydrated:!1,cache:A.cache},o.updateQueue.baseState=w,o.memoizedState=w,o.flags&256){o=_2(r,o,m,d);break e}else if(m!==S){S=Ir(Error(s(424)),o),nc(S),o=_2(r,o,m,d);break e}else for(r=o.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,Gt=zr(r.firstChild),On=o,Tt=!0,As=null,Lr=!0,d=v1(o,null,m,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Da(),m===S){o=Xi(r,o,d);break e}Bn(r,o,m,d)}o=o.child}return o;case 26:return Sd(r,o),r===null?(d=zv(o.type,null,o.pendingProps,null))?o.memoizedState=d:Tt||(d=o.type,r=o.pendingProps,m=zd(O.current).createElement(d),m[gn]=o,m[Rn]=r,Un(m,d,r),vn(m),o.stateNode=m):o.memoizedState=zv(o.type,r.memoizedProps,o.pendingProps,r.memoizedState),null;case 27:return De(o),r===null&&Tt&&(m=o.stateNode=Nv(o.type,o.pendingProps,O.current),On=o,Lr=!0,S=Gt,qs(o.type)?(cp=S,Gt=zr(m.firstChild)):Gt=S),Bn(r,o,o.pendingProps.children,d),Sd(r,o),r===null&&(o.flags|=4194304),o.child;case 5:return r===null&&Tt&&((S=m=Gt)&&(m=Cw(m,o.type,o.pendingProps,Lr),m!==null?(o.stateNode=m,On=o,Gt=zr(m.firstChild),Lr=!1,S=!0):S=!1),S||js(o)),De(o),S=o.type,w=o.pendingProps,A=r!==null?r.memoizedProps:null,m=w.children,ip(S,w)?m=null:A!==null&&ip(S,A)&&(o.flags|=32),o.memoizedState!==null&&(S=r0(r,o,US,null,null,d),Mc._currentValue=S),Sd(r,o),Bn(r,o,m,d),o.child;case 6:return r===null&&Tt&&((r=d=Gt)&&(d=Aw(d,o.pendingProps,Lr),d!==null?(o.stateNode=d,On=o,Gt=null,r=!0):r=!1),r||js(o)),null;case 13:return x2(r,o,d);case 4:return Le(o,o.stateNode.containerInfo),m=o.pendingProps,r===null?o.child=Va(o,null,m,d):Bn(r,o,m,d),o.child;case 11:return p2(r,o,o.type,o.pendingProps,d);case 7:return Bn(r,o,o.pendingProps,d),o.child;case 8:return Bn(r,o,o.pendingProps.children,d),o.child;case 12:return Bn(r,o,o.pendingProps.children,d),o.child;case 10:return m=o.pendingProps,Ms(o,o.type,m.value),Bn(r,o,m.children,d),o.child;case 9:return S=o.type._context,m=o.pendingProps.children,La(o),S=Vn(S),m=m(S),o.flags|=1,Bn(r,o,m,d),o.child;case 14:return m2(r,o,o.type,o.pendingProps,d);case 15:return g2(r,o,o.type,o.pendingProps,d);case 19:return E2(r,o,d);case 31:return XS(r,o,d);case 22:return v2(r,o,d,o.pendingProps);case 24:return La(o),m=Vn(bn),r===null?(S=Gh(),S===null&&(S=$t,w=$h(),S.pooledCache=w,w.refCount++,w!==null&&(S.pooledCacheLanes|=d),S=w),o.memoizedState={parent:m,cache:S},Xh(o),Ms(o,bn,S)):((r.lanes&d)!==0&&(Yh(r,o),cc(o,null,null,d),lc()),S=r.memoizedState,w=o.memoizedState,S.parent!==m?(S={parent:m,cache:m},o.memoizedState=S,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=S),Ms(o,bn,m)):(m=w.cache,Ms(o,bn,m),m!==S.cache&&Fh(o,[bn],d,!0))),Bn(r,o,o.pendingProps.children,d),o.child;case 29:throw o.pendingProps}throw Error(s(156,o.tag))}function Yi(r){r.flags|=4}function k0(r,o,d,m,S){if((o=(r.mode&32)!==0)&&(o=!1),o){if(r.flags|=16777216,(S&335544128)===S)if(r.stateNode.complete)r.flags|=8192;else if(Z2())r.flags|=8192;else throw Oa=sd,Qh}else r.flags&=-16777217}function A2(r,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!qv(o))if(Z2())r.flags|=8192;else throw Oa=sd,Qh}function _d(r,o){o!==null&&(r.flags|=4),r.flags&16384&&(o=r.tag!==22?Oi():536870912,r.lanes|=o,Vo|=o)}function mc(r,o){if(!Tt)switch(r.tailMode){case"hidden":o=r.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var m=null;d!==null;)d.alternate!==null&&(m=d),d=d.sibling;m===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:m.sibling=null}}function Qt(r){var o=r.alternate!==null&&r.alternate.child===r.child,d=0,m=0;if(o)for(var S=r.child;S!==null;)d|=S.lanes|S.childLanes,m|=S.subtreeFlags&65011712,m|=S.flags&65011712,S.return=r,S=S.sibling;else for(S=r.child;S!==null;)d|=S.lanes|S.childLanes,m|=S.subtreeFlags,m|=S.flags,S.return=r,S=S.sibling;return r.subtreeFlags|=m,r.childLanes=d,o}function KS(r,o,d){var m=o.pendingProps;switch(Vh(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qt(o),null;case 1:return Qt(o),null;case 3:return d=o.stateNode,m=null,r!==null&&(m=r.memoizedState.cache),o.memoizedState.cache!==m&&(o.flags|=2048),Wi(bn),Oe(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(r===null||r.child===null)&&(Co(o)?Yi(o):r===null||r.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Uh())),Qt(o),null;case 26:var S=o.type,w=o.memoizedState;return r===null?(Yi(o),w!==null?(Qt(o),A2(o,w)):(Qt(o),k0(o,S,null,m,d))):w?w!==r.memoizedState?(Yi(o),Qt(o),A2(o,w)):(Qt(o),o.flags&=-16777217):(r=r.memoizedProps,r!==m&&Yi(o),Qt(o),k0(o,S,r,m,d)),null;case 27:if(re(o),d=O.current,S=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==m&&Yi(o);else{if(!m){if(o.stateNode===null)throw Error(s(166));return Qt(o),null}r=fe.current,Co(o)?a1(o):(r=Nv(S,m,d),o.stateNode=r,Yi(o))}return Qt(o),null;case 5:if(re(o),S=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==m&&Yi(o);else{if(!m){if(o.stateNode===null)throw Error(s(166));return Qt(o),null}if(w=fe.current,Co(o))a1(o);else{var A=zd(O.current);switch(w){case 1:w=A.createElementNS("http://www.w3.org/2000/svg",S);break;case 2:w=A.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;default:switch(S){case"svg":w=A.createElementNS("http://www.w3.org/2000/svg",S);break;case"math":w=A.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;case"script":w=A.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof m.is=="string"?A.createElement("select",{is:m.is}):A.createElement("select"),m.multiple?w.multiple=!0:m.size&&(w.size=m.size);break;default:w=typeof m.is=="string"?A.createElement(S,{is:m.is}):A.createElement(S)}}w[gn]=o,w[Rn]=m;e:for(A=o.child;A!==null;){if(A.tag===5||A.tag===6)w.appendChild(A.stateNode);else if(A.tag!==4&&A.tag!==27&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===o)break e;for(;A.sibling===null;){if(A.return===null||A.return===o)break e;A=A.return}A.sibling.return=A.return,A=A.sibling}o.stateNode=w;e:switch(Un(w,S,m),S){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&Yi(o)}}return Qt(o),k0(o,o.type,r===null?null:r.memoizedProps,o.pendingProps,d),null;case 6:if(r&&o.stateNode!=null)r.memoizedProps!==m&&Yi(o);else{if(typeof m!="string"&&o.stateNode===null)throw Error(s(166));if(r=O.current,Co(o)){if(r=o.stateNode,d=o.memoizedProps,m=null,S=On,S!==null)switch(S.tag){case 27:case 5:m=S.memoizedProps}r[gn]=o,r=!!(r.nodeValue===d||m!==null&&m.suppressHydrationWarning===!0||xv(r.nodeValue,d)),r||js(o,!0)}else r=zd(r).createTextNode(m),r[gn]=o,o.stateNode=r}return Qt(o),null;case 31:if(d=o.memoizedState,r===null||r.memoizedState!==null){if(m=Co(o),d!==null){if(r===null){if(!m)throw Error(s(318));if(r=o.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(s(557));r[gn]=o}else Da(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Qt(o),r=!1}else d=Uh(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=d),r=!0;if(!r)return o.flags&256?(gr(o),o):(gr(o),null);if((o.flags&128)!==0)throw Error(s(558))}return Qt(o),null;case 13:if(m=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(S=Co(o),m!==null&&m.dehydrated!==null){if(r===null){if(!S)throw Error(s(318));if(S=o.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(s(317));S[gn]=o}else Da(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Qt(o),S=!1}else S=Uh(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=S),S=!0;if(!S)return o.flags&256?(gr(o),o):(gr(o),null)}return gr(o),(o.flags&128)!==0?(o.lanes=d,o):(d=m!==null,r=r!==null&&r.memoizedState!==null,d&&(m=o.child,S=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(S=m.alternate.memoizedState.cachePool.pool),w=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(w=m.memoizedState.cachePool.pool),w!==S&&(m.flags|=2048)),d!==r&&d&&(o.child.flags|=8192),_d(o,o.updateQueue),Qt(o),null);case 4:return Oe(),r===null&&Z0(o.stateNode.containerInfo),Qt(o),null;case 10:return Wi(o.type),Qt(o),null;case 19:if(Z(fn),m=o.memoizedState,m===null)return Qt(o),null;if(S=(o.flags&128)!==0,w=m.rendering,w===null)if(S)mc(m,!1);else{if(cn!==0||r!==null&&(r.flags&128)!==0)for(r=o.child;r!==null;){if(w=cd(r),w!==null){for(o.flags|=128,mc(m,!1),r=w.updateQueue,o.updateQueue=r,_d(o,r),o.subtreeFlags=0,r=d,d=o.child;d!==null;)t1(d,r),d=d.sibling;return te(fn,fn.current&1|2),Tt&&Fi(o,m.treeForkCount),o.child}r=r.sibling}m.tail!==null&&Ge()>Ad&&(o.flags|=128,S=!0,mc(m,!1),o.lanes=4194304)}else{if(!S)if(r=cd(w),r!==null){if(o.flags|=128,S=!0,r=r.updateQueue,o.updateQueue=r,_d(o,r),mc(m,!0),m.tail===null&&m.tailMode==="hidden"&&!w.alternate&&!Tt)return Qt(o),null}else 2*Ge()-m.renderingStartTime>Ad&&d!==536870912&&(o.flags|=128,S=!0,mc(m,!1),o.lanes=4194304);m.isBackwards?(w.sibling=o.child,o.child=w):(r=m.last,r!==null?r.sibling=w:o.child=w,m.last=w)}return m.tail!==null?(r=m.tail,m.rendering=r,m.tail=r.sibling,m.renderingStartTime=Ge(),r.sibling=null,d=fn.current,te(fn,S?d&1|2:d&1),Tt&&Fi(o,m.treeForkCount),r):(Qt(o),null);case 22:case 23:return gr(o),e0(),m=o.memoizedState!==null,r!==null?r.memoizedState!==null!==m&&(o.flags|=8192):m&&(o.flags|=8192),m?(d&536870912)!==0&&(o.flags&128)===0&&(Qt(o),o.subtreeFlags&6&&(o.flags|=8192)):Qt(o),d=o.updateQueue,d!==null&&_d(o,d.retryQueue),d=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),m=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(m=o.memoizedState.cachePool.pool),m!==d&&(o.flags|=2048),r!==null&&Z(Pa),null;case 24:return d=null,r!==null&&(d=r.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),Wi(bn),Qt(o),null;case 25:return null;case 30:return null}throw Error(s(156,o.tag))}function JS(r,o){switch(Vh(o),o.tag){case 1:return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return Wi(bn),Oe(),r=o.flags,(r&65536)!==0&&(r&128)===0?(o.flags=r&-65537|128,o):null;case 26:case 27:case 5:return re(o),null;case 31:if(o.memoizedState!==null){if(gr(o),o.alternate===null)throw Error(s(340));Da()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 13:if(gr(o),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(s(340));Da()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return Z(fn),null;case 4:return Oe(),null;case 10:return Wi(o.type),null;case 22:case 23:return gr(o),e0(),r!==null&&Z(Pa),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 24:return Wi(bn),null;case 25:return null;default:return null}}function j2(r,o){switch(Vh(o),o.tag){case 3:Wi(bn),Oe();break;case 26:case 27:case 5:re(o);break;case 4:Oe();break;case 31:o.memoizedState!==null&&gr(o);break;case 13:gr(o);break;case 19:Z(fn);break;case 10:Wi(o.type);break;case 22:case 23:gr(o),e0(),r!==null&&Z(Pa);break;case 24:Wi(bn)}}function gc(r,o){try{var d=o.updateQueue,m=d!==null?d.lastEffect:null;if(m!==null){var S=m.next;d=S;do{if((d.tag&r)===r){m=void 0;var w=d.create,A=d.inst;m=w(),A.destroy=m}d=d.next}while(d!==S)}}catch(L){zt(o,o.return,L)}}function Ls(r,o,d){try{var m=o.updateQueue,S=m!==null?m.lastEffect:null;if(S!==null){var w=S.next;m=w;do{if((m.tag&r)===r){var A=m.inst,L=A.destroy;if(L!==void 0){A.destroy=void 0,S=o;var G=d,oe=L;try{oe()}catch(ye){zt(S,G,ye)}}}m=m.next}while(m!==w)}}catch(ye){zt(o,o.return,ye)}}function M2(r){var o=r.updateQueue;if(o!==null){var d=r.stateNode;try{b1(o,d)}catch(m){zt(r,r.return,m)}}}function R2(r,o,d){d.props=Ua(r.type,r.memoizedProps),d.state=r.memoizedState;try{d.componentWillUnmount()}catch(m){zt(r,o,m)}}function vc(r,o){try{var d=r.ref;if(d!==null){switch(r.tag){case 26:case 27:case 5:var m=r.stateNode;break;case 30:m=r.stateNode;break;default:m=r.stateNode}typeof d=="function"?r.refCleanup=d(m):d.current=m}}catch(S){zt(r,o,S)}}function Ai(r,o){var d=r.ref,m=r.refCleanup;if(d!==null)if(typeof m=="function")try{m()}catch(S){zt(r,o,S)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(S){zt(r,o,S)}else d.current=null}function k2(r){var o=r.type,d=r.memoizedProps,m=r.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":d.autoFocus&&m.focus();break e;case"img":d.src?m.src=d.src:d.srcSet&&(m.srcset=d.srcSet)}}catch(S){zt(r,r.return,S)}}function I0(r,o,d){try{var m=r.stateNode;Sw(m,r.type,d,o),m[Rn]=o}catch(S){zt(r,r.return,S)}}function I2(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&qs(r.type)||r.tag===4}function D0(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||I2(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&qs(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function N0(r,o,d){var m=r.tag;if(m===5||m===6)r=r.stateNode,o?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(r,o):(o=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,o.appendChild(r),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=Gr));else if(m!==4&&(m===27&&qs(r.type)&&(d=r.stateNode,o=null),r=r.child,r!==null))for(N0(r,o,d),r=r.sibling;r!==null;)N0(r,o,d),r=r.sibling}function xd(r,o,d){var m=r.tag;if(m===5||m===6)r=r.stateNode,o?d.insertBefore(r,o):d.appendChild(r);else if(m!==4&&(m===27&&qs(r.type)&&(d=r.stateNode),r=r.child,r!==null))for(xd(r,o,d),r=r.sibling;r!==null;)xd(r,o,d),r=r.sibling}function D2(r){var o=r.stateNode,d=r.memoizedProps;try{for(var m=r.type,S=o.attributes;S.length;)o.removeAttributeNode(S[0]);Un(o,m,d),o[gn]=r,o[Rn]=d}catch(w){zt(r,r.return,w)}}var Ki=!1,_n=!1,L0=!1,N2=typeof WeakSet=="function"?WeakSet:Set,In=null;function ZS(r,o){if(r=r.containerInfo,np=Fd,r=Wg(r),jh(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var m=d.getSelection&&d.getSelection();if(m&&m.rangeCount!==0){d=m.anchorNode;var S=m.anchorOffset,w=m.focusNode;m=m.focusOffset;try{d.nodeType,w.nodeType}catch{d=null;break e}var A=0,L=-1,G=-1,oe=0,ye=0,Ae=r,ue=null;t:for(;;){for(var pe;Ae!==d||S!==0&&Ae.nodeType!==3||(L=A+S),Ae!==w||m!==0&&Ae.nodeType!==3||(G=A+m),Ae.nodeType===3&&(A+=Ae.nodeValue.length),(pe=Ae.firstChild)!==null;)ue=Ae,Ae=pe;for(;;){if(Ae===r)break t;if(ue===d&&++oe===S&&(L=A),ue===w&&++ye===m&&(G=A),(pe=Ae.nextSibling)!==null)break;Ae=ue,ue=Ae.parentNode}Ae=pe}d=L===-1||G===-1?null:{start:L,end:G}}else d=null}d=d||{start:0,end:0}}else d=null;for(rp={focusedElem:r,selectionRange:d},Fd=!1,In=o;In!==null;)if(o=In,r=o.child,(o.subtreeFlags&1028)!==0&&r!==null)r.return=o,In=r;else for(;In!==null;){switch(o=In,w=o.alternate,r=o.flags,o.tag){case 0:if((r&4)!==0&&(r=o.updateQueue,r=r!==null?r.events:null,r!==null))for(d=0;d<r.length;d++)S=r[d],S.ref.impl=S.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&w!==null){r=void 0,d=o,S=w.memoizedProps,w=w.memoizedState,m=d.stateNode;try{var Qe=Ua(d.type,S);r=m.getSnapshotBeforeUpdate(Qe,w),m.__reactInternalSnapshotBeforeUpdate=r}catch(st){zt(d,d.return,st)}}break;case 3:if((r&1024)!==0){if(r=o.stateNode.containerInfo,d=r.nodeType,d===9)ap(r);else if(d===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":ap(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(s(163))}if(r=o.sibling,r!==null){r.return=o.return,In=r;break}In=o.return}}function L2(r,o,d){var m=d.flags;switch(d.tag){case 0:case 11:case 15:Zi(r,d),m&4&&gc(5,d);break;case 1:if(Zi(r,d),m&4)if(r=d.stateNode,o===null)try{r.componentDidMount()}catch(A){zt(d,d.return,A)}else{var S=Ua(d.type,o.memoizedProps);o=o.memoizedState;try{r.componentDidUpdate(S,o,r.__reactInternalSnapshotBeforeUpdate)}catch(A){zt(d,d.return,A)}}m&64&&M2(d),m&512&&vc(d,d.return);break;case 3:if(Zi(r,d),m&64&&(r=d.updateQueue,r!==null)){if(o=null,d.child!==null)switch(d.child.tag){case 27:case 5:o=d.child.stateNode;break;case 1:o=d.child.stateNode}try{b1(r,o)}catch(A){zt(d,d.return,A)}}break;case 27:o===null&&m&4&&D2(d);case 26:case 5:Zi(r,d),o===null&&m&4&&k2(d),m&512&&vc(d,d.return);break;case 12:Zi(r,d);break;case 31:Zi(r,d),m&4&&O2(r,d);break;case 13:Zi(r,d),m&4&&V2(r,d),m&64&&(r=d.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(d=lw.bind(null,d),jw(r,d))));break;case 22:if(m=d.memoizedState!==null||Ki,!m){o=o!==null&&o.memoizedState!==null||_n,S=Ki;var w=_n;Ki=m,(_n=o)&&!w?es(r,d,(d.subtreeFlags&8772)!==0):Zi(r,d),Ki=S,_n=w}break;case 30:break;default:Zi(r,d)}}function P2(r){var o=r.alternate;o!==null&&(r.alternate=null,P2(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&lo(o)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var en=null,rr=!1;function Ji(r,o,d){for(d=d.child;d!==null;)z2(r,o,d),d=d.sibling}function z2(r,o,d){if(Ne&&typeof Ne.onCommitFiberUnmount=="function")try{Ne.onCommitFiberUnmount(Ft,d)}catch{}switch(d.tag){case 26:_n||Ai(d,o),Ji(r,o,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:_n||Ai(d,o);var m=en,S=rr;qs(d.type)&&(en=d.stateNode,rr=!1),Ji(r,o,d),Cc(d.stateNode),en=m,rr=S;break;case 5:_n||Ai(d,o);case 6:if(m=en,S=rr,en=null,Ji(r,o,d),en=m,rr=S,en!==null)if(rr)try{(en.nodeType===9?en.body:en.nodeName==="HTML"?en.ownerDocument.body:en).removeChild(d.stateNode)}catch(w){zt(d,o,w)}else try{en.removeChild(d.stateNode)}catch(w){zt(d,o,w)}break;case 18:en!==null&&(rr?(r=en,Mv(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,d.stateNode),Go(r)):Mv(en,d.stateNode));break;case 4:m=en,S=rr,en=d.stateNode.containerInfo,rr=!0,Ji(r,o,d),en=m,rr=S;break;case 0:case 11:case 14:case 15:Ls(2,d,o),_n||Ls(4,d,o),Ji(r,o,d);break;case 1:_n||(Ai(d,o),m=d.stateNode,typeof m.componentWillUnmount=="function"&&R2(d,o,m)),Ji(r,o,d);break;case 21:Ji(r,o,d);break;case 22:_n=(m=_n)||d.memoizedState!==null,Ji(r,o,d),_n=m;break;default:Ji(r,o,d)}}function O2(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Go(r)}catch(d){zt(o,o.return,d)}}}function V2(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Go(r)}catch(d){zt(o,o.return,d)}}function ew(r){switch(r.tag){case 31:case 13:case 19:var o=r.stateNode;return o===null&&(o=r.stateNode=new N2),o;case 22:return r=r.stateNode,o=r._retryCache,o===null&&(o=r._retryCache=new N2),o;default:throw Error(s(435,r.tag))}}function Td(r,o){var d=ew(r);o.forEach(function(m){if(!d.has(m)){d.add(m);var S=cw.bind(null,r,m);m.then(S,S)}})}function ir(r,o){var d=o.deletions;if(d!==null)for(var m=0;m<d.length;m++){var S=d[m],w=r,A=o,L=A;e:for(;L!==null;){switch(L.tag){case 27:if(qs(L.type)){en=L.stateNode,rr=!1;break e}break;case 5:en=L.stateNode,rr=!1;break e;case 3:case 4:en=L.stateNode.containerInfo,rr=!0;break e}L=L.return}if(en===null)throw Error(s(160));z2(w,A,S),en=null,rr=!1,w=S.alternate,w!==null&&(w.return=null),S.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)B2(o,r),o=o.sibling}var Zr=null;function B2(r,o){var d=r.alternate,m=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:ir(o,r),sr(r),m&4&&(Ls(3,r,r.return),gc(3,r),Ls(5,r,r.return));break;case 1:ir(o,r),sr(r),m&512&&(_n||d===null||Ai(d,d.return)),m&64&&Ki&&(r=r.updateQueue,r!==null&&(m=r.callbacks,m!==null&&(d=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=d===null?m:d.concat(m))));break;case 26:var S=Zr;if(ir(o,r),sr(r),m&512&&(_n||d===null||Ai(d,d.return)),m&4){var w=d!==null?d.memoizedState:null;if(m=r.memoizedState,d===null)if(m===null)if(r.stateNode===null){e:{m=r.type,d=r.memoizedProps,S=S.ownerDocument||S;t:switch(m){case"title":w=S.getElementsByTagName("title")[0],(!w||w[hi]||w[gn]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=S.createElement(m),S.head.insertBefore(w,S.querySelector("head > title"))),Un(w,m,d),w[gn]=r,vn(w),m=w;break e;case"link":var A=Bv("link","href",S).get(m+(d.href||""));if(A){for(var L=0;L<A.length;L++)if(w=A[L],w.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&w.getAttribute("rel")===(d.rel==null?null:d.rel)&&w.getAttribute("title")===(d.title==null?null:d.title)&&w.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){A.splice(L,1);break t}}w=S.createElement(m),Un(w,m,d),S.head.appendChild(w);break;case"meta":if(A=Bv("meta","content",S).get(m+(d.content||""))){for(L=0;L<A.length;L++)if(w=A[L],w.getAttribute("content")===(d.content==null?null:""+d.content)&&w.getAttribute("name")===(d.name==null?null:d.name)&&w.getAttribute("property")===(d.property==null?null:d.property)&&w.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&w.getAttribute("charset")===(d.charSet==null?null:d.charSet)){A.splice(L,1);break t}}w=S.createElement(m),Un(w,m,d),S.head.appendChild(w);break;default:throw Error(s(468,m))}w[gn]=r,vn(w),m=w}r.stateNode=m}else Uv(S,r.type,r.stateNode);else r.stateNode=Vv(S,m,r.memoizedProps);else w!==m?(w===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):w.count--,m===null?Uv(S,r.type,r.stateNode):Vv(S,m,r.memoizedProps)):m===null&&r.stateNode!==null&&I0(r,r.memoizedProps,d.memoizedProps)}break;case 27:ir(o,r),sr(r),m&512&&(_n||d===null||Ai(d,d.return)),d!==null&&m&4&&I0(r,r.memoizedProps,d.memoizedProps);break;case 5:if(ir(o,r),sr(r),m&512&&(_n||d===null||Ai(d,d.return)),r.flags&32){S=r.stateNode;try{nr(S,"")}catch(Qe){zt(r,r.return,Qe)}}m&4&&r.stateNode!=null&&(S=r.memoizedProps,I0(r,S,d!==null?d.memoizedProps:S)),m&1024&&(L0=!0);break;case 6:if(ir(o,r),sr(r),m&4){if(r.stateNode===null)throw Error(s(162));m=r.memoizedProps,d=r.stateNode;try{d.nodeValue=m}catch(Qe){zt(r,r.return,Qe)}}break;case 3:if(Bd=null,S=Zr,Zr=Od(o.containerInfo),ir(o,r),Zr=S,sr(r),m&4&&d!==null&&d.memoizedState.isDehydrated)try{Go(o.containerInfo)}catch(Qe){zt(r,r.return,Qe)}L0&&(L0=!1,U2(r));break;case 4:m=Zr,Zr=Od(r.stateNode.containerInfo),ir(o,r),sr(r),Zr=m;break;case 12:ir(o,r),sr(r);break;case 31:ir(o,r),sr(r),m&4&&(m=r.updateQueue,m!==null&&(r.updateQueue=null,Td(r,m)));break;case 13:ir(o,r),sr(r),r.child.flags&8192&&r.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(Cd=Ge()),m&4&&(m=r.updateQueue,m!==null&&(r.updateQueue=null,Td(r,m)));break;case 22:S=r.memoizedState!==null;var G=d!==null&&d.memoizedState!==null,oe=Ki,ye=_n;if(Ki=oe||S,_n=ye||G,ir(o,r),_n=ye,Ki=oe,sr(r),m&8192)e:for(o=r.stateNode,o._visibility=S?o._visibility&-2:o._visibility|1,S&&(d===null||G||Ki||_n||qa(r)),d=null,o=r;;){if(o.tag===5||o.tag===26){if(d===null){G=d=o;try{if(w=G.stateNode,S)A=w.style,typeof A.setProperty=="function"?A.setProperty("display","none","important"):A.display="none";else{L=G.stateNode;var Ae=G.memoizedProps.style,ue=Ae!=null&&Ae.hasOwnProperty("display")?Ae.display:null;L.style.display=ue==null||typeof ue=="boolean"?"":(""+ue).trim()}}catch(Qe){zt(G,G.return,Qe)}}}else if(o.tag===6){if(d===null){G=o;try{G.stateNode.nodeValue=S?"":G.memoizedProps}catch(Qe){zt(G,G.return,Qe)}}}else if(o.tag===18){if(d===null){G=o;try{var pe=G.stateNode;S?Rv(pe,!0):Rv(G.stateNode,!1)}catch(Qe){zt(G,G.return,Qe)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===r)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;d===o&&(d=null),o=o.return}d===o&&(d=null),o.sibling.return=o.return,o=o.sibling}m&4&&(m=r.updateQueue,m!==null&&(d=m.retryQueue,d!==null&&(m.retryQueue=null,Td(r,d))));break;case 19:ir(o,r),sr(r),m&4&&(m=r.updateQueue,m!==null&&(r.updateQueue=null,Td(r,m)));break;case 30:break;case 21:break;default:ir(o,r),sr(r)}}function sr(r){var o=r.flags;if(o&2){try{for(var d,m=r.return;m!==null;){if(I2(m)){d=m;break}m=m.return}if(d==null)throw Error(s(160));switch(d.tag){case 27:var S=d.stateNode,w=D0(r);xd(r,w,S);break;case 5:var A=d.stateNode;d.flags&32&&(nr(A,""),d.flags&=-33);var L=D0(r);xd(r,L,A);break;case 3:case 4:var G=d.stateNode.containerInfo,oe=D0(r);N0(r,oe,G);break;default:throw Error(s(161))}}catch(ye){zt(r,r.return,ye)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function U2(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var o=r;U2(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),r=r.sibling}}function Zi(r,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)L2(r,o.alternate,o),o=o.sibling}function qa(r){for(r=r.child;r!==null;){var o=r;switch(o.tag){case 0:case 11:case 14:case 15:Ls(4,o,o.return),qa(o);break;case 1:Ai(o,o.return);var d=o.stateNode;typeof d.componentWillUnmount=="function"&&R2(o,o.return,d),qa(o);break;case 27:Cc(o.stateNode);case 26:case 5:Ai(o,o.return),qa(o);break;case 22:o.memoizedState===null&&qa(o);break;case 30:qa(o);break;default:qa(o)}r=r.sibling}}function es(r,o,d){for(d=d&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var m=o.alternate,S=r,w=o,A=w.flags;switch(w.tag){case 0:case 11:case 15:es(S,w,d),gc(4,w);break;case 1:if(es(S,w,d),m=w,S=m.stateNode,typeof S.componentDidMount=="function")try{S.componentDidMount()}catch(oe){zt(m,m.return,oe)}if(m=w,S=m.updateQueue,S!==null){var L=m.stateNode;try{var G=S.shared.hiddenCallbacks;if(G!==null)for(S.shared.hiddenCallbacks=null,S=0;S<G.length;S++)y1(G[S],L)}catch(oe){zt(m,m.return,oe)}}d&&A&64&&M2(w),vc(w,w.return);break;case 27:D2(w);case 26:case 5:es(S,w,d),d&&m===null&&A&4&&k2(w),vc(w,w.return);break;case 12:es(S,w,d);break;case 31:es(S,w,d),d&&A&4&&O2(S,w);break;case 13:es(S,w,d),d&&A&4&&V2(S,w);break;case 22:w.memoizedState===null&&es(S,w,d),vc(w,w.return);break;case 30:break;default:es(S,w,d)}o=o.sibling}}function P0(r,o){var d=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),r=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(r=o.memoizedState.cachePool.pool),r!==d&&(r!=null&&r.refCount++,d!=null&&rc(d))}function z0(r,o){r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&rc(r))}function ei(r,o,d,m){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)q2(r,o,d,m),o=o.sibling}function q2(r,o,d,m){var S=o.flags;switch(o.tag){case 0:case 11:case 15:ei(r,o,d,m),S&2048&&gc(9,o);break;case 1:ei(r,o,d,m);break;case 3:ei(r,o,d,m),S&2048&&(r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&rc(r)));break;case 12:if(S&2048){ei(r,o,d,m),r=o.stateNode;try{var w=o.memoizedProps,A=w.id,L=w.onPostCommit;typeof L=="function"&&L(A,o.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(G){zt(o,o.return,G)}}else ei(r,o,d,m);break;case 31:ei(r,o,d,m);break;case 13:ei(r,o,d,m);break;case 23:break;case 22:w=o.stateNode,A=o.alternate,o.memoizedState!==null?w._visibility&2?ei(r,o,d,m):yc(r,o):w._visibility&2?ei(r,o,d,m):(w._visibility|=2,Po(r,o,d,m,(o.subtreeFlags&10256)!==0||!1)),S&2048&&P0(A,o);break;case 24:ei(r,o,d,m),S&2048&&z0(o.alternate,o);break;default:ei(r,o,d,m)}}function Po(r,o,d,m,S){for(S=S&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var w=r,A=o,L=d,G=m,oe=A.flags;switch(A.tag){case 0:case 11:case 15:Po(w,A,L,G,S),gc(8,A);break;case 23:break;case 22:var ye=A.stateNode;A.memoizedState!==null?ye._visibility&2?Po(w,A,L,G,S):yc(w,A):(ye._visibility|=2,Po(w,A,L,G,S)),S&&oe&2048&&P0(A.alternate,A);break;case 24:Po(w,A,L,G,S),S&&oe&2048&&z0(A.alternate,A);break;default:Po(w,A,L,G,S)}o=o.sibling}}function yc(r,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var d=r,m=o,S=m.flags;switch(m.tag){case 22:yc(d,m),S&2048&&P0(m.alternate,m);break;case 24:yc(d,m),S&2048&&z0(m.alternate,m);break;default:yc(d,m)}o=o.sibling}}var bc=8192;function zo(r,o,d){if(r.subtreeFlags&bc)for(r=r.child;r!==null;)H2(r,o,d),r=r.sibling}function H2(r,o,d){switch(r.tag){case 26:zo(r,o,d),r.flags&bc&&r.memoizedState!==null&&Bw(d,Zr,r.memoizedState,r.memoizedProps);break;case 5:zo(r,o,d);break;case 3:case 4:var m=Zr;Zr=Od(r.stateNode.containerInfo),zo(r,o,d),Zr=m;break;case 22:r.memoizedState===null&&(m=r.alternate,m!==null&&m.memoizedState!==null?(m=bc,bc=16777216,zo(r,o,d),bc=m):zo(r,o,d));break;default:zo(r,o,d)}}function F2(r){var o=r.alternate;if(o!==null&&(r=o.child,r!==null)){o.child=null;do o=r.sibling,r.sibling=null,r=o;while(r!==null)}}function Sc(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var m=o[d];In=m,W2(m,r)}F2(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)$2(r),r=r.sibling}function $2(r){switch(r.tag){case 0:case 11:case 15:Sc(r),r.flags&2048&&Ls(9,r,r.return);break;case 3:Sc(r);break;case 12:Sc(r);break;case 22:var o=r.stateNode;r.memoizedState!==null&&o._visibility&2&&(r.return===null||r.return.tag!==13)?(o._visibility&=-3,Ed(r)):Sc(r);break;default:Sc(r)}}function Ed(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var m=o[d];In=m,W2(m,r)}F2(r)}for(r=r.child;r!==null;){switch(o=r,o.tag){case 0:case 11:case 15:Ls(8,o,o.return),Ed(o);break;case 22:d=o.stateNode,d._visibility&2&&(d._visibility&=-3,Ed(o));break;default:Ed(o)}r=r.sibling}}function W2(r,o){for(;In!==null;){var d=In;switch(d.tag){case 0:case 11:case 15:Ls(8,d,o);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var m=d.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:rc(d.memoizedState.cache)}if(m=d.child,m!==null)m.return=d,In=m;else e:for(d=r;In!==null;){m=In;var S=m.sibling,w=m.return;if(P2(m),m===d){In=null;break e}if(S!==null){S.return=w,In=S;break e}In=w}}}var tw={getCacheForType:function(r){var o=Vn(bn),d=o.data.get(r);return d===void 0&&(d=r(),o.data.set(r,d)),d},cacheSignal:function(){return Vn(bn).controller.signal}},nw=typeof WeakMap=="function"?WeakMap:Map,Dt=0,$t=null,gt=null,yt=0,Pt=0,vr=null,Ps=!1,Oo=!1,O0=!1,ts=0,cn=0,zs=0,Ha=0,V0=0,yr=0,Vo=0,wc=null,ar=null,B0=!1,Cd=0,G2=0,Ad=1/0,jd=null,Os=null,jn=0,Vs=null,Bo=null,ns=0,U0=0,q0=null,Q2=null,_c=0,H0=null;function br(){return(Dt&2)!==0&&yt!==0?yt&-yt:W.T!==null?X0():Mu()}function X2(){if(yr===0)if((yt&536870912)===0||Tt){var r=Pn;Pn<<=1,(Pn&3932160)===0&&(Pn=262144),yr=r}else yr=536870912;return r=mr.current,r!==null&&(r.flags|=32),yr}function or(r,o,d){(r===$t&&(Pt===2||Pt===9)||r.cancelPendingCommit!==null)&&(Uo(r,0),Bs(r,yt,yr,!1)),va(r,d),((Dt&2)===0||r!==$t)&&(r===$t&&((Dt&2)===0&&(Ha|=d),cn===4&&Bs(r,yt,yr,!1)),ji(r))}function Y2(r,o,d){if((Dt&6)!==0)throw Error(s(327));var m=!d&&(o&127)===0&&(o&r.expiredLanes)===0||Jt(r,o),S=m?sw(r,o):$0(r,o,!0),w=m;do{if(S===0){Oo&&!m&&Bs(r,o,0,!1);break}else{if(d=r.current.alternate,w&&!rw(d)){S=$0(r,o,!1),w=!1;continue}if(S===2){if(w=o,r.errorRecoveryDisabledLanes&w)var A=0;else A=r.pendingLanes&-536870913,A=A!==0?A:A&536870912?536870912:0;if(A!==0){o=A;e:{var L=r;S=wc;var G=L.current.memoizedState.isDehydrated;if(G&&(Uo(L,A).flags|=256),A=$0(L,A,!1),A!==2){if(O0&&!G){L.errorRecoveryDisabledLanes|=w,Ha|=w,S=4;break e}w=ar,ar=S,w!==null&&(ar===null?ar=w:ar.push.apply(ar,w))}S=A}if(w=!1,S!==2)continue}}if(S===1){Uo(r,0),Bs(r,o,0,!0);break}e:{switch(m=r,w=S,w){case 0:case 1:throw Error(s(345));case 4:if((o&4194048)!==o)break;case 6:Bs(m,o,yr,!Ps);break e;case 2:ar=null;break;case 3:case 5:break;default:throw Error(s(329))}if((o&62914560)===o&&(S=Cd+300-Ge(),10<S)){if(Bs(m,o,yr,!Ps),Nt(m,0,!0)!==0)break e;ns=o,m.timeoutHandle=Av(K2.bind(null,m,d,ar,jd,B0,o,yr,Ha,Vo,Ps,w,"Throttled",-0,0),S);break e}K2(m,d,ar,jd,B0,o,yr,Ha,Vo,Ps,w,null,-0,0)}}break}while(!0);ji(r)}function K2(r,o,d,m,S,w,A,L,G,oe,ye,Ae,ue,pe){if(r.timeoutHandle=-1,Ae=o.subtreeFlags,Ae&8192||(Ae&16785408)===16785408){Ae={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Gr},H2(o,w,Ae);var Qe=(w&62914560)===w?Cd-Ge():(w&4194048)===w?G2-Ge():0;if(Qe=Uw(Ae,Qe),Qe!==null){ns=w,r.cancelPendingCommit=Qe(sv.bind(null,r,o,w,d,m,S,A,L,G,ye,Ae,null,ue,pe)),Bs(r,w,A,!oe);return}}sv(r,o,w,d,m,S,A,L,G)}function rw(r){for(var o=r;;){var d=o.tag;if((d===0||d===11||d===15)&&o.flags&16384&&(d=o.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var m=0;m<d.length;m++){var S=d[m],w=S.getSnapshot;S=S.value;try{if(!hr(w(),S))return!1}catch{return!1}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Bs(r,o,d,m){o&=~V0,o&=~Ha,r.suspendedLanes|=o,r.pingedLanes&=~o,m&&(r.warmLanes|=o),m=r.expirationTimes;for(var S=o;0<S;){var w=31-$e(S),A=1<<w;m[w]=-1,S&=~A}d!==0&&ya(r,d,o)}function Md(){return(Dt&6)===0?(xc(0),!1):!0}function F0(){if(gt!==null){if(Pt===0)var r=gt.return;else r=gt,$i=Na=null,a0(r),ko=null,sc=0,r=gt;for(;r!==null;)j2(r.alternate,r),r=r.return;gt=null}}function Uo(r,o){var d=r.timeoutHandle;d!==-1&&(r.timeoutHandle=-1,xw(d)),d=r.cancelPendingCommit,d!==null&&(r.cancelPendingCommit=null,d()),ns=0,F0(),$t=r,gt=d=Hi(r.current,null),yt=o,Pt=0,vr=null,Ps=!1,Oo=Jt(r,o),O0=!1,Vo=yr=V0=Ha=zs=cn=0,ar=wc=null,B0=!1,(o&8)!==0&&(o|=o&32);var m=r.entangledLanes;if(m!==0)for(r=r.entanglements,m&=o;0<m;){var S=31-$e(m),w=1<<S;o|=r[S],m&=~w}return ts=o,Yu(),d}function J2(r,o){pt=null,W.H=hc,o===Ro||o===id?(o=p1(),Pt=3):o===Qh?(o=p1(),Pt=4):Pt=o===_0?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,vr=o,gt===null&&(cn=1,yd(r,Ir(o,r.current)))}function Z2(){var r=mr.current;return r===null?!0:(yt&4194048)===yt?Pr===null:(yt&62914560)===yt||(yt&536870912)!==0?r===Pr:!1}function ev(){var r=W.H;return W.H=hc,r===null?hc:r}function tv(){var r=W.A;return W.A=tw,r}function Rd(){cn=4,Ps||(yt&4194048)!==yt&&mr.current!==null||(Oo=!0),(zs&134217727)===0&&(Ha&134217727)===0||$t===null||Bs($t,yt,yr,!1)}function $0(r,o,d){var m=Dt;Dt|=2;var S=ev(),w=tv();($t!==r||yt!==o)&&(jd=null,Uo(r,o)),o=!1;var A=cn;e:do try{if(Pt!==0&&gt!==null){var L=gt,G=vr;switch(Pt){case 8:F0(),A=6;break e;case 3:case 2:case 9:case 6:mr.current===null&&(o=!0);var oe=Pt;if(Pt=0,vr=null,qo(r,L,G,oe),d&&Oo){A=0;break e}break;default:oe=Pt,Pt=0,vr=null,qo(r,L,G,oe)}}iw(),A=cn;break}catch(ye){J2(r,ye)}while(!0);return o&&r.shellSuspendCounter++,$i=Na=null,Dt=m,W.H=S,W.A=w,gt===null&&($t=null,yt=0,Yu()),A}function iw(){for(;gt!==null;)nv(gt)}function sw(r,o){var d=Dt;Dt|=2;var m=ev(),S=tv();$t!==r||yt!==o?(jd=null,Ad=Ge()+500,Uo(r,o)):Oo=Jt(r,o);e:do try{if(Pt!==0&&gt!==null){o=gt;var w=vr;t:switch(Pt){case 1:Pt=0,vr=null,qo(r,o,w,1);break;case 2:case 9:if(f1(w)){Pt=0,vr=null,rv(o);break}o=function(){Pt!==2&&Pt!==9||$t!==r||(Pt=7),ji(r)},w.then(o,o);break e;case 3:Pt=7;break e;case 4:Pt=5;break e;case 7:f1(w)?(Pt=0,vr=null,rv(o)):(Pt=0,vr=null,qo(r,o,w,7));break;case 5:var A=null;switch(gt.tag){case 26:A=gt.memoizedState;case 5:case 27:var L=gt;if(A?qv(A):L.stateNode.complete){Pt=0,vr=null;var G=L.sibling;if(G!==null)gt=G;else{var oe=L.return;oe!==null?(gt=oe,kd(oe)):gt=null}break t}}Pt=0,vr=null,qo(r,o,w,5);break;case 6:Pt=0,vr=null,qo(r,o,w,6);break;case 8:F0(),cn=6;break e;default:throw Error(s(462))}}aw();break}catch(ye){J2(r,ye)}while(!0);return $i=Na=null,W.H=m,W.A=S,Dt=d,gt!==null?0:($t=null,yt=0,Yu(),cn)}function aw(){for(;gt!==null&&!Te();)nv(gt)}function nv(r){var o=C2(r.alternate,r,ts);r.memoizedProps=r.pendingProps,o===null?kd(r):gt=o}function rv(r){var o=r,d=o.alternate;switch(o.tag){case 15:case 0:o=S2(d,o,o.pendingProps,o.type,void 0,yt);break;case 11:o=S2(d,o,o.pendingProps,o.type.render,o.ref,yt);break;case 5:a0(o);default:j2(d,o),o=gt=t1(o,ts),o=C2(d,o,ts)}r.memoizedProps=r.pendingProps,o===null?kd(r):gt=o}function qo(r,o,d,m){$i=Na=null,a0(o),ko=null,sc=0;var S=o.return;try{if(QS(r,S,o,d,yt)){cn=1,yd(r,Ir(d,r.current)),gt=null;return}}catch(w){if(S!==null)throw gt=S,w;cn=1,yd(r,Ir(d,r.current)),gt=null;return}o.flags&32768?(Tt||m===1?r=!0:Oo||(yt&536870912)!==0?r=!1:(Ps=r=!0,(m===2||m===9||m===3||m===6)&&(m=mr.current,m!==null&&m.tag===13&&(m.flags|=16384))),iv(o,r)):kd(o)}function kd(r){var o=r;do{if((o.flags&32768)!==0){iv(o,Ps);return}r=o.return;var d=KS(o.alternate,o,ts);if(d!==null){gt=d;return}if(o=o.sibling,o!==null){gt=o;return}gt=o=r}while(o!==null);cn===0&&(cn=5)}function iv(r,o){do{var d=JS(r.alternate,r);if(d!==null){d.flags&=32767,gt=d;return}if(d=r.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!o&&(r=r.sibling,r!==null)){gt=r;return}gt=r=d}while(r!==null);cn=6,gt=null}function sv(r,o,d,m,S,w,A,L,G){r.cancelPendingCommit=null;do Id();while(jn!==0);if((Dt&6)!==0)throw Error(s(327));if(o!==null){if(o===r.current)throw Error(s(177));if(w=o.lanes|o.childLanes,w|=Dh,Th(r,d,w,A,L,G),r===$t&&(gt=$t=null,yt=0),Bo=o,Vs=r,ns=d,U0=w,q0=S,Q2=m,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,uw(dt,function(){return uv(),null})):(r.callbackNode=null,r.callbackPriority=0),m=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||m){m=W.T,W.T=null,S=J.p,J.p=2,A=Dt,Dt|=4;try{ZS(r,o,d)}finally{Dt=A,J.p=S,W.T=m}}jn=1,av(),ov(),lv()}}function av(){if(jn===1){jn=0;var r=Vs,o=Bo,d=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||d){d=W.T,W.T=null;var m=J.p;J.p=2;var S=Dt;Dt|=4;try{B2(o,r);var w=rp,A=Wg(r.containerInfo),L=w.focusedElem,G=w.selectionRange;if(A!==L&&L&&L.ownerDocument&&$g(L.ownerDocument.documentElement,L)){if(G!==null&&jh(L)){var oe=G.start,ye=G.end;if(ye===void 0&&(ye=oe),"selectionStart"in L)L.selectionStart=oe,L.selectionEnd=Math.min(ye,L.value.length);else{var Ae=L.ownerDocument||document,ue=Ae&&Ae.defaultView||window;if(ue.getSelection){var pe=ue.getSelection(),Qe=L.textContent.length,st=Math.min(G.start,Qe),Ht=G.end===void 0?st:Math.min(G.end,Qe);!pe.extend&&st>Ht&&(A=Ht,Ht=st,st=A);var ne=Fg(L,st),Y=Fg(L,Ht);if(ne&&Y&&(pe.rangeCount!==1||pe.anchorNode!==ne.node||pe.anchorOffset!==ne.offset||pe.focusNode!==Y.node||pe.focusOffset!==Y.offset)){var ae=Ae.createRange();ae.setStart(ne.node,ne.offset),pe.removeAllRanges(),st>Ht?(pe.addRange(ae),pe.extend(Y.node,Y.offset)):(ae.setEnd(Y.node,Y.offset),pe.addRange(ae))}}}}for(Ae=[],pe=L;pe=pe.parentNode;)pe.nodeType===1&&Ae.push({element:pe,left:pe.scrollLeft,top:pe.scrollTop});for(typeof L.focus=="function"&&L.focus(),L=0;L<Ae.length;L++){var Ee=Ae[L];Ee.element.scrollLeft=Ee.left,Ee.element.scrollTop=Ee.top}}Fd=!!np,rp=np=null}finally{Dt=S,J.p=m,W.T=d}}r.current=o,jn=2}}function ov(){if(jn===2){jn=0;var r=Vs,o=Bo,d=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||d){d=W.T,W.T=null;var m=J.p;J.p=2;var S=Dt;Dt|=4;try{L2(r,o.alternate,o)}finally{Dt=S,J.p=m,W.T=d}}jn=3}}function lv(){if(jn===4||jn===3){jn=0,Pe();var r=Vs,o=Bo,d=ns,m=Q2;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?jn=5:(jn=0,Bo=Vs=null,cv(r,r.pendingLanes));var S=r.pendingLanes;if(S===0&&(Os=null),Vi(d),o=o.stateNode,Ne&&typeof Ne.onCommitFiberRoot=="function")try{Ne.onCommitFiberRoot(Ft,o,void 0,(o.current.flags&128)===128)}catch{}if(m!==null){o=W.T,S=J.p,J.p=2,W.T=null;try{for(var w=r.onRecoverableError,A=0;A<m.length;A++){var L=m[A];w(L.value,{componentStack:L.stack})}}finally{W.T=o,J.p=S}}(ns&3)!==0&&Id(),ji(r),S=r.pendingLanes,(d&261930)!==0&&(S&42)!==0?r===H0?_c++:(_c=0,H0=r):_c=0,xc(0)}}function cv(r,o){(r.pooledCacheLanes&=o)===0&&(o=r.pooledCache,o!=null&&(r.pooledCache=null,rc(o)))}function Id(){return av(),ov(),lv(),uv()}function uv(){if(jn!==5)return!1;var r=Vs,o=U0;U0=0;var d=Vi(ns),m=W.T,S=J.p;try{J.p=32>d?32:d,W.T=null,d=q0,q0=null;var w=Vs,A=ns;if(jn=0,Bo=Vs=null,ns=0,(Dt&6)!==0)throw Error(s(331));var L=Dt;if(Dt|=4,$2(w.current),q2(w,w.current,A,d),Dt=L,xc(0,!1),Ne&&typeof Ne.onPostCommitFiberRoot=="function")try{Ne.onPostCommitFiberRoot(Ft,w)}catch{}return!0}finally{J.p=S,W.T=m,cv(r,o)}}function dv(r,o,d){o=Ir(d,o),o=w0(r.stateNode,o,2),r=Is(r,o,2),r!==null&&(va(r,2),ji(r))}function zt(r,o,d){if(r.tag===3)dv(r,r,d);else for(;o!==null;){if(o.tag===3){dv(o,r,d);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Os===null||!Os.has(m))){r=Ir(d,r),d=f2(2),m=Is(o,d,2),m!==null&&(h2(d,m,o,r),va(m,2),ji(m));break}}o=o.return}}function W0(r,o,d){var m=r.pingCache;if(m===null){m=r.pingCache=new nw;var S=new Set;m.set(o,S)}else S=m.get(o),S===void 0&&(S=new Set,m.set(o,S));S.has(d)||(O0=!0,S.add(d),r=ow.bind(null,r,o,d),o.then(r,r))}function ow(r,o,d){var m=r.pingCache;m!==null&&m.delete(o),r.pingedLanes|=r.suspendedLanes&d,r.warmLanes&=~d,$t===r&&(yt&d)===d&&(cn===4||cn===3&&(yt&62914560)===yt&&300>Ge()-Cd?(Dt&2)===0&&Uo(r,0):V0|=d,Vo===yt&&(Vo=0)),ji(r)}function fv(r,o){o===0&&(o=Oi()),r=ka(r,o),r!==null&&(va(r,o),ji(r))}function lw(r){var o=r.memoizedState,d=0;o!==null&&(d=o.retryLane),fv(r,d)}function cw(r,o){var d=0;switch(r.tag){case 31:case 13:var m=r.stateNode,S=r.memoizedState;S!==null&&(d=S.retryLane);break;case 19:m=r.stateNode;break;case 22:m=r.stateNode._retryCache;break;default:throw Error(s(314))}m!==null&&m.delete(o),fv(r,d)}function uw(r,o){return we(r,o)}var Dd=null,Ho=null,G0=!1,Nd=!1,Q0=!1,Us=0;function ji(r){r!==Ho&&r.next===null&&(Ho===null?Dd=Ho=r:Ho=Ho.next=r),Nd=!0,G0||(G0=!0,fw())}function xc(r,o){if(!Q0&&Nd){Q0=!0;do for(var d=!1,m=Dd;m!==null;){if(r!==0){var S=m.pendingLanes;if(S===0)var w=0;else{var A=m.suspendedLanes,L=m.pingedLanes;w=(1<<31-$e(42|r)+1)-1,w&=S&~(A&~L),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(d=!0,gv(m,w))}else w=yt,w=Nt(m,m===$t?w:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(w&3)===0||Jt(m,w)||(d=!0,gv(m,w));m=m.next}while(d);Q0=!1}}function dw(){hv()}function hv(){Nd=G0=!1;var r=0;Us!==0&&_w()&&(r=Us);for(var o=Ge(),d=null,m=Dd;m!==null;){var S=m.next,w=pv(m,o);w===0?(m.next=null,d===null?Dd=S:d.next=S,S===null&&(Ho=d)):(d=m,(r!==0||(w&3)!==0)&&(Nd=!0)),m=S}jn!==0&&jn!==5||xc(r),Us!==0&&(Us=0)}function pv(r,o){for(var d=r.suspendedLanes,m=r.pingedLanes,S=r.expirationTimes,w=r.pendingLanes&-62914561;0<w;){var A=31-$e(w),L=1<<A,G=S[A];G===-1?((L&d)===0||(L&m)!==0)&&(S[A]=ur(L,o)):G<=o&&(r.expiredLanes|=L),w&=~L}if(o=$t,d=yt,d=Nt(r,r===o?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),m=r.callbackNode,d===0||r===o&&(Pt===2||Pt===9)||r.cancelPendingCommit!==null)return m!==null&&m!==null&&Ce(m),r.callbackNode=null,r.callbackPriority=0;if((d&3)===0||Jt(r,d)){if(o=d&-d,o===r.callbackPriority)return o;switch(m!==null&&Ce(m),Vi(d)){case 2:case 8:d=Je;break;case 32:d=dt;break;case 268435456:d=Vt;break;default:d=dt}return m=mv.bind(null,r),d=we(d,m),r.callbackPriority=o,r.callbackNode=d,o}return m!==null&&m!==null&&Ce(m),r.callbackPriority=2,r.callbackNode=null,2}function mv(r,o){if(jn!==0&&jn!==5)return r.callbackNode=null,r.callbackPriority=0,null;var d=r.callbackNode;if(Id()&&r.callbackNode!==d)return null;var m=yt;return m=Nt(r,r===$t?m:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),m===0?null:(Y2(r,m,o),pv(r,Ge()),r.callbackNode!=null&&r.callbackNode===d?mv.bind(null,r):null)}function gv(r,o){if(Id())return null;Y2(r,o,!0)}function fw(){Tw(function(){(Dt&6)!==0?we(ze,dw):hv()})}function X0(){if(Us===0){var r=jo;r===0&&(r=xt,xt<<=1,(xt&261888)===0&&(xt=256)),Us=r}return Us}function vv(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:ho(""+r)}function yv(r,o){var d=o.ownerDocument.createElement("input");return d.name=o.name,d.value=o.value,r.id&&d.setAttribute("form",r.id),o.parentNode.insertBefore(d,o),r=new FormData(r),d.parentNode.removeChild(d),r}function hw(r,o,d,m,S){if(o==="submit"&&d&&d.stateNode===S){var w=vv((S[Rn]||null).action),A=m.submitter;A&&(o=(o=A[Rn]||null)?vv(o.formAction):A.getAttribute("formAction"),o!==null&&(w=o,A=null));var L=new wi("action","action",null,m,S);r.push({event:L,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(Us!==0){var G=A?yv(S,A):new FormData(S);m0(d,{pending:!0,data:G,method:S.method,action:w},null,G)}}else typeof w=="function"&&(L.preventDefault(),G=A?yv(S,A):new FormData(S),m0(d,{pending:!0,data:G,method:S.method,action:w},w,G))},currentTarget:S}]})}}for(var Y0=0;Y0<Ih.length;Y0++){var K0=Ih[Y0],pw=K0.toLowerCase(),mw=K0[0].toUpperCase()+K0.slice(1);Jr(pw,"on"+mw)}Jr(Xg,"onAnimationEnd"),Jr(Yg,"onAnimationIteration"),Jr(Kg,"onAnimationStart"),Jr("dblclick","onDoubleClick"),Jr("focusin","onFocus"),Jr("focusout","onBlur"),Jr(kS,"onTransitionRun"),Jr(IS,"onTransitionStart"),Jr(DS,"onTransitionCancel"),Jr(Jg,"onTransitionEnd"),vi("onMouseEnter",["mouseout","mouseover"]),vi("onMouseLeave",["mouseout","mouseover"]),vi("onPointerEnter",["pointerout","pointerover"]),vi("onPointerLeave",["pointerout","pointerover"]),gi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),gi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),gi("onBeforeInput",["compositionend","keypress","textInput","paste"]),gi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),gi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),gi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Tc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),gw=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Tc));function bv(r,o){o=(o&4)!==0;for(var d=0;d<r.length;d++){var m=r[d],S=m.event;m=m.listeners;e:{var w=void 0;if(o)for(var A=m.length-1;0<=A;A--){var L=m[A],G=L.instance,oe=L.currentTarget;if(L=L.listener,G!==w&&S.isPropagationStopped())break e;w=L,S.currentTarget=oe;try{w(S)}catch(ye){Xu(ye)}S.currentTarget=null,w=G}else for(A=0;A<m.length;A++){if(L=m[A],G=L.instance,oe=L.currentTarget,L=L.listener,G!==w&&S.isPropagationStopped())break e;w=L,S.currentTarget=oe;try{w(S)}catch(ye){Xu(ye)}S.currentTarget=null,w=G}}}}function vt(r,o){var d=o[oo];d===void 0&&(d=o[oo]=new Set);var m=r+"__bubble";d.has(m)||(Sv(o,r,2,!1),d.add(m))}function J0(r,o,d){var m=0;o&&(m|=4),Sv(d,r,m,o)}var Ld="_reactListening"+Math.random().toString(36).slice(2);function Z0(r){if(!r[Ld]){r[Ld]=!0,Pl.forEach(function(d){d!=="selectionchange"&&(gw.has(d)||J0(d,!1,r),J0(d,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[Ld]||(o[Ld]=!0,J0("selectionchange",!1,o))}}function Sv(r,o,d,m){switch(Xv(o)){case 2:var S=Fw;break;case 8:S=$w;break;default:S=pp}d=S.bind(null,o,d,r),S=void 0,!xa||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(S=!0),m?S!==void 0?r.addEventListener(o,d,{capture:!0,passive:S}):r.addEventListener(o,d,!0):S!==void 0?r.addEventListener(o,d,{passive:S}):r.addEventListener(o,d,!1)}function ep(r,o,d,m,S){var w=m;if((o&1)===0&&(o&2)===0&&m!==null)e:for(;;){if(m===null)return;var A=m.tag;if(A===3||A===4){var L=m.stateNode.containerInfo;if(L===S)break;if(A===4)for(A=m.return;A!==null;){var G=A.tag;if((G===3||G===4)&&A.stateNode.containerInfo===S)return;A=A.return}for(;L!==null;){if(A=pi(L),A===null)return;if(G=A.tag,G===5||G===6||G===26||G===27){m=w=A;continue e}L=L.parentNode}}m=m.return}_s(function(){var oe=w,ye=jr(d),Ae=[];e:{var ue=Zg.get(r);if(ue!==void 0){var pe=wi,Qe=r;switch(r){case"keypress":if(Ea(d)===0)break e;case"keydown":case"keyup":pe=Wu;break;case"focusin":Qe="focus",pe=Aa;break;case"focusout":Qe="blur",pe=Aa;break;case"beforeblur":case"afterblur":pe=Aa;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pe=Xl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pe=zu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pe=C;break;case Xg:case Yg:case Kg:pe=Vu;break;case Jg:pe=V;break;case"scroll":case"scrollend":pe=Ql;break;case"wheel":pe=he;break;case"copy":case"cut":case"paste":pe=Bu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pe=qi;break;case"toggle":case"beforetoggle":pe=ht}var st=(o&4)!==0,Ht=!st&&(r==="scroll"||r==="scrollend"),ne=st?ue!==null?ue+"Capture":null:ue;st=[];for(var Y=oe,ae;Y!==null;){var Ee=Y;if(ae=Ee.stateNode,Ee=Ee.tag,Ee!==5&&Ee!==26&&Ee!==27||ae===null||ne===null||(Ee=Qr(Y,ne),Ee!=null&&st.push(Ec(Y,Ee,ae))),Ht)break;Y=Y.return}0<st.length&&(ue=new pe(ue,Qe,null,d,ye),Ae.push({event:ue,listeners:st}))}}if((o&7)===0){e:{if(ue=r==="mouseover"||r==="pointerover",pe=r==="mouseout"||r==="pointerout",ue&&d!==$l&&(Qe=d.relatedTarget||d.fromElement)&&(pi(Qe)||Qe[fi]))break e;if((pe||ue)&&(ue=ye.window===ye?ye:(ue=ye.ownerDocument)?ue.defaultView||ue.parentWindow:window,pe?(Qe=d.relatedTarget||d.toElement,pe=oe,Qe=Qe?pi(Qe):null,Qe!==null&&(Ht=l(Qe),st=Qe.tag,Qe!==Ht||st!==5&&st!==27&&st!==6)&&(Qe=null)):(pe=null,Qe=oe),pe!==Qe)){if(st=Xl,Ee="onMouseLeave",ne="onMouseEnter",Y="mouse",(r==="pointerout"||r==="pointerover")&&(st=qi,Ee="onPointerLeave",ne="onPointerEnter",Y="pointer"),Ht=pe==null?ue:dr(pe),ae=Qe==null?ue:dr(Qe),ue=new st(Ee,Y+"leave",pe,d,ye),ue.target=Ht,ue.relatedTarget=ae,Ee=null,pi(ye)===oe&&(st=new st(ne,Y+"enter",Qe,d,ye),st.target=ae,st.relatedTarget=Ht,Ee=st),Ht=Ee,pe&&Qe)t:{for(st=vw,ne=pe,Y=Qe,ae=0,Ee=ne;Ee;Ee=st(Ee))ae++;Ee=0;for(var tt=Y;tt;tt=st(tt))Ee++;for(;0<ae-Ee;)ne=st(ne),ae--;for(;0<Ee-ae;)Y=st(Y),Ee--;for(;ae--;){if(ne===Y||Y!==null&&ne===Y.alternate){st=ne;break t}ne=st(ne),Y=st(Y)}st=null}else st=null;pe!==null&&wv(Ae,ue,pe,st,!1),Qe!==null&&Ht!==null&&wv(Ae,Ht,Qe,st,!0)}}e:{if(ue=oe?dr(oe):window,pe=ue.nodeName&&ue.nodeName.toLowerCase(),pe==="select"||pe==="input"&&ue.type==="file")var Rt=Og;else if(Pg(ue))if(Vg)Rt=jS;else{Rt=CS;var Ke=ES}else pe=ue.nodeName,!pe||pe.toLowerCase()!=="input"||ue.type!=="checkbox"&&ue.type!=="radio"?oe&&fo(oe.elementType)&&(Rt=Og):Rt=AS;if(Rt&&(Rt=Rt(r,oe))){zg(Ae,Rt,d,ye);break e}Ke&&Ke(r,ue,oe),r==="focusout"&&oe&&ue.type==="number"&&oe.memoizedProps.value!=null&&ql(ue,"number",ue.value)}switch(Ke=oe?dr(oe):window,r){case"focusin":(Pg(Ke)||Ke.contentEditable==="true")&&(So=Ke,Mh=oe,ec=null);break;case"focusout":ec=Mh=So=null;break;case"mousedown":Rh=!0;break;case"contextmenu":case"mouseup":case"dragend":Rh=!1,Gg(Ae,d,ye);break;case"selectionchange":if(RS)break;case"keydown":case"keyup":Gg(Ae,d,ye)}var mt;if(It)e:{switch(r){case"compositionstart":var bt="onCompositionStart";break e;case"compositionend":bt="onCompositionEnd";break e;case"compositionupdate":bt="onCompositionUpdate";break e}bt=void 0}else bo?ja(r,d)&&(bt="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(bt="onCompositionStart");bt&&(Ti&&d.locale!=="ko"&&(bo||bt!=="onCompositionStart"?bt==="onCompositionEnd"&&bo&&(mt=Gl()):(Si=ye,Wl="value"in Si?Si.value:Si.textContent,bo=!0)),Ke=Pd(oe,bt),0<Ke.length&&(bt=new xi(bt,r,null,d,ye),Ae.push({event:bt,listeners:Ke}),mt?bt.data=mt:(mt=yo(d),mt!==null&&(bt.data=mt)))),(mt=Rr?wS(r,d):_S(r,d))&&(bt=Pd(oe,"onBeforeInput"),0<bt.length&&(Ke=new xi("onBeforeInput","beforeinput",null,d,ye),Ae.push({event:Ke,listeners:bt}),Ke.data=mt)),hw(Ae,r,oe,d,ye)}bv(Ae,o)})}function Ec(r,o,d){return{instance:r,listener:o,currentTarget:d}}function Pd(r,o){for(var d=o+"Capture",m=[];r!==null;){var S=r,w=S.stateNode;if(S=S.tag,S!==5&&S!==26&&S!==27||w===null||(S=Qr(r,d),S!=null&&m.unshift(Ec(r,S,w)),S=Qr(r,o),S!=null&&m.push(Ec(r,S,w))),r.tag===3)return m;r=r.return}return[]}function vw(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function wv(r,o,d,m,S){for(var w=o._reactName,A=[];d!==null&&d!==m;){var L=d,G=L.alternate,oe=L.stateNode;if(L=L.tag,G!==null&&G===m)break;L!==5&&L!==26&&L!==27||oe===null||(G=oe,S?(oe=Qr(d,w),oe!=null&&A.unshift(Ec(d,oe,G))):S||(oe=Qr(d,w),oe!=null&&A.push(Ec(d,oe,G)))),d=d.return}A.length!==0&&r.push({event:o,listeners:A})}var yw=/\r\n?/g,bw=/\u0000|\uFFFD/g;function _v(r){return(typeof r=="string"?r:""+r).replace(yw,`
`).replace(bw,"")}function xv(r,o){return o=_v(o),_v(r)===o}function qt(r,o,d,m,S,w){switch(d){case"children":typeof m=="string"?o==="body"||o==="textarea"&&m===""||nr(r,m):(typeof m=="number"||typeof m=="bigint")&&o!=="body"&&nr(r,""+m);break;case"className":fr(r,"class",m);break;case"tabIndex":fr(r,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":fr(r,d,m);break;case"style":Fl(r,m,w);break;case"data":if(o!=="object"){fr(r,"data",m);break}case"src":case"href":if(m===""&&(o!=="a"||d!=="href")){r.removeAttribute(d);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){r.removeAttribute(d);break}m=ho(""+m),r.setAttribute(d,m);break;case"action":case"formAction":if(typeof m=="function"){r.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(d==="formAction"?(o!=="input"&&qt(r,o,"name",S.name,S,null),qt(r,o,"formEncType",S.formEncType,S,null),qt(r,o,"formMethod",S.formMethod,S,null),qt(r,o,"formTarget",S.formTarget,S,null)):(qt(r,o,"encType",S.encType,S,null),qt(r,o,"method",S.method,S,null),qt(r,o,"target",S.target,S,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){r.removeAttribute(d);break}m=ho(""+m),r.setAttribute(d,m);break;case"onClick":m!=null&&(r.onclick=Gr);break;case"onScroll":m!=null&&vt("scroll",r);break;case"onScrollEnd":m!=null&&vt("scrollend",r);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(d=m.__html,d!=null){if(S.children!=null)throw Error(s(60));r.innerHTML=d}}break;case"multiple":r.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":r.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){r.removeAttribute("xlink:href");break}d=ho(""+m),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?r.setAttribute(d,""+m):r.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?r.setAttribute(d,""):r.removeAttribute(d);break;case"capture":case"download":m===!0?r.setAttribute(d,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?r.setAttribute(d,m):r.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?r.setAttribute(d,m):r.removeAttribute(d);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?r.removeAttribute(d):r.setAttribute(d,m);break;case"popover":vt("beforetoggle",r),vt("toggle",r),co(r,"popover",m);break;case"xlinkActuate":yn(r,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":yn(r,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":yn(r,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":yn(r,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":yn(r,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":yn(r,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":yn(r,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":yn(r,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":yn(r,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":co(r,"is",m);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=Pu.get(d)||d,co(r,d,m))}}function tp(r,o,d,m,S,w){switch(d){case"style":Fl(r,m,w);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(d=m.__html,d!=null){if(S.children!=null)throw Error(s(60));r.innerHTML=d}}break;case"children":typeof m=="string"?nr(r,m):(typeof m=="number"||typeof m=="bigint")&&nr(r,""+m);break;case"onScroll":m!=null&&vt("scroll",r);break;case"onScrollEnd":m!=null&&vt("scrollend",r);break;case"onClick":m!=null&&(r.onclick=Gr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!zl.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(S=d.endsWith("Capture"),o=d.slice(2,S?d.length-7:void 0),w=r[Rn]||null,w=w!=null?w[d]:null,typeof w=="function"&&r.removeEventListener(o,w,S),typeof m=="function")){typeof w!="function"&&w!==null&&(d in r?r[d]=null:r.hasAttribute(d)&&r.removeAttribute(d)),r.addEventListener(o,m,S);break e}d in r?r[d]=m:m===!0?r.setAttribute(d,""):co(r,d,m)}}}function Un(r,o,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":vt("error",r),vt("load",r);var m=!1,S=!1,w;for(w in d)if(d.hasOwnProperty(w)){var A=d[w];if(A!=null)switch(w){case"src":m=!0;break;case"srcSet":S=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:qt(r,o,w,A,d,null)}}S&&qt(r,o,"srcSet",d.srcSet,d,null),m&&qt(r,o,"src",d.src,d,null);return;case"input":vt("invalid",r);var L=w=A=S=null,G=null,oe=null;for(m in d)if(d.hasOwnProperty(m)){var ye=d[m];if(ye!=null)switch(m){case"name":S=ye;break;case"type":A=ye;break;case"checked":G=ye;break;case"defaultChecked":oe=ye;break;case"value":w=ye;break;case"defaultValue":L=ye;break;case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(s(137,o));break;default:qt(r,o,m,ye,d,null)}}Du(r,w,L,G,oe,A,S,!1);return;case"select":vt("invalid",r),m=A=w=null;for(S in d)if(d.hasOwnProperty(S)&&(L=d[S],L!=null))switch(S){case"value":w=L;break;case"defaultValue":A=L;break;case"multiple":m=L;default:qt(r,o,S,L,d,null)}o=w,d=A,r.multiple=!!m,o!=null?ys(r,!!m,o,!1):d!=null&&ys(r,!!m,d,!0);return;case"textarea":vt("invalid",r),w=S=m=null;for(A in d)if(d.hasOwnProperty(A)&&(L=d[A],L!=null))switch(A){case"value":m=L;break;case"defaultValue":S=L;break;case"children":w=L;break;case"dangerouslySetInnerHTML":if(L!=null)throw Error(s(91));break;default:qt(r,o,A,L,d,null)}bs(r,m,S,w);return;case"option":for(G in d)d.hasOwnProperty(G)&&(m=d[G],m!=null)&&(G==="selected"?r.selected=m&&typeof m!="function"&&typeof m!="symbol":qt(r,o,G,m,d,null));return;case"dialog":vt("beforetoggle",r),vt("toggle",r),vt("cancel",r),vt("close",r);break;case"iframe":case"object":vt("load",r);break;case"video":case"audio":for(m=0;m<Tc.length;m++)vt(Tc[m],r);break;case"image":vt("error",r),vt("load",r);break;case"details":vt("toggle",r);break;case"embed":case"source":case"link":vt("error",r),vt("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(oe in d)if(d.hasOwnProperty(oe)&&(m=d[oe],m!=null))switch(oe){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:qt(r,o,oe,m,d,null)}return;default:if(fo(o)){for(ye in d)d.hasOwnProperty(ye)&&(m=d[ye],m!==void 0&&tp(r,o,ye,m,d,void 0));return}}for(L in d)d.hasOwnProperty(L)&&(m=d[L],m!=null&&qt(r,o,L,m,d,null))}function Sw(r,o,d,m){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var S=null,w=null,A=null,L=null,G=null,oe=null,ye=null;for(pe in d){var Ae=d[pe];if(d.hasOwnProperty(pe)&&Ae!=null)switch(pe){case"checked":break;case"value":break;case"defaultValue":G=Ae;default:m.hasOwnProperty(pe)||qt(r,o,pe,null,m,Ae)}}for(var ue in m){var pe=m[ue];if(Ae=d[ue],m.hasOwnProperty(ue)&&(pe!=null||Ae!=null))switch(ue){case"type":w=pe;break;case"name":S=pe;break;case"checked":oe=pe;break;case"defaultChecked":ye=pe;break;case"value":A=pe;break;case"defaultValue":L=pe;break;case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(s(137,o));break;default:pe!==Ae&&qt(r,o,ue,pe,m,Ae)}}uo(r,A,L,G,oe,ye,w,S);return;case"select":pe=A=L=ue=null;for(w in d)if(G=d[w],d.hasOwnProperty(w)&&G!=null)switch(w){case"value":break;case"multiple":pe=G;default:m.hasOwnProperty(w)||qt(r,o,w,null,m,G)}for(S in m)if(w=m[S],G=d[S],m.hasOwnProperty(S)&&(w!=null||G!=null))switch(S){case"value":ue=w;break;case"defaultValue":L=w;break;case"multiple":A=w;default:w!==G&&qt(r,o,S,w,m,G)}o=L,d=A,m=pe,ue!=null?ys(r,!!d,ue,!1):!!m!=!!d&&(o!=null?ys(r,!!d,o,!0):ys(r,!!d,d?[]:"",!1));return;case"textarea":pe=ue=null;for(L in d)if(S=d[L],d.hasOwnProperty(L)&&S!=null&&!m.hasOwnProperty(L))switch(L){case"value":break;case"children":break;default:qt(r,o,L,null,m,S)}for(A in m)if(S=m[A],w=d[A],m.hasOwnProperty(A)&&(S!=null||w!=null))switch(A){case"value":ue=S;break;case"defaultValue":pe=S;break;case"children":break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(s(91));break;default:S!==w&&qt(r,o,A,S,m,w)}Nu(r,ue,pe);return;case"option":for(var Qe in d)ue=d[Qe],d.hasOwnProperty(Qe)&&ue!=null&&!m.hasOwnProperty(Qe)&&(Qe==="selected"?r.selected=!1:qt(r,o,Qe,null,m,ue));for(G in m)ue=m[G],pe=d[G],m.hasOwnProperty(G)&&ue!==pe&&(ue!=null||pe!=null)&&(G==="selected"?r.selected=ue&&typeof ue!="function"&&typeof ue!="symbol":qt(r,o,G,ue,m,pe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var st in d)ue=d[st],d.hasOwnProperty(st)&&ue!=null&&!m.hasOwnProperty(st)&&qt(r,o,st,null,m,ue);for(oe in m)if(ue=m[oe],pe=d[oe],m.hasOwnProperty(oe)&&ue!==pe&&(ue!=null||pe!=null))switch(oe){case"children":case"dangerouslySetInnerHTML":if(ue!=null)throw Error(s(137,o));break;default:qt(r,o,oe,ue,m,pe)}return;default:if(fo(o)){for(var Ht in d)ue=d[Ht],d.hasOwnProperty(Ht)&&ue!==void 0&&!m.hasOwnProperty(Ht)&&tp(r,o,Ht,void 0,m,ue);for(ye in m)ue=m[ye],pe=d[ye],!m.hasOwnProperty(ye)||ue===pe||ue===void 0&&pe===void 0||tp(r,o,ye,ue,m,pe);return}}for(var ne in d)ue=d[ne],d.hasOwnProperty(ne)&&ue!=null&&!m.hasOwnProperty(ne)&&qt(r,o,ne,null,m,ue);for(Ae in m)ue=m[Ae],pe=d[Ae],!m.hasOwnProperty(Ae)||ue===pe||ue==null&&pe==null||qt(r,o,Ae,ue,m,pe)}function Tv(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ww(){if(typeof performance.getEntriesByType=="function"){for(var r=0,o=0,d=performance.getEntriesByType("resource"),m=0;m<d.length;m++){var S=d[m],w=S.transferSize,A=S.initiatorType,L=S.duration;if(w&&L&&Tv(A)){for(A=0,L=S.responseEnd,m+=1;m<d.length;m++){var G=d[m],oe=G.startTime;if(oe>L)break;var ye=G.transferSize,Ae=G.initiatorType;ye&&Tv(Ae)&&(G=G.responseEnd,A+=ye*(G<L?1:(L-oe)/(G-oe)))}if(--m,o+=8*(w+A)/(S.duration/1e3),r++,10<r)break}}if(0<r)return o/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var np=null,rp=null;function zd(r){return r.nodeType===9?r:r.ownerDocument}function Ev(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Cv(r,o){if(r===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&o==="foreignObject"?0:r}function ip(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var sp=null;function _w(){var r=window.event;return r&&r.type==="popstate"?r===sp?!1:(sp=r,!0):(sp=null,!1)}var Av=typeof setTimeout=="function"?setTimeout:void 0,xw=typeof clearTimeout=="function"?clearTimeout:void 0,jv=typeof Promise=="function"?Promise:void 0,Tw=typeof queueMicrotask=="function"?queueMicrotask:typeof jv<"u"?function(r){return jv.resolve(null).then(r).catch(Ew)}:Av;function Ew(r){setTimeout(function(){throw r})}function qs(r){return r==="head"}function Mv(r,o){var d=o,m=0;do{var S=d.nextSibling;if(r.removeChild(d),S&&S.nodeType===8)if(d=S.data,d==="/$"||d==="/&"){if(m===0){r.removeChild(S),Go(o);return}m--}else if(d==="$"||d==="$?"||d==="$~"||d==="$!"||d==="&")m++;else if(d==="html")Cc(r.ownerDocument.documentElement);else if(d==="head"){d=r.ownerDocument.head,Cc(d);for(var w=d.firstChild;w;){var A=w.nextSibling,L=w.nodeName;w[hi]||L==="SCRIPT"||L==="STYLE"||L==="LINK"&&w.rel.toLowerCase()==="stylesheet"||d.removeChild(w),w=A}}else d==="body"&&Cc(r.ownerDocument.body);d=S}while(d);Go(o)}function Rv(r,o){var d=r;r=0;do{var m=d.nextSibling;if(d.nodeType===1?o?(d._stashedDisplay=d.style.display,d.style.display="none"):(d.style.display=d._stashedDisplay||"",d.getAttribute("style")===""&&d.removeAttribute("style")):d.nodeType===3&&(o?(d._stashedText=d.nodeValue,d.nodeValue=""):d.nodeValue=d._stashedText||""),m&&m.nodeType===8)if(d=m.data,d==="/$"){if(r===0)break;r--}else d!=="$"&&d!=="$?"&&d!=="$~"&&d!=="$!"||r++;d=m}while(d)}function ap(r){var o=r.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var d=o;switch(o=o.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":ap(d),lo(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}r.removeChild(d)}}function Cw(r,o,d,m){for(;r.nodeType===1;){var S=d;if(r.nodeName.toLowerCase()!==o.toLowerCase()){if(!m&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(m){if(!r[hi])switch(o){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(w=r.getAttribute("rel"),w==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(w!==S.rel||r.getAttribute("href")!==(S.href==null||S.href===""?null:S.href)||r.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin)||r.getAttribute("title")!==(S.title==null?null:S.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(w=r.getAttribute("src"),(w!==(S.src==null?null:S.src)||r.getAttribute("type")!==(S.type==null?null:S.type)||r.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin))&&w&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(o==="input"&&r.type==="hidden"){var w=S.name==null?null:""+S.name;if(S.type==="hidden"&&r.getAttribute("name")===w)return r}else return r;if(r=zr(r.nextSibling),r===null)break}return null}function Aw(r,o,d){if(o==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!d||(r=zr(r.nextSibling),r===null))return null;return r}function kv(r,o){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!o||(r=zr(r.nextSibling),r===null))return null;return r}function op(r){return r.data==="$?"||r.data==="$~"}function lp(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function jw(r,o){var d=r.ownerDocument;if(r.data==="$~")r._reactRetry=o;else if(r.data!=="$?"||d.readyState!=="loading")o();else{var m=function(){o(),d.removeEventListener("DOMContentLoaded",m)};d.addEventListener("DOMContentLoaded",m),r._reactRetry=m}}function zr(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return r}var cp=null;function Iv(r){r=r.nextSibling;for(var o=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"||d==="/&"){if(o===0)return zr(r.nextSibling);o--}else d!=="$"&&d!=="$!"&&d!=="$?"&&d!=="$~"&&d!=="&"||o++}r=r.nextSibling}return null}function Dv(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"){if(o===0)return r;o--}else d!=="/$"&&d!=="/&"||o++}r=r.previousSibling}return null}function Nv(r,o,d){switch(o=zd(d),r){case"html":if(r=o.documentElement,!r)throw Error(s(452));return r;case"head":if(r=o.head,!r)throw Error(s(453));return r;case"body":if(r=o.body,!r)throw Error(s(454));return r;default:throw Error(s(451))}}function Cc(r){for(var o=r.attributes;o.length;)r.removeAttributeNode(o[0]);lo(r)}var Or=new Map,Lv=new Set;function Od(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var rs=J.d;J.d={f:Mw,r:Rw,D:kw,C:Iw,L:Dw,m:Nw,X:Pw,S:Lw,M:zw};function Mw(){var r=rs.f(),o=Md();return r||o}function Rw(r){var o=Ar(r);o!==null&&o.tag===5&&o.type==="form"?J1(o):rs.r(r)}var Fo=typeof document>"u"?null:document;function Pv(r,o,d){var m=Fo;if(m&&typeof o=="string"&&o){var S=tr(o);S='link[rel="'+r+'"][href="'+S+'"]',typeof d=="string"&&(S+='[crossorigin="'+d+'"]'),Lv.has(S)||(Lv.add(S),r={rel:r,crossOrigin:d,href:o},m.querySelector(S)===null&&(o=m.createElement("link"),Un(o,"link",r),vn(o),m.head.appendChild(o)))}}function kw(r){rs.D(r),Pv("dns-prefetch",r,null)}function Iw(r,o){rs.C(r,o),Pv("preconnect",r,o)}function Dw(r,o,d){rs.L(r,o,d);var m=Fo;if(m&&r&&o){var S='link[rel="preload"][as="'+tr(o)+'"]';o==="image"&&d&&d.imageSrcSet?(S+='[imagesrcset="'+tr(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(S+='[imagesizes="'+tr(d.imageSizes)+'"]')):S+='[href="'+tr(r)+'"]';var w=S;switch(o){case"style":w=$o(r);break;case"script":w=Wo(r)}Or.has(w)||(r=h({rel:"preload",href:o==="image"&&d&&d.imageSrcSet?void 0:r,as:o},d),Or.set(w,r),m.querySelector(S)!==null||o==="style"&&m.querySelector(Ac(w))||o==="script"&&m.querySelector(jc(w))||(o=m.createElement("link"),Un(o,"link",r),vn(o),m.head.appendChild(o)))}}function Nw(r,o){rs.m(r,o);var d=Fo;if(d&&r){var m=o&&typeof o.as=="string"?o.as:"script",S='link[rel="modulepreload"][as="'+tr(m)+'"][href="'+tr(r)+'"]',w=S;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=Wo(r)}if(!Or.has(w)&&(r=h({rel:"modulepreload",href:r},o),Or.set(w,r),d.querySelector(S)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(jc(w)))return}m=d.createElement("link"),Un(m,"link",r),vn(m),d.head.appendChild(m)}}}function Lw(r,o,d){rs.S(r,o,d);var m=Fo;if(m&&r){var S=mi(m).hoistableStyles,w=$o(r);o=o||"default";var A=S.get(w);if(!A){var L={loading:0,preload:null};if(A=m.querySelector(Ac(w)))L.loading=5;else{r=h({rel:"stylesheet",href:r,"data-precedence":o},d),(d=Or.get(w))&&up(r,d);var G=A=m.createElement("link");vn(G),Un(G,"link",r),G._p=new Promise(function(oe,ye){G.onload=oe,G.onerror=ye}),G.addEventListener("load",function(){L.loading|=1}),G.addEventListener("error",function(){L.loading|=2}),L.loading|=4,Vd(A,o,m)}A={type:"stylesheet",instance:A,count:1,state:L},S.set(w,A)}}}function Pw(r,o){rs.X(r,o);var d=Fo;if(d&&r){var m=mi(d).hoistableScripts,S=Wo(r),w=m.get(S);w||(w=d.querySelector(jc(S)),w||(r=h({src:r,async:!0},o),(o=Or.get(S))&&dp(r,o),w=d.createElement("script"),vn(w),Un(w,"link",r),d.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},m.set(S,w))}}function zw(r,o){rs.M(r,o);var d=Fo;if(d&&r){var m=mi(d).hoistableScripts,S=Wo(r),w=m.get(S);w||(w=d.querySelector(jc(S)),w||(r=h({src:r,async:!0,type:"module"},o),(o=Or.get(S))&&dp(r,o),w=d.createElement("script"),vn(w),Un(w,"link",r),d.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},m.set(S,w))}}function zv(r,o,d,m){var S=(S=O.current)?Od(S):null;if(!S)throw Error(s(446));switch(r){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(o=$o(d.href),d=mi(S).hoistableStyles,m=d.get(o),m||(m={type:"style",instance:null,count:0,state:null},d.set(o,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){r=$o(d.href);var w=mi(S).hoistableStyles,A=w.get(r);if(A||(S=S.ownerDocument||S,A={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(r,A),(w=S.querySelector(Ac(r)))&&!w._p&&(A.instance=w,A.state.loading=5),Or.has(r)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Or.set(r,d),w||Ow(S,r,d,A.state))),o&&m===null)throw Error(s(528,""));return A}if(o&&m!==null)throw Error(s(529,""));return null;case"script":return o=d.async,d=d.src,typeof d=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Wo(d),d=mi(S).hoistableScripts,m=d.get(o),m||(m={type:"script",instance:null,count:0,state:null},d.set(o,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,r))}}function $o(r){return'href="'+tr(r)+'"'}function Ac(r){return'link[rel="stylesheet"]['+r+"]"}function Ov(r){return h({},r,{"data-precedence":r.precedence,precedence:null})}function Ow(r,o,d,m){r.querySelector('link[rel="preload"][as="style"]['+o+"]")?m.loading=1:(o=r.createElement("link"),m.preload=o,o.addEventListener("load",function(){return m.loading|=1}),o.addEventListener("error",function(){return m.loading|=2}),Un(o,"link",d),vn(o),r.head.appendChild(o))}function Wo(r){return'[src="'+tr(r)+'"]'}function jc(r){return"script[async]"+r}function Vv(r,o,d){if(o.count++,o.instance===null)switch(o.type){case"style":var m=r.querySelector('style[data-href~="'+tr(d.href)+'"]');if(m)return o.instance=m,vn(m),m;var S=h({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return m=(r.ownerDocument||r).createElement("style"),vn(m),Un(m,"style",S),Vd(m,d.precedence,r),o.instance=m;case"stylesheet":S=$o(d.href);var w=r.querySelector(Ac(S));if(w)return o.state.loading|=4,o.instance=w,vn(w),w;m=Ov(d),(S=Or.get(S))&&up(m,S),w=(r.ownerDocument||r).createElement("link"),vn(w);var A=w;return A._p=new Promise(function(L,G){A.onload=L,A.onerror=G}),Un(w,"link",m),o.state.loading|=4,Vd(w,d.precedence,r),o.instance=w;case"script":return w=Wo(d.src),(S=r.querySelector(jc(w)))?(o.instance=S,vn(S),S):(m=d,(S=Or.get(w))&&(m=h({},d),dp(m,S)),r=r.ownerDocument||r,S=r.createElement("script"),vn(S),Un(S,"link",m),r.head.appendChild(S),o.instance=S);case"void":return null;default:throw Error(s(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(m=o.instance,o.state.loading|=4,Vd(m,d.precedence,r));return o.instance}function Vd(r,o,d){for(var m=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),S=m.length?m[m.length-1]:null,w=S,A=0;A<m.length;A++){var L=m[A];if(L.dataset.precedence===o)w=L;else if(w!==S)break}w?w.parentNode.insertBefore(r,w.nextSibling):(o=d.nodeType===9?d.head:d,o.insertBefore(r,o.firstChild))}function up(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.title==null&&(r.title=o.title)}function dp(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.integrity==null&&(r.integrity=o.integrity)}var Bd=null;function Bv(r,o,d){if(Bd===null){var m=new Map,S=Bd=new Map;S.set(d,m)}else S=Bd,m=S.get(d),m||(m=new Map,S.set(d,m));if(m.has(r))return m;for(m.set(r,null),d=d.getElementsByTagName(r),S=0;S<d.length;S++){var w=d[S];if(!(w[hi]||w[gn]||r==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var A=w.getAttribute(o)||"";A=r+A;var L=m.get(A);L?L.push(w):m.set(A,[w])}}return m}function Uv(r,o,d){r=r.ownerDocument||r,r.head.insertBefore(d,o==="title"?r.querySelector("head > title"):null)}function Vw(r,o,d){if(d===1||o.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;return o.rel==="stylesheet"?(r=o.disabled,typeof o.precedence=="string"&&r==null):!0;case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function qv(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function Bw(r,o,d,m){if(d.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var S=$o(m.href),w=o.querySelector(Ac(S));if(w){o=w._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(r.count++,r=Ud.bind(r),o.then(r,r)),d.state.loading|=4,d.instance=w,vn(w);return}w=o.ownerDocument||o,m=Ov(m),(S=Or.get(S))&&up(m,S),w=w.createElement("link"),vn(w);var A=w;A._p=new Promise(function(L,G){A.onload=L,A.onerror=G}),Un(w,"link",m),d.instance=w}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(d,o),(o=d.state.preload)&&(d.state.loading&3)===0&&(r.count++,d=Ud.bind(r),o.addEventListener("load",d),o.addEventListener("error",d))}}var fp=0;function Uw(r,o){return r.stylesheets&&r.count===0&&Hd(r,r.stylesheets),0<r.count||0<r.imgCount?function(d){var m=setTimeout(function(){if(r.stylesheets&&Hd(r,r.stylesheets),r.unsuspend){var w=r.unsuspend;r.unsuspend=null,w()}},6e4+o);0<r.imgBytes&&fp===0&&(fp=62500*ww());var S=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Hd(r,r.stylesheets),r.unsuspend)){var w=r.unsuspend;r.unsuspend=null,w()}},(r.imgBytes>fp?50:800)+o);return r.unsuspend=d,function(){r.unsuspend=null,clearTimeout(m),clearTimeout(S)}}:null}function Ud(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Hd(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var qd=null;function Hd(r,o){r.stylesheets=null,r.unsuspend!==null&&(r.count++,qd=new Map,o.forEach(qw,r),qd=null,Ud.call(r))}function qw(r,o){if(!(o.state.loading&4)){var d=qd.get(r);if(d)var m=d.get(null);else{d=new Map,qd.set(r,d);for(var S=r.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<S.length;w++){var A=S[w];(A.nodeName==="LINK"||A.getAttribute("media")!=="not all")&&(d.set(A.dataset.precedence,A),m=A)}m&&d.set(null,m)}S=o.instance,A=S.getAttribute("data-precedence"),w=d.get(A)||m,w===m&&d.set(null,S),d.set(A,S),this.count++,m=Ud.bind(this),S.addEventListener("load",m),S.addEventListener("error",m),w?w.parentNode.insertBefore(S,w.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(S,r.firstChild)),o.state.loading|=4}}var Mc={$$typeof:B,Provider:null,Consumer:null,_currentValue:ve,_currentValue2:ve,_threadCount:0};function Hw(r,o,d,m,S,w,A,L,G){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=di(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=di(0),this.hiddenUpdates=di(null),this.identifierPrefix=m,this.onUncaughtError=S,this.onCaughtError=w,this.onRecoverableError=A,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=G,this.incompleteTransitions=new Map}function Hv(r,o,d,m,S,w,A,L,G,oe,ye,Ae){return r=new Hw(r,o,d,A,G,oe,ye,Ae,L),o=1,w===!0&&(o|=24),w=pr(3,null,null,o),r.current=w,w.stateNode=r,o=$h(),o.refCount++,r.pooledCache=o,o.refCount++,w.memoizedState={element:m,isDehydrated:d,cache:o},Xh(w),r}function Fv(r){return r?(r=xo,r):xo}function $v(r,o,d,m,S,w){S=Fv(S),m.context===null?m.context=S:m.pendingContext=S,m=ks(o),m.payload={element:d},w=w===void 0?null:w,w!==null&&(m.callback=w),d=Is(r,m,o),d!==null&&(or(d,r,o),oc(d,r,o))}function Wv(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<o?d:o}}function hp(r,o){Wv(r,o),(r=r.alternate)&&Wv(r,o)}function Gv(r){if(r.tag===13||r.tag===31){var o=ka(r,67108864);o!==null&&or(o,r,67108864),hp(r,67108864)}}function Qv(r){if(r.tag===13||r.tag===31){var o=br();o=ba(o);var d=ka(r,o);d!==null&&or(d,r,o),hp(r,o)}}var Fd=!0;function Fw(r,o,d,m){var S=W.T;W.T=null;var w=J.p;try{J.p=2,pp(r,o,d,m)}finally{J.p=w,W.T=S}}function $w(r,o,d,m){var S=W.T;W.T=null;var w=J.p;try{J.p=8,pp(r,o,d,m)}finally{J.p=w,W.T=S}}function pp(r,o,d,m){if(Fd){var S=mp(m);if(S===null)ep(r,o,m,$d,d),Yv(r,m);else if(Gw(S,r,o,d,m))m.stopPropagation();else if(Yv(r,m),o&4&&-1<Ww.indexOf(r)){for(;S!==null;){var w=Ar(S);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var A=He(w.pendingLanes);if(A!==0){var L=w;for(L.pendingLanes|=2,L.entangledLanes|=2;A;){var G=1<<31-$e(A);L.entanglements[1]|=G,A&=~G}ji(w),(Dt&6)===0&&(Ad=Ge()+500,xc(0))}}break;case 31:case 13:L=ka(w,2),L!==null&&or(L,w,2),Md(),hp(w,2)}if(w=mp(m),w===null&&ep(r,o,m,$d,d),w===S)break;S=w}S!==null&&m.stopPropagation()}else ep(r,o,m,null,d)}}function mp(r){return r=jr(r),gp(r)}var $d=null;function gp(r){if($d=null,r=pi(r),r!==null){var o=l(r);if(o===null)r=null;else{var d=o.tag;if(d===13){if(r=i(o),r!==null)return r;r=null}else if(d===31){if(r=p(o),r!==null)return r;r=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return $d=r,null}function Xv(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ce()){case ze:return 2;case Je:return 8;case dt:case nt:return 32;case Vt:return 268435456;default:return 32}default:return 32}}var vp=!1,Hs=null,Fs=null,$s=null,Rc=new Map,kc=new Map,Ws=[],Ww="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Yv(r,o){switch(r){case"focusin":case"focusout":Hs=null;break;case"dragenter":case"dragleave":Fs=null;break;case"mouseover":case"mouseout":$s=null;break;case"pointerover":case"pointerout":Rc.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":kc.delete(o.pointerId)}}function Ic(r,o,d,m,S,w){return r===null||r.nativeEvent!==w?(r={blockedOn:o,domEventName:d,eventSystemFlags:m,nativeEvent:w,targetContainers:[S]},o!==null&&(o=Ar(o),o!==null&&Gv(o)),r):(r.eventSystemFlags|=m,o=r.targetContainers,S!==null&&o.indexOf(S)===-1&&o.push(S),r)}function Gw(r,o,d,m,S){switch(o){case"focusin":return Hs=Ic(Hs,r,o,d,m,S),!0;case"dragenter":return Fs=Ic(Fs,r,o,d,m,S),!0;case"mouseover":return $s=Ic($s,r,o,d,m,S),!0;case"pointerover":var w=S.pointerId;return Rc.set(w,Ic(Rc.get(w)||null,r,o,d,m,S)),!0;case"gotpointercapture":return w=S.pointerId,kc.set(w,Ic(kc.get(w)||null,r,o,d,m,S)),!0}return!1}function Kv(r){var o=pi(r.target);if(o!==null){var d=l(o);if(d!==null){if(o=d.tag,o===13){if(o=i(d),o!==null){r.blockedOn=o,$r(r.priority,function(){Qv(d)});return}}else if(o===31){if(o=p(d),o!==null){r.blockedOn=o,$r(r.priority,function(){Qv(d)});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Wd(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var d=mp(r.nativeEvent);if(d===null){d=r.nativeEvent;var m=new d.constructor(d.type,d);$l=m,d.target.dispatchEvent(m),$l=null}else return o=Ar(d),o!==null&&Gv(o),r.blockedOn=d,!1;o.shift()}return!0}function Jv(r,o,d){Wd(r)&&d.delete(o)}function Qw(){vp=!1,Hs!==null&&Wd(Hs)&&(Hs=null),Fs!==null&&Wd(Fs)&&(Fs=null),$s!==null&&Wd($s)&&($s=null),Rc.forEach(Jv),kc.forEach(Jv)}function Gd(r,o){r.blockedOn===o&&(r.blockedOn=null,vp||(vp=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Qw)))}var Qd=null;function Zv(r){Qd!==r&&(Qd=r,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Qd===r&&(Qd=null);for(var o=0;o<r.length;o+=3){var d=r[o],m=r[o+1],S=r[o+2];if(typeof m!="function"){if(gp(m||d)===null)continue;break}var w=Ar(d);w!==null&&(r.splice(o,3),o-=3,m0(w,{pending:!0,data:S,method:d.method,action:m},m,S))}}))}function Go(r){function o(G){return Gd(G,r)}Hs!==null&&Gd(Hs,r),Fs!==null&&Gd(Fs,r),$s!==null&&Gd($s,r),Rc.forEach(o),kc.forEach(o);for(var d=0;d<Ws.length;d++){var m=Ws[d];m.blockedOn===r&&(m.blockedOn=null)}for(;0<Ws.length&&(d=Ws[0],d.blockedOn===null);)Kv(d),d.blockedOn===null&&Ws.shift();if(d=(r.ownerDocument||r).$$reactFormReplay,d!=null)for(m=0;m<d.length;m+=3){var S=d[m],w=d[m+1],A=S[Rn]||null;if(typeof w=="function")A||Zv(d);else if(A){var L=null;if(w&&w.hasAttribute("formAction")){if(S=w,A=w[Rn]||null)L=A.formAction;else if(gp(S)!==null)continue}else L=A.action;typeof L=="function"?d[m+1]=L:(d.splice(m,3),m-=3),Zv(d)}}}function ey(){function r(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(A){return S=A})},focusReset:"manual",scroll:"manual"})}function o(){S!==null&&(S(),S=null),m||setTimeout(d,20)}function d(){if(!m&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,S=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(d,100),function(){m=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),S!==null&&(S(),S=null)}}}function yp(r){this._internalRoot=r}Xd.prototype.render=yp.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(s(409));var d=o.current,m=br();$v(d,m,r,o,null,null)},Xd.prototype.unmount=yp.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;$v(r.current,2,null,r,null,null),Md(),o[fi]=null}};function Xd(r){this._internalRoot=r}Xd.prototype.unstable_scheduleHydration=function(r){if(r){var o=Mu();r={blockedOn:null,target:r,priority:o};for(var d=0;d<Ws.length&&o!==0&&o<Ws[d].priority;d++);Ws.splice(d,0,r),d===0&&Kv(r)}};var ty=t.version;if(ty!=="19.2.4")throw Error(s(527,ty,"19.2.4"));J.findDOMNode=function(r){var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(s(188)):(r=Object.keys(r).join(","),Error(s(268,r)));return r=v(o),r=r!==null?u(r):null,r=r===null?null:r.stateNode,r};var Xw={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:W,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yd.isDisabled&&Yd.supportsFiber)try{Ft=Yd.inject(Xw),Ne=Yd}catch{}}return Nc.createRoot=function(r,o){if(!a(r))throw Error(s(299));var d=!1,m="",S=l2,w=c2,A=u2;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onUncaughtError!==void 0&&(S=o.onUncaughtError),o.onCaughtError!==void 0&&(w=o.onCaughtError),o.onRecoverableError!==void 0&&(A=o.onRecoverableError)),o=Hv(r,1,!1,null,null,d,m,null,S,w,A,ey),r[fi]=o.current,Z0(r),new yp(o)},Nc.hydrateRoot=function(r,o,d){if(!a(r))throw Error(s(299));var m=!1,S="",w=l2,A=c2,L=u2,G=null;return d!=null&&(d.unstable_strictMode===!0&&(m=!0),d.identifierPrefix!==void 0&&(S=d.identifierPrefix),d.onUncaughtError!==void 0&&(w=d.onUncaughtError),d.onCaughtError!==void 0&&(A=d.onCaughtError),d.onRecoverableError!==void 0&&(L=d.onRecoverableError),d.formState!==void 0&&(G=d.formState)),o=Hv(r,1,!0,o,d??null,m,S,G,w,A,L,ey),o.context=Fv(null),d=o.current,m=br(),m=ba(m),S=ks(m),S.callback=null,Is(d,S,m),d=m,o.current.lanes=d,va(o,d),ji(o),r[fi]=o.current,Z0(r),new Xd(o)},Nc.version="19.2.4",Nc}var dy;function s_(){if(dy)return wp.exports;dy=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),wp.exports=i_(),wp.exports}var a_=s_();var fy="popstate";function o_(e={}){function t(s,a){let{pathname:l,search:i,hash:p}=s.location;return Hp("",{pathname:l,search:i,hash:p},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(s,a){return typeof a=="string"?a:Yc(a)}return c_(t,n,null,e)}function tn(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Hr(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function l_(){return Math.random().toString(36).substring(2,10)}function hy(e,t){return{usr:e.state,key:e.key,idx:t}}function Hp(e,t,n=null,s){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?bl(t):t,state:n,key:t&&t.key||s||l_()}}function Yc({pathname:e="/",search:t="",hash:n=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function bl(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let s=e.indexOf("?");s>=0&&(t.search=e.substring(s),e=e.substring(0,s)),e&&(t.pathname=e)}return t}function c_(e,t,n,s={}){let{window:a=document.defaultView,v5Compat:l=!1}=s,i=a.history,p="POP",g=null,v=u();v==null&&(v=0,i.replaceState({...i.state,idx:v},""));function u(){return(i.state||{idx:null}).idx}function h(){p="POP";let E=u(),R=E==null?null:E-v;v=E,g&&g({action:p,location:_.location,delta:R})}function y(E,R){p="PUSH";let P=Hp(_.location,E,R);v=u()+1;let B=hy(P,v),X=_.createHref(P);try{i.pushState(B,"",X)}catch(Q){if(Q instanceof DOMException&&Q.name==="DataCloneError")throw Q;a.location.assign(X)}l&&g&&g({action:p,location:_.location,delta:1})}function x(E,R){p="REPLACE";let P=Hp(_.location,E,R);v=u();let B=hy(P,v),X=_.createHref(P);i.replaceState(B,"",X),l&&g&&g({action:p,location:_.location,delta:0})}function T(E){return u_(E)}let _={get action(){return p},get location(){return e(a,i)},listen(E){if(g)throw new Error("A history only accepts one active listener");return a.addEventListener(fy,h),g=E,()=>{a.removeEventListener(fy,h),g=null}},createHref(E){return t(a,E)},createURL:T,encodeLocation(E){let R=T(E);return{pathname:R.pathname,search:R.search,hash:R.hash}},push:y,replace:x,go(E){return i.go(E)}};return _}function u_(e,t=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),tn(n,"No window.location.(origin|href) available to create URL");let s=typeof e=="string"?e:Yc(e);return s=s.replace(/ $/,"%20"),!t&&s.startsWith("//")&&(s=n+s),new URL(s,n)}function f8(e,t,n="/"){return d_(e,t,n,!1)}function d_(e,t,n,s){let a=typeof t=="string"?bl(t):t,l=ds(a.pathname||"/",n);if(l==null)return null;let i=h8(e);f_(i);let p=null;for(let g=0;p==null&&g<i.length;++g){let v=x_(l);p=w_(i[g],v,s)}return p}function h8(e,t=[],n=[],s="",a=!1){let l=(i,p,g=a,v)=>{let u={relativePath:v===void 0?i.path||"":v,caseSensitive:i.caseSensitive===!0,childrenIndex:p,route:i};if(u.relativePath.startsWith("/")){if(!u.relativePath.startsWith(s)&&g)return;tn(u.relativePath.startsWith(s),`Absolute route path "${u.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),u.relativePath=u.relativePath.slice(s.length)}let h=cs([s,u.relativePath]),y=n.concat(u);i.children&&i.children.length>0&&(tn(i.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),h8(i.children,t,y,h,g)),!(i.path==null&&!i.index)&&t.push({path:h,score:b_(h,i.index),routesMeta:y})};return e.forEach((i,p)=>{if(i.path===""||!i.path?.includes("?"))l(i,p);else for(let g of p8(i.path))l(i,p,!0,g)}),t}function p8(e){let t=e.split("/");if(t.length===0)return[];let[n,...s]=t,a=n.endsWith("?"),l=n.replace(/\?$/,"");if(s.length===0)return a?[l,""]:[l];let i=p8(s.join("/")),p=[];return p.push(...i.map(g=>g===""?l:[l,g].join("/"))),a&&p.push(...i),p.map(g=>e.startsWith("/")&&g===""?"/":g)}function f_(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:S_(t.routesMeta.map(s=>s.childrenIndex),n.routesMeta.map(s=>s.childrenIndex)))}var h_=/^:[\w-]+$/,p_=3,m_=2,g_=1,v_=10,y_=-2,py=e=>e==="*";function b_(e,t){let n=e.split("/"),s=n.length;return n.some(py)&&(s+=y_),t&&(s+=m_),n.filter(a=>!py(a)).reduce((a,l)=>a+(h_.test(l)?p_:l===""?g_:v_),s)}function S_(e,t){return e.length===t.length&&e.slice(0,-1).every((s,a)=>s===t[a])?e[e.length-1]-t[t.length-1]:0}function w_(e,t,n=!1){let{routesMeta:s}=e,a={},l="/",i=[];for(let p=0;p<s.length;++p){let g=s[p],v=p===s.length-1,u=l==="/"?t:t.slice(l.length)||"/",h=Sf({path:g.relativePath,caseSensitive:g.caseSensitive,end:v},u),y=g.route;if(!h&&v&&n&&!s[s.length-1].route.index&&(h=Sf({path:g.relativePath,caseSensitive:g.caseSensitive,end:!1},u)),!h)return null;Object.assign(a,h.params),i.push({params:a,pathname:cs([l,h.pathname]),pathnameBase:A_(cs([l,h.pathnameBase])),route:y}),h.pathnameBase!=="/"&&(l=cs([l,h.pathnameBase]))}return i}function Sf(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,s]=__(e.path,e.caseSensitive,e.end),a=t.match(n);if(!a)return null;let l=a[0],i=l.replace(/(.)\/+$/,"$1"),p=a.slice(1);return{params:s.reduce((v,{paramName:u,isOptional:h},y)=>{if(u==="*"){let T=p[y]||"";i=l.slice(0,l.length-T.length).replace(/(.)\/+$/,"$1")}const x=p[y];return h&&!x?v[u]=void 0:v[u]=(x||"").replace(/%2F/g,"/"),v},{}),pathname:l,pathnameBase:i,pattern:e}}function __(e,t=!1,n=!0){Hr(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let s=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,p,g)=>(s.push({paramName:p,isOptional:g!=null}),g?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(s.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),s]}function x_(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Hr(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function ds(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,s=e.charAt(n);return s&&s!=="/"?null:e.slice(n)||"/"}var T_=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function E_(e,t="/"){let{pathname:n,search:s="",hash:a=""}=typeof e=="string"?bl(e):e,l;return n?(n=n.replace(/\/\/+/g,"/"),n.startsWith("/")?l=my(n.substring(1),"/"):l=my(n,t)):l=t,{pathname:l,search:j_(s),hash:M_(a)}}function my(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function Ep(e,t,n,s){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function C_(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function wm(e){let t=C_(e);return t.map((n,s)=>s===t.length-1?n.pathname:n.pathnameBase)}function _m(e,t,n,s=!1){let a;typeof e=="string"?a=bl(e):(a={...e},tn(!a.pathname||!a.pathname.includes("?"),Ep("?","pathname","search",a)),tn(!a.pathname||!a.pathname.includes("#"),Ep("#","pathname","hash",a)),tn(!a.search||!a.search.includes("#"),Ep("#","search","hash",a)));let l=e===""||a.pathname==="",i=l?"/":a.pathname,p;if(i==null)p=n;else{let h=t.length-1;if(!s&&i.startsWith("..")){let y=i.split("/");for(;y[0]==="..";)y.shift(),h-=1;a.pathname=y.join("/")}p=h>=0?t[h]:"/"}let g=E_(a,p),v=i&&i!=="/"&&i.endsWith("/"),u=(l||i===".")&&n.endsWith("/");return!g.pathname.endsWith("/")&&(v||u)&&(g.pathname+="/"),g}var cs=e=>e.join("/").replace(/\/\/+/g,"/"),A_=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),j_=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,M_=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,R_=class{constructor(e,t,n,s=!1){this.status=e,this.statusText=t||"",this.internal=s,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function k_(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}function I_(e){return e.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var m8=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function g8(e,t){let n=e;if(typeof n!="string"||!T_.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let s=n,a=!1;if(m8)try{let l=new URL(window.location.href),i=n.startsWith("//")?new URL(l.protocol+n):new URL(n),p=ds(i.pathname,t);i.origin===l.origin&&p!=null?n=p+i.search+i.hash:a=!0}catch{Hr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:s,isExternal:a,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var v8=["POST","PUT","PATCH","DELETE"];new Set(v8);var D_=["GET",...v8];new Set(D_);var Sl=M.createContext(null);Sl.displayName="DataRouter";var Jf=M.createContext(null);Jf.displayName="DataRouterState";var N_=M.createContext(!1),y8=M.createContext({isTransitioning:!1});y8.displayName="ViewTransition";var L_=M.createContext(new Map);L_.displayName="Fetchers";var P_=M.createContext(null);P_.displayName="Await";var Er=M.createContext(null);Er.displayName="Navigation";var lu=M.createContext(null);lu.displayName="Location";var li=M.createContext({outlet:null,matches:[],isDataRoute:!1});li.displayName="Route";var xm=M.createContext(null);xm.displayName="RouteError";var b8="REACT_ROUTER_ERROR",z_="REDIRECT",O_="ROUTE_ERROR_RESPONSE";function V_(e){if(e.startsWith(`${b8}:${z_}:{`))try{let t=JSON.parse(e.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function B_(e){if(e.startsWith(`${b8}:${O_}:{`))try{let t=JSON.parse(e.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new R_(t.status,t.statusText,t.data)}catch{}}function U_(e,{relative:t}={}){tn(wl(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:s}=M.useContext(Er),{hash:a,pathname:l,search:i}=cu(e,{relative:t}),p=l;return n!=="/"&&(p=l==="/"?n:cs([n,l])),s.createHref({pathname:p,search:i,hash:a})}function wl(){return M.useContext(lu)!=null}function ci(){return tn(wl(),"useLocation() may be used only in the context of a <Router> component."),M.useContext(lu).location}var S8="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function w8(e){M.useContext(Er).static||M.useLayoutEffect(e)}function ui(){let{isDataRoute:e}=M.useContext(li);return e?ex():q_()}function q_(){tn(wl(),"useNavigate() may be used only in the context of a <Router> component.");let e=M.useContext(Sl),{basename:t,navigator:n}=M.useContext(Er),{matches:s}=M.useContext(li),{pathname:a}=ci(),l=JSON.stringify(wm(s)),i=M.useRef(!1);return w8(()=>{i.current=!0}),M.useCallback((g,v={})=>{if(Hr(i.current,S8),!i.current)return;if(typeof g=="number"){n.go(g);return}let u=_m(g,JSON.parse(l),a,v.relative==="path");e==null&&t!=="/"&&(u.pathname=u.pathname==="/"?t:cs([t,u.pathname])),(v.replace?n.replace:n.push)(u,v.state,v)},[t,n,l,a,e])}M.createContext(null);function _l(){let{matches:e}=M.useContext(li),t=e[e.length-1];return t?t.params:{}}function cu(e,{relative:t}={}){let{matches:n}=M.useContext(li),{pathname:s}=ci(),a=JSON.stringify(wm(n));return M.useMemo(()=>_m(e,JSON.parse(a),s,t==="path"),[e,a,s,t])}function H_(e,t){return _8(e,t)}function _8(e,t,n,s,a){tn(wl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=M.useContext(Er),{matches:i}=M.useContext(li),p=i[i.length-1],g=p?p.params:{},v=p?p.pathname:"/",u=p?p.pathnameBase:"/",h=p&&p.route;{let P=h&&h.path||"";T8(v,!h||P.endsWith("*")||P.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${v}" (under <Route path="${P}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${P}"> to <Route path="${P==="/"?"*":`${P}/*`}">.`)}let y=ci(),x;if(t){let P=typeof t=="string"?bl(t):t;tn(u==="/"||P.pathname?.startsWith(u),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${P.pathname}" was given in the \`location\` prop.`),x=P}else x=y;let T=x.pathname||"/",_=T;if(u!=="/"){let P=u.replace(/^\//,"").split("/");_="/"+T.replace(/^\//,"").split("/").slice(P.length).join("/")}let E=f8(e,{pathname:_});Hr(h||E!=null,`No routes matched location "${x.pathname}${x.search}${x.hash}" `),Hr(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${x.pathname}${x.search}${x.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let R=Q_(E&&E.map(P=>Object.assign({},P,{params:Object.assign({},g,P.params),pathname:cs([u,l.encodeLocation?l.encodeLocation(P.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:P.pathname]),pathnameBase:P.pathnameBase==="/"?u:cs([u,l.encodeLocation?l.encodeLocation(P.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:P.pathnameBase])})),i,n,s,a);return t&&R?M.createElement(lu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...x},navigationType:"POP"}},R):R}function F_(){let e=Z_(),t=k_(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,s="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:s},l={padding:"2px 4px",backgroundColor:s},i=null;return console.error("Error handled by React Router default ErrorBoundary:",e),i=M.createElement(M.Fragment,null,M.createElement("p",null," Hey developer "),M.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",M.createElement("code",{style:l},"ErrorBoundary")," or"," ",M.createElement("code",{style:l},"errorElement")," prop on your route.")),M.createElement(M.Fragment,null,M.createElement("h2",null,"Unexpected Application Error!"),M.createElement("h3",{style:{fontStyle:"italic"}},t),n?M.createElement("pre",{style:a},n):null,i)}var $_=M.createElement(F_,null),x8=class extends M.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.onError?this.props.onError(e,t):console.error("React Router caught the following error during render",e)}render(){let e=this.state.error;if(this.context&&typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){const n=B_(e.digest);n&&(e=n)}let t=e!==void 0?M.createElement(li.Provider,{value:this.props.routeContext},M.createElement(xm.Provider,{value:e,children:this.props.component})):this.props.children;return this.context?M.createElement(W_,{error:e},t):t}};x8.contextType=N_;var Cp=new WeakMap;function W_({children:e,error:t}){let{basename:n}=M.useContext(Er);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let s=V_(t.digest);if(s){let a=Cp.get(t);if(a)throw a;let l=g8(s.location,n);if(m8&&!Cp.get(t))if(l.isExternal||s.reloadDocument)window.location.href=l.absoluteURL||l.to;else{const i=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(l.to,{replace:s.replace}));throw Cp.set(t,i),i}return M.createElement("meta",{httpEquiv:"refresh",content:`0;url=${l.absoluteURL||l.to}`})}}return e}function G_({routeContext:e,match:t,children:n}){let s=M.useContext(Sl);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),M.createElement(li.Provider,{value:e},n)}function Q_(e,t=[],n=null,s=null,a=null){if(e==null){if(!n)return null;if(n.errors)e=n.matches;else if(t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let l=e,i=n?.errors;if(i!=null){let u=l.findIndex(h=>h.route.id&&i?.[h.route.id]!==void 0);tn(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(i).join(",")}`),l=l.slice(0,Math.min(l.length,u+1))}let p=!1,g=-1;if(n)for(let u=0;u<l.length;u++){let h=l[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(g=u),h.route.id){let{loaderData:y,errors:x}=n,T=h.route.loader&&!y.hasOwnProperty(h.route.id)&&(!x||x[h.route.id]===void 0);if(h.route.lazy||T){p=!0,g>=0?l=l.slice(0,g+1):l=[l[0]];break}}}let v=n&&s?(u,h)=>{s(u,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:I_(n.matches),errorInfo:h})}:void 0;return l.reduceRight((u,h,y)=>{let x,T=!1,_=null,E=null;n&&(x=i&&h.route.id?i[h.route.id]:void 0,_=h.route.errorElement||$_,p&&(g<0&&y===0?(T8("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),T=!0,E=null):g===y&&(T=!0,E=h.route.hydrateFallbackElement||null)));let R=t.concat(l.slice(0,y+1)),P=()=>{let B;return x?B=_:T?B=E:h.route.Component?B=M.createElement(h.route.Component,null):h.route.element?B=h.route.element:B=u,M.createElement(G_,{match:h,routeContext:{outlet:u,matches:R,isDataRoute:n!=null},children:B})};return n&&(h.route.ErrorBoundary||h.route.errorElement||y===0)?M.createElement(x8,{location:n.location,revalidation:n.revalidation,component:_,error:x,children:P(),routeContext:{outlet:null,matches:R,isDataRoute:!0},onError:v}):P()},null)}function Tm(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function X_(e){let t=M.useContext(Sl);return tn(t,Tm(e)),t}function Y_(e){let t=M.useContext(Jf);return tn(t,Tm(e)),t}function K_(e){let t=M.useContext(li);return tn(t,Tm(e)),t}function Em(e){let t=K_(e),n=t.matches[t.matches.length-1];return tn(n.route.id,`${e} can only be used on routes that contain a unique "id"`),n.route.id}function J_(){return Em("useRouteId")}function Z_(){let e=M.useContext(xm),t=Y_("useRouteError"),n=Em("useRouteError");return e!==void 0?e:t.errors?.[n]}function ex(){let{router:e}=X_("useNavigate"),t=Em("useNavigate"),n=M.useRef(!1);return w8(()=>{n.current=!0}),M.useCallback(async(a,l={})=>{Hr(n.current,S8),n.current&&(typeof a=="number"?await e.navigate(a):await e.navigate(a,{fromRouteId:t,...l}))},[e,t])}var gy={};function T8(e,t,n){!t&&!gy[e]&&(gy[e]=!0,Hr(!1,n))}M.memo(tx);function tx({routes:e,future:t,state:n,onError:s}){return _8(e,void 0,n,s,t)}function E8({to:e,replace:t,state:n,relative:s}){tn(wl(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=M.useContext(Er);Hr(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:l}=M.useContext(li),{pathname:i}=ci(),p=ui(),g=_m(e,wm(l),i,s==="path"),v=JSON.stringify(g);return M.useEffect(()=>{p(JSON.parse(v),{replace:t,state:n,relative:s})},[p,v,s,t,n]),null}function lr(e){tn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function nx({basename:e="/",children:t=null,location:n,navigationType:s="POP",navigator:a,static:l=!1,unstable_useTransitions:i}){tn(!wl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let p=e.replace(/^\/*/,"/"),g=M.useMemo(()=>({basename:p,navigator:a,static:l,unstable_useTransitions:i,future:{}}),[p,a,l,i]);typeof n=="string"&&(n=bl(n));let{pathname:v="/",search:u="",hash:h="",state:y=null,key:x="default"}=n,T=M.useMemo(()=>{let _=ds(v,p);return _==null?null:{location:{pathname:_,search:u,hash:h,state:y,key:x},navigationType:s}},[p,v,u,h,y,x,s]);return Hr(T!=null,`<Router basename="${p}"> is not able to match the URL "${v}${u}${h}" because it does not start with the basename, so the <Router> won't render anything.`),T==null?null:M.createElement(Er.Provider,{value:g},M.createElement(lu.Provider,{children:t,value:T}))}function rx({children:e,location:t}){return H_(Fp(e),t)}function Fp(e,t=[]){let n=[];return M.Children.forEach(e,(s,a)=>{if(!M.isValidElement(s))return;let l=[...t,a];if(s.type===M.Fragment){n.push.apply(n,Fp(s.props.children,l));return}tn(s.type===lr,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),tn(!s.props.index||!s.props.children,"An index route cannot have child routes.");let i={id:s.props.id||l.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,middleware:s.props.middleware,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(i.children=Fp(s.props.children,l)),n.push(i)}),n}var of="get",lf="application/x-www-form-urlencoded";function Zf(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement}function ix(e){return Zf(e)&&e.tagName.toLowerCase()==="button"}function sx(e){return Zf(e)&&e.tagName.toLowerCase()==="form"}function ax(e){return Zf(e)&&e.tagName.toLowerCase()==="input"}function ox(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function lx(e,t){return e.button===0&&(!t||t==="_self")&&!ox(e)}function $p(e=""){return new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let s=e[n];return t.concat(Array.isArray(s)?s.map(a=>[n,a]):[[n,s]])},[]))}function cx(e,t){let n=$p(e);return t&&t.forEach((s,a)=>{n.has(a)||t.getAll(a).forEach(l=>{n.append(a,l)})}),n}var Kd=null;function ux(){if(Kd===null)try{new FormData(document.createElement("form"),0),Kd=!1}catch{Kd=!0}return Kd}var dx=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ap(e){return e!=null&&!dx.has(e)?(Hr(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${lf}"`),null):e}function fx(e,t){let n,s,a,l,i;if(sx(e)){let p=e.getAttribute("action");s=p?ds(p,t):null,n=e.getAttribute("method")||of,a=Ap(e.getAttribute("enctype"))||lf,l=new FormData(e)}else if(ix(e)||ax(e)&&(e.type==="submit"||e.type==="image")){let p=e.form;if(p==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let g=e.getAttribute("formaction")||p.getAttribute("action");if(s=g?ds(g,t):null,n=e.getAttribute("formmethod")||p.getAttribute("method")||of,a=Ap(e.getAttribute("formenctype"))||Ap(p.getAttribute("enctype"))||lf,l=new FormData(p,e),!ux()){let{name:v,type:u,value:h}=e;if(u==="image"){let y=v?`${v}.`:"";l.append(`${y}x`,"0"),l.append(`${y}y`,"0")}else v&&l.append(v,h)}}else{if(Zf(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=of,s=null,a=lf,i=e}return l&&a==="text/plain"&&(i=l,l=void 0),{action:s,method:n.toLowerCase(),encType:a,formData:l,body:i}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Cm(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function hx(e,t,n,s){let a=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return n?a.pathname.endsWith("/")?a.pathname=`${a.pathname}_.${s}`:a.pathname=`${a.pathname}.${s}`:a.pathname==="/"?a.pathname=`_root.${s}`:t&&ds(a.pathname,t)==="/"?a.pathname=`${t.replace(/\/$/,"")}/_root.${s}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${s}`,a}async function px(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(n){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function mx(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function gx(e,t,n){let s=await Promise.all(e.map(async a=>{let l=t.routes[a.route.id];if(l){let i=await px(l,n);return i.links?i.links():[]}return[]}));return Sx(s.flat(1).filter(mx).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function vy(e,t,n,s,a,l){let i=(g,v)=>n[v]?g.route.id!==n[v].route.id:!0,p=(g,v)=>n[v].pathname!==g.pathname||n[v].route.path?.endsWith("*")&&n[v].params["*"]!==g.params["*"];return l==="assets"?t.filter((g,v)=>i(g,v)||p(g,v)):l==="data"?t.filter((g,v)=>{let u=s.routes[g.route.id];if(!u||!u.hasLoader)return!1;if(i(g,v)||p(g,v))return!0;if(g.route.shouldRevalidate){let h=g.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:g.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function vx(e,t,{includeHydrateFallback:n}={}){return yx(e.map(s=>{let a=t.routes[s.route.id];if(!a)return[];let l=[a.module];return a.clientActionModule&&(l=l.concat(a.clientActionModule)),a.clientLoaderModule&&(l=l.concat(a.clientLoaderModule)),n&&a.hydrateFallbackModule&&(l=l.concat(a.hydrateFallbackModule)),a.imports&&(l=l.concat(a.imports)),l}).flat(1))}function yx(e){return[...new Set(e)]}function bx(e){let t={},n=Object.keys(e).sort();for(let s of n)t[s]=e[s];return t}function Sx(e,t){let n=new Set;return new Set(t),e.reduce((s,a)=>{let l=JSON.stringify(bx(a));return n.has(l)||(n.add(l),s.push({key:l,link:a})),s},[])}function C8(){let e=M.useContext(Sl);return Cm(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function wx(){let e=M.useContext(Jf);return Cm(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var Am=M.createContext(void 0);Am.displayName="FrameworkContext";function A8(){let e=M.useContext(Am);return Cm(e,"You must render this element inside a <HydratedRouter> element"),e}function _x(e,t){let n=M.useContext(Am),[s,a]=M.useState(!1),[l,i]=M.useState(!1),{onFocus:p,onBlur:g,onMouseEnter:v,onMouseLeave:u,onTouchStart:h}=t,y=M.useRef(null);M.useEffect(()=>{if(e==="render"&&i(!0),e==="viewport"){let _=R=>{R.forEach(P=>{i(P.isIntersecting)})},E=new IntersectionObserver(_,{threshold:.5});return y.current&&E.observe(y.current),()=>{E.disconnect()}}},[e]),M.useEffect(()=>{if(s){let _=setTimeout(()=>{i(!0)},100);return()=>{clearTimeout(_)}}},[s]);let x=()=>{a(!0)},T=()=>{a(!1),i(!1)};return n?e!=="intent"?[l,y,{}]:[l,y,{onFocus:Lc(p,x),onBlur:Lc(g,T),onMouseEnter:Lc(v,x),onMouseLeave:Lc(u,T),onTouchStart:Lc(h,x)}]:[!1,y,{}]}function Lc(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function xx({page:e,...t}){let{router:n}=C8(),s=M.useMemo(()=>f8(n.routes,e,n.basename),[n.routes,e,n.basename]);return s?M.createElement(Ex,{page:e,matches:s,...t}):null}function Tx(e){let{manifest:t,routeModules:n}=A8(),[s,a]=M.useState([]);return M.useEffect(()=>{let l=!1;return gx(e,t,n).then(i=>{l||a(i)}),()=>{l=!0}},[e,t,n]),s}function Ex({page:e,matches:t,...n}){let s=ci(),{future:a,manifest:l,routeModules:i}=A8(),{basename:p}=C8(),{loaderData:g,matches:v}=wx(),u=M.useMemo(()=>vy(e,t,v,l,s,"data"),[e,t,v,l,s]),h=M.useMemo(()=>vy(e,t,v,l,s,"assets"),[e,t,v,l,s]),y=M.useMemo(()=>{if(e===s.pathname+s.search+s.hash)return[];let _=new Set,E=!1;if(t.forEach(P=>{let B=l.routes[P.route.id];!B||!B.hasLoader||(!u.some(X=>X.route.id===P.route.id)&&P.route.id in g&&i[P.route.id]?.shouldRevalidate||B.hasClientLoader?E=!0:_.add(P.route.id))}),_.size===0)return[];let R=hx(e,p,a.unstable_trailingSlashAwareDataRequests,"data");return E&&_.size>0&&R.searchParams.set("_routes",t.filter(P=>_.has(P.route.id)).map(P=>P.route.id).join(",")),[R.pathname+R.search]},[p,a.unstable_trailingSlashAwareDataRequests,g,s,l,u,t,e,i]),x=M.useMemo(()=>vx(h,l),[h,l]),T=Tx(h);return M.createElement(M.Fragment,null,y.map(_=>M.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...n})),x.map(_=>M.createElement("link",{key:_,rel:"modulepreload",href:_,...n})),T.map(({key:_,link:E})=>M.createElement("link",{key:_,nonce:n.nonce,...E,crossOrigin:E.crossOrigin??n.crossOrigin})))}function Cx(...e){return t=>{e.forEach(n=>{typeof n=="function"?n(t):n!=null&&(n.current=t)})}}var Ax=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Ax&&(window.__reactRouterVersion="7.13.0")}catch{}function jx({basename:e,children:t,unstable_useTransitions:n,window:s}){let a=M.useRef();a.current==null&&(a.current=o_({window:s,v5Compat:!0}));let l=a.current,[i,p]=M.useState({action:l.action,location:l.location}),g=M.useCallback(v=>{n===!1?p(v):M.startTransition(()=>p(v))},[n]);return M.useLayoutEffect(()=>l.listen(g),[l,g]),M.createElement(nx,{basename:e,children:t,location:i.location,navigationType:i.action,navigator:l,unstable_useTransitions:n})}var j8=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Xt=M.forwardRef(function({onClick:t,discover:n="render",prefetch:s="none",relative:a,reloadDocument:l,replace:i,state:p,target:g,to:v,preventScrollReset:u,viewTransition:h,unstable_defaultShouldRevalidate:y,...x},T){let{basename:_,unstable_useTransitions:E}=M.useContext(Er),R=typeof v=="string"&&j8.test(v),P=g8(v,_);v=P.to;let B=U_(v,{relative:a}),[X,Q,K]=_x(s,x),k=Ix(v,{replace:i,state:p,target:g,preventScrollReset:u,relative:a,viewTransition:h,unstable_defaultShouldRevalidate:y,unstable_useTransitions:E});function I(U){t&&t(U),U.defaultPrevented||k(U)}let N=M.createElement("a",{...x,...K,href:P.absoluteURL||B,onClick:P.isExternal||l?t:I,ref:Cx(T,Q),target:g,"data-discover":!R&&n==="render"?"true":void 0});return X&&!R?M.createElement(M.Fragment,null,N,M.createElement(xx,{page:B})):N});Xt.displayName="Link";var Mx=M.forwardRef(function({"aria-current":t="page",caseSensitive:n=!1,className:s="",end:a=!1,style:l,to:i,viewTransition:p,children:g,...v},u){let h=cu(i,{relative:v.relative}),y=ci(),x=M.useContext(Jf),{navigator:T,basename:_}=M.useContext(Er),E=x!=null&&Ox(h)&&p===!0,R=T.encodeLocation?T.encodeLocation(h).pathname:h.pathname,P=y.pathname,B=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;n||(P=P.toLowerCase(),B=B?B.toLowerCase():null,R=R.toLowerCase()),B&&_&&(B=ds(B,_)||B);const X=R!=="/"&&R.endsWith("/")?R.length-1:R.length;let Q=P===R||!a&&P.startsWith(R)&&P.charAt(X)==="/",K=B!=null&&(B===R||!a&&B.startsWith(R)&&B.charAt(R.length)==="/"),k={isActive:Q,isPending:K,isTransitioning:E},I=Q?t:void 0,N;typeof s=="function"?N=s(k):N=[s,Q?"active":null,K?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let U=typeof l=="function"?l(k):l;return M.createElement(Xt,{...v,"aria-current":I,className:N,ref:u,style:U,to:i,viewTransition:p},typeof g=="function"?g(k):g)});Mx.displayName="NavLink";var Rx=M.forwardRef(({discover:e="render",fetcherKey:t,navigate:n,reloadDocument:s,replace:a,state:l,method:i=of,action:p,onSubmit:g,relative:v,preventScrollReset:u,viewTransition:h,unstable_defaultShouldRevalidate:y,...x},T)=>{let{unstable_useTransitions:_}=M.useContext(Er),E=Px(),R=zx(p,{relative:v}),P=i.toLowerCase()==="get"?"get":"post",B=typeof p=="string"&&j8.test(p),X=Q=>{if(g&&g(Q),Q.defaultPrevented)return;Q.preventDefault();let K=Q.nativeEvent.submitter,k=K?.getAttribute("formmethod")||i,I=()=>E(K||Q.currentTarget,{fetcherKey:t,method:k,navigate:n,replace:a,state:l,relative:v,preventScrollReset:u,viewTransition:h,unstable_defaultShouldRevalidate:y});_&&n!==!1?M.startTransition(()=>I()):I()};return M.createElement("form",{ref:T,method:P,action:R,onSubmit:s?g:X,...x,"data-discover":!B&&e==="render"?"true":void 0})});Rx.displayName="Form";function kx(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function M8(e){let t=M.useContext(Sl);return tn(t,kx(e)),t}function Ix(e,{target:t,replace:n,state:s,preventScrollReset:a,relative:l,viewTransition:i,unstable_defaultShouldRevalidate:p,unstable_useTransitions:g}={}){let v=ui(),u=ci(),h=cu(e,{relative:l});return M.useCallback(y=>{if(lx(y,t)){y.preventDefault();let x=n!==void 0?n:Yc(u)===Yc(h),T=()=>v(e,{replace:x,state:s,preventScrollReset:a,relative:l,viewTransition:i,unstable_defaultShouldRevalidate:p});g?M.startTransition(()=>T()):T()}},[u,v,h,n,s,t,e,a,l,i,p,g])}function Dx(e){Hr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=M.useRef($p(e)),n=M.useRef(!1),s=ci(),a=M.useMemo(()=>cx(s.search,n.current?null:t.current),[s.search]),l=ui(),i=M.useCallback((p,g)=>{const v=$p(typeof p=="function"?p(new URLSearchParams(a)):p);n.current=!0,l("?"+v,g)},[l,a]);return[a,i]}var Nx=0,Lx=()=>`__${String(++Nx)}__`;function Px(){let{router:e}=M8("useSubmit"),{basename:t}=M.useContext(Er),n=J_(),s=e.fetch,a=e.navigate;return M.useCallback(async(l,i={})=>{let{action:p,method:g,encType:v,formData:u,body:h}=fx(l,t);if(i.navigate===!1){let y=i.fetcherKey||Lx();await s(y,n,i.action||p,{unstable_defaultShouldRevalidate:i.unstable_defaultShouldRevalidate,preventScrollReset:i.preventScrollReset,formData:u,body:h,formMethod:i.method||g,formEncType:i.encType||v,flushSync:i.flushSync})}else await a(i.action||p,{unstable_defaultShouldRevalidate:i.unstable_defaultShouldRevalidate,preventScrollReset:i.preventScrollReset,formData:u,body:h,formMethod:i.method||g,formEncType:i.encType||v,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})},[s,a,t,n])}function zx(e,{relative:t}={}){let{basename:n}=M.useContext(Er),s=M.useContext(li);tn(s,"useFormAction must be used inside a RouteContext");let[a]=s.matches.slice(-1),l={...cu(e||".",{relative:t})},i=ci();if(e==null){l.search=i.search;let p=new URLSearchParams(l.search),g=p.getAll("index");if(g.some(u=>u==="")){p.delete("index"),g.filter(h=>h).forEach(h=>p.append("index",h));let u=p.toString();l.search=u?`?${u}`:""}}return(!e||e===".")&&a.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(l.pathname=l.pathname==="/"?n:cs([n,l.pathname])),Yc(l)}function Ox(e,{relative:t}={}){let n=M.useContext(y8);tn(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=M8("useViewTransitionState"),a=cu(e,{relative:t});if(!n.isTransitioning)return!1;let l=ds(n.currentLocation.pathname,s)||n.currentLocation.pathname,i=ds(n.nextLocation.pathname,s)||n.nextLocation.pathname;return Sf(a.pathname,i)!=null||Sf(a.pathname,l)!=null}const Vx=()=>{};var yy={};const R8=function(e){const t=[];let n=0;for(let s=0;s<e.length;s++){let a=e.charCodeAt(s);a<128?t[n++]=a:a<2048?(t[n++]=a>>6|192,t[n++]=a&63|128):(a&64512)===55296&&s+1<e.length&&(e.charCodeAt(s+1)&64512)===56320?(a=65536+((a&1023)<<10)+(e.charCodeAt(++s)&1023),t[n++]=a>>18|240,t[n++]=a>>12&63|128,t[n++]=a>>6&63|128,t[n++]=a&63|128):(t[n++]=a>>12|224,t[n++]=a>>6&63|128,t[n++]=a&63|128)}return t},Bx=function(e){const t=[];let n=0,s=0;for(;n<e.length;){const a=e[n++];if(a<128)t[s++]=String.fromCharCode(a);else if(a>191&&a<224){const l=e[n++];t[s++]=String.fromCharCode((a&31)<<6|l&63)}else if(a>239&&a<365){const l=e[n++],i=e[n++],p=e[n++],g=((a&7)<<18|(l&63)<<12|(i&63)<<6|p&63)-65536;t[s++]=String.fromCharCode(55296+(g>>10)),t[s++]=String.fromCharCode(56320+(g&1023))}else{const l=e[n++],i=e[n++];t[s++]=String.fromCharCode((a&15)<<12|(l&63)<<6|i&63)}}return t.join("")},k8={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let a=0;a<e.length;a+=3){const l=e[a],i=a+1<e.length,p=i?e[a+1]:0,g=a+2<e.length,v=g?e[a+2]:0,u=l>>2,h=(l&3)<<4|p>>4;let y=(p&15)<<2|v>>6,x=v&63;g||(x=64,i||(y=64)),s.push(n[u],n[h],n[y],n[x])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(R8(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):Bx(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let a=0;a<e.length;){const l=n[e.charAt(a++)],p=a<e.length?n[e.charAt(a)]:0;++a;const v=a<e.length?n[e.charAt(a)]:64;++a;const h=a<e.length?n[e.charAt(a)]:64;if(++a,l==null||p==null||v==null||h==null)throw new Ux;const y=l<<2|p>>4;if(s.push(y),v!==64){const x=p<<4&240|v>>2;if(s.push(x),h!==64){const T=v<<6&192|h;s.push(T)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Ux extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const qx=function(e){const t=R8(e);return k8.encodeByteArray(t,!0)},wf=function(e){return qx(e).replace(/\./g,"")},I8=function(e){try{return k8.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Hx(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Fx=()=>Hx().__FIREBASE_DEFAULTS__,$x=()=>{if(typeof process>"u"||typeof yy>"u")return;const e=yy.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},Wx=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&I8(e[1]);return t&&JSON.parse(t)},eh=()=>{try{return Vx()||Fx()||$x()||Wx()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},D8=e=>eh()?.emulatorHosts?.[e],Gx=e=>{const t=D8(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const s=parseInt(t.substring(n+1),10);return t[0]==="["?[t.substring(1,n-1),s]:[t.substring(0,n),s]},N8=()=>eh()?.config,L8=e=>eh()?.[`_${e}`];class Qx{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,n)=>{this.resolve=t,this.reject=n})}wrapCallback(t){return(n,s)=>{n?this.reject(n):this.resolve(s),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(n):t(n,s))}}}function xl(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function P8(e){return(await fetch(e,{credentials:"include"})).ok}function Xx(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},s=t||"demo-project",a=e.iat||0,l=e.sub||e.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i={iss:`https://securetoken.google.com/${s}`,aud:s,iat:a,exp:a+3600,auth_time:a,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...e};return[wf(JSON.stringify(n)),wf(JSON.stringify(i)),""].join(".")}const qc={};function Yx(){const e={prod:[],emulator:[]};for(const t of Object.keys(qc))qc[t]?e.emulator.push(t):e.prod.push(t);return e}function Kx(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}let by=!1;function z8(e,t){if(typeof window>"u"||typeof document>"u"||!xl(window.location.host)||qc[e]===t||qc[e]||by)return;qc[e]=t;function n(y){return`__firebase__banner__${y}`}const s="__firebase__banner",l=Yx().prod.length>0;function i(){const y=document.getElementById(s);y&&y.remove()}function p(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function g(y,x){y.setAttribute("width","24"),y.setAttribute("id",x),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function v(){const y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{by=!0,i()},y}function u(y,x){y.setAttribute("id",x),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function h(){const y=Kx(s),x=n("text"),T=document.getElementById(x)||document.createElement("span"),_=n("learnmore"),E=document.getElementById(_)||document.createElement("a"),R=n("preprendIcon"),P=document.getElementById(R)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){const B=y.element;p(B),u(E,_);const X=v();g(P,R),B.append(P,T,E,X),document.body.appendChild(B)}l?(T.innerText="Preview backend disconnected.",P.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(P.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,T.innerText="Preview backend running in this workspace."),T.setAttribute("id",x)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}function Yn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Jx(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Yn())}function Zx(){const e=eh()?.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function e6(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function t6(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function n6(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function r6(){const e=Yn();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function i6(){return!Zx()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function s6(){try{return typeof indexedDB=="object"}catch{return!1}}function a6(){return new Promise((e,t)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(s);a.onsuccess=()=>{a.result.close(),n||self.indexedDB.deleteDatabase(s),e(!0)},a.onupgradeneeded=()=>{n=!1},a.onerror=()=>{t(a.error?.message||"")}}catch(n){t(n)}})}const o6="FirebaseError";class gs extends Error{constructor(t,n,s){super(n),this.code=t,this.customData=s,this.name=o6,Object.setPrototypeOf(this,gs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,uu.prototype.create)}}class uu{constructor(t,n,s){this.service=t,this.serviceName=n,this.errors=s}create(t,...n){const s=n[0]||{},a=`${this.service}/${t}`,l=this.errors[t],i=l?l6(l,s):"Error",p=`${this.serviceName}: ${i} (${a}).`;return new gs(a,p,s)}}function l6(e,t){return e.replace(c6,(n,s)=>{const a=t[s];return a!=null?String(a):`<${s}?>`})}const c6=/\{\$([^}]+)}/g;function u6(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function la(e,t){if(e===t)return!0;const n=Object.keys(e),s=Object.keys(t);for(const a of n){if(!s.includes(a))return!1;const l=e[a],i=t[a];if(Sy(l)&&Sy(i)){if(!la(l,i))return!1}else if(l!==i)return!1}for(const a of s)if(!n.includes(a))return!1;return!0}function Sy(e){return e!==null&&typeof e=="object"}function du(e){const t=[];for(const[n,s]of Object.entries(e))Array.isArray(s)?s.forEach(a=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(a))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return t.length?"&"+t.join("&"):""}function d6(e,t){const n=new f6(e,t);return n.subscribe.bind(n)}class f6{constructor(t,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{t(this)}).catch(s=>{this.error(s)})}next(t){this.forEachObserver(n=>{n.next(t)})}error(t){this.forEachObserver(n=>{n.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,n,s){let a;if(t===void 0&&n===void 0&&s===void 0)throw new Error("Missing Observer.");h6(t,["next","error","complete"])?a=t:a={next:t,error:n,complete:s},a.next===void 0&&(a.next=jp),a.error===void 0&&(a.error=jp),a.complete===void 0&&(a.complete=jp);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),l}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,t)}sendOne(t,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{n(this.observers[t])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function h6(e,t){if(typeof e!="object"||e===null)return!1;for(const n of t)if(n in e&&typeof e[n]=="function")return!0;return!1}function jp(){}function mn(e){return e&&e._delegate?e._delegate:e}class Ka{constructor(t,n,s){this.name=t,this.instanceFactory=n,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Fa="[DEFAULT]";class p6{constructor(t,n){this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const n=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(n)){const s=new Qx;if(this.instancesDeferred.set(n,s),this.isInitialized(n)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:n});a&&s.resolve(a)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(t){const n=this.normalizeInstanceIdentifier(t?.identifier),s=t?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(s)return null;throw a}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(g6(t))try{this.getOrInitializeService({instanceIdentifier:Fa})}catch{}for(const[n,s]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(n);try{const l=this.getOrInitializeService({instanceIdentifier:a});s.resolve(l)}catch{}}}}clearInstance(t=Fa){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...t.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Fa){return this.instances.has(t)}getOptions(t=Fa){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:n={}}=t,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:s,options:n});for(const[l,i]of this.instancesDeferred.entries()){const p=this.normalizeInstanceIdentifier(l);s===p&&i.resolve(a)}return a}onInit(t,n){const s=this.normalizeInstanceIdentifier(n),a=this.onInitCallbacks.get(s)??new Set;a.add(t),this.onInitCallbacks.set(s,a);const l=this.instances.get(s);return l&&t(l,s),()=>{a.delete(t)}}invokeOnInitCallbacks(t,n){const s=this.onInitCallbacks.get(n);if(s)for(const a of s)try{a(t,n)}catch{}}getOrInitializeService({instanceIdentifier:t,options:n={}}){let s=this.instances.get(t);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:m6(t),options:n}),this.instances.set(t,s),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(s,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,s)}catch{}return s||null}normalizeInstanceIdentifier(t=Fa){return this.component?this.component.multipleInstances?t:Fa:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function m6(e){return e===Fa?void 0:e}function g6(e){return e.instantiationMode==="EAGER"}class v6{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const n=this.getProvider(t.name);if(n.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);n.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const n=new p6(t,this);return this.providers.set(t,n),n}getProviders(){return Array.from(this.providers.values())}}var St;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(St||(St={}));const y6={debug:St.DEBUG,verbose:St.VERBOSE,info:St.INFO,warn:St.WARN,error:St.ERROR,silent:St.SILENT},b6=St.INFO,S6={[St.DEBUG]:"log",[St.VERBOSE]:"log",[St.INFO]:"info",[St.WARN]:"warn",[St.ERROR]:"error"},w6=(e,t,...n)=>{if(t<e.logLevel)return;const s=new Date().toISOString(),a=S6[t];if(a)console[a](`[${s}]  ${e.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class jm{constructor(t){this.name=t,this._logLevel=b6,this._logHandler=w6,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in St))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?y6[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,St.DEBUG,...t),this._logHandler(this,St.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,St.VERBOSE,...t),this._logHandler(this,St.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,St.INFO,...t),this._logHandler(this,St.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,St.WARN,...t),this._logHandler(this,St.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,St.ERROR,...t),this._logHandler(this,St.ERROR,...t)}}const _6=(e,t)=>t.some(n=>e instanceof n);let wy,_y;function x6(){return wy||(wy=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function T6(){return _y||(_y=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const O8=new WeakMap,Wp=new WeakMap,V8=new WeakMap,Mp=new WeakMap,Mm=new WeakMap;function E6(e){const t=new Promise((n,s)=>{const a=()=>{e.removeEventListener("success",l),e.removeEventListener("error",i)},l=()=>{n(na(e.result)),a()},i=()=>{s(e.error),a()};e.addEventListener("success",l),e.addEventListener("error",i)});return t.then(n=>{n instanceof IDBCursor&&O8.set(n,e)}).catch(()=>{}),Mm.set(t,e),t}function C6(e){if(Wp.has(e))return;const t=new Promise((n,s)=>{const a=()=>{e.removeEventListener("complete",l),e.removeEventListener("error",i),e.removeEventListener("abort",i)},l=()=>{n(),a()},i=()=>{s(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",l),e.addEventListener("error",i),e.addEventListener("abort",i)});Wp.set(e,t)}let Gp={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return Wp.get(e);if(t==="objectStoreNames")return e.objectStoreNames||V8.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return na(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function A6(e){Gp=e(Gp)}function j6(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const s=e.call(Rp(this),t,...n);return V8.set(s,t.sort?t.sort():[t]),na(s)}:T6().includes(e)?function(...t){return e.apply(Rp(this),t),na(O8.get(this))}:function(...t){return na(e.apply(Rp(this),t))}}function M6(e){return typeof e=="function"?j6(e):(e instanceof IDBTransaction&&C6(e),_6(e,x6())?new Proxy(e,Gp):e)}function na(e){if(e instanceof IDBRequest)return E6(e);if(Mp.has(e))return Mp.get(e);const t=M6(e);return t!==e&&(Mp.set(e,t),Mm.set(t,e)),t}const Rp=e=>Mm.get(e);function R6(e,t,{blocked:n,upgrade:s,blocking:a,terminated:l}={}){const i=indexedDB.open(e,t),p=na(i);return s&&i.addEventListener("upgradeneeded",g=>{s(na(i.result),g.oldVersion,g.newVersion,na(i.transaction),g)}),n&&i.addEventListener("blocked",g=>n(g.oldVersion,g.newVersion,g)),p.then(g=>{l&&g.addEventListener("close",()=>l()),a&&g.addEventListener("versionchange",v=>a(v.oldVersion,v.newVersion,v))}).catch(()=>{}),p}const k6=["get","getKey","getAll","getAllKeys","count"],I6=["put","add","delete","clear"],kp=new Map;function xy(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(kp.get(t))return kp.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,a=I6.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(a||k6.includes(n)))return;const l=async function(i,...p){const g=this.transaction(i,a?"readwrite":"readonly");let v=g.store;return s&&(v=v.index(p.shift())),(await Promise.all([v[n](...p),a&&g.done]))[0]};return kp.set(t,l),l}A6(e=>({...e,get:(t,n,s)=>xy(t,n)||e.get(t,n,s),has:(t,n)=>!!xy(t,n)||e.has(t,n)}));class D6{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(N6(n)){const s=n.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(n=>n).join(" ")}}function N6(e){return e.getComponent()?.type==="VERSION"}const Qp="@firebase/app",Ty="0.14.8";const fs=new jm("@firebase/app"),L6="@firebase/app-compat",P6="@firebase/analytics-compat",z6="@firebase/analytics",O6="@firebase/app-check-compat",V6="@firebase/app-check",B6="@firebase/auth",U6="@firebase/auth-compat",q6="@firebase/database",H6="@firebase/data-connect",F6="@firebase/database-compat",$6="@firebase/functions",W6="@firebase/functions-compat",G6="@firebase/installations",Q6="@firebase/installations-compat",X6="@firebase/messaging",Y6="@firebase/messaging-compat",K6="@firebase/performance",J6="@firebase/performance-compat",Z6="@firebase/remote-config",e5="@firebase/remote-config-compat",t5="@firebase/storage",n5="@firebase/storage-compat",r5="@firebase/firestore",i5="@firebase/ai",s5="@firebase/firestore-compat",a5="firebase",o5="12.9.0";const Xp="[DEFAULT]",l5={[Qp]:"fire-core",[L6]:"fire-core-compat",[z6]:"fire-analytics",[P6]:"fire-analytics-compat",[V6]:"fire-app-check",[O6]:"fire-app-check-compat",[B6]:"fire-auth",[U6]:"fire-auth-compat",[q6]:"fire-rtdb",[H6]:"fire-data-connect",[F6]:"fire-rtdb-compat",[$6]:"fire-fn",[W6]:"fire-fn-compat",[G6]:"fire-iid",[Q6]:"fire-iid-compat",[X6]:"fire-fcm",[Y6]:"fire-fcm-compat",[K6]:"fire-perf",[J6]:"fire-perf-compat",[Z6]:"fire-rc",[e5]:"fire-rc-compat",[t5]:"fire-gcs",[n5]:"fire-gcs-compat",[r5]:"fire-fst",[s5]:"fire-fst-compat",[i5]:"fire-vertex","fire-js":"fire-js",[a5]:"fire-js-all"};const _f=new Map,c5=new Map,Yp=new Map;function Ey(e,t){try{e.container.addComponent(t)}catch(n){fs.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ol(e){const t=e.name;if(Yp.has(t))return fs.debug(`There were multiple attempts to register component ${t}.`),!1;Yp.set(t,e);for(const n of _f.values())Ey(n,e);for(const n of c5.values())Ey(n,e);return!0}function Rm(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ni(e){return e==null?!1:e.settings!==void 0}const u5={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ra=new uu("app","Firebase",u5);class d5{constructor(t,n,s){this._isDeleted=!1,this._options={...t},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Ka("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ra.create("app-deleted",{appName:this._name})}}const Tl=o5;function B8(e,t={}){let n=e;typeof t!="object"&&(t={name:t});const s={name:Xp,automaticDataCollectionEnabled:!0,...t},a=s.name;if(typeof a!="string"||!a)throw ra.create("bad-app-name",{appName:String(a)});if(n||(n=N8()),!n)throw ra.create("no-options");const l=_f.get(a);if(l){if(la(n,l.options)&&la(s,l.config))return l;throw ra.create("duplicate-app",{appName:a})}const i=new v6(a);for(const g of Yp.values())i.addComponent(g);const p=new d5(n,s,i);return _f.set(a,p),p}function U8(e=Xp){const t=_f.get(e);if(!t&&e===Xp&&N8())return B8();if(!t)throw ra.create("no-app",{appName:e});return t}function ia(e,t,n){let s=l5[e]??e;n&&(s+=`-${n}`);const a=s.match(/\s|\//),l=t.match(/\s|\//);if(a||l){const i=[`Unable to register library "${s}" with version "${t}":`];a&&i.push(`library name "${s}" contains illegal characters (whitespace or "/")`),a&&l&&i.push("and"),l&&i.push(`version name "${t}" contains illegal characters (whitespace or "/")`),fs.warn(i.join(" "));return}ol(new Ka(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}const f5="firebase-heartbeat-database",h5=1,Kc="firebase-heartbeat-store";let Ip=null;function q8(){return Ip||(Ip=R6(f5,h5,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(Kc)}catch(n){console.warn(n)}}}}).catch(e=>{throw ra.create("idb-open",{originalErrorMessage:e.message})})),Ip}async function p5(e){try{const n=(await q8()).transaction(Kc),s=await n.objectStore(Kc).get(H8(e));return await n.done,s}catch(t){if(t instanceof gs)fs.warn(t.message);else{const n=ra.create("idb-get",{originalErrorMessage:t?.message});fs.warn(n.message)}}}async function Cy(e,t){try{const s=(await q8()).transaction(Kc,"readwrite");await s.objectStore(Kc).put(t,H8(e)),await s.done}catch(n){if(n instanceof gs)fs.warn(n.message);else{const s=ra.create("idb-set",{originalErrorMessage:n?.message});fs.warn(s.message)}}}function H8(e){return`${e.name}!${e.options.appId}`}const m5=1024,g5=30;class v5{constructor(t){this.container=t,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new b5(n),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Ay();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:n}),this._heartbeatsCache.heartbeats.length>g5){const a=S5(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){fs.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Ay(),{heartbeatsToSend:n,unsentEntries:s}=y5(this._heartbeatsCache.heartbeats),a=wf(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(t){return fs.warn(t),""}}}function Ay(){return new Date().toISOString().substring(0,10)}function y5(e,t=m5){const n=[];let s=e.slice();for(const a of e){const l=n.find(i=>i.agent===a.agent);if(l){if(l.dates.push(a.date),jy(n)>t){l.dates.pop();break}}else if(n.push({agent:a.agent,dates:[a.date]}),jy(n)>t){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}class b5{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return s6()?a6().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await p5(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const s=await this.read();return Cy(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const s=await this.read();return Cy(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}else return}}function jy(e){return wf(JSON.stringify({version:2,heartbeats:e})).length}function S5(e){if(e.length===0)return-1;let t=0,n=e[0].date;for(let s=1;s<e.length;s++)e[s].date<n&&(n=e[s].date,t=s);return t}function w5(e){ol(new Ka("platform-logger",t=>new D6(t),"PRIVATE")),ol(new Ka("heartbeat",t=>new v5(t),"PRIVATE")),ia(Qp,Ty,e),ia(Qp,Ty,"esm2020"),ia("fire-js","")}w5("");function F8(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const _5=F8,$8=new uu("auth","Firebase",F8());const xf=new jm("@firebase/auth");function x5(e,...t){xf.logLevel<=St.WARN&&xf.warn(`Auth (${Tl}): ${e}`,...t)}function cf(e,...t){xf.logLevel<=St.ERROR&&xf.error(`Auth (${Tl}): ${e}`,...t)}function Li(e,...t){throw Im(e,...t)}function ii(e,...t){return Im(e,...t)}function km(e,t,n){const s={..._5(),[t]:n};return new uu("auth","Firebase",s).create(t,{appName:e.name})}function Qa(e){return km(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function T5(e,t,n){const s=n;if(!(t instanceof s))throw s.name!==t.constructor.name&&Li(e,"argument-error"),km(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Im(e,...t){if(typeof e!="string"){const n=t[0],s=[...t.slice(1)];return s[0]&&(s[0].appName=e.name),e._errorFactory.create(n,...s)}return $8.create(e,...t)}function lt(e,t,...n){if(!e)throw Im(t,...n)}function as(e){const t="INTERNAL ASSERTION FAILED: "+e;throw cf(t),new Error(t)}function hs(e,t){e||as(t)}function Kp(){return typeof self<"u"&&self.location?.href||""}function E5(){return My()==="http:"||My()==="https:"}function My(){return typeof self<"u"&&self.location?.protocol||null}function C5(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(E5()||t6()||"connection"in navigator)?navigator.onLine:!0}function A5(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}class fu{constructor(t,n){this.shortDelay=t,this.longDelay=n,hs(n>t,"Short delay should be less than long delay!"),this.isMobile=Jx()||n6()}get(){return C5()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Dm(e,t){hs(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class W8{static initialize(t,n,s){this.fetchImpl=t,n&&(this.headersImpl=n),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;as("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;as("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;as("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const j5={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const M5=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],R5=new fu(3e4,6e4);function Nm(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function El(e,t,n,s,a={}){return G8(e,a,async()=>{let l={},i={};s&&(t==="GET"?i=s:l={body:JSON.stringify(s)});const p=du({key:e.config.apiKey,...i}).slice(1),g=await e._getAdditionalHeaders();g["Content-Type"]="application/json",e.languageCode&&(g["X-Firebase-Locale"]=e.languageCode);const v={method:t,headers:g,...l};return e6()||(v.referrerPolicy="no-referrer"),e.emulatorConfig&&xl(e.emulatorConfig.host)&&(v.credentials="include"),W8.fetch()(await Q8(e,e.config.apiHost,n,p),v)})}async function G8(e,t,n){e._canInitEmulator=!1;const s={...j5,...t};try{const a=new I5(e),l=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();const i=await l.json();if("needConfirmation"in i)throw Jd(e,"account-exists-with-different-credential",i);if(l.ok&&!("errorMessage"in i))return i;{const p=l.ok?i.errorMessage:i.error.message,[g,v]=p.split(" : ");if(g==="FEDERATED_USER_ID_ALREADY_LINKED")throw Jd(e,"credential-already-in-use",i);if(g==="EMAIL_EXISTS")throw Jd(e,"email-already-in-use",i);if(g==="USER_DISABLED")throw Jd(e,"user-disabled",i);const u=s[g]||g.toLowerCase().replace(/[_\s]+/g,"-");if(v)throw km(e,u,v);Li(e,u)}}catch(a){if(a instanceof gs)throw a;Li(e,"network-request-failed",{message:String(a)})}}async function k5(e,t,n,s,a={}){const l=await El(e,t,n,s,a);return"mfaPendingCredential"in l&&Li(e,"multi-factor-auth-required",{_serverResponse:l}),l}async function Q8(e,t,n,s){const a=`${t}${n}?${s}`,l=e,i=l.config.emulator?Dm(e.config,a):`${e.config.apiScheme}://${a}`;return M5.includes(n)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(i).toString():i}class I5{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((n,s)=>{this.timer=setTimeout(()=>s(ii(this.auth,"network-request-failed")),R5.get())})}}function Jd(e,t,n){const s={appName:e.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const a=ii(e,t,s);return a.customData._tokenResponse=n,a}async function D5(e,t){return El(e,"POST","/v1/accounts:delete",t)}async function Tf(e,t){return El(e,"POST","/v1/accounts:lookup",t)}function Hc(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function N5(e,t=!1){const n=mn(e),s=await n.getIdToken(t),a=Lm(s);lt(a&&a.exp&&a.auth_time&&a.iat,n.auth,"internal-error");const l=typeof a.firebase=="object"?a.firebase:void 0,i=l?.sign_in_provider;return{claims:a,token:s,authTime:Hc(Dp(a.auth_time)),issuedAtTime:Hc(Dp(a.iat)),expirationTime:Hc(Dp(a.exp)),signInProvider:i||null,signInSecondFactor:l?.sign_in_second_factor||null}}function Dp(e){return Number(e)*1e3}function Lm(e){const[t,n,s]=e.split(".");if(t===void 0||n===void 0||s===void 0)return cf("JWT malformed, contained fewer than 3 sections"),null;try{const a=I8(n);return a?JSON.parse(a):(cf("Failed to decode base64 JWT payload"),null)}catch(a){return cf("Caught error parsing JWT payload as JSON",a?.toString()),null}}function Ry(e){const t=Lm(e);return lt(t,"internal-error"),lt(typeof t.exp<"u","internal-error"),lt(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}async function Jc(e,t,n=!1){if(n)return t;try{return await t}catch(s){throw s instanceof gs&&L5(s)&&e.auth.currentUser===e&&await e.auth.signOut(),s}}function L5({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}class P5{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){if(t){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(t=!1){if(!this.isRunning)return;const n=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){t?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Jp{constructor(t,n){this.createdAt=t,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Hc(this.lastLoginAt),this.creationTime=Hc(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Ef(e){const t=e.auth,n=await e.getIdToken(),s=await Jc(e,Tf(t,{idToken:n}));lt(s?.users.length,t,"internal-error");const a=s.users[0];e._notifyReloadListener(a);const l=a.providerUserInfo?.length?X8(a.providerUserInfo):[],i=O5(e.providerData,l),p=e.isAnonymous,g=!(e.email&&a.passwordHash)&&!i?.length,v=p?g:!1,u={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:i,metadata:new Jp(a.createdAt,a.lastLoginAt),isAnonymous:v};Object.assign(e,u)}async function z5(e){const t=mn(e);await Ef(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function O5(e,t){return[...e.filter(s=>!t.some(a=>a.providerId===s.providerId)),...t]}function X8(e){return e.map(({providerId:t,...n})=>({providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function V5(e,t){const n=await G8(e,{},async()=>{const s=du({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:a,apiKey:l}=e.config,i=await Q8(e,a,"/v1/token",`key=${l}`),p=await e._getAdditionalHeaders();p["Content-Type"]="application/x-www-form-urlencoded";const g={method:"POST",headers:p,body:s};return e.emulatorConfig&&xl(e.emulatorConfig.host)&&(g.credentials="include"),W8.fetch()(i,g)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function B5(e,t){return El(e,"POST","/v2/accounts:revokeToken",Nm(e,t))}class nl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){lt(t.idToken,"internal-error"),lt(typeof t.idToken<"u","internal-error"),lt(typeof t.refreshToken<"u","internal-error");const n="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):Ry(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,n)}updateFromIdToken(t){lt(t.length!==0,"internal-error");const n=Ry(t);this.updateTokensAndExpiration(t,null,n)}async getToken(t,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(lt(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,n){const{accessToken:s,refreshToken:a,expiresIn:l}=await V5(t,n);this.updateTokensAndExpiration(s,a,Number(l))}updateTokensAndExpiration(t,n,s){this.refreshToken=n||null,this.accessToken=t||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(t,n){const{refreshToken:s,accessToken:a,expirationTime:l}=n,i=new nl;return s&&(lt(typeof s=="string","internal-error",{appName:t}),i.refreshToken=s),a&&(lt(typeof a=="string","internal-error",{appName:t}),i.accessToken=a),l&&(lt(typeof l=="number","internal-error",{appName:t}),i.expirationTime=l),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new nl,this.toJSON())}_performRefresh(){return as("not implemented")}}function Qs(e,t){lt(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class ri{constructor({uid:t,auth:n,stsTokenManager:s,...a}){this.providerId="firebase",this.proactiveRefresh=new P5(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new Jp(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(t){const n=await Jc(this,this.stsTokenManager.getToken(this.auth,t));return lt(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(t){return N5(this,t)}reload(){return z5(this)}_assign(t){this!==t&&(lt(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(n=>({...n})),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const n=new ri({...this,auth:t,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(t){lt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,n=!1){let s=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),s=!0),n&&await Ef(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ni(this.auth.app))return Promise.reject(Qa(this.auth));const t=await this.getIdToken();return await Jc(this,D5(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>({...t})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,n){const s=n.displayName??void 0,a=n.email??void 0,l=n.phoneNumber??void 0,i=n.photoURL??void 0,p=n.tenantId??void 0,g=n._redirectEventId??void 0,v=n.createdAt??void 0,u=n.lastLoginAt??void 0,{uid:h,emailVerified:y,isAnonymous:x,providerData:T,stsTokenManager:_}=n;lt(h&&_,t,"internal-error");const E=nl.fromJSON(this.name,_);lt(typeof h=="string",t,"internal-error"),Qs(s,t.name),Qs(a,t.name),lt(typeof y=="boolean",t,"internal-error"),lt(typeof x=="boolean",t,"internal-error"),Qs(l,t.name),Qs(i,t.name),Qs(p,t.name),Qs(g,t.name),Qs(v,t.name),Qs(u,t.name);const R=new ri({uid:h,auth:t,email:a,emailVerified:y,displayName:s,isAnonymous:x,photoURL:i,phoneNumber:l,tenantId:p,stsTokenManager:E,createdAt:v,lastLoginAt:u});return T&&Array.isArray(T)&&(R.providerData=T.map(P=>({...P}))),g&&(R._redirectEventId=g),R}static async _fromIdTokenResponse(t,n,s=!1){const a=new nl;a.updateFromServerResponse(n);const l=new ri({uid:n.localId,auth:t,stsTokenManager:a,isAnonymous:s});return await Ef(l),l}static async _fromGetAccountInfoResponse(t,n,s){const a=n.users[0];lt(a.localId!==void 0,"internal-error");const l=a.providerUserInfo!==void 0?X8(a.providerUserInfo):[],i=!(a.email&&a.passwordHash)&&!l?.length,p=new nl;p.updateFromIdToken(s);const g=new ri({uid:a.localId,auth:t,stsTokenManager:p,isAnonymous:i}),v={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new Jp(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!l?.length};return Object.assign(g,v),g}}const ky=new Map;function os(e){hs(e instanceof Function,"Expected a class definition");let t=ky.get(e);return t?(hs(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ky.set(e,t),t)}class Y8{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,n){this.storage[t]=n}async _get(t){const n=this.storage[t];return n===void 0?null:n}async _remove(t){delete this.storage[t]}_addListener(t,n){}_removeListener(t,n){}}Y8.type="NONE";const Iy=Y8;function uf(e,t,n){return`firebase:${e}:${t}:${n}`}class rl{constructor(t,n,s){this.persistence=t,this.auth=n,this.userKey=s;const{config:a,name:l}=this.auth;this.fullUserKey=uf(this.userKey,a.apiKey,l),this.fullPersistenceKey=uf("persistence",a.apiKey,l),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if(typeof t=="string"){const n=await Tf(this.auth,{idToken:t}).catch(()=>{});return n?ri._fromGetAccountInfoResponse(this.auth,n,t):null}return ri._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,n,s="authUser"){if(!n.length)return new rl(os(Iy),t,s);const a=(await Promise.all(n.map(async v=>{if(await v._isAvailable())return v}))).filter(v=>v);let l=a[0]||os(Iy);const i=uf(s,t.config.apiKey,t.name);let p=null;for(const v of n)try{const u=await v._get(i);if(u){let h;if(typeof u=="string"){const y=await Tf(t,{idToken:u}).catch(()=>{});if(!y)break;h=await ri._fromGetAccountInfoResponse(t,y,u)}else h=ri._fromJSON(t,u);v!==l&&(p=h),l=v;break}}catch{}const g=a.filter(v=>v._shouldAllowMigration);return!l._shouldAllowMigration||!g.length?new rl(l,t,s):(l=g[0],p&&await l._set(i,p.toJSON()),await Promise.all(n.map(async v=>{if(v!==l)try{await v._remove(i)}catch{}})),new rl(l,t,s))}}function Dy(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(e4(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(K8(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(n4(t))return"Blackberry";if(r4(t))return"Webos";if(J8(t))return"Safari";if((t.includes("chrome/")||Z8(t))&&!t.includes("edge/"))return"Chrome";if(t4(t))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=e.match(n);if(s?.length===2)return s[1]}return"Other"}function K8(e=Yn()){return/firefox\//i.test(e)}function J8(e=Yn()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Z8(e=Yn()){return/crios\//i.test(e)}function e4(e=Yn()){return/iemobile/i.test(e)}function t4(e=Yn()){return/android/i.test(e)}function n4(e=Yn()){return/blackberry/i.test(e)}function r4(e=Yn()){return/webos/i.test(e)}function Pm(e=Yn()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function U5(e=Yn()){return Pm(e)&&!!window.navigator?.standalone}function q5(){return r6()&&document.documentMode===10}function i4(e=Yn()){return Pm(e)||t4(e)||r4(e)||n4(e)||/windows phone/i.test(e)||e4(e)}function s4(e,t=[]){let n;switch(e){case"Browser":n=Dy(Yn());break;case"Worker":n=`${Dy(Yn())}-${e}`;break;default:n=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Tl}/${s}`}class H5{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,n){const s=l=>new Promise((i,p)=>{try{const g=t(l);i(g)}catch(g){p(g)}});s.onAbort=n,this.queue.push(s);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const n=[];try{for(const s of this.queue)await s(t),s.onAbort&&n.push(s.onAbort)}catch(s){n.reverse();for(const a of n)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}async function F5(e,t={}){return El(e,"GET","/v2/passwordPolicy",Nm(e,t))}const $5=6;class W5{constructor(t){const n=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??$5,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=t.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=t.forceUpgradeOnSignin??!1,this.schemaVersion=t.schemaVersion}validatePassword(t){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,n),this.validatePasswordCharacterOptions(t,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(t,n){const s=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;s&&(n.meetsMinPasswordLength=t.length>=s),a&&(n.meetsMaxPasswordLength=t.length<=a)}validatePasswordCharacterOptions(t,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let s;for(let a=0;a<t.length;a++)s=t.charAt(a),this.updatePasswordCharacterOptionsStatuses(n,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(t,n,s,a,l){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=l))}}class G5{constructor(t,n,s,a){this.app=t,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=s,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ny(this),this.idTokenSubscription=new Ny(this),this.beforeStateQueue=new H5(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=$8,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=os(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await rl.create(this,t),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const n=await Tf(this,{idToken:t}),s=await ri._fromGetAccountInfoResponse(this,n,t);await this.directlySetCurrentUser(s)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){if(ni(this.app)){const l=this.app.settings.authIdToken;return l?new Promise(i=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(l).then(i,i))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let s=n,a=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const l=this.redirectUser?._redirectEventId,i=s?._redirectEventId,p=await this.tryRedirectSignIn(t);(!l||l===i)&&p?.user&&(s=p.user,a=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(l){s=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(l))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return lt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(t){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(t){try{await Ef(t)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=A5()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(ni(this.app))return Promise.reject(Qa(this));const n=t?mn(t):null;return n&&lt(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(t,n=!1){if(!this._deleted)return t&&lt(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return ni(this.app)?Promise.reject(Qa(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return ni(this.app)?Promise.reject(Qa(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(os(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await F5(this),n=new W5(t);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new uu("auth","Firebase",t())}onAuthStateChanged(t,n,s){return this.registerStateListener(this.authStateSubscription,t,n,s)}beforeAuthStateChanged(t,n){return this.beforeStateQueue.pushCallback(t,n)}onIdTokenChanged(t,n,s){return this.registerStateListener(this.idTokenSubscription,t,n,s)}authStateReady(){return new Promise((t,n)=>{if(this.currentUser)t();else{const s=this.onAuthStateChanged(()=>{s(),t()},n)}})}async revokeAccessToken(t){if(this.currentUser){const n=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:n};this.tenantId!=null&&(s.tenantId=this.tenantId),await B5(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(t,n){const s=await this.getOrInitRedirectPersistenceManager(n);return t===null?s.removeCurrentUser():s.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const n=t&&os(t)||this._popupRedirectResolver;lt(n,this,"argument-error"),this.redirectPersistenceManager=await rl.create(this,[os(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===t?this._currentUser:this.redirectUser?._redirectEventId===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const t=this.currentUser?.uid??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,n,s,a){if(this._deleted)return()=>{};const l=typeof n=="function"?n:n.next.bind(n);let i=!1;const p=this._isInitialized?Promise.resolve():this._initializationPromise;if(lt(p,this,"internal-error"),p.then(()=>{i||l(this.currentUser)}),typeof n=="function"){const g=t.addObserver(n,s,a);return()=>{i=!0,g()}}else{const g=t.addObserver(n);return()=>{i=!0,g()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return lt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=s4(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(t["X-Firebase-Client"]=n);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){if(ni(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return t?.error&&x5(`Error while retrieving App Check token: ${t.error}`),t?.token}}function th(e){return mn(e)}class Ny{constructor(t){this.auth=t,this.observer=null,this.addObserver=d6(n=>this.observer=n)}get next(){return lt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let zm={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Q5(e){zm=e}function X5(e){return zm.loadJS(e)}function Y5(){return zm.gapiScript}function K5(e){return`__${e}${Math.floor(Math.random()*1e6)}`}function J5(e,t){const n=Rm(e,"auth");if(n.isInitialized()){const a=n.getImmediate(),l=n.getOptions();if(la(l,t??{}))return a;Li(a,"already-initialized")}return n.initialize({options:t})}function Z5(e,t){const n=t?.persistence||[],s=(Array.isArray(n)?n:[n]).map(os);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(s,t?.popupRedirectResolver)}function eT(e,t,n){const s=th(e);lt(/^https?:\/\//.test(t),s,"invalid-emulator-scheme");const a=!1,l=a4(t),{host:i,port:p}=tT(t),g=p===null?"":`:${p}`,v={url:`${l}//${i}${g}/`},u=Object.freeze({host:i,port:p,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!s._canInitEmulator){lt(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),lt(la(v,s.config.emulator)&&la(u,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=v,s.emulatorConfig=u,s.settings.appVerificationDisabledForTesting=!0,xl(i)?(P8(`${l}//${i}${g}`),z8("Auth",!0)):nT()}function a4(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function tT(e){const t=a4(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(s);if(a){const l=a[1];return{host:l,port:Ly(s.substr(l.length+1))}}else{const[l,i]=s.split(":");return{host:l,port:Ly(i)}}}function Ly(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function nT(){function e(){const t=document.createElement("p"),n=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}class o4{constructor(t,n){this.providerId=t,this.signInMethod=n}toJSON(){return as("not implemented")}_getIdTokenResponse(t){return as("not implemented")}_linkToIdToken(t,n){return as("not implemented")}_getReauthenticationResolver(t){return as("not implemented")}}async function il(e,t){return k5(e,"POST","/v1/accounts:signInWithIdp",Nm(e,t))}const rT="http://localhost";class Ja extends o4{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const n=new Ja(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(n.idToken=t.idToken),t.accessToken&&(n.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(n.nonce=t.nonce),t.pendingToken&&(n.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(n.accessToken=t.oauthToken,n.secret=t.oauthTokenSecret):Li("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const n=typeof t=="string"?JSON.parse(t):t,{providerId:s,signInMethod:a,...l}=n;if(!s||!a)return null;const i=new Ja(s,a);return i.idToken=l.idToken||void 0,i.accessToken=l.accessToken||void 0,i.secret=l.secret,i.nonce=l.nonce,i.pendingToken=l.pendingToken||null,i}_getIdTokenResponse(t){const n=this.buildRequest();return il(t,n)}_linkToIdToken(t,n){const s=this.buildRequest();return s.idToken=n,il(t,s)}_getReauthenticationResolver(t){const n=this.buildRequest();return n.autoCreate=!1,il(t,n)}buildRequest(){const t={requestUri:rT,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),t.postBody=du(n)}return t}}class Om{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class hu extends Om{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class Ks extends hu{constructor(){super("facebook.com")}static credential(t){return Ja._fromParams({providerId:Ks.PROVIDER_ID,signInMethod:Ks.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Ks.credentialFromTaggedObject(t)}static credentialFromError(t){return Ks.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Ks.credential(t.oauthAccessToken)}catch{return null}}}Ks.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ks.PROVIDER_ID="facebook.com";class ss extends hu{constructor(){super("google.com"),this.addScope("profile")}static credential(t,n){return Ja._fromParams({providerId:ss.PROVIDER_ID,signInMethod:ss.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return ss.credentialFromTaggedObject(t)}static credentialFromError(t){return ss.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:n,oauthAccessToken:s}=t;if(!n&&!s)return null;try{return ss.credential(n,s)}catch{return null}}}ss.GOOGLE_SIGN_IN_METHOD="google.com";ss.PROVIDER_ID="google.com";class Js extends hu{constructor(){super("github.com")}static credential(t){return Ja._fromParams({providerId:Js.PROVIDER_ID,signInMethod:Js.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Js.credentialFromTaggedObject(t)}static credentialFromError(t){return Js.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Js.credential(t.oauthAccessToken)}catch{return null}}}Js.GITHUB_SIGN_IN_METHOD="github.com";Js.PROVIDER_ID="github.com";class Zs extends hu{constructor(){super("twitter.com")}static credential(t,n){return Ja._fromParams({providerId:Zs.PROVIDER_ID,signInMethod:Zs.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:n})}static credentialFromResult(t){return Zs.credentialFromTaggedObject(t)}static credentialFromError(t){return Zs.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:s}=t;if(!n||!s)return null;try{return Zs.credential(n,s)}catch{return null}}}Zs.TWITTER_SIGN_IN_METHOD="twitter.com";Zs.PROVIDER_ID="twitter.com";class ll{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,n,s,a=!1){const l=await ri._fromIdTokenResponse(t,s,a),i=Py(s);return new ll({user:l,providerId:i,_tokenResponse:s,operationType:n})}static async _forOperation(t,n,s){await t._updateTokensIfNecessary(s,!0);const a=Py(s);return new ll({user:t,providerId:a,_tokenResponse:s,operationType:n})}}function Py(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Cf extends gs{constructor(t,n,s,a){super(n.code,n.message),this.operationType=s,this.user=a,Object.setPrototypeOf(this,Cf.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(t,n,s,a){return new Cf(t,n,s,a)}}function l4(e,t,n,s){return(t==="reauthenticate"?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?Cf._fromErrorAndOperation(e,l,t,s):l})}async function iT(e,t,n=!1){const s=await Jc(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ll._forOperation(e,"link",s)}async function sT(e,t,n=!1){const{auth:s}=e;if(ni(s.app))return Promise.reject(Qa(s));const a="reauthenticate";try{const l=await Jc(e,l4(s,a,t,e),n);lt(l.idToken,s,"internal-error");const i=Lm(l.idToken);lt(i,s,"internal-error");const{sub:p}=i;return lt(e.uid===p,s,"user-mismatch"),ll._forOperation(e,a,l)}catch(l){throw l?.code==="auth/user-not-found"&&Li(s,"user-mismatch"),l}}async function aT(e,t,n=!1){if(ni(e.app))return Promise.reject(Qa(e));const s="signIn",a=await l4(e,s,t),l=await ll._fromIdTokenResponse(e,s,a);return n||await e._updateCurrentUser(l.user),l}function oT(e,t,n,s){return mn(e).onIdTokenChanged(t,n,s)}function lT(e,t,n){return mn(e).beforeAuthStateChanged(t,n)}function cT(e,t,n,s){return mn(e).onAuthStateChanged(t,n,s)}function uT(e){return mn(e).signOut()}const Af="__sak";class c4{constructor(t,n){this.storageRetriever=t,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Af,"1"),this.storage.removeItem(Af),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,n){return this.storage.setItem(t,JSON.stringify(n)),Promise.resolve()}_get(t){const n=this.storage.getItem(t);return Promise.resolve(n?JSON.parse(n):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}const dT=1e3,fT=10;class u4 extends c4{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,n)=>this.onStorageEvent(t,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=i4(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const n of Object.keys(this.listeners)){const s=this.storage.getItem(n),a=this.localCache[n];s!==a&&t(n,a,s)}}onStorageEvent(t,n=!1){if(!t.key){this.forAllChangedKeys((i,p,g)=>{this.notifyListeners(i,g)});return}const s=t.key;n?this.detachListener():this.stopPolling();const a=()=>{const i=this.storage.getItem(s);!n&&this.localCache[s]===i||this.notifyListeners(s,i)},l=this.storage.getItem(s);q5()&&l!==t.newValue&&t.newValue!==t.oldValue?setTimeout(a,fT):a()}notifyListeners(t,n){this.localCache[t]=n;const s=this.listeners[t];if(s)for(const a of Array.from(s))a(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,n,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:n,newValue:s}),!0)})},dT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(n)}_removeListener(t,n){this.listeners[t]&&(this.listeners[t].delete(n),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,n){await super._set(t,n),this.localCache[t]=JSON.stringify(n)}async _get(t){const n=await super._get(t);return this.localCache[t]=JSON.stringify(n),n}async _remove(t){await super._remove(t),delete this.localCache[t]}}u4.type="LOCAL";const hT=u4;class d4 extends c4{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,n){}_removeListener(t,n){}}d4.type="SESSION";const f4=d4;function pT(e){return Promise.all(e.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(n){return{fulfilled:!1,reason:n}}}))}class nh{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const n=this.receivers.find(a=>a.isListeningto(t));if(n)return n;const s=new nh(t);return this.receivers.push(s),s}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const n=t,{eventId:s,eventType:a,data:l}=n.data,i=this.handlersMap[a];if(!i?.size)return;n.ports[0].postMessage({status:"ack",eventId:s,eventType:a});const p=Array.from(i).map(async v=>v(n.origin,l)),g=await pT(p);n.ports[0].postMessage({status:"done",eventId:s,eventType:a,response:g})}_subscribe(t,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(n)}_unsubscribe(t,n){this.handlersMap[t]&&n&&this.handlersMap[t].delete(n),(!n||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}nh.receivers=[];function Vm(e="",t=10){let n="";for(let s=0;s<t;s++)n+=Math.floor(Math.random()*10);return e+n}class mT{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,n,s=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let l,i;return new Promise((p,g)=>{const v=Vm("",20);a.port1.start();const u=setTimeout(()=>{g(new Error("unsupported_event"))},s);i={messageChannel:a,onMessage(h){const y=h;if(y.data.eventId===v)switch(y.data.status){case"ack":clearTimeout(u),l=setTimeout(()=>{g(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),p(y.data.response);break;default:clearTimeout(u),clearTimeout(l),g(new Error("invalid_response"));break}}},this.handlers.add(i),a.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:t,eventId:v,data:n},[a.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function Ri(){return window}function gT(e){Ri().location.href=e}function h4(){return typeof Ri().WorkerGlobalScope<"u"&&typeof Ri().importScripts=="function"}async function vT(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function yT(){return navigator?.serviceWorker?.controller||null}function bT(){return h4()?self:null}const p4="firebaseLocalStorageDb",ST=1,jf="firebaseLocalStorage",m4="fbase_key";class pu{constructor(t){this.request=t}toPromise(){return new Promise((t,n)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function rh(e,t){return e.transaction([jf],t?"readwrite":"readonly").objectStore(jf)}function wT(){const e=indexedDB.deleteDatabase(p4);return new pu(e).toPromise()}function Zp(){const e=indexedDB.open(p4,ST);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const s=e.result;try{s.createObjectStore(jf,{keyPath:m4})}catch(a){n(a)}}),e.addEventListener("success",async()=>{const s=e.result;s.objectStoreNames.contains(jf)?t(s):(s.close(),await wT(),t(await Zp()))})})}async function zy(e,t,n){const s=rh(e,!0).put({[m4]:t,value:n});return new pu(s).toPromise()}async function _T(e,t){const n=rh(e,!1).get(t),s=await new pu(n).toPromise();return s===void 0?null:s.value}function Oy(e,t){const n=rh(e,!0).delete(t);return new pu(n).toPromise()}const xT=800,TT=3;class g4{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Zp(),this.db)}async _withRetries(t){let n=0;for(;;)try{const s=await this._openDb();return await t(s)}catch(s){if(n++>TT)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return h4()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=nh._getInstance(bT()),this.receiver._subscribe("keyChanged",async(t,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(t,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await vT(),!this.activeServiceWorker)return;this.sender=new mT(this.activeServiceWorker);const t=await this.sender._send("ping",{},800);t&&t[0]?.fulfilled&&t[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||yT()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await Zp();return await zy(t,Af,"1"),await Oy(t,Af),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(s=>zy(s,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(t){const n=await this._withRetries(s=>_T(s,t));return this.localCache[t]=n,n}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Oy(n,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(a=>{const l=rh(a,!1).getAll();return new pu(l).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const n=[],s=new Set;if(t.length!==0)for(const{fbase_key:a,value:l}of t)s.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(l)&&(this.notifyListeners(a,l),n.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!s.has(a)&&(this.notifyListeners(a,null),n.push(a));return n}notifyListeners(t,n){this.localCache[t]=n;const s=this.listeners[t];if(s)for(const a of Array.from(s))a(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),xT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(n)}_removeListener(t,n){this.listeners[t]&&(this.listeners[t].delete(n),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}g4.type="LOCAL";const ET=g4;new fu(3e4,6e4);function v4(e,t){return t?os(t):(lt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}class Bm extends o4{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return il(t,this._buildIdpRequest())}_linkToIdToken(t,n){return il(t,this._buildIdpRequest(n))}_getReauthenticationResolver(t){return il(t,this._buildIdpRequest())}_buildIdpRequest(t){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(n.idToken=t),n}}function CT(e){return aT(e.auth,new Bm(e),e.bypassAuthState)}function AT(e){const{auth:t,user:n}=e;return lt(n,t,"internal-error"),sT(n,new Bm(e),e.bypassAuthState)}async function jT(e){const{auth:t,user:n}=e;return lt(n,t,"internal-error"),iT(n,new Bm(e),e.bypassAuthState)}class y4{constructor(t,n,s,a,l=!1){this.auth=t,this.resolver=s,this.user=a,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(t,n)=>{this.pendingPromise={resolve:t,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(t){const{urlResponse:n,sessionId:s,postBody:a,tenantId:l,error:i,type:p}=t;if(i){this.reject(i);return}const g={auth:this.auth,requestUri:n,sessionId:s,tenantId:l||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(p)(g))}catch(v){this.reject(v)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return CT;case"linkViaPopup":case"linkViaRedirect":return jT;case"reauthViaPopup":case"reauthViaRedirect":return AT;default:Li(this.auth,"internal-error")}}resolve(t){hs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){hs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const MT=new fu(2e3,1e4);async function RT(e,t,n){if(ni(e.app))return Promise.reject(ii(e,"operation-not-supported-in-this-environment"));const s=th(e);T5(e,t,Om);const a=v4(s,n);return new $a(s,"signInViaPopup",t,a).executeNotNull()}class $a extends y4{constructor(t,n,s,a,l){super(t,n,a,l),this.provider=s,this.authWindow=null,this.pollId=null,$a.currentPopupAction&&$a.currentPopupAction.cancel(),$a.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return lt(t,this.auth,"internal-error"),t}async onExecution(){hs(this.filter.length===1,"Popup operations only handle one event");const t=Vm();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(ii(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ii(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,$a.currentPopupAction=null}pollUserCancellation(){const t=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ii(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,MT.get())};t()}}$a.currentPopupAction=null;const kT="pendingRedirect",df=new Map;class IT extends y4{constructor(t,n,s=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,s),this.eventId=null}async execute(){let t=df.get(this.auth._key());if(!t){try{const s=await DT(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(s)}catch(n){t=()=>Promise.reject(n)}df.set(this.auth._key(),t)}return this.bypassAuthState||df.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const n=await this.auth._redirectUserForId(t.eventId);if(n)return this.user=n,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function DT(e,t){const n=PT(t),s=LT(e);if(!await s._isAvailable())return!1;const a=await s._get(n)==="true";return await s._remove(n),a}function NT(e,t){df.set(e._key(),t)}function LT(e){return os(e._redirectPersistence)}function PT(e){return uf(kT,e.config.apiKey,e.name)}async function zT(e,t,n=!1){if(ni(e.app))return Promise.reject(Qa(e));const s=th(e),a=v4(s,t),i=await new IT(s,a,n).execute();return i&&!n&&(delete i.user._redirectEventId,await s._persistUserIfCurrent(i.user),await s._setRedirectUser(null,t)),i}const OT=600*1e3;class VT{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(t,s)&&(n=!0,this.sendToConsumer(t,s),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!BT(t)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(t,n){if(t.error&&!b4(t)){const s=t.error.code?.split("auth/")[1]||"internal-error";n.onError(ii(this.auth,s))}else n.onAuthEvent(t)}isEventForConsumer(t,n){const s=n.eventId===null||!!t.eventId&&t.eventId===n.eventId;return n.filter.includes(t.type)&&s}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=OT&&this.cachedEventUids.clear(),this.cachedEventUids.has(Vy(t))}saveEventToCache(t){this.cachedEventUids.add(Vy(t)),this.lastProcessedEventTime=Date.now()}}function Vy(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(t=>t).join("-")}function b4({type:e,error:t}){return e==="unknown"&&t?.code==="auth/no-auth-event"}function BT(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return b4(e);default:return!1}}async function UT(e,t={}){return El(e,"GET","/v1/projects",t)}const qT=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,HT=/^https?/;async function FT(e){if(e.config.emulator)return;const{authorizedDomains:t}=await UT(e);for(const n of t)try{if($T(n))return}catch{}Li(e,"unauthorized-domain")}function $T(e){const t=Kp(),{protocol:n,hostname:s}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return i.hostname===""&&s===""?n==="chrome-extension:"&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):n==="chrome-extension:"&&i.hostname===s}if(!HT.test(n))return!1;if(qT.test(e))return s===e;const a=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(s)}const WT=new fu(3e4,6e4);function By(){const e=Ri().___jsl;if(e?.H){for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}}function GT(e){return new Promise((t,n)=>{function s(){By(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{By(),n(ii(e,"network-request-failed"))},timeout:WT.get()})}if(Ri().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(Ri().gapi?.load)s();else{const a=K5("iframefcb");return Ri()[a]=()=>{gapi.load?s():n(ii(e,"network-request-failed"))},X5(`${Y5()}?onload=${a}`).catch(l=>n(l))}}).catch(t=>{throw ff=null,t})}let ff=null;function QT(e){return ff=ff||GT(e),ff}const XT=new fu(5e3,15e3),YT="__/auth/iframe",KT="emulator/auth/iframe",JT={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ZT=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function eE(e){const t=e.config;lt(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Dm(t,KT):`https://${e.config.authDomain}/${YT}`,s={apiKey:t.apiKey,appName:e.name,v:Tl},a=ZT.get(e.config.apiHost);a&&(s.eid=a);const l=e._getFrameworks();return l.length&&(s.fw=l.join(",")),`${n}?${du(s).slice(1)}`}async function tE(e){const t=await QT(e),n=Ri().gapi;return lt(n,e,"internal-error"),t.open({where:document.body,url:eE(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:JT,dontclear:!0},s=>new Promise(async(a,l)=>{await s.restyle({setHideOnLeave:!1});const i=ii(e,"network-request-failed"),p=Ri().setTimeout(()=>{l(i)},XT.get());function g(){Ri().clearTimeout(p),a(s)}s.ping(g).then(g,()=>{l(i)})}))}const nE={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},rE=500,iE=600,sE="_blank",aE="http://localhost";class Uy{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function oE(e,t,n,s=rE,a=iE){const l=Math.max((window.screen.availHeight-a)/2,0).toString(),i=Math.max((window.screen.availWidth-s)/2,0).toString();let p="";const g={...nE,width:s.toString(),height:a.toString(),top:l,left:i},v=Yn().toLowerCase();n&&(p=Z8(v)?sE:n),K8(v)&&(t=t||aE,g.scrollbars="yes");const u=Object.entries(g).reduce((y,[x,T])=>`${y}${x}=${T},`,"");if(U5(v)&&p!=="_self")return lE(t||"",p),new Uy(null);const h=window.open(t||"",p,u);lt(h,e,"popup-blocked");try{h.focus()}catch{}return new Uy(h)}function lE(e,t){const n=document.createElement("a");n.href=e,n.target=t;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}const cE="__/auth/handler",uE="emulator/auth/handler",dE=encodeURIComponent("fac");async function qy(e,t,n,s,a,l){lt(e.config.authDomain,e,"auth-domain-config-required"),lt(e.config.apiKey,e,"invalid-api-key");const i={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:Tl,eventId:a};if(t instanceof Om){t.setDefaultLanguage(e.languageCode),i.providerId=t.providerId||"",u6(t.getCustomParameters())||(i.customParameters=JSON.stringify(t.getCustomParameters()));for(const[u,h]of Object.entries({}))i[u]=h}if(t instanceof hu){const u=t.getScopes().filter(h=>h!=="");u.length>0&&(i.scopes=u.join(","))}e.tenantId&&(i.tid=e.tenantId);const p=i;for(const u of Object.keys(p))p[u]===void 0&&delete p[u];const g=await e._getAppCheckToken(),v=g?`#${dE}=${encodeURIComponent(g)}`:"";return`${fE(e)}?${du(p).slice(1)}${v}`}function fE({config:e}){return e.emulator?Dm(e,uE):`https://${e.authDomain}/${cE}`}const Np="webStorageSupport";class hE{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=f4,this._completeRedirectFn=zT,this._overrideRedirectResult=NT}async _openPopup(t,n,s,a){hs(this.eventManagers[t._key()]?.manager,"_initialize() not called before _openPopup()");const l=await qy(t,n,s,Kp(),a);return oE(t,l,Vm())}async _openRedirect(t,n,s,a){await this._originValidation(t);const l=await qy(t,n,s,Kp(),a);return gT(l),new Promise(()=>{})}_initialize(t){const n=t._key();if(this.eventManagers[n]){const{manager:a,promise:l}=this.eventManagers[n];return a?Promise.resolve(a):(hs(l,"If manager is not set, promise should be"),l)}const s=this.initAndGetManager(t);return this.eventManagers[n]={promise:s},s.catch(()=>{delete this.eventManagers[n]}),s}async initAndGetManager(t){const n=await tE(t),s=new VT(t);return n.register("authEvent",a=>(lt(a?.authEvent,t,"invalid-auth-event"),{status:s.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:s},this.iframes[t._key()]=n,s}_isIframeWebStorageSupported(t,n){this.iframes[t._key()].send(Np,{type:Np},a=>{const l=a?.[0]?.[Np];l!==void 0&&n(!!l),Li(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const n=t._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=FT(t)),this.originValidationPromises[n]}get _shouldInitProactively(){return i4()||J8()||Pm()}}const pE=hE;var Hy="@firebase/auth",Fy="1.12.0";class mE{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const n=this.auth.onIdTokenChanged(s=>{t(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(t,n),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const n=this.internalListeners.get(t);n&&(this.internalListeners.delete(t),n(),this.updateProactiveRefresh())}assertAuthConfigured(){lt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function gE(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function vE(e){ol(new Ka("auth",(t,{options:n})=>{const s=t.getProvider("app").getImmediate(),a=t.getProvider("heartbeat"),l=t.getProvider("app-check-internal"),{apiKey:i,authDomain:p}=s.options;lt(i&&!i.includes(":"),"invalid-api-key",{appName:s.name});const g={apiKey:i,authDomain:p,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:s4(e)},v=new G5(s,a,l,g);return Z5(v,n),v},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,n,s)=>{t.getProvider("auth-internal").initialize()})),ol(new Ka("auth-internal",t=>{const n=th(t.getProvider("auth").getImmediate());return(s=>new mE(s))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),ia(Hy,Fy,gE(e)),ia(Hy,Fy,"esm2020")}const yE=300,bE=L8("authIdTokenMaxAge")||yE;let $y=null;const SE=e=>async t=>{const n=t&&await t.getIdTokenResult(),s=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(s&&s>bE)return;const a=n?.token;$y!==a&&($y=a,await fetch(e,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function wE(e=U8()){const t=Rm(e,"auth");if(t.isInitialized())return t.getImmediate();const n=J5(e,{popupRedirectResolver:pE,persistence:[ET,hT,f4]}),s=L8("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(s,location.origin);if(location.origin===l.origin){const i=SE(l.toString());lT(n,i,()=>i(n.currentUser)),oT(n,p=>i(p))}}const a=D8("auth");return a&&eT(n,`http://${a}`),n}function _E(){return document.getElementsByTagName("head")?.[0]??document}Q5({loadJS(e){return new Promise((t,n)=>{const s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=a=>{const l=ii("internal-error");l.customData=a,n(l)},s.type="text/javascript",s.charset="UTF-8",_E().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});vE("Browser");var Wy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var sa,S4;(function(){var e;function t(k,I){function N(){}N.prototype=I.prototype,k.F=I.prototype,k.prototype=new N,k.prototype.constructor=k,k.D=function(U,z,q){for(var D=Array(arguments.length-2),de=2;de<arguments.length;de++)D[de-2]=arguments[de];return I.prototype[z].apply(U,D)}}function n(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(s,n),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(k,I,N){N||(N=0);const U=Array(16);if(typeof I=="string")for(var z=0;z<16;++z)U[z]=I.charCodeAt(N++)|I.charCodeAt(N++)<<8|I.charCodeAt(N++)<<16|I.charCodeAt(N++)<<24;else for(z=0;z<16;++z)U[z]=I[N++]|I[N++]<<8|I[N++]<<16|I[N++]<<24;I=k.g[0],N=k.g[1],z=k.g[2];let q=k.g[3],D;D=I+(q^N&(z^q))+U[0]+3614090360&4294967295,I=N+(D<<7&4294967295|D>>>25),D=q+(z^I&(N^z))+U[1]+3905402710&4294967295,q=I+(D<<12&4294967295|D>>>20),D=z+(N^q&(I^N))+U[2]+606105819&4294967295,z=q+(D<<17&4294967295|D>>>15),D=N+(I^z&(q^I))+U[3]+3250441966&4294967295,N=z+(D<<22&4294967295|D>>>10),D=I+(q^N&(z^q))+U[4]+4118548399&4294967295,I=N+(D<<7&4294967295|D>>>25),D=q+(z^I&(N^z))+U[5]+1200080426&4294967295,q=I+(D<<12&4294967295|D>>>20),D=z+(N^q&(I^N))+U[6]+2821735955&4294967295,z=q+(D<<17&4294967295|D>>>15),D=N+(I^z&(q^I))+U[7]+4249261313&4294967295,N=z+(D<<22&4294967295|D>>>10),D=I+(q^N&(z^q))+U[8]+1770035416&4294967295,I=N+(D<<7&4294967295|D>>>25),D=q+(z^I&(N^z))+U[9]+2336552879&4294967295,q=I+(D<<12&4294967295|D>>>20),D=z+(N^q&(I^N))+U[10]+4294925233&4294967295,z=q+(D<<17&4294967295|D>>>15),D=N+(I^z&(q^I))+U[11]+2304563134&4294967295,N=z+(D<<22&4294967295|D>>>10),D=I+(q^N&(z^q))+U[12]+1804603682&4294967295,I=N+(D<<7&4294967295|D>>>25),D=q+(z^I&(N^z))+U[13]+4254626195&4294967295,q=I+(D<<12&4294967295|D>>>20),D=z+(N^q&(I^N))+U[14]+2792965006&4294967295,z=q+(D<<17&4294967295|D>>>15),D=N+(I^z&(q^I))+U[15]+1236535329&4294967295,N=z+(D<<22&4294967295|D>>>10),D=I+(z^q&(N^z))+U[1]+4129170786&4294967295,I=N+(D<<5&4294967295|D>>>27),D=q+(N^z&(I^N))+U[6]+3225465664&4294967295,q=I+(D<<9&4294967295|D>>>23),D=z+(I^N&(q^I))+U[11]+643717713&4294967295,z=q+(D<<14&4294967295|D>>>18),D=N+(q^I&(z^q))+U[0]+3921069994&4294967295,N=z+(D<<20&4294967295|D>>>12),D=I+(z^q&(N^z))+U[5]+3593408605&4294967295,I=N+(D<<5&4294967295|D>>>27),D=q+(N^z&(I^N))+U[10]+38016083&4294967295,q=I+(D<<9&4294967295|D>>>23),D=z+(I^N&(q^I))+U[15]+3634488961&4294967295,z=q+(D<<14&4294967295|D>>>18),D=N+(q^I&(z^q))+U[4]+3889429448&4294967295,N=z+(D<<20&4294967295|D>>>12),D=I+(z^q&(N^z))+U[9]+568446438&4294967295,I=N+(D<<5&4294967295|D>>>27),D=q+(N^z&(I^N))+U[14]+3275163606&4294967295,q=I+(D<<9&4294967295|D>>>23),D=z+(I^N&(q^I))+U[3]+4107603335&4294967295,z=q+(D<<14&4294967295|D>>>18),D=N+(q^I&(z^q))+U[8]+1163531501&4294967295,N=z+(D<<20&4294967295|D>>>12),D=I+(z^q&(N^z))+U[13]+2850285829&4294967295,I=N+(D<<5&4294967295|D>>>27),D=q+(N^z&(I^N))+U[2]+4243563512&4294967295,q=I+(D<<9&4294967295|D>>>23),D=z+(I^N&(q^I))+U[7]+1735328473&4294967295,z=q+(D<<14&4294967295|D>>>18),D=N+(q^I&(z^q))+U[12]+2368359562&4294967295,N=z+(D<<20&4294967295|D>>>12),D=I+(N^z^q)+U[5]+4294588738&4294967295,I=N+(D<<4&4294967295|D>>>28),D=q+(I^N^z)+U[8]+2272392833&4294967295,q=I+(D<<11&4294967295|D>>>21),D=z+(q^I^N)+U[11]+1839030562&4294967295,z=q+(D<<16&4294967295|D>>>16),D=N+(z^q^I)+U[14]+4259657740&4294967295,N=z+(D<<23&4294967295|D>>>9),D=I+(N^z^q)+U[1]+2763975236&4294967295,I=N+(D<<4&4294967295|D>>>28),D=q+(I^N^z)+U[4]+1272893353&4294967295,q=I+(D<<11&4294967295|D>>>21),D=z+(q^I^N)+U[7]+4139469664&4294967295,z=q+(D<<16&4294967295|D>>>16),D=N+(z^q^I)+U[10]+3200236656&4294967295,N=z+(D<<23&4294967295|D>>>9),D=I+(N^z^q)+U[13]+681279174&4294967295,I=N+(D<<4&4294967295|D>>>28),D=q+(I^N^z)+U[0]+3936430074&4294967295,q=I+(D<<11&4294967295|D>>>21),D=z+(q^I^N)+U[3]+3572445317&4294967295,z=q+(D<<16&4294967295|D>>>16),D=N+(z^q^I)+U[6]+76029189&4294967295,N=z+(D<<23&4294967295|D>>>9),D=I+(N^z^q)+U[9]+3654602809&4294967295,I=N+(D<<4&4294967295|D>>>28),D=q+(I^N^z)+U[12]+3873151461&4294967295,q=I+(D<<11&4294967295|D>>>21),D=z+(q^I^N)+U[15]+530742520&4294967295,z=q+(D<<16&4294967295|D>>>16),D=N+(z^q^I)+U[2]+3299628645&4294967295,N=z+(D<<23&4294967295|D>>>9),D=I+(z^(N|~q))+U[0]+4096336452&4294967295,I=N+(D<<6&4294967295|D>>>26),D=q+(N^(I|~z))+U[7]+1126891415&4294967295,q=I+(D<<10&4294967295|D>>>22),D=z+(I^(q|~N))+U[14]+2878612391&4294967295,z=q+(D<<15&4294967295|D>>>17),D=N+(q^(z|~I))+U[5]+4237533241&4294967295,N=z+(D<<21&4294967295|D>>>11),D=I+(z^(N|~q))+U[12]+1700485571&4294967295,I=N+(D<<6&4294967295|D>>>26),D=q+(N^(I|~z))+U[3]+2399980690&4294967295,q=I+(D<<10&4294967295|D>>>22),D=z+(I^(q|~N))+U[10]+4293915773&4294967295,z=q+(D<<15&4294967295|D>>>17),D=N+(q^(z|~I))+U[1]+2240044497&4294967295,N=z+(D<<21&4294967295|D>>>11),D=I+(z^(N|~q))+U[8]+1873313359&4294967295,I=N+(D<<6&4294967295|D>>>26),D=q+(N^(I|~z))+U[15]+4264355552&4294967295,q=I+(D<<10&4294967295|D>>>22),D=z+(I^(q|~N))+U[6]+2734768916&4294967295,z=q+(D<<15&4294967295|D>>>17),D=N+(q^(z|~I))+U[13]+1309151649&4294967295,N=z+(D<<21&4294967295|D>>>11),D=I+(z^(N|~q))+U[4]+4149444226&4294967295,I=N+(D<<6&4294967295|D>>>26),D=q+(N^(I|~z))+U[11]+3174756917&4294967295,q=I+(D<<10&4294967295|D>>>22),D=z+(I^(q|~N))+U[2]+718787259&4294967295,z=q+(D<<15&4294967295|D>>>17),D=N+(q^(z|~I))+U[9]+3951481745&4294967295,k.g[0]=k.g[0]+I&4294967295,k.g[1]=k.g[1]+(z+(D<<21&4294967295|D>>>11))&4294967295,k.g[2]=k.g[2]+z&4294967295,k.g[3]=k.g[3]+q&4294967295}s.prototype.v=function(k,I){I===void 0&&(I=k.length);const N=I-this.blockSize,U=this.C;let z=this.h,q=0;for(;q<I;){if(z==0)for(;q<=N;)a(this,k,q),q+=this.blockSize;if(typeof k=="string"){for(;q<I;)if(U[z++]=k.charCodeAt(q++),z==this.blockSize){a(this,U),z=0;break}}else for(;q<I;)if(U[z++]=k[q++],z==this.blockSize){a(this,U),z=0;break}}this.h=z,this.o+=I},s.prototype.A=function(){var k=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);k[0]=128;for(var I=1;I<k.length-8;++I)k[I]=0;I=this.o*8;for(var N=k.length-8;N<k.length;++N)k[N]=I&255,I/=256;for(this.v(k),k=Array(16),I=0,N=0;N<4;++N)for(let U=0;U<32;U+=8)k[I++]=this.g[N]>>>U&255;return k};function l(k,I){var N=p;return Object.prototype.hasOwnProperty.call(N,k)?N[k]:N[k]=I(k)}function i(k,I){this.h=I;const N=[];let U=!0;for(let z=k.length-1;z>=0;z--){const q=k[z]|0;U&&q==I||(N[z]=q,U=!1)}this.g=N}var p={};function g(k){return-128<=k&&k<128?l(k,function(I){return new i([I|0],I<0?-1:0)}):new i([k|0],k<0?-1:0)}function v(k){if(isNaN(k)||!isFinite(k))return h;if(k<0)return E(v(-k));const I=[];let N=1;for(let U=0;k>=N;U++)I[U]=k/N|0,N*=4294967296;return new i(I,0)}function u(k,I){if(k.length==0)throw Error("number format error: empty string");if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(k.charAt(0)=="-")return E(u(k.substring(1),I));if(k.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=v(Math.pow(I,8));let U=h;for(let q=0;q<k.length;q+=8){var z=Math.min(8,k.length-q);const D=parseInt(k.substring(q,q+z),I);z<8?(z=v(Math.pow(I,z)),U=U.j(z).add(v(D))):(U=U.j(N),U=U.add(v(D)))}return U}var h=g(0),y=g(1),x=g(16777216);e=i.prototype,e.m=function(){if(_(this))return-E(this).m();let k=0,I=1;for(let N=0;N<this.g.length;N++){const U=this.i(N);k+=(U>=0?U:4294967296+U)*I,I*=4294967296}return k},e.toString=function(k){if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(T(this))return"0";if(_(this))return"-"+E(this).toString(k);const I=v(Math.pow(k,6));var N=this;let U="";for(;;){const z=X(N,I).g;N=R(N,z.j(I));let q=((N.g.length>0?N.g[0]:N.h)>>>0).toString(k);if(N=z,T(N))return q+U;for(;q.length<6;)q="0"+q;U=q+U}},e.i=function(k){return k<0?0:k<this.g.length?this.g[k]:this.h};function T(k){if(k.h!=0)return!1;for(let I=0;I<k.g.length;I++)if(k.g[I]!=0)return!1;return!0}function _(k){return k.h==-1}e.l=function(k){return k=R(this,k),_(k)?-1:T(k)?0:1};function E(k){const I=k.g.length,N=[];for(let U=0;U<I;U++)N[U]=~k.g[U];return new i(N,~k.h).add(y)}e.abs=function(){return _(this)?E(this):this},e.add=function(k){const I=Math.max(this.g.length,k.g.length),N=[];let U=0;for(let z=0;z<=I;z++){let q=U+(this.i(z)&65535)+(k.i(z)&65535),D=(q>>>16)+(this.i(z)>>>16)+(k.i(z)>>>16);U=D>>>16,q&=65535,D&=65535,N[z]=D<<16|q}return new i(N,N[N.length-1]&-2147483648?-1:0)};function R(k,I){return k.add(E(I))}e.j=function(k){if(T(this)||T(k))return h;if(_(this))return _(k)?E(this).j(E(k)):E(E(this).j(k));if(_(k))return E(this.j(E(k)));if(this.l(x)<0&&k.l(x)<0)return v(this.m()*k.m());const I=this.g.length+k.g.length,N=[];for(var U=0;U<2*I;U++)N[U]=0;for(U=0;U<this.g.length;U++)for(let z=0;z<k.g.length;z++){const q=this.i(U)>>>16,D=this.i(U)&65535,de=k.i(z)>>>16,je=k.i(z)&65535;N[2*U+2*z]+=D*je,P(N,2*U+2*z),N[2*U+2*z+1]+=q*je,P(N,2*U+2*z+1),N[2*U+2*z+1]+=D*de,P(N,2*U+2*z+1),N[2*U+2*z+2]+=q*de,P(N,2*U+2*z+2)}for(k=0;k<I;k++)N[k]=N[2*k+1]<<16|N[2*k];for(k=I;k<2*I;k++)N[k]=0;return new i(N,0)};function P(k,I){for(;(k[I]&65535)!=k[I];)k[I+1]+=k[I]>>>16,k[I]&=65535,I++}function B(k,I){this.g=k,this.h=I}function X(k,I){if(T(I))throw Error("division by zero");if(T(k))return new B(h,h);if(_(k))return I=X(E(k),I),new B(E(I.g),E(I.h));if(_(I))return I=X(k,E(I)),new B(E(I.g),I.h);if(k.g.length>30){if(_(k)||_(I))throw Error("slowDivide_ only works with positive integers.");for(var N=y,U=I;U.l(k)<=0;)N=Q(N),U=Q(U);var z=K(N,1),q=K(U,1);for(U=K(U,2),N=K(N,2);!T(U);){var D=q.add(U);D.l(k)<=0&&(z=z.add(N),q=D),U=K(U,1),N=K(N,1)}return I=R(k,z.j(I)),new B(z,I)}for(z=h;k.l(I)>=0;){for(N=Math.max(1,Math.floor(k.m()/I.m())),U=Math.ceil(Math.log(N)/Math.LN2),U=U<=48?1:Math.pow(2,U-48),q=v(N),D=q.j(I);_(D)||D.l(k)>0;)N-=U,q=v(N),D=q.j(I);T(q)&&(q=y),z=z.add(q),k=R(k,D)}return new B(z,k)}e.B=function(k){return X(this,k).h},e.and=function(k){const I=Math.max(this.g.length,k.g.length),N=[];for(let U=0;U<I;U++)N[U]=this.i(U)&k.i(U);return new i(N,this.h&k.h)},e.or=function(k){const I=Math.max(this.g.length,k.g.length),N=[];for(let U=0;U<I;U++)N[U]=this.i(U)|k.i(U);return new i(N,this.h|k.h)},e.xor=function(k){const I=Math.max(this.g.length,k.g.length),N=[];for(let U=0;U<I;U++)N[U]=this.i(U)^k.i(U);return new i(N,this.h^k.h)};function Q(k){const I=k.g.length+1,N=[];for(let U=0;U<I;U++)N[U]=k.i(U)<<1|k.i(U-1)>>>31;return new i(N,k.h)}function K(k,I){const N=I>>5;I%=32;const U=k.g.length-N,z=[];for(let q=0;q<U;q++)z[q]=I>0?k.i(q+N)>>>I|k.i(q+N+1)<<32-I:k.i(q+N);return new i(z,k.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,S4=s,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=v,i.fromString=u,sa=i}).apply(typeof Wy<"u"?Wy:typeof self<"u"?self:typeof window<"u"?window:{});var Zd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var w4,Vc,_4,hf,em,x4,T4,E4;(function(){var e,t=Object.defineProperty;function n(b){b=[typeof globalThis=="object"&&globalThis,b,typeof window=="object"&&window,typeof self=="object"&&self,typeof Zd=="object"&&Zd];for(var C=0;C<b.length;++C){var j=b[C];if(j&&j.Math==Math)return j}throw Error("Cannot find global object")}var s=n(this);function a(b,C){if(C)e:{var j=s;b=b.split(".");for(var V=0;V<b.length-1;V++){var ie=b[V];if(!(ie in j))break e;j=j[ie]}b=b[b.length-1],V=j[b],C=C(V),C!=V&&C!=null&&t(j,b,{configurable:!0,writable:!0,value:C})}}a("Symbol.dispose",function(b){return b||Symbol("Symbol.dispose")}),a("Array.prototype.values",function(b){return b||function(){return this[Symbol.iterator]()}}),a("Object.entries",function(b){return b||function(C){var j=[],V;for(V in C)Object.prototype.hasOwnProperty.call(C,V)&&j.push([V,C[V]]);return j}});var l=l||{},i=this||self;function p(b){var C=typeof b;return C=="object"&&b!=null||C=="function"}function g(b,C,j){return b.call.apply(b.bind,arguments)}function v(b,C,j){return v=g,v.apply(null,arguments)}function u(b,C){var j=Array.prototype.slice.call(arguments,1);return function(){var V=j.slice();return V.push.apply(V,arguments),b.apply(this,V)}}function h(b,C){function j(){}j.prototype=C.prototype,b.Z=C.prototype,b.prototype=new j,b.prototype.constructor=b,b.Ob=function(V,ie,he){for(var Ve=Array(arguments.length-2),ht=2;ht<arguments.length;ht++)Ve[ht-2]=arguments[ht];return C.prototype[ie].apply(V,Ve)}}var y=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?b=>b&&AsyncContext.Snapshot.wrap(b):b=>b;function x(b){const C=b.length;if(C>0){const j=Array(C);for(let V=0;V<C;V++)j[V]=b[V];return j}return[]}function T(b,C){for(let V=1;V<arguments.length;V++){const ie=arguments[V];var j=typeof ie;if(j=j!="object"?j:ie?Array.isArray(ie)?"array":j:"null",j=="array"||j=="object"&&typeof ie.length=="number"){j=b.length||0;const he=ie.length||0;b.length=j+he;for(let Ve=0;Ve<he;Ve++)b[j+Ve]=ie[Ve]}else b.push(ie)}}class _{constructor(C,j){this.i=C,this.j=j,this.h=0,this.g=null}get(){let C;return this.h>0?(this.h--,C=this.g,this.g=C.next,C.next=null):C=this.i(),C}}function E(b){i.setTimeout(()=>{throw b},0)}function R(){var b=k;let C=null;return b.g&&(C=b.g,b.g=b.g.next,b.g||(b.h=null),C.next=null),C}class P{constructor(){this.h=this.g=null}add(C,j){const V=B.get();V.set(C,j),this.h?this.h.next=V:this.g=V,this.h=V}}var B=new _(()=>new X,b=>b.reset());class X{constructor(){this.next=this.g=this.h=null}set(C,j){this.h=C,this.g=j,this.next=null}reset(){this.next=this.g=this.h=null}}let Q,K=!1,k=new P,I=()=>{const b=Promise.resolve(void 0);Q=()=>{b.then(N)}};function N(){for(var b;b=R();){try{b.h.call(b.g)}catch(j){E(j)}var C=B;C.j(b),C.h<100&&(C.h++,b.next=C.g,C.g=b)}K=!1}function U(){this.u=this.u,this.C=this.C}U.prototype.u=!1,U.prototype.dispose=function(){this.u||(this.u=!0,this.N())},U.prototype[Symbol.dispose]=function(){this.dispose()},U.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function z(b,C){this.type=b,this.g=this.target=C,this.defaultPrevented=!1}z.prototype.h=function(){this.defaultPrevented=!0};var q=(function(){if(!i.addEventListener||!Object.defineProperty)return!1;var b=!1,C=Object.defineProperty({},"passive",{get:function(){b=!0}});try{const j=()=>{};i.addEventListener("test",j,C),i.removeEventListener("test",j,C)}catch{}return b})();function D(b){return/^[\s\xa0]*$/.test(b)}function de(b,C){z.call(this,b?b.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,b&&this.init(b,C)}h(de,z),de.prototype.init=function(b,C){const j=this.type=b.type,V=b.changedTouches&&b.changedTouches.length?b.changedTouches[0]:null;this.target=b.target||b.srcElement,this.g=C,C=b.relatedTarget,C||(j=="mouseover"?C=b.fromElement:j=="mouseout"&&(C=b.toElement)),this.relatedTarget=C,V?(this.clientX=V.clientX!==void 0?V.clientX:V.pageX,this.clientY=V.clientY!==void 0?V.clientY:V.pageY,this.screenX=V.screenX||0,this.screenY=V.screenY||0):(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0),this.button=b.button,this.key=b.key||"",this.ctrlKey=b.ctrlKey,this.altKey=b.altKey,this.shiftKey=b.shiftKey,this.metaKey=b.metaKey,this.pointerId=b.pointerId||0,this.pointerType=b.pointerType,this.state=b.state,this.i=b,b.defaultPrevented&&de.Z.h.call(this)},de.prototype.h=function(){de.Z.h.call(this);const b=this.i;b.preventDefault?b.preventDefault():b.returnValue=!1};var je="closure_listenable_"+(Math.random()*1e6|0),W=0;function J(b,C,j,V,ie){this.listener=b,this.proxy=null,this.src=C,this.type=j,this.capture=!!V,this.ha=ie,this.key=++W,this.da=this.fa=!1}function ve(b){b.da=!0,b.listener=null,b.proxy=null,b.src=null,b.ha=null}function Se(b,C,j){for(const V in b)C.call(j,b[V],V,b)}function Re(b,C){for(const j in b)C.call(void 0,b[j],j,b)}function H(b){const C={};for(const j in b)C[j]=b[j];return C}const Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function te(b,C){let j,V;for(let ie=1;ie<arguments.length;ie++){V=arguments[ie];for(j in V)b[j]=V[j];for(let he=0;he<Z.length;he++)j=Z[he],Object.prototype.hasOwnProperty.call(V,j)&&(b[j]=V[j])}}function fe(b){this.src=b,this.g={},this.h=0}fe.prototype.add=function(b,C,j,V,ie){const he=b.toString();b=this.g[he],b||(b=this.g[he]=[],this.h++);const Ve=O(b,C,V,ie);return Ve>-1?(C=b[Ve],j||(C.fa=!1)):(C=new J(C,this.src,he,!!V,ie),C.fa=j,b.push(C)),C};function F(b,C){const j=C.type;if(j in b.g){var V=b.g[j],ie=Array.prototype.indexOf.call(V,C,void 0),he;(he=ie>=0)&&Array.prototype.splice.call(V,ie,1),he&&(ve(C),b.g[j].length==0&&(delete b.g[j],b.h--))}}function O(b,C,j,V){for(let ie=0;ie<b.length;++ie){const he=b[ie];if(!he.da&&he.listener==C&&he.capture==!!j&&he.ha==V)return ie}return-1}var xe="closure_lm_"+(Math.random()*1e6|0),Le={};function Oe(b,C,j,V,ie){if(Array.isArray(C)){for(let he=0;he<C.length;he++)Oe(b,C[he],j,V,ie);return null}return j=ge(j),b&&b[je]?b.J(C,j,p(V)?!!V.capture:!1,ie):De(b,C,j,!1,V,ie)}function De(b,C,j,V,ie,he){if(!C)throw Error("Invalid event type");const Ve=p(ie)?!!ie.capture:!!ie;let ht=$(b);if(ht||(b[xe]=ht=new fe(b)),j=ht.add(C,j,V,Ve,he),j.proxy)return j;if(V=re(),j.proxy=V,V.src=b,V.listener=j,b.addEventListener)q||(ie=Ve),ie===void 0&&(ie=!1),b.addEventListener(C.toString(),V,ie);else if(b.attachEvent)b.attachEvent(se(C.toString()),V);else if(b.addListener&&b.removeListener)b.addListener(V);else throw Error("addEventListener and attachEvent are unavailable.");return j}function re(){function b(j){return C.call(b.src,b.listener,j)}const C=Ue;return b}function Ie(b,C,j,V,ie){if(Array.isArray(C))for(var he=0;he<C.length;he++)Ie(b,C[he],j,V,ie);else V=p(V)?!!V.capture:!!V,j=ge(j),b&&b[je]?(b=b.i,he=String(C).toString(),he in b.g&&(C=b.g[he],j=O(C,j,V,ie),j>-1&&(ve(C[j]),Array.prototype.splice.call(C,j,1),C.length==0&&(delete b.g[he],b.h--)))):b&&(b=$(b))&&(C=b.g[C.toString()],b=-1,C&&(b=O(C,j,V,ie)),(j=b>-1?C[b]:null)&&Xe(j))}function Xe(b){if(typeof b!="number"&&b&&!b.da){var C=b.src;if(C&&C[je])F(C.i,b);else{var j=b.type,V=b.proxy;C.removeEventListener?C.removeEventListener(j,V,b.capture):C.detachEvent?C.detachEvent(se(j),V):C.addListener&&C.removeListener&&C.removeListener(V),(j=$(C))?(F(j,b),j.h==0&&(j.src=null,C[xe]=null)):ve(b)}}}function se(b){return b in Le?Le[b]:Le[b]="on"+b}function Ue(b,C){if(b.da)b=!0;else{C=new de(C,this);const j=b.listener,V=b.ha||b.src;b.fa&&Xe(b),b=j.call(V,C)}return b}function $(b){return b=b[xe],b instanceof fe?b:null}var ee="__closure_events_fn_"+(Math.random()*1e9>>>0);function ge(b){return typeof b=="function"?b:(b[ee]||(b[ee]=function(C){return b.handleEvent(C)}),b[ee])}function me(){U.call(this),this.i=new fe(this),this.M=this,this.G=null}h(me,U),me.prototype[je]=!0,me.prototype.removeEventListener=function(b,C,j,V){Ie(this,b,C,j,V)};function we(b,C){var j,V=b.G;if(V)for(j=[];V;V=V.G)j.push(V);if(b=b.M,V=C.type||C,typeof C=="string")C=new z(C,b);else if(C instanceof z)C.target=C.target||b;else{var ie=C;C=new z(V,b),te(C,ie)}ie=!0;let he,Ve;if(j)for(Ve=j.length-1;Ve>=0;Ve--)he=C.g=j[Ve],ie=Ce(he,V,!0,C)&&ie;if(he=C.g=b,ie=Ce(he,V,!0,C)&&ie,ie=Ce(he,V,!1,C)&&ie,j)for(Ve=0;Ve<j.length;Ve++)he=C.g=j[Ve],ie=Ce(he,V,!1,C)&&ie}me.prototype.N=function(){if(me.Z.N.call(this),this.i){var b=this.i;for(const C in b.g){const j=b.g[C];for(let V=0;V<j.length;V++)ve(j[V]);delete b.g[C],b.h--}}this.G=null},me.prototype.J=function(b,C,j,V){return this.i.add(String(b),C,!1,j,V)},me.prototype.K=function(b,C,j,V){return this.i.add(String(b),C,!0,j,V)};function Ce(b,C,j,V){if(C=b.i.g[String(C)],!C)return!0;C=C.concat();let ie=!0;for(let he=0;he<C.length;++he){const Ve=C[he];if(Ve&&!Ve.da&&Ve.capture==j){const ht=Ve.listener,dn=Ve.ha||Ve.src;Ve.fa&&F(b.i,Ve),ie=ht.call(dn,V)!==!1&&ie}}return ie&&!V.defaultPrevented}function Te(b,C){if(typeof b!="function")if(b&&typeof b.handleEvent=="function")b=v(b.handleEvent,b);else throw Error("Invalid listener argument");return Number(C)>2147483647?-1:i.setTimeout(b,C||0)}function Pe(b){b.g=Te(()=>{b.g=null,b.i&&(b.i=!1,Pe(b))},b.l);const C=b.h;b.h=null,b.m.apply(null,C)}class Ge extends U{constructor(C,j){super(),this.m=C,this.l=j,this.h=null,this.i=!1,this.g=null}j(C){this.h=arguments,this.g?this.i=!0:Pe(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(b){U.call(this),this.h=b,this.g={}}h(ce,U);var ze=[];function Je(b){Se(b.g,function(C,j){this.g.hasOwnProperty(j)&&Xe(C)},b),b.g={}}ce.prototype.N=function(){ce.Z.N.call(this),Je(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var dt=i.JSON.stringify,nt=i.JSON.parse,Vt=class{stringify(b){return i.JSON.stringify(b,void 0)}parse(b){return i.JSON.parse(b,void 0)}};function nn(){}function Wn(){}var Ft={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ne(){z.call(this,"d")}h(Ne,z);function ke(){z.call(this,"c")}h(ke,z);var $e={},Ye=null;function Ze(){return Ye=Ye||new me}$e.Ia="serverreachability";function qe(b){z.call(this,$e.Ia,b)}h(qe,z);function xt(b){const C=Ze();we(C,new qe(C))}$e.STAT_EVENT="statevent";function Pn(b,C){z.call(this,$e.STAT_EVENT,b),this.stat=C}h(Pn,z);function rn(b){const C=Ze();we(C,new Pn(C,b))}$e.Ja="timingevent";function He(b,C){z.call(this,$e.Ja,b),this.size=C}h(He,z);function Nt(b,C){if(typeof b!="function")throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){b()},C)}function Jt(){this.g=!0}Jt.prototype.ua=function(){this.g=!1};function ur(b,C,j,V,ie,he){b.info(function(){if(b.g)if(he){var Ve="",ht=he.split("&");for(let It=0;It<ht.length;It++){var dn=ht[It].split("=");if(dn.length>1){const Zt=dn[0];dn=dn[1];const Rr=Zt.split("_");Ve=Rr.length>=2&&Rr[1]=="type"?Ve+(Zt+"="+dn+"&"):Ve+(Zt+"=redacted&")}}}else Ve=null;else Ve=he;return"XMLHTTP REQ ("+V+") [attempt "+ie+"]: "+C+`
`+j+`
`+Ve})}function Oi(b,C,j,V,ie,he,Ve){b.info(function(){return"XMLHTTP RESP ("+V+") [ attempt "+ie+"]: "+C+`
`+j+`
`+he+" "+Ve})}function di(b,C,j,V){b.info(function(){return"XMLHTTP TEXT ("+C+"): "+Th(b,j)+(V?" "+V:"")})}function va(b,C){b.info(function(){return"TIMEOUT: "+C})}Jt.prototype.info=function(){};function Th(b,C){if(!b.g)return C;if(!C)return null;try{const he=JSON.parse(C);if(he){for(b=0;b<he.length;b++)if(Array.isArray(he[b])){var j=he[b];if(!(j.length<2)){var V=j[1];if(Array.isArray(V)&&!(V.length<1)){var ie=V[0];if(ie!="noop"&&ie!="stop"&&ie!="close")for(let Ve=1;Ve<V.length;Ve++)V[Ve]=""}}}}return dt(he)}catch{return C}}var ya={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Nl={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ll;function ba(){}h(ba,nn),ba.prototype.g=function(){return new XMLHttpRequest},Ll=new ba;function Vi(b){return encodeURIComponent(String(b))}function Mu(b){var C=1;b=b.split(":");const j=[];for(;C>0&&b.length;)j.push(b.shift()),C--;return b.length&&j.push(b.join(":")),j}function $r(b,C,j,V){this.j=b,this.i=C,this.l=j,this.S=V||1,this.V=new ce(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Wr}function Wr(){this.i=null,this.g="",this.h=!1}var gn={},Rn={};function fi(b,C,j){b.M=1,b.A=Sa(yn(C)),b.u=j,b.R=!0,oo(b,null)}function oo(b,C){b.F=Date.now(),hi(b),b.B=yn(b.A);var j=b.B,V=b.S;Array.isArray(V)||(V=[String(V)]),fo(j.i,"t",V),b.C=0,j=b.j.L,b.h=new Wr,b.g=Fu(b.j,j?C:null,!b.u),b.P>0&&(b.O=new Ge(v(b.Y,b,b.g),b.P)),C=b.V,j=b.g,V=b.ba;var ie="readystatechange";Array.isArray(ie)||(ie&&(ze[0]=ie.toString()),ie=ze);for(let he=0;he<ie.length;he++){const Ve=Oe(j,ie[he],V||C.handleEvent,!1,C.h||C);if(!Ve)break;C.g[Ve.key]=Ve}C=b.J?H(b.J):{},b.u?(b.v||(b.v="POST"),C["Content-Type"]="application/x-www-form-urlencoded",b.g.ea(b.B,b.v,b.u,C)):(b.v="GET",b.g.ea(b.B,b.v,null,C)),xt(),ur(b.i,b.v,b.B,b.l,b.S,b.u)}$r.prototype.ba=function(b){b=b.target;const C=this.O;C&&Xr(b)==3?C.j():this.Y(b)},$r.prototype.Y=function(b){try{if(b==this.g)e:{const ht=Xr(this.g),dn=this.g.ya(),It=this.g.ca();if(!(ht<3)&&(ht!=3||this.g&&(this.h.h||this.g.la()||zn(this.g)))){this.K||ht!=4||dn==7||(dn==8||It<=0?xt(3):xt(2)),pi(this);var C=this.g.ca();this.X=C;var j=Eh(this);if(this.o=C==200,Oi(this.i,this.v,this.B,this.l,this.S,ht,C),this.o){if(this.U&&!this.L){t:{if(this.g){var V,ie=this.g;if((V=ie.g?ie.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(V)){var he=V;break t}}he=null}if(b=he)di(this.i,this.l,b,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,mi(this,b);else{this.o=!1,this.m=3,rn(12),dr(this),Ar(this);break e}}if(this.R){b=!0;let Zt;for(;!this.K&&this.C<j.length;)if(Zt=ku(this,j),Zt==Rn){ht==4&&(this.m=4,rn(14),b=!1),di(this.i,this.l,null,"[Incomplete Response]");break}else if(Zt==gn){this.m=4,rn(15),di(this.i,this.l,j,"[Invalid Chunk]"),b=!1;break}else di(this.i,this.l,Zt,null),mi(this,Zt);if(Ru(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ht!=4||j.length!=0||this.h.h||(this.m=1,rn(16),b=!1),this.o=this.o&&b,!b)di(this.i,this.l,j,"[Invalid Chunked Response]"),dr(this),Ar(this);else if(j.length>0&&!this.W){this.W=!0;var Ve=this.j;Ve.g==this&&Ve.aa&&!Ve.P&&(Ve.j.info("Great, no buffering proxy detected. Bytes received: "+j.length),Yl(Ve),Ve.P=!0,rn(11))}}else di(this.i,this.l,j,null),mi(this,j);ht==4&&dr(this),this.o&&!this.K&&(ht==4?Bu(this.j,this):(this.o=!1,hi(this)))}else Ui(this.g),C==400&&j.indexOf("Unknown SID")>0?(this.m=3,rn(12)):(this.m=0,rn(13)),dr(this),Ar(this)}}}catch{}};function Eh(b){if(!Ru(b))return b.g.la();const C=zn(b.g);if(C==="")return"";let j="";const V=C.length,ie=Xr(b.g)==4;if(!b.h.i){if(typeof TextDecoder>"u")return dr(b),Ar(b),"";b.h.i=new i.TextDecoder}for(let he=0;he<V;he++)b.h.h=!0,j+=b.h.i.decode(C[he],{stream:!(ie&&he==V-1)});return C.length=0,b.h.g+=j,b.C=0,b.h.g}function Ru(b){return b.g?b.v=="GET"&&b.M!=2&&b.j.Aa:!1}function ku(b,C){var j=b.C,V=C.indexOf(`
`,j);return V==-1?Rn:(j=Number(C.substring(j,V)),isNaN(j)?gn:(V+=1,V+j>C.length?Rn:(C=C.slice(V,V+j),b.C=V+j,C)))}$r.prototype.cancel=function(){this.K=!0,dr(this)};function hi(b){b.T=Date.now()+b.H,lo(b,b.H)}function lo(b,C){if(b.D!=null)throw Error("WatchDog timer not null");b.D=Nt(v(b.aa,b),C)}function pi(b){b.D&&(i.clearTimeout(b.D),b.D=null)}$r.prototype.aa=function(){this.D=null;const b=Date.now();b-this.T>=0?(va(this.i,this.B),this.M!=2&&(xt(),rn(17)),dr(this),this.m=2,Ar(this)):lo(this,this.T-b)};function Ar(b){b.j.I==0||b.K||Bu(b.j,b)}function dr(b){pi(b);var C=b.O;C&&typeof C.dispose=="function"&&C.dispose(),b.O=null,Je(b.V),b.g&&(C=b.g,b.g=null,C.abort(),C.dispose())}function mi(b,C){try{var j=b.j;if(j.I!=0&&(j.g==b||vi(j.h,b))){if(!b.L&&vi(j.h,b)&&j.I==3){try{var V=j.Ba.g.parse(C)}catch{V=null}if(Array.isArray(V)&&V.length==3){var ie=V;if(ie[0]==0){e:if(!j.v){if(j.g)if(j.g.F+3e3<b.F)vo(j),Ts(j);else break e;Aa(j),rn(18)}}else j.xa=ie[1],0<j.xa-j.K&&ie[2]<37500&&j.F&&j.A==0&&!j.C&&(j.C=Nt(v(j.Va,j),6e3));gi(j.h)<=1&&j.ta&&(j.ta=void 0)}else xi(j,11)}else if((b.L||j.g==b)&&vo(j),!D(C))for(ie=j.Ba.g.parse(C),C=0;C<ie.length;C++){let It=ie[C];const Zt=It[0];if(!(Zt<=j.K))if(j.K=Zt,It=It[1],j.I==2)if(It[0]=="c"){j.M=It[1],j.ba=It[2];const Rr=It[3];Rr!=null&&(j.ka=Rr,j.j.info("VER="+j.ka));const Ti=It[4];Ti!=null&&(j.za=Ti,j.j.info("SVER="+j.za));const Yr=It[5];Yr!=null&&typeof Yr=="number"&&Yr>0&&(V=1.5*Yr,j.O=V,j.j.info("backChannelRequestTimeoutMs_="+V)),V=j;const Kr=b.g;if(Kr){const ja=Kr.g?Kr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ja){var he=V.h;he.g||ja.indexOf("spdy")==-1&&ja.indexOf("quic")==-1&&ja.indexOf("h2")==-1||(he.j=he.l,he.g=new Set,he.h&&(Ol(he,he.h),he.h=null))}if(V.G){const yo=Kr.g?Kr.g.getResponseHeader("X-HTTP-Session-Id"):null;yo&&(V.wa=yo,Lt(V.J,V.G,yo))}}j.I=3,j.l&&j.l.ra(),j.aa&&(j.T=Date.now()-b.F,j.j.info("Handshake RTT: "+j.T+"ms")),V=j;var Ve=b;if(V.na=Hu(V,V.L?V.ba:null,V.W),Ve.L){Vl(V.h,Ve);var ht=Ve,dn=V.O;dn&&(ht.H=dn),ht.D&&(pi(ht),hi(ht)),V.g=Ve}else Ou(V);j.i.length>0&&_i(j)}else It[0]!="stop"&&It[0]!="close"||xi(j,7);else j.I==3&&(It[0]=="stop"||It[0]=="close"?It[0]=="stop"?xi(j,7):Ql(j):It[0]!="noop"&&j.l&&j.l.qa(It),j.A=0)}}xt(4)}catch{}}var vn=class{constructor(b,C){this.g=b,this.map=C}};function Pl(b){this.l=b||10,i.PerformanceNavigationTiming?(b=i.performance.getEntriesByType("navigation"),b=b.length>0&&(b[0].nextHopProtocol=="hq"||b[0].nextHopProtocol=="h2")):b=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=b?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function zl(b){return b.h?!0:b.g?b.g.size>=b.j:!1}function gi(b){return b.h?1:b.g?b.g.size:0}function vi(b,C){return b.h?b.h==C:b.g?b.g.has(C):!1}function Ol(b,C){b.g?b.g.add(C):b.h=C}function Vl(b,C){b.h&&b.h==C?b.h=null:b.g&&b.g.has(C)&&b.g.delete(C)}Pl.prototype.cancel=function(){if(this.i=Bl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const b of this.g.values())b.cancel();this.g.clear()}};function Bl(b){if(b.h!=null)return b.i.concat(b.h.G);if(b.g!=null&&b.g.size!==0){let C=b.i;for(const j of b.g.values())C=C.concat(j.G);return C}return x(b.i)}var Iu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function co(b,C){if(b){b=b.split("&");for(let j=0;j<b.length;j++){const V=b[j].indexOf("=");let ie,he=null;V>=0?(ie=b[j].substring(0,V),he=b[j].substring(V+1)):ie=b[j],C(ie,he?decodeURIComponent(he.replace(/\+/g," ")):"")}}}function fr(b){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let C;b instanceof fr?(this.l=b.l,kn(this,b.j),this.o=b.o,this.g=b.g,vs(this,b.u),this.h=b.h,Ul(this,Pu(b.i)),this.m=b.m):b&&(C=String(b).match(Iu))?(this.l=!1,kn(this,C[1]||"",!0),this.o=yi(C[2]||""),this.g=yi(C[3]||"",!0),vs(this,C[4]),this.h=yi(C[5]||"",!0),Ul(this,C[6]||"",!0),this.m=yi(C[7]||"")):(this.l=!1,this.i=new bs(null,this.l))}fr.prototype.toString=function(){const b=[];var C=this.j;C&&b.push(wa(C,uo,!0),":");var j=this.g;return(j||C=="file")&&(b.push("//"),(C=this.o)&&b.push(wa(C,uo,!0),"@"),b.push(Vi(j).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),j=this.u,j!=null&&b.push(":",String(j))),(j=this.h)&&(this.g&&j.charAt(0)!="/"&&b.push("/"),b.push(wa(j,j.charAt(0)=="/"?ql:Du,!0))),(j=this.i.toString())&&b.push("?",j),(j=this.m)&&b.push("#",wa(j,Nu)),b.join("")},fr.prototype.resolve=function(b){const C=yn(this);let j=!!b.j;j?kn(C,b.j):j=!!b.o,j?C.o=b.o:j=!!b.g,j?C.g=b.g:j=b.u!=null;var V=b.h;if(j)vs(C,b.u);else if(j=!!b.h){if(V.charAt(0)!="/")if(this.g&&!this.h)V="/"+V;else{var ie=C.h.lastIndexOf("/");ie!=-1&&(V=C.h.slice(0,ie+1)+V)}if(ie=V,ie==".."||ie==".")V="";else if(ie.indexOf("./")!=-1||ie.indexOf("/.")!=-1){V=ie.lastIndexOf("/",0)==0,ie=ie.split("/");const he=[];for(let Ve=0;Ve<ie.length;){const ht=ie[Ve++];ht=="."?V&&Ve==ie.length&&he.push(""):ht==".."?((he.length>1||he.length==1&&he[0]!="")&&he.pop(),V&&Ve==ie.length&&he.push("")):(he.push(ht),V=!0)}V=he.join("/")}else V=ie}return j?C.h=V:j=b.i.toString()!=="",j?Ul(C,Pu(b.i)):j=!!b.m,j&&(C.m=b.m),C};function yn(b){return new fr(b)}function kn(b,C,j){b.j=j?yi(C,!0):C,b.j&&(b.j=b.j.replace(/:$/,""))}function vs(b,C){if(C){if(C=Number(C),isNaN(C)||C<0)throw Error("Bad port number "+C);b.u=C}else b.u=null}function Ul(b,C,j){C instanceof bs?(b.i=C,ho(b.i,b.l)):(j||(C=wa(C,ys)),b.i=new bs(C,b.l))}function Lt(b,C,j){b.i.set(C,j)}function Sa(b){return Lt(b,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),b}function yi(b,C){return b?C?decodeURI(b.replace(/%25/g,"%2525")):decodeURIComponent(b):""}function wa(b,C,j){return typeof b=="string"?(b=encodeURI(b).replace(C,tr),j&&(b=b.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b):null}function tr(b){return b=b.charCodeAt(0),"%"+(b>>4&15).toString(16)+(b&15).toString(16)}var uo=/[#\/\?@]/g,Du=/[#\?:]/g,ql=/[#\?]/g,ys=/[#\?@]/g,Nu=/#/g;function bs(b,C){this.h=this.g=null,this.i=b||null,this.j=!!C}function nr(b){b.g||(b.g=new Map,b.h=0,b.i&&co(b.i,function(C,j){b.add(decodeURIComponent(C.replace(/\+/g," ")),j)}))}e=bs.prototype,e.add=function(b,C){nr(this),this.i=null,b=Ss(this,b);let j=this.g.get(b);return j||this.g.set(b,j=[]),j.push(C),this.h+=1,this};function Lu(b,C){nr(b),C=Ss(b,C),b.g.has(C)&&(b.i=null,b.h-=b.g.get(C).length,b.g.delete(C))}function Hl(b,C){return nr(b),C=Ss(b,C),b.g.has(C)}e.forEach=function(b,C){nr(this),this.g.forEach(function(j,V){j.forEach(function(ie){b.call(C,ie,V,this)},this)},this)};function Fl(b,C){nr(b);let j=[];if(typeof C=="string")Hl(b,C)&&(j=j.concat(b.g.get(Ss(b,C))));else for(b=Array.from(b.g.values()),C=0;C<b.length;C++)j=j.concat(b[C]);return j}e.set=function(b,C){return nr(this),this.i=null,b=Ss(this,b),Hl(this,b)&&(this.h-=this.g.get(b).length),this.g.set(b,[C]),this.h+=1,this},e.get=function(b,C){return b?(b=Fl(this,b),b.length>0?String(b[0]):C):C};function fo(b,C,j){Lu(b,C),j.length>0&&(b.i=null,b.g.set(Ss(b,C),x(j)),b.h+=j.length)}e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const b=[],C=Array.from(this.g.keys());for(let V=0;V<C.length;V++){var j=C[V];const ie=Vi(j);j=Fl(this,j);for(let he=0;he<j.length;he++){let Ve=ie;j[he]!==""&&(Ve+="="+Vi(j[he])),b.push(Ve)}}return this.i=b.join("&")};function Pu(b){const C=new bs;return C.i=b.i,b.g&&(C.g=new Map(b.g),C.h=b.h),C}function Ss(b,C){return C=String(C),b.j&&(C=C.toLowerCase()),C}function ho(b,C){C&&!b.j&&(nr(b),b.i=null,b.g.forEach(function(j,V){const ie=V.toLowerCase();V!=ie&&(Lu(this,V),fo(this,ie,j))},b)),b.j=C}function Gr(b,C){const j=new Jt;if(i.Image){const V=new Image;V.onload=u(jr,j,"TestLoadImage: loaded",!0,C,V),V.onerror=u(jr,j,"TestLoadImage: error",!1,C,V),V.onabort=u(jr,j,"TestLoadImage: abort",!1,C,V),V.ontimeout=u(jr,j,"TestLoadImage: timeout",!1,C,V),i.setTimeout(function(){V.ontimeout&&V.ontimeout()},1e4),V.src=b}else C(!1)}function $l(b,C){const j=new Jt,V=new AbortController,ie=setTimeout(()=>{V.abort(),jr(j,"TestPingServer: timeout",!1,C)},1e4);fetch(b,{signal:V.signal}).then(he=>{clearTimeout(ie),he.ok?jr(j,"TestPingServer: ok",!0,C):jr(j,"TestPingServer: server error",!1,C)}).catch(()=>{clearTimeout(ie),jr(j,"TestPingServer: error",!1,C)})}function jr(b,C,j,V,ie){try{ie&&(ie.onload=null,ie.onerror=null,ie.onabort=null,ie.ontimeout=null),V(j)}catch{}}function ws(){this.g=new Vt}function bi(b){this.i=b.Sb||null,this.h=b.ab||!1}h(bi,nn),bi.prototype.g=function(){return new _a(this.i,this.h)};function _a(b,C){me.call(this),this.H=b,this.o=C,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(_a,me),e=_a.prototype,e.open=function(b,C){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=b,this.D=C,this.readyState=1,Qr(this)},e.send=function(b){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const C={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};b&&(C.body=b),(this.H||i).fetch(new Request(this.D,C)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,_s(this)),this.readyState=0},e.Pa=function(b){if(this.g&&(this.l=b,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=b.headers,this.readyState=2,Qr(this)),this.g&&(this.readyState=3,Qr(this),this.g)))if(this.responseType==="arraybuffer")b.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof i.ReadableStream<"u"&&"body"in b){if(this.j=b.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;po(this)}else b.text().then(this.Oa.bind(this),this.ga.bind(this))};function po(b){b.j.read().then(b.Ma.bind(b)).catch(b.ga.bind(b))}e.Ma=function(b){if(this.g){if(this.o&&b.value)this.response.push(b.value);else if(!this.o){var C=b.value?b.value:new Uint8Array(0);(C=this.B.decode(C,{stream:!b.done}))&&(this.response=this.responseText+=C)}b.done?_s(this):Qr(this),this.readyState==3&&po(this)}},e.Oa=function(b){this.g&&(this.response=this.responseText=b,_s(this))},e.Na=function(b){this.g&&(this.response=b,_s(this))},e.ga=function(){this.g&&_s(this)};function _s(b){b.readyState=4,b.l=null,b.j=null,b.B=null,Qr(b)}e.setRequestHeader=function(b,C){this.A.append(b,C)},e.getResponseHeader=function(b){return this.h&&this.h.get(b.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const b=[],C=this.h.entries();for(var j=C.next();!j.done;)j=j.value,b.push(j[0]+": "+j[1]),j=C.next();return b.join(`\r
`)};function Qr(b){b.onreadystatechange&&b.onreadystatechange.call(b)}Object.defineProperty(_a.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(b){this.m=b?"include":"same-origin"}});function Mr(b){let C="";return Se(b,function(j,V){C+=V,C+=":",C+=j,C+=`\r
`}),C}function xa(b,C,j){e:{for(V in j){var V=!1;break e}V=!0}V||(j=Mr(j),typeof b=="string"?j!=null&&Vi(j):Lt(b,C,j))}function Bt(b){me.call(this),this.headers=new Map,this.L=b||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(Bt,me);var Si=/^https?$/i,Wl=["POST","PUT"];e=Bt.prototype,e.Fa=function(b){this.H=b},e.ea=function(b,C,j,V){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+b);C=C?C.toUpperCase():"GET",this.D=b,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ll.g(),this.g.onreadystatechange=y(v(this.Ca,this));try{this.B=!0,this.g.open(C,String(b),!0),this.B=!1}catch(he){Ta(this,he);return}if(b=j||"",j=new Map(this.headers),V)if(Object.getPrototypeOf(V)===Object.prototype)for(var ie in V)j.set(ie,V[ie]);else if(typeof V.keys=="function"&&typeof V.get=="function")for(const he of V.keys())j.set(he,V.get(he));else throw Error("Unknown input type for opt_headers: "+String(V));V=Array.from(j.keys()).find(he=>he.toLowerCase()=="content-type"),ie=i.FormData&&b instanceof i.FormData,!(Array.prototype.indexOf.call(Wl,C,void 0)>=0)||V||ie||j.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[he,Ve]of j)this.g.setRequestHeader(he,Ve);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(b),this.v=!1}catch(he){Ta(this,he)}};function Ta(b,C){b.h=!1,b.g&&(b.j=!0,b.g.abort(),b.j=!1),b.l=C,b.o=5,Gl(b),Bi(b)}function Gl(b){b.A||(b.A=!0,we(b,"complete"),we(b,"error"))}e.abort=function(b){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=b||7,we(this,"complete"),we(this,"abort"),Bi(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Bi(this,!0)),Bt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Ea(this):this.Xa())},e.Xa=function(){Ea(this)};function Ea(b){if(b.h&&typeof l<"u"){if(b.v&&Xr(b)==4)setTimeout(b.Ca.bind(b),0);else if(we(b,"readystatechange"),Xr(b)==4){b.h=!1;try{const he=b.ca();e:switch(he){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var C=!0;break e;default:C=!1}var j;if(!(j=C)){var V;if(V=he===0){let Ve=String(b.D).match(Iu)[1]||null;!Ve&&i.self&&i.self.location&&(Ve=i.self.location.protocol.slice(0,-1)),V=!Si.test(Ve?Ve.toLowerCase():"")}j=V}if(j)we(b,"complete"),we(b,"success");else{b.o=6;try{var ie=Xr(b)>2?b.g.statusText:""}catch{ie=""}b.l=ie+" ["+b.ca()+"]",Gl(b)}}finally{Bi(b)}}}}function Bi(b,C){if(b.g){b.m&&(clearTimeout(b.m),b.m=null);const j=b.g;b.g=null,C||we(b,"ready");try{j.onreadystatechange=null}catch{}}}e.isActive=function(){return!!this.g};function Xr(b){return b.g?b.g.readyState:0}e.ca=function(){try{return Xr(this)>2?this.g.status:-1}catch{return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},e.La=function(b){if(this.g){var C=this.g.responseText;return b&&C.indexOf(b)==0&&(C=C.substring(b.length)),nt(C)}};function zn(b){try{if(!b.g)return null;if("response"in b.g)return b.g.response;switch(b.F){case"":case"text":return b.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in b.g)return b.g.mozResponseArrayBuffer}return null}catch{return null}}function Ui(b){const C={};b=(b.g&&Xr(b)>=2&&b.g.getAllResponseHeaders()||"").split(`\r
`);for(let V=0;V<b.length;V++){if(D(b[V]))continue;var j=Mu(b[V]);const ie=j[0];if(j=j[1],typeof j!="string")continue;j=j.trim();const he=C[ie]||[];C[ie]=he,he.push(j)}Re(C,function(V){return V.join(", ")})}e.ya=function(){return this.o},e.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function wi(b,C,j){return j&&j.internalChannelParams&&j.internalChannelParams[b]||C}function xs(b){this.za=0,this.i=[],this.j=new Jt,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=wi("failFast",!1,b),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=wi("baseRetryDelayMs",5e3,b),this.Za=wi("retryDelaySeedMs",1e4,b),this.Ta=wi("forwardChannelMaxRetries",2,b),this.va=wi("forwardChannelRequestTimeoutMs",2e4,b),this.ma=b&&b.xmlHttpFactory||void 0,this.Ua=b&&b.Rb||void 0,this.Aa=b&&b.useFetchStreams||!1,this.O=void 0,this.L=b&&b.supportsCrossDomainXhr||!1,this.M="",this.h=new Pl(b&&b.concurrentRequestLimit),this.Ba=new ws,this.S=b&&b.fastHandshake||!1,this.R=b&&b.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=b&&b.Pb||!1,b&&b.ua&&this.j.ua(),b&&b.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&b&&b.detectBufferingProxy||!1,this.ia=void 0,b&&b.longPollingTimeout&&b.longPollingTimeout>0&&(this.ia=b.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}e=xs.prototype,e.ka=8,e.I=1,e.connect=function(b,C,j,V){rn(0),this.W=b,this.H=C||{},j&&V!==void 0&&(this.H.OSID=j,this.H.OAID=V),this.F=this.X,this.J=Hu(this,null,this.W),_i(this)};function Ql(b){if(mo(b),b.I==3){var C=b.V++,j=yn(b.J);if(Lt(j,"SID",b.M),Lt(j,"RID",C),Lt(j,"TYPE","terminate"),Ca(b,j),C=new $r(b,b.j,C),C.M=2,C.A=Sa(yn(j)),j=!1,i.navigator&&i.navigator.sendBeacon)try{j=i.navigator.sendBeacon(C.A.toString(),"")}catch{}!j&&i.Image&&(new Image().src=C.A,j=!0),j||(C.g=Fu(C.j,null),C.g.ea(C.A)),C.F=Date.now(),hi(C)}qu(b)}function Ts(b){b.g&&(Yl(b),b.g.cancel(),b.g=null)}function mo(b){Ts(b),b.v&&(i.clearTimeout(b.v),b.v=null),vo(b),b.h.cancel(),b.m&&(typeof b.m=="number"&&i.clearTimeout(b.m),b.m=null)}function _i(b){if(!zl(b.h)&&!b.m){b.m=!0;var C=b.Ea;Q||I(),K||(Q(),K=!0),k.add(C,b),b.D=0}}function go(b,C){return gi(b.h)>=b.h.j-(b.m?1:0)?!1:b.m?(b.i=C.G.concat(b.i),!0):b.I==1||b.I==2||b.D>=(b.Sa?0:b.Ta)?!1:(b.m=Nt(v(b.Ea,b,C),Uu(b,b.D)),b.D++,!0)}e.Ea=function(b){if(this.m)if(this.m=null,this.I==1){if(!b){this.V=Math.floor(Math.random()*1e5),b=this.V++;const ie=new $r(this,this.j,b);let he=this.o;if(this.U&&(he?(he=H(he),te(he,this.U)):he=this.U),this.u!==null||this.R||(ie.J=he,he=null),this.S)e:{for(var C=0,j=0;j<this.i.length;j++){t:{var V=this.i[j];if("__data__"in V.map&&(V=V.map.__data__,typeof V=="string")){V=V.length;break t}V=void 0}if(V===void 0)break;if(C+=V,C>4096){C=j;break e}if(C===4096||j===this.i.length-1){C=j+1;break e}}C=1e3}else C=1e3;C=zu(this,ie,C),j=yn(this.J),Lt(j,"RID",b),Lt(j,"CVER",22),this.G&&Lt(j,"X-HTTP-Session-Id",this.G),Ca(this,j),he&&(this.R?C="headers="+Vi(Mr(he))+"&"+C:this.u&&xa(j,this.u,he)),Ol(this.h,ie),this.Ra&&Lt(j,"TYPE","init"),this.S?(Lt(j,"$req",C),Lt(j,"SID","null"),ie.U=!0,fi(ie,j,null)):fi(ie,j,C),this.I=2}}else this.I==3&&(b?Xl(this,b):this.i.length==0||zl(this.h)||Xl(this))};function Xl(b,C){var j;C?j=C.l:j=b.V++;const V=yn(b.J);Lt(V,"SID",b.M),Lt(V,"RID",j),Lt(V,"AID",b.K),Ca(b,V),b.u&&b.o&&xa(V,b.u,b.o),j=new $r(b,b.j,j,b.D+1),b.u===null&&(j.J=b.o),C&&(b.i=C.G.concat(b.i)),C=zu(b,j,1e3),j.H=Math.round(b.va*.5)+Math.round(b.va*.5*Math.random()),Ol(b.h,j),fi(j,V,C)}function Ca(b,C){b.H&&Se(b.H,function(j,V){Lt(C,V,j)}),b.l&&Se({},function(j,V){Lt(C,V,j)})}function zu(b,C,j){j=Math.min(b.i.length,j);const V=b.l?v(b.l.Ka,b.l,b):null;e:{var ie=b.i;let ht=-1;for(;;){const dn=["count="+j];ht==-1?j>0?(ht=ie[0].g,dn.push("ofs="+ht)):ht=0:dn.push("ofs="+ht);let It=!0;for(let Zt=0;Zt<j;Zt++){var he=ie[Zt].g;const Rr=ie[Zt].map;if(he-=ht,he<0)ht=Math.max(0,ie[Zt].g-100),It=!1;else try{he="req"+he+"_"||"";try{var Ve=Rr instanceof Map?Rr:Object.entries(Rr);for(const[Ti,Yr]of Ve){let Kr=Yr;p(Yr)&&(Kr=dt(Yr)),dn.push(he+Ti+"="+encodeURIComponent(Kr))}}catch(Ti){throw dn.push(he+"type="+encodeURIComponent("_badmap")),Ti}}catch{V&&V(Rr)}}if(It){Ve=dn.join("&");break e}}Ve=void 0}return b=b.i.splice(0,j),C.G=b,Ve}function Ou(b){if(!b.g&&!b.v){b.Y=1;var C=b.Da;Q||I(),K||(Q(),K=!0),k.add(C,b),b.A=0}}function Aa(b){return b.g||b.v||b.A>=3?!1:(b.Y++,b.v=Nt(v(b.Da,b),Uu(b,b.A)),b.A++,!0)}e.Da=function(){if(this.v=null,Vu(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var b=4*this.T;this.j.info("BP detection timer enabled: "+b),this.B=Nt(v(this.Wa,this),b)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,rn(10),Ts(this),Vu(this))};function Yl(b){b.B!=null&&(i.clearTimeout(b.B),b.B=null)}function Vu(b){b.g=new $r(b,b.j,"rpc",b.Y),b.u===null&&(b.g.J=b.o),b.g.P=0;var C=yn(b.na);Lt(C,"RID","rpc"),Lt(C,"SID",b.M),Lt(C,"AID",b.K),Lt(C,"CI",b.F?"0":"1"),!b.F&&b.ia&&Lt(C,"TO",b.ia),Lt(C,"TYPE","xmlhttp"),Ca(b,C),b.u&&b.o&&xa(C,b.u,b.o),b.O&&(b.g.H=b.O);var j=b.g;b=b.ba,j.M=1,j.A=Sa(yn(C)),j.u=null,j.R=!0,oo(j,b)}e.Va=function(){this.C!=null&&(this.C=null,Ts(this),Aa(this),rn(19))};function vo(b){b.C!=null&&(i.clearTimeout(b.C),b.C=null)}function Bu(b,C){var j=null;if(b.g==C){vo(b),Yl(b),b.g=null;var V=2}else if(vi(b.h,C))j=C.G,Vl(b.h,C),V=1;else return;if(b.I!=0){if(C.o)if(V==1){j=C.u?C.u.length:0,C=Date.now()-C.F;var ie=b.D;V=Ze(),we(V,new He(V,j)),_i(b)}else Ou(b);else if(ie=C.m,ie==3||ie==0&&C.X>0||!(V==1&&go(b,C)||V==2&&Aa(b)))switch(j&&j.length>0&&(C=b.h,C.i=C.i.concat(j)),ie){case 1:xi(b,5);break;case 4:xi(b,10);break;case 3:xi(b,6);break;default:xi(b,2)}}}function Uu(b,C){let j=b.Qa+Math.floor(Math.random()*b.Za);return b.isActive()||(j*=2),j*C}function xi(b,C){if(b.j.info("Error code "+C),C==2){var j=v(b.bb,b),V=b.Ua;const ie=!V;V=new fr(V||"//www.google.com/images/cleardot.gif"),i.location&&i.location.protocol=="http"||kn(V,"https"),Sa(V),ie?Gr(V.toString(),j):$l(V.toString(),j)}else rn(2);b.I=0,b.l&&b.l.pa(C),qu(b),mo(b)}e.bb=function(b){b?(this.j.info("Successfully pinged google.com"),rn(2)):(this.j.info("Failed to ping google.com"),rn(1))};function qu(b){if(b.I=0,b.ja=[],b.l){const C=Bl(b.h);(C.length!=0||b.i.length!=0)&&(T(b.ja,C),T(b.ja,b.i),b.h.i.length=0,x(b.i),b.i.length=0),b.l.oa()}}function Hu(b,C,j){var V=j instanceof fr?yn(j):new fr(j);if(V.g!="")C&&(V.g=C+"."+V.g),vs(V,V.u);else{var ie=i.location;V=ie.protocol,C=C?C+"."+ie.hostname:ie.hostname,ie=+ie.port;const he=new fr(null);V&&kn(he,V),C&&(he.g=C),ie&&vs(he,ie),j&&(he.h=j),V=he}return j=b.G,C=b.wa,j&&C&&Lt(V,j,C),Lt(V,"VER",b.ka),Ca(b,V),V}function Fu(b,C,j){if(C&&!b.L)throw Error("Can't create secondary domain capable XhrIo object.");return C=b.Aa&&!b.ma?new Bt(new bi({ab:j})):new Bt(b.ma),C.Fa(b.L),C}e.isActive=function(){return!!this.l&&this.l.isActive(this)};function $u(){}e=$u.prototype,e.ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){};function Es(){}Es.prototype.g=function(b,C){return new Kn(b,C)};function Kn(b,C){me.call(this),this.g=new xs(C),this.l=b,this.h=C&&C.messageUrlParams||null,b=C&&C.messageHeaders||null,C&&C.clientProtocolHeaderRequired&&(b?b["X-Client-Protocol"]="webchannel":b={"X-Client-Protocol":"webchannel"}),this.g.o=b,b=C&&C.initMessageHeaders||null,C&&C.messageContentType&&(b?b["X-WebChannel-Content-Type"]=C.messageContentType:b={"X-WebChannel-Content-Type":C.messageContentType}),C&&C.sa&&(b?b["X-WebChannel-Client-Profile"]=C.sa:b={"X-WebChannel-Client-Profile":C.sa}),this.g.U=b,(b=C&&C.Qb)&&!D(b)&&(this.g.u=b),this.A=C&&C.supportsCrossDomainXhr||!1,this.v=C&&C.sendRawJson||!1,(C=C&&C.httpSessionIdParam)&&!D(C)&&(this.g.G=C,b=this.h,b!==null&&C in b&&(b=this.h,C in b&&delete b[C])),this.j=new qi(this)}h(Kn,me),Kn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Kn.prototype.close=function(){Ql(this.g)},Kn.prototype.o=function(b){var C=this.g;if(typeof b=="string"){var j={};j.__data__=b,b=j}else this.v&&(j={},j.__data__=dt(b),b=j);C.i.push(new vn(C.Ya++,b)),C.I==3&&_i(C)},Kn.prototype.N=function(){this.g.l=null,delete this.j,Ql(this.g),delete this.g,Kn.Z.N.call(this)};function Wu(b){Ne.call(this),b.__headers__&&(this.headers=b.__headers__,this.statusCode=b.__status__,delete b.__headers__,delete b.__status__);var C=b.__sm__;if(C){e:{for(const j in C){b=j;break e}b=void 0}(this.i=b)&&(b=this.i,C=C!==null&&b in C?C[b]:void 0),this.data=C}else this.data=b}h(Wu,Ne);function Gu(){ke.call(this),this.status=1}h(Gu,ke);function qi(b){this.g=b}h(qi,$u),qi.prototype.ra=function(){we(this.g,"a")},qi.prototype.qa=function(b){we(this.g,new Wu(b))},qi.prototype.pa=function(b){we(this.g,new Gu)},qi.prototype.oa=function(){we(this.g,"b")},Es.prototype.createWebChannel=Es.prototype.g,Kn.prototype.send=Kn.prototype.o,Kn.prototype.open=Kn.prototype.m,Kn.prototype.close=Kn.prototype.close,E4=function(){return new Es},T4=function(){return Ze()},x4=$e,em={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ya.NO_ERROR=0,ya.TIMEOUT=8,ya.HTTP_ERROR=6,hf=ya,Nl.COMPLETE="complete",_4=Nl,Wn.EventType=Ft,Ft.OPEN="a",Ft.CLOSE="b",Ft.ERROR="c",Ft.MESSAGE="d",me.prototype.listen=me.prototype.J,Vc=Wn,Bt.prototype.listenOnce=Bt.prototype.K,Bt.prototype.getLastError=Bt.prototype.Ha,Bt.prototype.getLastErrorCode=Bt.prototype.ya,Bt.prototype.getStatus=Bt.prototype.ca,Bt.prototype.getResponseJson=Bt.prototype.La,Bt.prototype.getResponseText=Bt.prototype.la,Bt.prototype.send=Bt.prototype.ea,Bt.prototype.setWithCredentials=Bt.prototype.Fa,w4=Bt}).apply(typeof Zd<"u"?Zd:typeof self<"u"?self:typeof window<"u"?window:{});class Xn{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Xn.UNAUTHENTICATED=new Xn(null),Xn.GOOGLE_CREDENTIALS=new Xn("google-credentials-uid"),Xn.FIRST_PARTY=new Xn("first-party-uid"),Xn.MOCK_USER=new Xn("mock-user");let Cl="12.9.0";function xE(e){Cl=e}const Za=new jm("@firebase/firestore");function Xo(){return Za.logLevel}function We(e,...t){if(Za.logLevel<=St.DEBUG){const n=t.map(Um);Za.debug(`Firestore (${Cl}): ${e}`,...n)}}function ps(e,...t){if(Za.logLevel<=St.ERROR){const n=t.map(Um);Za.error(`Firestore (${Cl}): ${e}`,...n)}}function eo(e,...t){if(Za.logLevel<=St.WARN){const n=t.map(Um);Za.warn(`Firestore (${Cl}): ${e}`,...n)}}function Um(e){if(typeof e=="string")return e;try{return(function(n){return JSON.stringify(n)})(e)}catch{return e}}function rt(e,t,n){let s="Unexpected state";typeof t=="string"?s=t:n=t,C4(e,s,n)}function C4(e,t,n){let s=`FIRESTORE (${Cl}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(n!==void 0)try{s+=" CONTEXT: "+JSON.stringify(n)}catch{s+=" CONTEXT: "+n}throw ps(s),new Error(s)}function jt(e,t,n,s){let a="Unexpected state";typeof n=="string"?a=n:s=n,e||C4(t,a,s)}function ut(e,t){return e}const _e={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Be extends gs{constructor(t,n){super(t,n),this.code=t,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ki{constructor(){this.promise=new Promise(((t,n)=>{this.resolve=t,this.reject=n}))}}class A4{constructor(t,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class TE{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,n){t.enqueueRetryable((()=>n(Xn.UNAUTHENTICATED)))}shutdown(){}}class EE{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,n){this.changeListener=n,t.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class CE{constructor(t){this.t=t,this.currentUser=Xn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){jt(this.o===void 0,42304);let s=this.i;const a=g=>this.i!==s?(s=this.i,n(g)):Promise.resolve();let l=new ki;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new ki,t.enqueueRetryable((()=>a(this.currentUser)))};const i=()=>{const g=l;t.enqueueRetryable((async()=>{await g.promise,await a(this.currentUser)}))},p=g=>{We("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=g,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit((g=>p(g))),setTimeout((()=>{if(!this.auth){const g=this.t.getImmediate({optional:!0});g?p(g):(We("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new ki)}}),0),i()}getToken(){const t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((s=>this.i!==t?(We("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(jt(typeof s.accessToken=="string",31837,{l:s}),new A4(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return jt(t===null||typeof t=="string",2055,{h:t}),new Xn(t)}}class AE{constructor(t,n,s){this.P=t,this.T=n,this.I=s,this.type="FirstParty",this.user=Xn.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const t=this.A();return t&&this.R.set("Authorization",t),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class jE{constructor(t,n,s){this.P=t,this.T=n,this.I=s}getToken(){return Promise.resolve(new AE(this.P,this.T,this.I))}start(t,n){t.enqueueRetryable((()=>n(Xn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Gy{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ME{constructor(t,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ni(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,n){jt(this.o===void 0,3512);const s=l=>{l.error!=null&&We("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const i=l.token!==this.m;return this.m=l.token,We("FirebaseAppCheckTokenProvider",`Received ${i?"new":"existing"} token.`),i?n(l.token):Promise.resolve()};this.o=l=>{t.enqueueRetryable((()=>s(l)))};const a=l=>{We("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((l=>a(l))),setTimeout((()=>{if(!this.appCheck){const l=this.V.getImmediate({optional:!0});l?a(l):We("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Gy(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((n=>n?(jt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Gy(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function RE(e){const t=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(n);else for(let s=0;s<e;s++)n[s]=Math.floor(256*Math.random());return n}class qm{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const a=RE(40);for(let l=0;l<a.length;++l)s.length<20&&a[l]<n&&(s+=t.charAt(a[l]%62))}return s}}function wt(e,t){return e<t?-1:e>t?1:0}function tm(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const a=e.charAt(s),l=t.charAt(s);if(a!==l)return Lp(a)===Lp(l)?wt(a,l):Lp(a)?1:-1}return wt(e.length,t.length)}const kE=55296,IE=57343;function Lp(e){const t=e.charCodeAt(0);return t>=kE&&t<=IE}function cl(e,t,n){return e.length===t.length&&e.every(((s,a)=>n(s,t[a])))}const Qy="__name__";class Mi{constructor(t,n,s){n===void 0?n=0:n>t.length&&rt(637,{offset:n,range:t.length}),s===void 0?s=t.length-n:s>t.length-n&&rt(1746,{length:s,range:t.length-n}),this.segments=t,this.offset=n,this.len=s}get length(){return this.len}isEqual(t){return Mi.comparator(this,t)===0}child(t){const n=this.segments.slice(this.offset,this.limit());return t instanceof Mi?t.forEach((s=>{n.push(s)})):n.push(t),this.construct(n)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0}forEach(t){for(let n=this.offset,s=this.limit();n<s;n++)t(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){const s=Math.min(t.length,n.length);for(let a=0;a<s;a++){const l=Mi.compareSegments(t.get(a),n.get(a));if(l!==0)return l}return wt(t.length,n.length)}static compareSegments(t,n){const s=Mi.isNumericId(t),a=Mi.isNumericId(n);return s&&!a?-1:!s&&a?1:s&&a?Mi.extractNumericId(t).compare(Mi.extractNumericId(n)):tm(t,n)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return sa.fromString(t.substring(4,t.length-2))}}class Ot extends Mi{construct(t,n,s){return new Ot(t,n,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const n=[];for(const s of t){if(s.indexOf("//")>=0)throw new Be(_e.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);n.push(...s.split("/").filter((a=>a.length>0)))}return new Ot(n)}static emptyPath(){return new Ot([])}}const DE=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Hn extends Mi{construct(t,n,s){return new Hn(t,n,s)}static isValidIdentifier(t){return DE.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Hn.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Qy}static keyField(){return new Hn([Qy])}static fromServerFormat(t){const n=[];let s="",a=0;const l=()=>{if(s.length===0)throw new Be(_e.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(s),s=""};let i=!1;for(;a<t.length;){const p=t[a];if(p==="\\"){if(a+1===t.length)throw new Be(_e.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const g=t[a+1];if(g!=="\\"&&g!=="."&&g!=="`")throw new Be(_e.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);s+=g,a+=2}else p==="`"?(i=!i,a++):p!=="."||i?(s+=p,a++):(l(),a++)}if(l(),i)throw new Be(_e.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Hn(n)}static emptyPath(){return new Hn([])}}class et{constructor(t){this.path=t}static fromPath(t){return new et(Ot.fromString(t))}static fromName(t){return new et(Ot.fromString(t).popFirst(5))}static empty(){return new et(Ot.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Ot.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,n){return Ot.comparator(t.path,n.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new et(new Ot(t.slice()))}}function Hm(e,t,n){if(!n)throw new Be(_e.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function NE(e,t,n,s){if(t===!0&&s===!0)throw new Be(_e.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Xy(e){if(!et.isDocumentKey(e))throw new Be(_e.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Yy(e){if(et.isDocumentKey(e))throw new Be(_e.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function j4(e){return typeof e=="object"&&e!==null&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null)}function ih(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";{const t=(function(s){return s.constructor?s.constructor.name:null})(e);return t?`a custom ${t} object`:"an object"}}return typeof e=="function"?"a function":rt(12329,{type:typeof e})}function Fn(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Be(_e.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ih(e);throw new Be(_e.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Cn(e,t){const n={typeString:e};return t&&(n.value=t),n}function mu(e,t){if(!j4(e))throw new Be(_e.INVALID_ARGUMENT,"JSON must be an object");let n;for(const s in t)if(t[s]){const a=t[s].typeString,l="value"in t[s]?{value:t[s].value}:void 0;if(!(s in e)){n=`JSON missing required field: '${s}'`;break}const i=e[s];if(a&&typeof i!==a){n=`JSON field '${s}' must be a ${a}.`;break}if(l!==void 0&&i!==l.value){n=`Expected '${s}' field to equal '${l.value}'`;break}}if(n)throw new Be(_e.INVALID_ARGUMENT,n);return!0}const Ky=-62135596800,Jy=1e6;class Yt{static now(){return Yt.fromMillis(Date.now())}static fromDate(t){return Yt.fromMillis(t.getTime())}static fromMillis(t){const n=Math.floor(t/1e3),s=Math.floor((t-1e3*n)*Jy);return new Yt(n,s)}constructor(t,n){if(this.seconds=t,this.nanoseconds=n,n<0)throw new Be(_e.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Be(_e.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<Ky)throw new Be(_e.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Be(_e.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Jy}_compareTo(t){return this.seconds===t.seconds?wt(this.nanoseconds,t.nanoseconds):wt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Yt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(mu(t,Yt._jsonSchema))return new Yt(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-Ky;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Yt._jsonSchemaVersion="firestore/timestamp/1.0",Yt._jsonSchema={type:Cn("string",Yt._jsonSchemaVersion),seconds:Cn("number"),nanoseconds:Cn("number")};class ot{static fromTimestamp(t){return new ot(t)}static min(){return new ot(new Yt(0,0))}static max(){return new ot(new Yt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Zc=-1;function LE(e,t){const n=e.toTimestamp().seconds,s=e.toTimestamp().nanoseconds+1,a=ot.fromTimestamp(s===1e9?new Yt(n+1,0):new Yt(n,s));return new ca(a,et.empty(),t)}function PE(e){return new ca(e.readTime,e.key,Zc)}class ca{constructor(t,n,s){this.readTime=t,this.documentKey=n,this.largestBatchId=s}static min(){return new ca(ot.min(),et.empty(),Zc)}static max(){return new ca(ot.max(),et.empty(),Zc)}}function zE(e,t){let n=e.readTime.compareTo(t.readTime);return n!==0?n:(n=et.comparator(e.documentKey,t.documentKey),n!==0?n:wt(e.largestBatchId,t.largestBatchId))}const OE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class VE{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Al(e){if(e.code!==_e.FAILED_PRECONDITION||e.message!==OE)throw e;We("LocalStore","Unexpectedly lost primary lease")}class Me{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(t){return this.next(void 0,t)}next(t,n){return this.callbackAttached&&rt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new Me(((s,a)=>{this.nextCallback=l=>{this.wrapSuccess(t,l).next(s,a)},this.catchCallback=l=>{this.wrapFailure(n,l).next(s,a)}}))}toPromise(){return new Promise(((t,n)=>{this.next(t,n)}))}wrapUserFunction(t){try{const n=t();return n instanceof Me?n:Me.resolve(n)}catch(n){return Me.reject(n)}}wrapSuccess(t,n){return t?this.wrapUserFunction((()=>t(n))):Me.resolve(n)}wrapFailure(t,n){return t?this.wrapUserFunction((()=>t(n))):Me.reject(n)}static resolve(t){return new Me(((n,s)=>{n(t)}))}static reject(t){return new Me(((n,s)=>{s(t)}))}static waitFor(t){return new Me(((n,s)=>{let a=0,l=0,i=!1;t.forEach((p=>{++a,p.next((()=>{++l,i&&l===a&&n()}),(g=>s(g)))})),i=!0,l===a&&n()}))}static or(t){let n=Me.resolve(!1);for(const s of t)n=n.next((a=>a?Me.resolve(a):s()));return n}static forEach(t,n){const s=[];return t.forEach(((a,l)=>{s.push(n.call(this,a,l))})),this.waitFor(s)}static mapArray(t,n){return new Me(((s,a)=>{const l=t.length,i=new Array(l);let p=0;for(let g=0;g<l;g++){const v=g;n(t[v]).next((u=>{i[v]=u,++p,p===l&&s(i)}),(u=>a(u)))}}))}static doWhile(t,n){return new Me(((s,a)=>{const l=()=>{t()===!0?n().next((()=>{l()}),a):s()};l()}))}}function BE(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function jl(e){return e.name==="IndexedDbTransactionError"}class sh{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>n.writeSequenceNumber(s))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}sh.ce=-1;const Fm=-1;function gu(e){return e==null}function Mf(e){return e===0&&1/e==-1/0}function UE(e){return typeof e=="number"&&Number.isInteger(e)&&!Mf(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const M4="";function qE(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Zy(t)),t=HE(e.get(n),t);return Zy(t)}function HE(e,t){let n=t;const s=e.length;for(let a=0;a<s;a++){const l=e.charAt(a);switch(l){case"\0":n+="";break;case M4:n+="";break;default:n+=l}}return n}function Zy(e){return e+M4+""}function e3(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ma(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function R4(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class an{constructor(t,n){this.comparator=t,this.root=n||qn.EMPTY}insert(t,n){return new an(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,qn.BLACK,null,null))}remove(t){return new an(this.comparator,this.root.remove(t,this.comparator).copy(null,null,qn.BLACK,null,null))}get(t){let n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(s===0)return n.value;s<0?n=n.left:s>0&&(n=n.right)}return null}indexOf(t){let n=0,s=this.root;for(;!s.isEmpty();){const a=this.comparator(t,s.key);if(a===0)return n+s.left.size;a<0?s=s.left:(n+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((n,s)=>(t(n,s),!1)))}toString(){const t=[];return this.inorderTraversal(((n,s)=>(t.push(`${n}:${s}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new ef(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new ef(this.root,t,this.comparator,!1)}getReverseIterator(){return new ef(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new ef(this.root,t,this.comparator,!0)}}class ef{constructor(t,n,s,a){this.isReverse=a,this.nodeStack=[];let l=1;for(;!t.isEmpty();)if(l=n?s(t.key,n):1,n&&a&&(l*=-1),l<0)t=this.isReverse?t.left:t.right;else{if(l===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const n={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class qn{constructor(t,n,s,a,l){this.key=t,this.value=n,this.color=s??qn.RED,this.left=a??qn.EMPTY,this.right=l??qn.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,n,s,a,l){return new qn(t??this.key,n??this.value,s??this.color,a??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,n,s){let a=this;const l=s(t,a.key);return a=l<0?a.copy(null,null,null,a.left.insert(t,n,s),null):l===0?a.copy(null,n,null,null,null):a.copy(null,null,null,null,a.right.insert(t,n,s)),a.fixUp()}removeMin(){if(this.left.isEmpty())return qn.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,n){let s,a=this;if(n(t,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(t,n),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),n(t,a.key)===0){if(a.right.isEmpty())return qn.EMPTY;s=a.right.min(),a=a.copy(s.key,s.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(t,n))}return a.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,qn.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,qn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw rt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw rt(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw rt(27949);return t+(this.isRed()?0:1)}}qn.EMPTY=null,qn.RED=!0,qn.BLACK=!1;qn.EMPTY=new class{constructor(){this.size=0}get key(){throw rt(57766)}get value(){throw rt(16141)}get color(){throw rt(16727)}get left(){throw rt(29726)}get right(){throw rt(36894)}copy(t,n,s,a,l){return this}insert(t,n,s){return new qn(t,n)}remove(t,n){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Mn{constructor(t){this.comparator=t,this.data=new an(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((n,s)=>(t(n),!1)))}forEachInRange(t,n){const s=this.data.getIteratorFrom(t[0]);for(;s.hasNext();){const a=s.getNext();if(this.comparator(a.key,t[1])>=0)return;n(a.key)}}forEachWhile(t,n){let s;for(s=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();s.hasNext();)if(!t(s.getNext().key))return}firstAfterOrEqual(t){const n=this.data.getIteratorFrom(t);return n.hasNext()?n.getNext().key:null}getIterator(){return new t3(this.data.getIterator())}getIteratorFrom(t){return new t3(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let n=this;return n.size<t.size&&(n=t,t=this),t.forEach((s=>{n=n.add(s)})),n}isEqual(t){if(!(t instanceof Mn)||this.size!==t.size)return!1;const n=this.data.getIterator(),s=t.data.getIterator();for(;n.hasNext();){const a=n.getNext().key,l=s.getNext().key;if(this.comparator(a,l)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((n=>{t.push(n)})),t}toString(){const t=[];return this.forEach((n=>t.push(n))),"SortedSet("+t.toString()+")"}copy(t){const n=new Mn(this.comparator);return n.data=t,n}}class t3{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class wr{constructor(t){this.fields=t,t.sort(Hn.comparator)}static empty(){return new wr([])}unionWith(t){let n=new Mn(Hn.comparator);for(const s of this.fields)n=n.add(s);for(const s of t)n=n.add(s);return new wr(n.toArray())}covers(t){for(const n of this.fields)if(n.isPrefixOf(t))return!0;return!1}isEqual(t){return cl(this.fields,t.fields,((n,s)=>n.isEqual(s)))}}class k4 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class $n{constructor(t){this.binaryString=t}static fromBase64String(t){const n=(function(a){try{return atob(a)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new k4("Invalid base64 string: "+l):l}})(t);return new $n(n)}static fromUint8Array(t){const n=(function(a){let l="";for(let i=0;i<a.length;++i)l+=String.fromCharCode(a[i]);return l})(t);return new $n(n)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const s=new Uint8Array(n.length);for(let a=0;a<n.length;a++)s[a]=n.charCodeAt(a);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return wt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}$n.EMPTY_BYTE_STRING=new $n("");const FE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ua(e){if(jt(!!e,39018),typeof e=="string"){let t=0;const n=FE.exec(e);if(jt(!!n,46558,{timestamp:e}),n[1]){let a=n[1];a=(a+"000000000").substr(0,9),t=Number(a)}const s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:pn(e.seconds),nanos:pn(e.nanos)}}function pn(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function da(e){return typeof e=="string"?$n.fromBase64String(e):$n.fromUint8Array(e)}const I4="server_timestamp",D4="__type__",N4="__previous_value__",L4="__local_write_time__";function $m(e){return(e?.mapValue?.fields||{})[D4]?.stringValue===I4}function ah(e){const t=e.mapValue.fields[N4];return $m(t)?ah(t):t}function eu(e){const t=ua(e.mapValue.fields[L4].timestampValue);return new Yt(t.seconds,t.nanos)}class $E{constructor(t,n,s,a,l,i,p,g,v,u,h){this.databaseId=t,this.appId=n,this.persistenceKey=s,this.host=a,this.ssl=l,this.forceLongPolling=i,this.autoDetectLongPolling=p,this.longPollingOptions=g,this.useFetchStreams=v,this.isUsingEmulator=u,this.apiKey=h}}const Rf="(default)";class tu{constructor(t,n){this.projectId=t,this.database=n||Rf}static empty(){return new tu("","")}get isDefaultDatabase(){return this.database===Rf}isEqual(t){return t instanceof tu&&t.projectId===this.projectId&&t.database===this.database}}function WE(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Be(_e.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new tu(e.options.projectId,t)}const P4="__type__",GE="__max__",tf={mapValue:{}},z4="__vector__",kf="value";function fa(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?$m(e)?4:XE(e)?9007199254740991:QE(e)?10:11:rt(28295,{value:e})}function Pi(e,t){if(e===t)return!0;const n=fa(e);if(n!==fa(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return eu(e).isEqual(eu(t));case 3:return(function(a,l){if(typeof a.timestampValue=="string"&&typeof l.timestampValue=="string"&&a.timestampValue.length===l.timestampValue.length)return a.timestampValue===l.timestampValue;const i=ua(a.timestampValue),p=ua(l.timestampValue);return i.seconds===p.seconds&&i.nanos===p.nanos})(e,t);case 5:return e.stringValue===t.stringValue;case 6:return(function(a,l){return da(a.bytesValue).isEqual(da(l.bytesValue))})(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return(function(a,l){return pn(a.geoPointValue.latitude)===pn(l.geoPointValue.latitude)&&pn(a.geoPointValue.longitude)===pn(l.geoPointValue.longitude)})(e,t);case 2:return(function(a,l){if("integerValue"in a&&"integerValue"in l)return pn(a.integerValue)===pn(l.integerValue);if("doubleValue"in a&&"doubleValue"in l){const i=pn(a.doubleValue),p=pn(l.doubleValue);return i===p?Mf(i)===Mf(p):isNaN(i)&&isNaN(p)}return!1})(e,t);case 9:return cl(e.arrayValue.values||[],t.arrayValue.values||[],Pi);case 10:case 11:return(function(a,l){const i=a.mapValue.fields||{},p=l.mapValue.fields||{};if(e3(i)!==e3(p))return!1;for(const g in i)if(i.hasOwnProperty(g)&&(p[g]===void 0||!Pi(i[g],p[g])))return!1;return!0})(e,t);default:return rt(52216,{left:e})}}function nu(e,t){return(e.values||[]).find((n=>Pi(n,t)))!==void 0}function ul(e,t){if(e===t)return 0;const n=fa(e),s=fa(t);if(n!==s)return wt(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return wt(e.booleanValue,t.booleanValue);case 2:return(function(l,i){const p=pn(l.integerValue||l.doubleValue),g=pn(i.integerValue||i.doubleValue);return p<g?-1:p>g?1:p===g?0:isNaN(p)?isNaN(g)?0:-1:1})(e,t);case 3:return n3(e.timestampValue,t.timestampValue);case 4:return n3(eu(e),eu(t));case 5:return tm(e.stringValue,t.stringValue);case 6:return(function(l,i){const p=da(l),g=da(i);return p.compareTo(g)})(e.bytesValue,t.bytesValue);case 7:return(function(l,i){const p=l.split("/"),g=i.split("/");for(let v=0;v<p.length&&v<g.length;v++){const u=wt(p[v],g[v]);if(u!==0)return u}return wt(p.length,g.length)})(e.referenceValue,t.referenceValue);case 8:return(function(l,i){const p=wt(pn(l.latitude),pn(i.latitude));return p!==0?p:wt(pn(l.longitude),pn(i.longitude))})(e.geoPointValue,t.geoPointValue);case 9:return r3(e.arrayValue,t.arrayValue);case 10:return(function(l,i){const p=l.fields||{},g=i.fields||{},v=p[kf]?.arrayValue,u=g[kf]?.arrayValue,h=wt(v?.values?.length||0,u?.values?.length||0);return h!==0?h:r3(v,u)})(e.mapValue,t.mapValue);case 11:return(function(l,i){if(l===tf.mapValue&&i===tf.mapValue)return 0;if(l===tf.mapValue)return 1;if(i===tf.mapValue)return-1;const p=l.fields||{},g=Object.keys(p),v=i.fields||{},u=Object.keys(v);g.sort(),u.sort();for(let h=0;h<g.length&&h<u.length;++h){const y=tm(g[h],u[h]);if(y!==0)return y;const x=ul(p[g[h]],v[u[h]]);if(x!==0)return x}return wt(g.length,u.length)})(e.mapValue,t.mapValue);default:throw rt(23264,{he:n})}}function n3(e,t){if(typeof e=="string"&&typeof t=="string"&&e.length===t.length)return wt(e,t);const n=ua(e),s=ua(t),a=wt(n.seconds,s.seconds);return a!==0?a:wt(n.nanos,s.nanos)}function r3(e,t){const n=e.values||[],s=t.values||[];for(let a=0;a<n.length&&a<s.length;++a){const l=ul(n[a],s[a]);if(l)return l}return wt(n.length,s.length)}function dl(e){return nm(e)}function nm(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(function(n){const s=ua(n);return`time(${s.seconds},${s.nanos})`})(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?(function(n){return da(n).toBase64()})(e.bytesValue):"referenceValue"in e?(function(n){return et.fromName(n).toString()})(e.referenceValue):"geoPointValue"in e?(function(n){return`geo(${n.latitude},${n.longitude})`})(e.geoPointValue):"arrayValue"in e?(function(n){let s="[",a=!0;for(const l of n.values||[])a?a=!1:s+=",",s+=nm(l);return s+"]"})(e.arrayValue):"mapValue"in e?(function(n){const s=Object.keys(n.fields||{}).sort();let a="{",l=!0;for(const i of s)l?l=!1:a+=",",a+=`${i}:${nm(n.fields[i])}`;return a+"}"})(e.mapValue):rt(61005,{value:e})}function pf(e){switch(fa(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=ah(e);return t?16+pf(t):16;case 5:return 2*e.stringValue.length;case 6:return da(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((a,l)=>a+pf(l)),0)})(e.arrayValue);case 10:case 11:return(function(s){let a=0;return ma(s.fields,((l,i)=>{a+=l.length+pf(i)})),a})(e.mapValue);default:throw rt(13486,{value:e})}}function i3(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function rm(e){return!!e&&"integerValue"in e}function Wm(e){return!!e&&"arrayValue"in e}function s3(e){return!!e&&"nullValue"in e}function a3(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function mf(e){return!!e&&"mapValue"in e}function QE(e){return(e?.mapValue?.fields||{})[P4]?.stringValue===z4}function Fc(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&typeof e.timestampValue=="object")return{timestampValue:{...e.timestampValue}};if(e.mapValue){const t={mapValue:{fields:{}}};return ma(e.mapValue.fields,((n,s)=>t.mapValue.fields[n]=Fc(s))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Fc(e.arrayValue.values[n]);return t}return{...e}}function XE(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===GE}class Zn{constructor(t){this.value=t}static empty(){return new Zn({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let n=this.value;for(let s=0;s<t.length-1;++s)if(n=(n.mapValue.fields||{})[t.get(s)],!mf(n))return null;return n=(n.mapValue.fields||{})[t.lastSegment()],n||null}}set(t,n){this.getFieldsMap(t.popLast())[t.lastSegment()]=Fc(n)}setAll(t){let n=Hn.emptyPath(),s={},a=[];t.forEach(((i,p)=>{if(!n.isImmediateParentOf(p)){const g=this.getFieldsMap(n);this.applyChanges(g,s,a),s={},a=[],n=p.popLast()}i?s[p.lastSegment()]=Fc(i):a.push(p.lastSegment())}));const l=this.getFieldsMap(n);this.applyChanges(l,s,a)}delete(t){const n=this.field(t.popLast());mf(n)&&n.mapValue.fields&&delete n.mapValue.fields[t.lastSegment()]}isEqual(t){return Pi(this.value,t.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let s=0;s<t.length;++s){let a=n.mapValue.fields[t.get(s)];mf(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},n.mapValue.fields[t.get(s)]=a),n=a}return n.mapValue.fields}applyChanges(t,n,s){ma(n,((a,l)=>t[a]=l));for(const a of s)delete t[a]}clone(){return new Zn(Fc(this.value))}}function O4(e){const t=[];return ma(e.fields,((n,s)=>{const a=new Hn([n]);if(mf(s)){const l=O4(s.mapValue).fields;if(l.length===0)t.push(a);else for(const i of l)t.push(a.child(i))}else t.push(a)})),new wr(t)}class Nn{constructor(t,n,s,a,l,i,p){this.key=t,this.documentType=n,this.version=s,this.readTime=a,this.createTime=l,this.data=i,this.documentState=p}static newInvalidDocument(t){return new Nn(t,0,ot.min(),ot.min(),ot.min(),Zn.empty(),0)}static newFoundDocument(t,n,s,a){return new Nn(t,1,n,ot.min(),s,a,0)}static newNoDocument(t,n){return new Nn(t,2,n,ot.min(),ot.min(),Zn.empty(),0)}static newUnknownDocument(t,n){return new Nn(t,3,n,ot.min(),ot.min(),Zn.empty(),2)}convertToFoundDocument(t,n){return!this.createTime.isEqual(ot.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Zn.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Zn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ot.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Nn&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Nn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class If{constructor(t,n){this.position=t,this.inclusive=n}}function o3(e,t,n){let s=0;for(let a=0;a<e.position.length;a++){const l=t[a],i=e.position[a];if(l.field.isKeyField()?s=et.comparator(et.fromName(i.referenceValue),n.key):s=ul(i,n.data.field(l.field)),l.dir==="desc"&&(s*=-1),s!==0)break}return s}function l3(e,t){if(e===null)return t===null;if(t===null||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Pi(e.position[n],t.position[n]))return!1;return!0}class ru{constructor(t,n="asc"){this.field=t,this.dir=n}}function YE(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class V4{}class Tn extends V4{constructor(t,n,s){super(),this.field=t,this.op=n,this.value=s}static create(t,n,s){return t.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(t,n,s):new JE(t,n,s):n==="array-contains"?new tC(t,s):n==="in"?new nC(t,s):n==="not-in"?new rC(t,s):n==="array-contains-any"?new iC(t,s):new Tn(t,n,s)}static createKeyFieldInFilter(t,n,s){return n==="in"?new ZE(t,s):new eC(t,s)}matches(t){const n=t.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(ul(n,this.value)):n!==null&&fa(this.value)===fa(n)&&this.matchesComparison(ul(n,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return rt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ai extends V4{constructor(t,n){super(),this.filters=t,this.op=n,this.Pe=null}static create(t,n){return new ai(t,n)}matches(t){return B4(this)?this.filters.find((n=>!n.matches(t)))===void 0:this.filters.find((n=>n.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,n)=>t.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function B4(e){return e.op==="and"}function U4(e){return KE(e)&&B4(e)}function KE(e){for(const t of e.filters)if(t instanceof ai)return!1;return!0}function im(e){if(e instanceof Tn)return e.field.canonicalString()+e.op.toString()+dl(e.value);if(U4(e))return e.filters.map((t=>im(t))).join(",");{const t=e.filters.map((n=>im(n))).join(",");return`${e.op}(${t})`}}function q4(e,t){return e instanceof Tn?(function(s,a){return a instanceof Tn&&s.op===a.op&&s.field.isEqual(a.field)&&Pi(s.value,a.value)})(e,t):e instanceof ai?(function(s,a){return a instanceof ai&&s.op===a.op&&s.filters.length===a.filters.length?s.filters.reduce(((l,i,p)=>l&&q4(i,a.filters[p])),!0):!1})(e,t):void rt(19439)}function H4(e){return e instanceof Tn?(function(n){return`${n.field.canonicalString()} ${n.op} ${dl(n.value)}`})(e):e instanceof ai?(function(n){return n.op.toString()+" {"+n.getFilters().map(H4).join(" ,")+"}"})(e):"Filter"}class JE extends Tn{constructor(t,n,s){super(t,n,s),this.key=et.fromName(s.referenceValue)}matches(t){const n=et.comparator(t.key,this.key);return this.matchesComparison(n)}}class ZE extends Tn{constructor(t,n){super(t,"in",n),this.keys=F4("in",n)}matches(t){return this.keys.some((n=>n.isEqual(t.key)))}}class eC extends Tn{constructor(t,n){super(t,"not-in",n),this.keys=F4("not-in",n)}matches(t){return!this.keys.some((n=>n.isEqual(t.key)))}}function F4(e,t){return(t.arrayValue?.values||[]).map((n=>et.fromName(n.referenceValue)))}class tC extends Tn{constructor(t,n){super(t,"array-contains",n)}matches(t){const n=t.data.field(this.field);return Wm(n)&&nu(n.arrayValue,this.value)}}class nC extends Tn{constructor(t,n){super(t,"in",n)}matches(t){const n=t.data.field(this.field);return n!==null&&nu(this.value.arrayValue,n)}}class rC extends Tn{constructor(t,n){super(t,"not-in",n)}matches(t){if(nu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=t.data.field(this.field);return n!==null&&n.nullValue===void 0&&!nu(this.value.arrayValue,n)}}class iC extends Tn{constructor(t,n){super(t,"array-contains-any",n)}matches(t){const n=t.data.field(this.field);return!(!Wm(n)||!n.arrayValue.values)&&n.arrayValue.values.some((s=>nu(this.value.arrayValue,s)))}}class sC{constructor(t,n=null,s=[],a=[],l=null,i=null,p=null){this.path=t,this.collectionGroup=n,this.orderBy=s,this.filters=a,this.limit=l,this.startAt=i,this.endAt=p,this.Te=null}}function c3(e,t=null,n=[],s=[],a=null,l=null,i=null){return new sC(e,t,n,s,a,l,i)}function Gm(e){const t=ut(e);if(t.Te===null){let n=t.path.canonicalString();t.collectionGroup!==null&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((s=>im(s))).join(","),n+="|ob:",n+=t.orderBy.map((s=>(function(l){return l.field.canonicalString()+l.dir})(s))).join(","),gu(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((s=>dl(s))).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((s=>dl(s))).join(",")),t.Te=n}return t.Te}function Qm(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!YE(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!q4(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!l3(e.startAt,t.startAt)&&l3(e.endAt,t.endAt)}function sm(e){return et.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}class io{constructor(t,n=null,s=[],a=[],l=null,i="F",p=null,g=null){this.path=t,this.collectionGroup=n,this.explicitOrderBy=s,this.filters=a,this.limit=l,this.limitType=i,this.startAt=p,this.endAt=g,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function aC(e,t,n,s,a,l,i,p){return new io(e,t,n,s,a,l,i,p)}function oh(e){return new io(e)}function u3(e){return e.filters.length===0&&e.limit===null&&e.startAt==null&&e.endAt==null&&(e.explicitOrderBy.length===0||e.explicitOrderBy.length===1&&e.explicitOrderBy[0].field.isKeyField())}function oC(e){return et.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}function $4(e){return e.collectionGroup!==null}function $c(e){const t=ut(e);if(t.Ie===null){t.Ie=[];const n=new Set;for(const l of t.explicitOrderBy)t.Ie.push(l),n.add(l.field.canonicalString());const s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(i){let p=new Mn(Hn.comparator);return i.filters.forEach((g=>{g.getFlattenedFilters().forEach((v=>{v.isInequality()&&(p=p.add(v.field))}))})),p})(t).forEach((l=>{n.has(l.canonicalString())||l.isKeyField()||t.Ie.push(new ru(l,s))})),n.has(Hn.keyField().canonicalString())||t.Ie.push(new ru(Hn.keyField(),s))}return t.Ie}function Ii(e){const t=ut(e);return t.Ee||(t.Ee=lC(t,$c(e))),t.Ee}function lC(e,t){if(e.limitType==="F")return c3(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((a=>{const l=a.dir==="desc"?"asc":"desc";return new ru(a.field,l)}));const n=e.endAt?new If(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new If(e.startAt.position,e.startAt.inclusive):null;return c3(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}}function am(e,t){const n=e.filters.concat([t]);return new io(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function cC(e,t){const n=e.explicitOrderBy.concat([t]);return new io(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function Df(e,t,n){return new io(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function lh(e,t){return Qm(Ii(e),Ii(t))&&e.limitType===t.limitType}function W4(e){return`${Gm(Ii(e))}|lt:${e.limitType}`}function Yo(e){return`Query(target=${(function(n){let s=n.path.canonicalString();return n.collectionGroup!==null&&(s+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(s+=`, filters: [${n.filters.map((a=>H4(a))).join(", ")}]`),gu(n.limit)||(s+=", limit: "+n.limit),n.orderBy.length>0&&(s+=`, orderBy: [${n.orderBy.map((a=>(function(i){return`${i.field.canonicalString()} (${i.dir})`})(a))).join(", ")}]`),n.startAt&&(s+=", startAt: ",s+=n.startAt.inclusive?"b:":"a:",s+=n.startAt.position.map((a=>dl(a))).join(",")),n.endAt&&(s+=", endAt: ",s+=n.endAt.inclusive?"a:":"b:",s+=n.endAt.position.map((a=>dl(a))).join(",")),`Target(${s})`})(Ii(e))}; limitType=${e.limitType})`}function ch(e,t){return t.isFoundDocument()&&(function(s,a){const l=a.key.path;return s.collectionGroup!==null?a.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(l):et.isDocumentKey(s.path)?s.path.isEqual(l):s.path.isImmediateParentOf(l)})(e,t)&&(function(s,a){for(const l of $c(s))if(!l.field.isKeyField()&&a.data.field(l.field)===null)return!1;return!0})(e,t)&&(function(s,a){for(const l of s.filters)if(!l.matches(a))return!1;return!0})(e,t)&&(function(s,a){return!(s.startAt&&!(function(i,p,g){const v=o3(i,p,g);return i.inclusive?v<=0:v<0})(s.startAt,$c(s),a)||s.endAt&&!(function(i,p,g){const v=o3(i,p,g);return i.inclusive?v>=0:v>0})(s.endAt,$c(s),a))})(e,t)}function uC(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function G4(e){return(t,n)=>{let s=!1;for(const a of $c(e)){const l=dC(a,t,n);if(l!==0)return l;s=s||a.field.isKeyField()}return 0}}function dC(e,t,n){const s=e.field.isKeyField()?et.comparator(t.key,n.key):(function(l,i,p){const g=i.data.field(l),v=p.data.field(l);return g!==null&&v!==null?ul(g,v):rt(42886)})(e.field,t,n);switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return rt(19790,{direction:e.dir})}}class so{constructor(t,n){this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}get(t){const n=this.mapKeyFn(t),s=this.inner[n];if(s!==void 0){for(const[a,l]of s)if(this.equalsFn(a,t))return l}}has(t){return this.get(t)!==void 0}set(t,n){const s=this.mapKeyFn(t),a=this.inner[s];if(a===void 0)return this.inner[s]=[[t,n]],void this.innerSize++;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return void(a[l]=[t,n]);a.push([t,n]),this.innerSize++}delete(t){const n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return!1;for(let a=0;a<s.length;a++)if(this.equalsFn(s[a][0],t))return s.length===1?delete this.inner[n]:s.splice(a,1),this.innerSize--,!0;return!1}forEach(t){ma(this.inner,((n,s)=>{for(const[a,l]of s)t(a,l)}))}isEmpty(){return R4(this.inner)}size(){return this.innerSize}}const fC=new an(et.comparator);function ms(){return fC}const Q4=new an(et.comparator);function Bc(...e){let t=Q4;for(const n of e)t=t.insert(n.key,n);return t}function X4(e){let t=Q4;return e.forEach(((n,s)=>t=t.insert(n,s.overlayedDocument))),t}function Wa(){return Wc()}function Y4(){return Wc()}function Wc(){return new so((e=>e.toString()),((e,t)=>e.isEqual(t)))}const hC=new an(et.comparator),pC=new Mn(et.comparator);function _t(...e){let t=pC;for(const n of e)t=t.add(n);return t}const mC=new Mn(wt);function gC(){return mC}function Xm(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Mf(t)?"-0":t}}function K4(e){return{integerValue:""+e}}function vC(e,t){return UE(t)?K4(t):Xm(e,t)}class uh{constructor(){this._=void 0}}function yC(e,t,n){return e instanceof iu?(function(a,l){const i={fields:{[D4]:{stringValue:I4},[L4]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return l&&$m(l)&&(l=ah(l)),l&&(i.fields[N4]=l),{mapValue:i}})(n,t):e instanceof fl?Z4(e,t):e instanceof su?eb(e,t):(function(a,l){const i=J4(a,l),p=d3(i)+d3(a.Ae);return rm(i)&&rm(a.Ae)?K4(p):Xm(a.serializer,p)})(e,t)}function bC(e,t,n){return e instanceof fl?Z4(e,t):e instanceof su?eb(e,t):n}function J4(e,t){return e instanceof Nf?(function(s){return rm(s)||(function(l){return!!l&&"doubleValue"in l})(s)})(t)?t:{integerValue:0}:null}class iu extends uh{}class fl extends uh{constructor(t){super(),this.elements=t}}function Z4(e,t){const n=tb(t);for(const s of e.elements)n.some((a=>Pi(a,s)))||n.push(s);return{arrayValue:{values:n}}}class su extends uh{constructor(t){super(),this.elements=t}}function eb(e,t){let n=tb(t);for(const s of e.elements)n=n.filter((a=>!Pi(a,s)));return{arrayValue:{values:n}}}class Nf extends uh{constructor(t,n){super(),this.serializer=t,this.Ae=n}}function d3(e){return pn(e.integerValue||e.doubleValue)}function tb(e){return Wm(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class nb{constructor(t,n){this.field=t,this.transform=n}}function SC(e,t){return e.field.isEqual(t.field)&&(function(s,a){return s instanceof fl&&a instanceof fl||s instanceof su&&a instanceof su?cl(s.elements,a.elements,Pi):s instanceof Nf&&a instanceof Nf?Pi(s.Ae,a.Ae):s instanceof iu&&a instanceof iu})(e.transform,t.transform)}class wC{constructor(t,n){this.version=t,this.transformResults=n}}class En{constructor(t,n){this.updateTime=t,this.exists=n}static none(){return new En}static exists(t){return new En(void 0,t)}static updateTime(t){return new En(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function gf(e,t){return e.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(e.updateTime):e.exists===void 0||e.exists===t.isFoundDocument()}class dh{}function rb(e,t){if(!e.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return e.isNoDocument()?new yu(e.key,En.none()):new vu(e.key,e.data,En.none());{const n=e.data,s=Zn.empty();let a=new Mn(Hn.comparator);for(let l of t.fields)if(!a.has(l)){let i=n.field(l);i===null&&l.length>1&&(l=l.popLast(),i=n.field(l)),i===null?s.delete(l):s.set(l,i),a=a.add(l)}return new ga(e.key,s,new wr(a.toArray()),En.none())}}function _C(e,t,n){e instanceof vu?(function(a,l,i){const p=a.value.clone(),g=h3(a.fieldTransforms,l,i.transformResults);p.setAll(g),l.convertToFoundDocument(i.version,p).setHasCommittedMutations()})(e,t,n):e instanceof ga?(function(a,l,i){if(!gf(a.precondition,l))return void l.convertToUnknownDocument(i.version);const p=h3(a.fieldTransforms,l,i.transformResults),g=l.data;g.setAll(ib(a)),g.setAll(p),l.convertToFoundDocument(i.version,g).setHasCommittedMutations()})(e,t,n):(function(a,l,i){l.convertToNoDocument(i.version).setHasCommittedMutations()})(0,t,n)}function Gc(e,t,n,s){return e instanceof vu?(function(l,i,p,g){if(!gf(l.precondition,i))return p;const v=l.value.clone(),u=p3(l.fieldTransforms,g,i);return v.setAll(u),i.convertToFoundDocument(i.version,v).setHasLocalMutations(),null})(e,t,n,s):e instanceof ga?(function(l,i,p,g){if(!gf(l.precondition,i))return p;const v=p3(l.fieldTransforms,g,i),u=i.data;return u.setAll(ib(l)),u.setAll(v),i.convertToFoundDocument(i.version,u).setHasLocalMutations(),p===null?null:p.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map((h=>h.field)))})(e,t,n,s):(function(l,i,p){return gf(l.precondition,i)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):p})(e,t,n)}function xC(e,t){let n=null;for(const s of e.fieldTransforms){const a=t.data.field(s.field),l=J4(s.transform,a||null);l!=null&&(n===null&&(n=Zn.empty()),n.set(s.field,l))}return n||null}function f3(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!(function(s,a){return s===void 0&&a===void 0||!(!s||!a)&&cl(s,a,((l,i)=>SC(l,i)))})(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class vu extends dh{constructor(t,n,s,a=[]){super(),this.key=t,this.value=n,this.precondition=s,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class ga extends dh{constructor(t,n,s,a,l=[]){super(),this.key=t,this.data=n,this.fieldMask=s,this.precondition=a,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function ib(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=e.data.field(n);t.set(n,s)}})),t}function h3(e,t,n){const s=new Map;jt(e.length===n.length,32656,{Ve:n.length,de:e.length});for(let a=0;a<n.length;a++){const l=e[a],i=l.transform,p=t.data.field(l.field);s.set(l.field,bC(i,p,n[a]))}return s}function p3(e,t,n){const s=new Map;for(const a of e){const l=a.transform,i=n.data.field(a.field);s.set(a.field,yC(l,i,t))}return s}class yu extends dh{constructor(t,n){super(),this.key=t,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sb extends dh{constructor(t,n){super(),this.key=t,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class TC{constructor(t,n,s,a){this.batchId=t,this.localWriteTime=n,this.baseMutations=s,this.mutations=a}applyToRemoteDocument(t,n){const s=n.mutationResults;for(let a=0;a<this.mutations.length;a++){const l=this.mutations[a];l.key.isEqual(t.key)&&_C(l,t,s[a])}}applyToLocalView(t,n){for(const s of this.baseMutations)s.key.isEqual(t.key)&&(n=Gc(s,t,n,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(t.key)&&(n=Gc(s,t,n,this.localWriteTime));return n}applyToLocalDocumentSet(t,n){const s=Y4();return this.mutations.forEach((a=>{const l=t.get(a.key),i=l.overlayedDocument;let p=this.applyToLocalView(i,l.mutatedFields);p=n.has(a.key)?null:p;const g=rb(i,p);g!==null&&s.set(a.key,g),i.isValidDocument()||i.convertToNoDocument(ot.min())})),s}keys(){return this.mutations.reduce(((t,n)=>t.add(n.key)),_t())}isEqual(t){return this.batchId===t.batchId&&cl(this.mutations,t.mutations,((n,s)=>f3(n,s)))&&cl(this.baseMutations,t.baseMutations,((n,s)=>f3(n,s)))}}class Ym{constructor(t,n,s,a){this.batch=t,this.commitVersion=n,this.mutationResults=s,this.docVersions=a}static from(t,n,s){jt(t.mutations.length===s.length,58842,{me:t.mutations.length,fe:s.length});let a=(function(){return hC})();const l=t.mutations;for(let i=0;i<l.length;i++)a=a.insert(l[i].key,s[i].version);return new Ym(t,n,s,a)}}class EC{constructor(t,n){this.largestBatchId=t,this.mutation=n}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class CC{constructor(t,n){this.count=t,this.unchangedNames=n}}var xn,Ct;function ab(e){switch(e){case _e.OK:return rt(64938);case _e.CANCELLED:case _e.UNKNOWN:case _e.DEADLINE_EXCEEDED:case _e.RESOURCE_EXHAUSTED:case _e.INTERNAL:case _e.UNAVAILABLE:case _e.UNAUTHENTICATED:return!1;case _e.INVALID_ARGUMENT:case _e.NOT_FOUND:case _e.ALREADY_EXISTS:case _e.PERMISSION_DENIED:case _e.FAILED_PRECONDITION:case _e.ABORTED:case _e.OUT_OF_RANGE:case _e.UNIMPLEMENTED:case _e.DATA_LOSS:return!0;default:return rt(15467,{code:e})}}function ob(e){if(e===void 0)return ps("GRPC error has no .code"),_e.UNKNOWN;switch(e){case xn.OK:return _e.OK;case xn.CANCELLED:return _e.CANCELLED;case xn.UNKNOWN:return _e.UNKNOWN;case xn.DEADLINE_EXCEEDED:return _e.DEADLINE_EXCEEDED;case xn.RESOURCE_EXHAUSTED:return _e.RESOURCE_EXHAUSTED;case xn.INTERNAL:return _e.INTERNAL;case xn.UNAVAILABLE:return _e.UNAVAILABLE;case xn.UNAUTHENTICATED:return _e.UNAUTHENTICATED;case xn.INVALID_ARGUMENT:return _e.INVALID_ARGUMENT;case xn.NOT_FOUND:return _e.NOT_FOUND;case xn.ALREADY_EXISTS:return _e.ALREADY_EXISTS;case xn.PERMISSION_DENIED:return _e.PERMISSION_DENIED;case xn.FAILED_PRECONDITION:return _e.FAILED_PRECONDITION;case xn.ABORTED:return _e.ABORTED;case xn.OUT_OF_RANGE:return _e.OUT_OF_RANGE;case xn.UNIMPLEMENTED:return _e.UNIMPLEMENTED;case xn.DATA_LOSS:return _e.DATA_LOSS;default:return rt(39323,{code:e})}}(Ct=xn||(xn={}))[Ct.OK=0]="OK",Ct[Ct.CANCELLED=1]="CANCELLED",Ct[Ct.UNKNOWN=2]="UNKNOWN",Ct[Ct.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ct[Ct.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ct[Ct.NOT_FOUND=5]="NOT_FOUND",Ct[Ct.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ct[Ct.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ct[Ct.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ct[Ct.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ct[Ct.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ct[Ct.ABORTED=10]="ABORTED",Ct[Ct.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ct[Ct.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ct[Ct.INTERNAL=13]="INTERNAL",Ct[Ct.UNAVAILABLE=14]="UNAVAILABLE",Ct[Ct.DATA_LOSS=15]="DATA_LOSS";function AC(){return new TextEncoder}const jC=new sa([4294967295,4294967295],0);function m3(e){const t=AC().encode(e),n=new S4;return n.update(t),new Uint8Array(n.digest())}function g3(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),s=t.getUint32(4,!0),a=t.getUint32(8,!0),l=t.getUint32(12,!0);return[new sa([n,s],0),new sa([a,l],0)]}class Km{constructor(t,n,s){if(this.bitmap=t,this.padding=n,this.hashCount=s,n<0||n>=8)throw new Uc(`Invalid padding: ${n}`);if(s<0)throw new Uc(`Invalid hash count: ${s}`);if(t.length>0&&this.hashCount===0)throw new Uc(`Invalid hash count: ${s}`);if(t.length===0&&n!==0)throw new Uc(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*t.length-n,this.pe=sa.fromNumber(this.ge)}ye(t,n,s){let a=t.add(n.multiply(sa.fromNumber(s)));return a.compare(jC)===1&&(a=new sa([a.getBits(0),a.getBits(1)],0)),a.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const n=m3(t),[s,a]=g3(n);for(let l=0;l<this.hashCount;l++){const i=this.ye(s,a,l);if(!this.we(i))return!1}return!0}static create(t,n,s){const a=t%8==0?0:8-t%8,l=new Uint8Array(Math.ceil(t/8)),i=new Km(l,a,n);return s.forEach((p=>i.insert(p))),i}insert(t){if(this.ge===0)return;const n=m3(t),[s,a]=g3(n);for(let l=0;l<this.hashCount;l++){const i=this.ye(s,a,l);this.be(i)}}be(t){const n=Math.floor(t/8),s=t%8;this.bitmap[n]|=1<<s}}class Uc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class fh{constructor(t,n,s,a,l){this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=s,this.documentUpdates=a,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(t,n,s){const a=new Map;return a.set(t,bu.createSynthesizedTargetChangeForCurrentChange(t,n,s)),new fh(ot.min(),a,new an(wt),ms(),_t())}}class bu{constructor(t,n,s,a,l){this.resumeToken=t,this.current=n,this.addedDocuments=s,this.modifiedDocuments=a,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(t,n,s){return new bu(s,n,_t(),_t(),_t())}}class vf{constructor(t,n,s,a){this.Se=t,this.removedTargetIds=n,this.key=s,this.De=a}}class lb{constructor(t,n){this.targetId=t,this.Ce=n}}class cb{constructor(t,n,s=$n.EMPTY_BYTE_STRING,a=null){this.state=t,this.targetIds=n,this.resumeToken=s,this.cause=a}}class v3{constructor(){this.ve=0,this.Fe=y3(),this.Me=$n.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=_t(),n=_t(),s=_t();return this.Fe.forEach(((a,l)=>{switch(l){case 0:t=t.add(a);break;case 2:n=n.add(a);break;case 1:s=s.add(a);break;default:rt(38017,{changeType:l})}})),new bu(this.Me,this.xe,t,n,s)}Ke(){this.Oe=!1,this.Fe=y3()}qe(t,n){this.Oe=!0,this.Fe=this.Fe.insert(t,n)}Ue(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}$e(){this.ve+=1}We(){this.ve-=1,jt(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class MC{constructor(t){this.Ge=t,this.ze=new Map,this.je=ms(),this.He=nf(),this.Je=nf(),this.Ze=new an(wt)}Xe(t){for(const n of t.Se)t.De&&t.De.isFoundDocument()?this.Ye(n,t.De):this.et(n,t.key,t.De);for(const n of t.removedTargetIds)this.et(n,t.key,t.De)}tt(t){this.forEachTarget(t,(n=>{const s=this.nt(n);switch(t.state){case 0:this.rt(n)&&s.Le(t.resumeToken);break;case 1:s.We(),s.Ne||s.Ke(),s.Le(t.resumeToken);break;case 2:s.We(),s.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(s.Qe(),s.Le(t.resumeToken));break;case 4:this.rt(n)&&(this.it(n),s.Le(t.resumeToken));break;default:rt(56790,{state:t.state})}}))}forEachTarget(t,n){t.targetIds.length>0?t.targetIds.forEach(n):this.ze.forEach(((s,a)=>{this.rt(a)&&n(a)}))}st(t){const n=t.targetId,s=t.Ce.count,a=this.ot(n);if(a){const l=a.target;if(sm(l))if(s===0){const i=new et(l.path);this.et(n,i,Nn.newNoDocument(i,ot.min()))}else jt(s===1,20013,{expectedCount:s});else{const i=this._t(n);if(i!==s){const p=this.ut(t),g=p?this.ct(p,t,i):1;if(g!==0){this.it(n);const v=g===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(n,v)}}}}}ut(t){const n=t.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:s="",padding:a=0},hashCount:l=0}=n;let i,p;try{i=da(s).toUint8Array()}catch(g){if(g instanceof k4)return eo("Decoding the base64 bloom filter in existence filter failed ("+g.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw g}try{p=new Km(i,a,l)}catch(g){return eo(g instanceof Uc?"BloomFilter error: ":"Applying bloom filter failed: ",g),null}return p.ge===0?null:p}ct(t,n,s){return n.Ce.count===s-this.Pt(t,n.targetId)?0:2}Pt(t,n){const s=this.Ge.getRemoteKeysForTarget(n);let a=0;return s.forEach((l=>{const i=this.Ge.ht(),p=`projects/${i.projectId}/databases/${i.database}/documents/${l.path.canonicalString()}`;t.mightContain(p)||(this.et(n,l,null),a++)})),a}Tt(t){const n=new Map;this.ze.forEach(((l,i)=>{const p=this.ot(i);if(p){if(l.current&&sm(p.target)){const g=new et(p.target.path);this.It(g).has(i)||this.Et(i,g)||this.et(i,g,Nn.newNoDocument(g,t))}l.Be&&(n.set(i,l.ke()),l.Ke())}}));let s=_t();this.Je.forEach(((l,i)=>{let p=!0;i.forEachWhile((g=>{const v=this.ot(g);return!v||v.purpose==="TargetPurposeLimboResolution"||(p=!1,!1)})),p&&(s=s.add(l))})),this.je.forEach(((l,i)=>i.setReadTime(t)));const a=new fh(t,n,this.Ze,this.je,s);return this.je=ms(),this.He=nf(),this.Je=nf(),this.Ze=new an(wt),a}Ye(t,n){if(!this.rt(t))return;const s=this.Et(t,n.key)?2:0;this.nt(t).qe(n.key,s),this.je=this.je.insert(n.key,n),this.He=this.He.insert(n.key,this.It(n.key).add(t)),this.Je=this.Je.insert(n.key,this.Rt(n.key).add(t))}et(t,n,s){if(!this.rt(t))return;const a=this.nt(t);this.Et(t,n)?a.qe(n,1):a.Ue(n),this.Je=this.Je.insert(n,this.Rt(n).delete(t)),this.Je=this.Je.insert(n,this.Rt(n).add(t)),s&&(this.je=this.je.insert(n,s))}removeTarget(t){this.ze.delete(t)}_t(t){const n=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+n.addedDocuments.size-n.removedDocuments.size}$e(t){this.nt(t).$e()}nt(t){let n=this.ze.get(t);return n||(n=new v3,this.ze.set(t,n)),n}Rt(t){let n=this.Je.get(t);return n||(n=new Mn(wt),this.Je=this.Je.insert(t,n)),n}It(t){let n=this.He.get(t);return n||(n=new Mn(wt),this.He=this.He.insert(t,n)),n}rt(t){const n=this.ot(t)!==null;return n||We("WatchChangeAggregator","Detected inactive target",t),n}ot(t){const n=this.ze.get(t);return n&&n.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new v3),this.Ge.getRemoteKeysForTarget(t).forEach((n=>{this.et(t,n,null)}))}Et(t,n){return this.Ge.getRemoteKeysForTarget(t).has(n)}}function nf(){return new an(et.comparator)}function y3(){return new an(et.comparator)}const RC={asc:"ASCENDING",desc:"DESCENDING"},kC={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},IC={and:"AND",or:"OR"};class DC{constructor(t,n){this.databaseId=t,this.useProto3Json=n}}function om(e,t){return e.useProto3Json||gu(t)?t:{value:t}}function Lf(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ub(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function NC(e,t){return Lf(e,t.toTimestamp())}function _r(e){return jt(!!e,49232),ot.fromTimestamp((function(n){const s=ua(n);return new Yt(s.seconds,s.nanos)})(e))}function Jm(e,t){return lm(e,t).canonicalString()}function lm(e,t){const n=(function(a){return new Ot(["projects",a.projectId,"databases",a.database])})(e).child("documents");return t===void 0?n:n.child(t)}function db(e){const t=Ot.fromString(e);return jt(vb(t),10190,{key:t.toString()}),t}function Pf(e,t){return Jm(e.databaseId,t.path)}function Qc(e,t){const n=db(t);if(n.get(1)!==e.databaseId.projectId)throw new Be(_e.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Be(_e.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new et(hb(n))}function fb(e,t){return Jm(e.databaseId,t)}function LC(e){const t=db(e);return t.length===4?Ot.emptyPath():hb(t)}function cm(e){return new Ot(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function hb(e){return jt(e.length>4&&e.get(4)==="documents",29091,{key:e.toString()}),e.popFirst(5)}function b3(e,t,n){return{name:Pf(e,t),fields:n.value.mapValue.fields}}function PC(e,t){return"found"in t?(function(s,a){jt(!!a.found,43571),a.found.name,a.found.updateTime;const l=Qc(s,a.found.name),i=_r(a.found.updateTime),p=a.found.createTime?_r(a.found.createTime):ot.min(),g=new Zn({mapValue:{fields:a.found.fields}});return Nn.newFoundDocument(l,i,p,g)})(e,t):"missing"in t?(function(s,a){jt(!!a.missing,3894),jt(!!a.readTime,22933);const l=Qc(s,a.missing),i=_r(a.readTime);return Nn.newNoDocument(l,i)})(e,t):rt(7234,{result:t})}function zC(e,t){let n;if("targetChange"in t){t.targetChange;const s=(function(v){return v==="NO_CHANGE"?0:v==="ADD"?1:v==="REMOVE"?2:v==="CURRENT"?3:v==="RESET"?4:rt(39313,{state:v})})(t.targetChange.targetChangeType||"NO_CHANGE"),a=t.targetChange.targetIds||[],l=(function(v,u){return v.useProto3Json?(jt(u===void 0||typeof u=="string",58123),$n.fromBase64String(u||"")):(jt(u===void 0||u instanceof Buffer||u instanceof Uint8Array,16193),$n.fromUint8Array(u||new Uint8Array))})(e,t.targetChange.resumeToken),i=t.targetChange.cause,p=i&&(function(v){const u=v.code===void 0?_e.UNKNOWN:ob(v.code);return new Be(u,v.message||"")})(i);n=new cb(s,a,l,p||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const a=Qc(e,s.document.name),l=_r(s.document.updateTime),i=s.document.createTime?_r(s.document.createTime):ot.min(),p=new Zn({mapValue:{fields:s.document.fields}}),g=Nn.newFoundDocument(a,l,i,p),v=s.targetIds||[],u=s.removedTargetIds||[];n=new vf(v,u,g.key,g)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const a=Qc(e,s.document),l=s.readTime?_r(s.readTime):ot.min(),i=Nn.newNoDocument(a,l),p=s.removedTargetIds||[];n=new vf([],p,i.key,i)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const a=Qc(e,s.document),l=s.removedTargetIds||[];n=new vf([],l,a,null)}else{if(!("filter"in t))return rt(11601,{Vt:t});{t.filter;const s=t.filter;s.targetId;const{count:a=0,unchangedNames:l}=s,i=new CC(a,l),p=s.targetId;n=new lb(p,i)}}return n}function pb(e,t){let n;if(t instanceof vu)n={update:b3(e,t.key,t.value)};else if(t instanceof yu)n={delete:Pf(e,t.key)};else if(t instanceof ga)n={update:b3(e,t.key,t.data),updateMask:WC(t.fieldMask)};else{if(!(t instanceof sb))return rt(16599,{dt:t.type});n={verify:Pf(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((s=>(function(l,i){const p=i.transform;if(p instanceof iu)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(p instanceof fl)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:p.elements}};if(p instanceof su)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:p.elements}};if(p instanceof Nf)return{fieldPath:i.field.canonicalString(),increment:p.Ae};throw rt(20930,{transform:i.transform})})(0,s)))),t.precondition.isNone||(n.currentDocument=(function(a,l){return l.updateTime!==void 0?{updateTime:NC(a,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:rt(27497)})(e,t.precondition)),n}function OC(e,t){return e&&e.length>0?(jt(t!==void 0,14353),e.map((n=>(function(a,l){let i=a.updateTime?_r(a.updateTime):_r(l);return i.isEqual(ot.min())&&(i=_r(l)),new wC(i,a.transformResults||[])})(n,t)))):[]}function VC(e,t){return{documents:[fb(e,t.path)]}}function BC(e,t){const n={structuredQuery:{}},s=t.path;let a;t.collectionGroup!==null?(a=s,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(a=s.popLast(),n.structuredQuery.from=[{collectionId:s.lastSegment()}]),n.parent=fb(e,a);const l=(function(v){if(v.length!==0)return gb(ai.create(v,"and"))})(t.filters);l&&(n.structuredQuery.where=l);const i=(function(v){if(v.length!==0)return v.map((u=>(function(y){return{field:Ko(y.field),direction:HC(y.dir)}})(u)))})(t.orderBy);i&&(n.structuredQuery.orderBy=i);const p=om(e,t.limit);return p!==null&&(n.structuredQuery.limit=p),t.startAt&&(n.structuredQuery.startAt=(function(v){return{before:v.inclusive,values:v.position}})(t.startAt)),t.endAt&&(n.structuredQuery.endAt=(function(v){return{before:!v.inclusive,values:v.position}})(t.endAt)),{ft:n,parent:a}}function UC(e){let t=LC(e.parent);const n=e.structuredQuery,s=n.from?n.from.length:0;let a=null;if(s>0){jt(s===1,65062);const u=n.from[0];u.allDescendants?a=u.collectionId:t=t.child(u.collectionId)}let l=[];n.where&&(l=(function(h){const y=mb(h);return y instanceof ai&&U4(y)?y.getFilters():[y]})(n.where));let i=[];n.orderBy&&(i=(function(h){return h.map((y=>(function(T){return new ru(Jo(T.field),(function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(T.direction))})(y)))})(n.orderBy));let p=null;n.limit&&(p=(function(h){let y;return y=typeof h=="object"?h.value:h,gu(y)?null:y})(n.limit));let g=null;n.startAt&&(g=(function(h){const y=!!h.before,x=h.values||[];return new If(x,y)})(n.startAt));let v=null;return n.endAt&&(v=(function(h){const y=!h.before,x=h.values||[];return new If(x,y)})(n.endAt)),aC(t,a,i,l,p,"F",g,v)}function qC(e,t){const n=(function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return rt(28987,{purpose:a})}})(t.purpose);return n==null?null:{"goog-listen-tags":n}}function mb(e){return e.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const s=Jo(n.unaryFilter.field);return Tn.create(s,"==",{doubleValue:NaN});case"IS_NULL":const a=Jo(n.unaryFilter.field);return Tn.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const l=Jo(n.unaryFilter.field);return Tn.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Jo(n.unaryFilter.field);return Tn.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return rt(61313);default:return rt(60726)}})(e):e.fieldFilter!==void 0?(function(n){return Tn.create(Jo(n.fieldFilter.field),(function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return rt(58110);default:return rt(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(e):e.compositeFilter!==void 0?(function(n){return ai.create(n.compositeFilter.filters.map((s=>mb(s))),(function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return rt(1026)}})(n.compositeFilter.op))})(e):rt(30097,{filter:e})}function HC(e){return RC[e]}function FC(e){return kC[e]}function $C(e){return IC[e]}function Ko(e){return{fieldPath:e.canonicalString()}}function Jo(e){return Hn.fromServerFormat(e.fieldPath)}function gb(e){return e instanceof Tn?(function(n){if(n.op==="=="){if(a3(n.value))return{unaryFilter:{field:Ko(n.field),op:"IS_NAN"}};if(s3(n.value))return{unaryFilter:{field:Ko(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(a3(n.value))return{unaryFilter:{field:Ko(n.field),op:"IS_NOT_NAN"}};if(s3(n.value))return{unaryFilter:{field:Ko(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ko(n.field),op:FC(n.op),value:n.value}}})(e):e instanceof ai?(function(n){const s=n.getFilters().map((a=>gb(a)));return s.length===1?s[0]:{compositeFilter:{op:$C(n.op),filters:s}}})(e):rt(54877,{filter:e})}function WC(e){const t=[];return e.fields.forEach((n=>t.push(n.canonicalString()))),{fieldPaths:t}}function vb(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"}function yb(e){return!!e&&typeof e._toProto=="function"&&e._protoValueType==="ProtoValue"}class ea{constructor(t,n,s,a,l=ot.min(),i=ot.min(),p=$n.EMPTY_BYTE_STRING,g=null){this.target=t,this.targetId=n,this.purpose=s,this.sequenceNumber=a,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=p,this.expectedCount=g}withSequenceNumber(t){return new ea(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,n){return new ea(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new ea(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new ea(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class GC{constructor(t){this.yt=t}}function QC(e){const t=UC({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType==="LAST"?Df(t,t.limit,"L"):t}class XC{constructor(){this.Sn=new YC}addToCollectionParentIndex(t,n){return this.Sn.add(n),Me.resolve()}getCollectionParents(t,n){return Me.resolve(this.Sn.getEntries(n))}addFieldIndex(t,n){return Me.resolve()}deleteFieldIndex(t,n){return Me.resolve()}deleteAllFieldIndexes(t){return Me.resolve()}createTargetIndexes(t,n){return Me.resolve()}getDocumentsMatchingTarget(t,n){return Me.resolve(null)}getIndexType(t,n){return Me.resolve(0)}getFieldIndexes(t,n){return Me.resolve([])}getNextCollectionGroupToUpdate(t){return Me.resolve(null)}getMinOffset(t,n){return Me.resolve(ca.min())}getMinOffsetFromCollectionGroup(t,n){return Me.resolve(ca.min())}updateCollectionGroup(t,n,s){return Me.resolve()}updateIndexEntries(t,n){return Me.resolve()}}class YC{constructor(){this.index={}}add(t){const n=t.lastSegment(),s=t.popLast(),a=this.index[n]||new Mn(Ot.comparator),l=!a.has(s);return this.index[n]=a.add(s),l}has(t){const n=t.lastSegment(),s=t.popLast(),a=this.index[n];return a&&a.has(s)}getEntries(t){return(this.index[t]||new Mn(Ot.comparator)).toArray()}}const S3={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},bb=41943040;class cr{static withCacheSize(t){return new cr(t,cr.DEFAULT_COLLECTION_PERCENTILE,cr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,n,s){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=s}}cr.DEFAULT_COLLECTION_PERCENTILE=10,cr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,cr.DEFAULT=new cr(bb,cr.DEFAULT_COLLECTION_PERCENTILE,cr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),cr.DISABLED=new cr(-1,0,0);class hl{constructor(t){this.sr=t}next(){return this.sr+=2,this.sr}static _r(){return new hl(0)}static ar(){return new hl(-1)}}const w3="LruGarbageCollector",KC=1048576;function _3([e,t],[n,s]){const a=wt(e,n);return a===0?wt(t,s):a}class JC{constructor(t){this.Pr=t,this.buffer=new Mn(_3),this.Tr=0}Ir(){return++this.Tr}Er(t){const n=[t,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(n);else{const s=this.buffer.last();_3(n,s)<0&&(this.buffer=this.buffer.delete(s).add(n))}}get maxValue(){return this.buffer.last()[0]}}class ZC{constructor(t,n,s){this.garbageCollector=t,this.asyncQueue=n,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(t){We(w3,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){jl(n)?We(w3,"Ignoring IndexedDB error during garbage collection: ",n):await Al(n)}await this.Ar(3e5)}))}}class eA{constructor(t,n){this.Vr=t,this.params=n}calculateTargetCount(t,n){return this.Vr.dr(t).next((s=>Math.floor(n/100*s)))}nthSequenceNumber(t,n){if(n===0)return Me.resolve(sh.ce);const s=new JC(n);return this.Vr.forEachTarget(t,(a=>s.Er(a.sequenceNumber))).next((()=>this.Vr.mr(t,(a=>s.Er(a))))).next((()=>s.maxValue))}removeTargets(t,n,s){return this.Vr.removeTargets(t,n,s)}removeOrphanedDocuments(t,n){return this.Vr.removeOrphanedDocuments(t,n)}collect(t,n){return this.params.cacheSizeCollectionThreshold===-1?(We("LruGarbageCollector","Garbage collection skipped; disabled"),Me.resolve(S3)):this.getCacheSize(t).next((s=>s<this.params.cacheSizeCollectionThreshold?(We("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),S3):this.gr(t,n)))}getCacheSize(t){return this.Vr.getCacheSize(t)}gr(t,n){let s,a,l,i,p,g,v;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((h=>(h>this.params.maximumSequenceNumbersToCollect?(We("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),a=this.params.maximumSequenceNumbersToCollect):a=h,i=Date.now(),this.nthSequenceNumber(t,a)))).next((h=>(s=h,p=Date.now(),this.removeTargets(t,s,n)))).next((h=>(l=h,g=Date.now(),this.removeOrphanedDocuments(t,s)))).next((h=>(v=Date.now(),Xo()<=St.DEBUG&&We("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${i-u}ms
	Determined least recently used ${a} in `+(p-i)+`ms
	Removed ${l} targets in `+(g-p)+`ms
	Removed ${h} documents in `+(v-g)+`ms
Total Duration: ${v-u}ms`),Me.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:l,documentsRemoved:h}))))}}function tA(e,t){return new eA(e,t)}class nA{constructor(){this.changes=new so((t=>t.toString()),((t,n)=>t.isEqual(n))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,n){this.assertNotApplied(),this.changes.set(t,Nn.newInvalidDocument(t).setReadTime(n))}getEntry(t,n){this.assertNotApplied();const s=this.changes.get(n);return s!==void 0?Me.resolve(s):this.getFromCache(t,n)}getEntries(t,n){return this.getAllFromCache(t,n)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class rA{constructor(t,n){this.overlayedDocument=t,this.mutatedFields=n}}class iA{constructor(t,n,s,a){this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=s,this.indexManager=a}getDocument(t,n){let s=null;return this.documentOverlayCache.getOverlay(t,n).next((a=>(s=a,this.remoteDocumentCache.getEntry(t,n)))).next((a=>(s!==null&&Gc(s.mutation,a,wr.empty(),Yt.now()),a)))}getDocuments(t,n){return this.remoteDocumentCache.getEntries(t,n).next((s=>this.getLocalViewOfDocuments(t,s,_t()).next((()=>s))))}getLocalViewOfDocuments(t,n,s=_t()){const a=Wa();return this.populateOverlays(t,a,n).next((()=>this.computeViews(t,n,a,s).next((l=>{let i=Bc();return l.forEach(((p,g)=>{i=i.insert(p,g.overlayedDocument)})),i}))))}getOverlayedDocuments(t,n){const s=Wa();return this.populateOverlays(t,s,n).next((()=>this.computeViews(t,n,s,_t())))}populateOverlays(t,n,s){const a=[];return s.forEach((l=>{n.has(l)||a.push(l)})),this.documentOverlayCache.getOverlays(t,a).next((l=>{l.forEach(((i,p)=>{n.set(i,p)}))}))}computeViews(t,n,s,a){let l=ms();const i=Wc(),p=(function(){return Wc()})();return n.forEach(((g,v)=>{const u=s.get(v.key);a.has(v.key)&&(u===void 0||u.mutation instanceof ga)?l=l.insert(v.key,v):u!==void 0?(i.set(v.key,u.mutation.getFieldMask()),Gc(u.mutation,v,u.mutation.getFieldMask(),Yt.now())):i.set(v.key,wr.empty())})),this.recalculateAndSaveOverlays(t,l).next((g=>(g.forEach(((v,u)=>i.set(v,u))),n.forEach(((v,u)=>p.set(v,new rA(u,i.get(v)??null)))),p)))}recalculateAndSaveOverlays(t,n){const s=Wc();let a=new an(((i,p)=>i-p)),l=_t();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,n).next((i=>{for(const p of i)p.keys().forEach((g=>{const v=n.get(g);if(v===null)return;let u=s.get(g)||wr.empty();u=p.applyToLocalView(v,u),s.set(g,u);const h=(a.get(p.batchId)||_t()).add(g);a=a.insert(p.batchId,h)}))})).next((()=>{const i=[],p=a.getReverseIterator();for(;p.hasNext();){const g=p.getNext(),v=g.key,u=g.value,h=Y4();u.forEach((y=>{if(!l.has(y)){const x=rb(n.get(y),s.get(y));x!==null&&h.set(y,x),l=l.add(y)}})),i.push(this.documentOverlayCache.saveOverlays(t,v,h))}return Me.waitFor(i)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(t,n){return this.remoteDocumentCache.getEntries(t,n).next((s=>this.recalculateAndSaveOverlays(t,s)))}getDocumentsMatchingQuery(t,n,s,a){return oC(n)?this.getDocumentsMatchingDocumentQuery(t,n.path):$4(n)?this.getDocumentsMatchingCollectionGroupQuery(t,n,s,a):this.getDocumentsMatchingCollectionQuery(t,n,s,a)}getNextDocuments(t,n,s,a){return this.remoteDocumentCache.getAllFromCollectionGroup(t,n,s,a).next((l=>{const i=a-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,n,s.largestBatchId,a-l.size):Me.resolve(Wa());let p=Zc,g=l;return i.next((v=>Me.forEach(v,((u,h)=>(p<h.largestBatchId&&(p=h.largestBatchId),l.get(u)?Me.resolve():this.remoteDocumentCache.getEntry(t,u).next((y=>{g=g.insert(u,y)}))))).next((()=>this.populateOverlays(t,v,l))).next((()=>this.computeViews(t,g,v,_t()))).next((u=>({batchId:p,changes:X4(u)})))))}))}getDocumentsMatchingDocumentQuery(t,n){return this.getDocument(t,new et(n)).next((s=>{let a=Bc();return s.isFoundDocument()&&(a=a.insert(s.key,s)),a}))}getDocumentsMatchingCollectionGroupQuery(t,n,s,a){const l=n.collectionGroup;let i=Bc();return this.indexManager.getCollectionParents(t,l).next((p=>Me.forEach(p,(g=>{const v=(function(h,y){return new io(y,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)})(n,g.child(l));return this.getDocumentsMatchingCollectionQuery(t,v,s,a).next((u=>{u.forEach(((h,y)=>{i=i.insert(h,y)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,n,s,a){let l;return this.documentOverlayCache.getOverlaysForCollection(t,n.path,s.largestBatchId).next((i=>(l=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,n,s,l,a)))).next((i=>{l.forEach(((g,v)=>{const u=v.getKey();i.get(u)===null&&(i=i.insert(u,Nn.newInvalidDocument(u)))}));let p=Bc();return i.forEach(((g,v)=>{const u=l.get(g);u!==void 0&&Gc(u.mutation,v,wr.empty(),Yt.now()),ch(n,v)&&(p=p.insert(g,v))})),p}))}}class sA{constructor(t){this.serializer=t,this.Nr=new Map,this.Br=new Map}getBundleMetadata(t,n){return Me.resolve(this.Nr.get(n))}saveBundleMetadata(t,n){return this.Nr.set(n.id,(function(a){return{id:a.id,version:a.version,createTime:_r(a.createTime)}})(n)),Me.resolve()}getNamedQuery(t,n){return Me.resolve(this.Br.get(n))}saveNamedQuery(t,n){return this.Br.set(n.name,(function(a){return{name:a.name,query:QC(a.bundledQuery),readTime:_r(a.readTime)}})(n)),Me.resolve()}}class aA{constructor(){this.overlays=new an(et.comparator),this.Lr=new Map}getOverlay(t,n){return Me.resolve(this.overlays.get(n))}getOverlays(t,n){const s=Wa();return Me.forEach(n,(a=>this.getOverlay(t,a).next((l=>{l!==null&&s.set(a,l)})))).next((()=>s))}saveOverlays(t,n,s){return s.forEach(((a,l)=>{this.bt(t,n,l)})),Me.resolve()}removeOverlaysForBatchId(t,n,s){const a=this.Lr.get(s);return a!==void 0&&(a.forEach((l=>this.overlays=this.overlays.remove(l))),this.Lr.delete(s)),Me.resolve()}getOverlaysForCollection(t,n,s){const a=Wa(),l=n.length+1,i=new et(n.child("")),p=this.overlays.getIteratorFrom(i);for(;p.hasNext();){const g=p.getNext().value,v=g.getKey();if(!n.isPrefixOf(v.path))break;v.path.length===l&&g.largestBatchId>s&&a.set(g.getKey(),g)}return Me.resolve(a)}getOverlaysForCollectionGroup(t,n,s,a){let l=new an(((v,u)=>v-u));const i=this.overlays.getIterator();for(;i.hasNext();){const v=i.getNext().value;if(v.getKey().getCollectionGroup()===n&&v.largestBatchId>s){let u=l.get(v.largestBatchId);u===null&&(u=Wa(),l=l.insert(v.largestBatchId,u)),u.set(v.getKey(),v)}}const p=Wa(),g=l.getIterator();for(;g.hasNext()&&(g.getNext().value.forEach(((v,u)=>p.set(v,u))),!(p.size()>=a)););return Me.resolve(p)}bt(t,n,s){const a=this.overlays.get(s.key);if(a!==null){const i=this.Lr.get(a.largestBatchId).delete(s.key);this.Lr.set(a.largestBatchId,i)}this.overlays=this.overlays.insert(s.key,new EC(n,s));let l=this.Lr.get(n);l===void 0&&(l=_t(),this.Lr.set(n,l)),this.Lr.set(n,l.add(s.key))}}class oA{constructor(){this.sessionToken=$n.EMPTY_BYTE_STRING}getSessionToken(t){return Me.resolve(this.sessionToken)}setSessionToken(t,n){return this.sessionToken=n,Me.resolve()}}class Zm{constructor(){this.kr=new Mn(Dn.Kr),this.qr=new Mn(Dn.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(t,n){const s=new Dn(t,n);this.kr=this.kr.add(s),this.qr=this.qr.add(s)}$r(t,n){t.forEach((s=>this.addReference(s,n)))}removeReference(t,n){this.Wr(new Dn(t,n))}Qr(t,n){t.forEach((s=>this.removeReference(s,n)))}Gr(t){const n=new et(new Ot([])),s=new Dn(n,t),a=new Dn(n,t+1),l=[];return this.qr.forEachInRange([s,a],(i=>{this.Wr(i),l.push(i.key)})),l}zr(){this.kr.forEach((t=>this.Wr(t)))}Wr(t){this.kr=this.kr.delete(t),this.qr=this.qr.delete(t)}jr(t){const n=new et(new Ot([])),s=new Dn(n,t),a=new Dn(n,t+1);let l=_t();return this.qr.forEachInRange([s,a],(i=>{l=l.add(i.key)})),l}containsKey(t){const n=new Dn(t,0),s=this.kr.firstAfterOrEqual(n);return s!==null&&t.isEqual(s.key)}}class Dn{constructor(t,n){this.key=t,this.Hr=n}static Kr(t,n){return et.comparator(t.key,n.key)||wt(t.Hr,n.Hr)}static Ur(t,n){return wt(t.Hr,n.Hr)||et.comparator(t.key,n.key)}}class lA{constructor(t,n){this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.Yn=1,this.Jr=new Mn(Dn.Kr)}checkEmpty(t){return Me.resolve(this.mutationQueue.length===0)}addMutationBatch(t,n,s,a){const l=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new TC(l,n,s,a);this.mutationQueue.push(i);for(const p of a)this.Jr=this.Jr.add(new Dn(p.key,l)),this.indexManager.addToCollectionParentIndex(t,p.key.path.popLast());return Me.resolve(i)}lookupMutationBatch(t,n){return Me.resolve(this.Zr(n))}getNextMutationBatchAfterBatchId(t,n){const s=n+1,a=this.Xr(s),l=a<0?0:a;return Me.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return Me.resolve(this.mutationQueue.length===0?Fm:this.Yn-1)}getAllMutationBatches(t){return Me.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,n){const s=new Dn(n,0),a=new Dn(n,Number.POSITIVE_INFINITY),l=[];return this.Jr.forEachInRange([s,a],(i=>{const p=this.Zr(i.Hr);l.push(p)})),Me.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(t,n){let s=new Mn(wt);return n.forEach((a=>{const l=new Dn(a,0),i=new Dn(a,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([l,i],(p=>{s=s.add(p.Hr)}))})),Me.resolve(this.Yr(s))}getAllMutationBatchesAffectingQuery(t,n){const s=n.path,a=s.length+1;let l=s;et.isDocumentKey(l)||(l=l.child(""));const i=new Dn(new et(l),0);let p=new Mn(wt);return this.Jr.forEachWhile((g=>{const v=g.key.path;return!!s.isPrefixOf(v)&&(v.length===a&&(p=p.add(g.Hr)),!0)}),i),Me.resolve(this.Yr(p))}Yr(t){const n=[];return t.forEach((s=>{const a=this.Zr(s);a!==null&&n.push(a)})),n}removeMutationBatch(t,n){jt(this.ei(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Jr;return Me.forEach(n.mutations,(a=>{const l=new Dn(a.key,n.batchId);return s=s.delete(l),this.referenceDelegate.markPotentiallyOrphaned(t,a.key)})).next((()=>{this.Jr=s}))}nr(t){}containsKey(t,n){const s=new Dn(n,0),a=this.Jr.firstAfterOrEqual(s);return Me.resolve(n.isEqual(a&&a.key))}performConsistencyCheck(t){return this.mutationQueue.length,Me.resolve()}ei(t,n){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){const n=this.Xr(t);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class cA{constructor(t){this.ti=t,this.docs=(function(){return new an(et.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,n){const s=n.key,a=this.docs.get(s),l=a?a.size:0,i=this.ti(n);return this.docs=this.docs.insert(s,{document:n.mutableCopy(),size:i}),this.size+=i-l,this.indexManager.addToCollectionParentIndex(t,s.path.popLast())}removeEntry(t){const n=this.docs.get(t);n&&(this.docs=this.docs.remove(t),this.size-=n.size)}getEntry(t,n){const s=this.docs.get(n);return Me.resolve(s?s.document.mutableCopy():Nn.newInvalidDocument(n))}getEntries(t,n){let s=ms();return n.forEach((a=>{const l=this.docs.get(a);s=s.insert(a,l?l.document.mutableCopy():Nn.newInvalidDocument(a))})),Me.resolve(s)}getDocumentsMatchingQuery(t,n,s,a){let l=ms();const i=n.path,p=new et(i.child("__id-9223372036854775808__")),g=this.docs.getIteratorFrom(p);for(;g.hasNext();){const{key:v,value:{document:u}}=g.getNext();if(!i.isPrefixOf(v.path))break;v.path.length>i.length+1||zE(PE(u),s)<=0||(a.has(u.key)||ch(n,u))&&(l=l.insert(u.key,u.mutableCopy()))}return Me.resolve(l)}getAllFromCollectionGroup(t,n,s,a){rt(9500)}ni(t,n){return Me.forEach(this.docs,(s=>n(s)))}newChangeBuffer(t){return new uA(this)}getSize(t){return Me.resolve(this.size)}}class uA extends nA{constructor(t){super(),this.Mr=t}applyChanges(t){const n=[];return this.changes.forEach(((s,a)=>{a.isValidDocument()?n.push(this.Mr.addEntry(t,a)):this.Mr.removeEntry(s)})),Me.waitFor(n)}getFromCache(t,n){return this.Mr.getEntry(t,n)}getAllFromCache(t,n){return this.Mr.getEntries(t,n)}}class dA{constructor(t){this.persistence=t,this.ri=new so((n=>Gm(n)),Qm),this.lastRemoteSnapshotVersion=ot.min(),this.highestTargetId=0,this.ii=0,this.si=new Zm,this.targetCount=0,this.oi=hl._r()}forEachTarget(t,n){return this.ri.forEach(((s,a)=>n(a))),Me.resolve()}getLastRemoteSnapshotVersion(t){return Me.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Me.resolve(this.ii)}allocateTargetId(t){return this.highestTargetId=this.oi.next(),Me.resolve(this.highestTargetId)}setTargetsMetadata(t,n,s){return s&&(this.lastRemoteSnapshotVersion=s),n>this.ii&&(this.ii=n),Me.resolve()}lr(t){this.ri.set(t.target,t);const n=t.targetId;n>this.highestTargetId&&(this.oi=new hl(n),this.highestTargetId=n),t.sequenceNumber>this.ii&&(this.ii=t.sequenceNumber)}addTargetData(t,n){return this.lr(n),this.targetCount+=1,Me.resolve()}updateTargetData(t,n){return this.lr(n),Me.resolve()}removeTargetData(t,n){return this.ri.delete(n.target),this.si.Gr(n.targetId),this.targetCount-=1,Me.resolve()}removeTargets(t,n,s){let a=0;const l=[];return this.ri.forEach(((i,p)=>{p.sequenceNumber<=n&&s.get(p.targetId)===null&&(this.ri.delete(i),l.push(this.removeMatchingKeysForTargetId(t,p.targetId)),a++)})),Me.waitFor(l).next((()=>a))}getTargetCount(t){return Me.resolve(this.targetCount)}getTargetData(t,n){const s=this.ri.get(n)||null;return Me.resolve(s)}addMatchingKeys(t,n,s){return this.si.$r(n,s),Me.resolve()}removeMatchingKeys(t,n,s){this.si.Qr(n,s);const a=this.persistence.referenceDelegate,l=[];return a&&n.forEach((i=>{l.push(a.markPotentiallyOrphaned(t,i))})),Me.waitFor(l)}removeMatchingKeysForTargetId(t,n){return this.si.Gr(n),Me.resolve()}getMatchingKeysForTargetId(t,n){const s=this.si.jr(n);return Me.resolve(s)}containsKey(t,n){return Me.resolve(this.si.containsKey(n))}}class Sb{constructor(t,n){this._i={},this.overlays={},this.ai=new sh(0),this.ui=!1,this.ui=!0,this.ci=new oA,this.referenceDelegate=t(this),this.li=new dA(this),this.indexManager=new XC,this.remoteDocumentCache=(function(a){return new cA(a)})((s=>this.referenceDelegate.hi(s))),this.serializer=new GC(n),this.Pi=new sA(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let n=this.overlays[t.toKey()];return n||(n=new aA,this.overlays[t.toKey()]=n),n}getMutationQueue(t,n){let s=this._i[t.toKey()];return s||(s=new lA(n,this.referenceDelegate),this._i[t.toKey()]=s),s}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(t,n,s){We("MemoryPersistence","Starting transaction:",t);const a=new fA(this.ai.next());return this.referenceDelegate.Ti(),s(a).next((l=>this.referenceDelegate.Ii(a).next((()=>l)))).toPromise().then((l=>(a.raiseOnCommittedEvent(),l)))}Ei(t,n){return Me.or(Object.values(this._i).map((s=>()=>s.containsKey(t,n))))}}class fA extends VE{constructor(t){super(),this.currentSequenceNumber=t}}class eg{constructor(t){this.persistence=t,this.Ri=new Zm,this.Ai=null}static Vi(t){return new eg(t)}get di(){if(this.Ai)return this.Ai;throw rt(60996)}addReference(t,n,s){return this.Ri.addReference(s,n),this.di.delete(s.toString()),Me.resolve()}removeReference(t,n,s){return this.Ri.removeReference(s,n),this.di.add(s.toString()),Me.resolve()}markPotentiallyOrphaned(t,n){return this.di.add(n.toString()),Me.resolve()}removeTarget(t,n){this.Ri.Gr(n.targetId).forEach((a=>this.di.add(a.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(t,n.targetId).next((a=>{a.forEach((l=>this.di.add(l.toString())))})).next((()=>s.removeTargetData(t,n)))}Ti(){this.Ai=new Set}Ii(t){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Me.forEach(this.di,(s=>{const a=et.fromPath(s);return this.mi(t,a).next((l=>{l||n.removeEntry(a,ot.min())}))})).next((()=>(this.Ai=null,n.apply(t))))}updateLimboDocument(t,n){return this.mi(t,n).next((s=>{s?this.di.delete(n.toString()):this.di.add(n.toString())}))}hi(t){return 0}mi(t,n){return Me.or([()=>Me.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(t,n),()=>this.persistence.Ei(t,n)])}}class zf{constructor(t,n){this.persistence=t,this.fi=new so((s=>qE(s.path)),((s,a)=>s.isEqual(a))),this.garbageCollector=tA(this,n)}static Vi(t,n){return new zf(t,n)}Ti(){}Ii(t){return Me.resolve()}forEachTarget(t,n){return this.persistence.getTargetCache().forEachTarget(t,n)}dr(t){const n=this.pr(t);return this.persistence.getTargetCache().getTargetCount(t).next((s=>n.next((a=>s+a))))}pr(t){let n=0;return this.mr(t,(s=>{n++})).next((()=>n))}mr(t,n){return Me.forEach(this.fi,((s,a)=>this.wr(t,s,a).next((l=>l?Me.resolve():n(a)))))}removeTargets(t,n,s){return this.persistence.getTargetCache().removeTargets(t,n,s)}removeOrphanedDocuments(t,n){let s=0;const a=this.persistence.getRemoteDocumentCache(),l=a.newChangeBuffer();return a.ni(t,(i=>this.wr(t,i,n).next((p=>{p||(s++,l.removeEntry(i,ot.min()))})))).next((()=>l.apply(t))).next((()=>s))}markPotentiallyOrphaned(t,n){return this.fi.set(n,t.currentSequenceNumber),Me.resolve()}removeTarget(t,n){const s=n.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,s)}addReference(t,n,s){return this.fi.set(s,t.currentSequenceNumber),Me.resolve()}removeReference(t,n,s){return this.fi.set(s,t.currentSequenceNumber),Me.resolve()}updateLimboDocument(t,n){return this.fi.set(n,t.currentSequenceNumber),Me.resolve()}hi(t){let n=t.key.toString().length;return t.isFoundDocument()&&(n+=pf(t.data.value)),n}wr(t,n,s){return Me.or([()=>this.persistence.Ei(t,n),()=>this.persistence.getTargetCache().containsKey(t,n),()=>{const a=this.fi.get(n);return Me.resolve(a!==void 0&&a>s)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class tg{constructor(t,n,s,a){this.targetId=t,this.fromCache=n,this.Ts=s,this.Is=a}static Es(t,n){let s=_t(),a=_t();for(const l of n.docChanges)switch(l.type){case 0:s=s.add(l.doc.key);break;case 1:a=a.add(l.doc.key)}return new tg(t,n.fromCache,s,a)}}class hA{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class pA{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return i6()?8:BE(Yn())>0?6:4})()}initialize(t,n){this.fs=t,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(t,n,s,a){const l={result:null};return this.gs(t,n).next((i=>{l.result=i})).next((()=>{if(!l.result)return this.ps(t,n,a,s).next((i=>{l.result=i}))})).next((()=>{if(l.result)return;const i=new hA;return this.ys(t,n,i).next((p=>{if(l.result=p,this.As)return this.ws(t,n,i,p.size)}))})).next((()=>l.result))}ws(t,n,s,a){return s.documentReadCount<this.Vs?(Xo()<=St.DEBUG&&We("QueryEngine","SDK will not create cache indexes for query:",Yo(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),Me.resolve()):(Xo()<=St.DEBUG&&We("QueryEngine","Query:",Yo(n),"scans",s.documentReadCount,"local documents and returns",a,"documents as results."),s.documentReadCount>this.ds*a?(Xo()<=St.DEBUG&&We("QueryEngine","The SDK decides to create cache indexes for query:",Yo(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ii(n))):Me.resolve())}gs(t,n){if(u3(n))return Me.resolve(null);let s=Ii(n);return this.indexManager.getIndexType(t,s).next((a=>a===0?null:(n.limit!==null&&a===1&&(n=Df(n,null,"F"),s=Ii(n)),this.indexManager.getDocumentsMatchingTarget(t,s).next((l=>{const i=_t(...l);return this.fs.getDocuments(t,i).next((p=>this.indexManager.getMinOffset(t,s).next((g=>{const v=this.bs(n,p);return this.Ss(n,v,i,g.readTime)?this.gs(t,Df(n,null,"F")):this.Ds(t,v,n,g)}))))})))))}ps(t,n,s,a){return u3(n)||a.isEqual(ot.min())?Me.resolve(null):this.fs.getDocuments(t,s).next((l=>{const i=this.bs(n,l);return this.Ss(n,i,s,a)?Me.resolve(null):(Xo()<=St.DEBUG&&We("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),Yo(n)),this.Ds(t,i,n,LE(a,Zc)).next((p=>p)))}))}bs(t,n){let s=new Mn(G4(t));return n.forEach(((a,l)=>{ch(t,l)&&(s=s.add(l))})),s}Ss(t,n,s,a){if(t.limit===null)return!1;if(s.size!==n.size)return!0;const l=t.limitType==="F"?n.last():n.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(a)>0)}ys(t,n,s){return Xo()<=St.DEBUG&&We("QueryEngine","Using full collection scan to execute query:",Yo(n)),this.fs.getDocumentsMatchingQuery(t,n,ca.min(),s)}Ds(t,n,s,a){return this.fs.getDocumentsMatchingQuery(t,s,a).next((l=>(n.forEach((i=>{l=l.insert(i.key,i)})),l)))}}const ng="LocalStore",mA=3e8;class gA{constructor(t,n,s,a){this.persistence=t,this.Cs=n,this.serializer=a,this.vs=new an(wt),this.Fs=new so((l=>Gm(l)),Qm),this.Ms=new Map,this.xs=t.getRemoteDocumentCache(),this.li=t.getTargetCache(),this.Pi=t.getBundleCache(),this.Os(s)}Os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new iA(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>t.collect(n,this.vs)))}}function vA(e,t,n,s){return new gA(e,t,n,s)}async function wb(e,t){const n=ut(e);return await n.persistence.runTransaction("Handle user change","readonly",(s=>{let a;return n.mutationQueue.getAllMutationBatches(s).next((l=>(a=l,n.Os(t),n.mutationQueue.getAllMutationBatches(s)))).next((l=>{const i=[],p=[];let g=_t();for(const v of a){i.push(v.batchId);for(const u of v.mutations)g=g.add(u.key)}for(const v of l){p.push(v.batchId);for(const u of v.mutations)g=g.add(u.key)}return n.localDocuments.getDocuments(s,g).next((v=>({Ns:v,removedBatchIds:i,addedBatchIds:p})))}))}))}function yA(e,t){const n=ut(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const a=t.batch.keys(),l=n.xs.newChangeBuffer({trackRemovals:!0});return(function(p,g,v,u){const h=v.batch,y=h.keys();let x=Me.resolve();return y.forEach((T=>{x=x.next((()=>u.getEntry(g,T))).next((_=>{const E=v.docVersions.get(T);jt(E!==null,48541),_.version.compareTo(E)<0&&(h.applyToRemoteDocument(_,v),_.isValidDocument()&&(_.setReadTime(v.commitVersion),u.addEntry(_)))}))})),x.next((()=>p.mutationQueue.removeMutationBatch(g,h)))})(n,s,t,l).next((()=>l.apply(s))).next((()=>n.mutationQueue.performConsistencyCheck(s))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(s,a,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(p){let g=_t();for(let v=0;v<p.mutationResults.length;++v)p.mutationResults[v].transformResults.length>0&&(g=g.add(p.batch.mutations[v].key));return g})(t)))).next((()=>n.localDocuments.getDocuments(s,a)))}))}function _b(e){const t=ut(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>t.li.getLastRemoteSnapshotVersion(n)))}function bA(e,t){const n=ut(e),s=t.snapshotVersion;let a=n.vs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(l=>{const i=n.xs.newChangeBuffer({trackRemovals:!0});a=n.vs;const p=[];t.targetChanges.forEach(((u,h)=>{const y=a.get(h);if(!y)return;p.push(n.li.removeMatchingKeys(l,u.removedDocuments,h).next((()=>n.li.addMatchingKeys(l,u.addedDocuments,h))));let x=y.withSequenceNumber(l.currentSequenceNumber);t.targetMismatches.get(h)!==null?x=x.withResumeToken($n.EMPTY_BYTE_STRING,ot.min()).withLastLimboFreeSnapshotVersion(ot.min()):u.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(u.resumeToken,s)),a=a.insert(h,x),(function(_,E,R){return _.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-_.snapshotVersion.toMicroseconds()>=mA?!0:R.addedDocuments.size+R.modifiedDocuments.size+R.removedDocuments.size>0})(y,x,u)&&p.push(n.li.updateTargetData(l,x))}));let g=ms(),v=_t();if(t.documentUpdates.forEach((u=>{t.resolvedLimboDocuments.has(u)&&p.push(n.persistence.referenceDelegate.updateLimboDocument(l,u))})),p.push(SA(l,i,t.documentUpdates).next((u=>{g=u.Bs,v=u.Ls}))),!s.isEqual(ot.min())){const u=n.li.getLastRemoteSnapshotVersion(l).next((h=>n.li.setTargetsMetadata(l,l.currentSequenceNumber,s)));p.push(u)}return Me.waitFor(p).next((()=>i.apply(l))).next((()=>n.localDocuments.getLocalViewOfDocuments(l,g,v))).next((()=>g))})).then((l=>(n.vs=a,l)))}function SA(e,t,n){let s=_t(),a=_t();return n.forEach((l=>s=s.add(l))),t.getEntries(e,s).next((l=>{let i=ms();return n.forEach(((p,g)=>{const v=l.get(p);g.isFoundDocument()!==v.isFoundDocument()&&(a=a.add(p)),g.isNoDocument()&&g.version.isEqual(ot.min())?(t.removeEntry(p,g.readTime),i=i.insert(p,g)):!v.isValidDocument()||g.version.compareTo(v.version)>0||g.version.compareTo(v.version)===0&&v.hasPendingWrites?(t.addEntry(g),i=i.insert(p,g)):We(ng,"Ignoring outdated watch update for ",p,". Current version:",v.version," Watch version:",g.version)})),{Bs:i,Ls:a}}))}function wA(e,t){const n=ut(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(s=>(t===void 0&&(t=Fm),n.mutationQueue.getNextMutationBatchAfterBatchId(s,t))))}function _A(e,t){const n=ut(e);return n.persistence.runTransaction("Allocate target","readwrite",(s=>{let a;return n.li.getTargetData(s,t).next((l=>l?(a=l,Me.resolve(a)):n.li.allocateTargetId(s).next((i=>(a=new ea(t,i,"TargetPurposeListen",s.currentSequenceNumber),n.li.addTargetData(s,a).next((()=>a)))))))})).then((s=>{const a=n.vs.get(s.targetId);return(a===null||s.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(n.vs=n.vs.insert(s.targetId,s),n.Fs.set(t,s.targetId)),s}))}async function um(e,t,n){const s=ut(e),a=s.vs.get(t),l=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",l,(i=>s.persistence.referenceDelegate.removeTarget(i,a)))}catch(i){if(!jl(i))throw i;We(ng,`Failed to update sequence numbers for target ${t}: ${i}`)}s.vs=s.vs.remove(t),s.Fs.delete(a.target)}function x3(e,t,n){const s=ut(e);let a=ot.min(),l=_t();return s.persistence.runTransaction("Execute query","readwrite",(i=>(function(g,v,u){const h=ut(g),y=h.Fs.get(u);return y!==void 0?Me.resolve(h.vs.get(y)):h.li.getTargetData(v,u)})(s,i,Ii(t)).next((p=>{if(p)return a=p.lastLimboFreeSnapshotVersion,s.li.getMatchingKeysForTargetId(i,p.targetId).next((g=>{l=g}))})).next((()=>s.Cs.getDocumentsMatchingQuery(i,t,n?a:ot.min(),n?l:_t()))).next((p=>(xA(s,uC(t),p),{documents:p,ks:l})))))}function xA(e,t,n){let s=e.Ms.get(t)||ot.min();n.forEach(((a,l)=>{l.readTime.compareTo(s)>0&&(s=l.readTime)})),e.Ms.set(t,s)}class T3{constructor(){this.activeTargetIds=gC()}Qs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class TA{constructor(){this.vo=new T3,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,n,s){}addLocalQueryTarget(t,n=!0){return n&&this.vo.Qs(t),this.Fo[t]||"not-current"}updateQueryState(t,n,s){this.Fo[t]=n}removeLocalQueryTarget(t){this.vo.Gs(t)}isLocalQueryTarget(t){return this.vo.activeTargetIds.has(t)}clearQueryState(t){delete this.Fo[t]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(t){return this.vo.activeTargetIds.has(t)}start(){return this.vo=new T3,Promise.resolve()}handleUserChange(t,n,s){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class EA{Mo(t){}shutdown(){}}const E3="ConnectivityMonitor";class C3{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(t){this.Lo.push(t)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){We(E3,"Network connectivity changed: AVAILABLE");for(const t of this.Lo)t(0)}Bo(){We(E3,"Network connectivity changed: UNAVAILABLE");for(const t of this.Lo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let rf=null;function dm(){return rf===null?rf=(function(){return 268435456+Math.round(2147483648*Math.random())})():rf++,"0x"+rf.toString(16)}const Pp="RestConnection",CA={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class AA{get Ko(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.qo=n+"://"+t.host,this.Uo=`projects/${s}/databases/${a}`,this.$o=this.databaseId.database===Rf?`project_id=${s}`:`project_id=${s}&database_id=${a}`}Wo(t,n,s,a,l){const i=dm(),p=this.Qo(t,n.toUriEncodedString());We(Pp,`Sending RPC '${t}' ${i}:`,p,s);const g={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(g,a,l);const{host:v}=new URL(p),u=xl(v);return this.zo(t,p,g,s,u).then((h=>(We(Pp,`Received RPC '${t}' ${i}: `,h),h)),(h=>{throw eo(Pp,`RPC '${t}' ${i} failed with error: `,h,"url: ",p,"request:",s),h}))}jo(t,n,s,a,l,i){return this.Wo(t,n,s,a,l)}Go(t,n,s){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Cl})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((a,l)=>t[l]=a)),s&&s.headers.forEach(((a,l)=>t[l]=a))}Qo(t,n){const s=CA[t];let a=`${this.qo}/v1/${n}:${s}`;return this.databaseInfo.apiKey&&(a=`${a}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),a}terminate(){}}class jA{constructor(t){this.Ho=t.Ho,this.Jo=t.Jo}Zo(t){this.Xo=t}Yo(t){this.e_=t}t_(t){this.n_=t}onMessage(t){this.r_=t}close(){this.Jo()}send(t){this.Ho(t)}i_(){this.Xo()}s_(){this.e_()}o_(t){this.n_(t)}__(t){this.r_(t)}}const Qn="WebChannelConnection",Pc=(e,t,n)=>{e.listen(t,(s=>{try{n(s)}catch(a){setTimeout((()=>{throw a}),0)}}))};class sl extends AA{constructor(t){super(t),this.a_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}static u_(){if(!sl.c_){const t=T4();Pc(t,x4.STAT_EVENT,(n=>{n.stat===em.PROXY?We(Qn,"STAT_EVENT: detected buffering proxy"):n.stat===em.NOPROXY&&We(Qn,"STAT_EVENT: detected no buffering proxy")})),sl.c_=!0}}zo(t,n,s,a,l){const i=dm();return new Promise(((p,g)=>{const v=new w4;v.setWithCredentials(!0),v.listenOnce(_4.COMPLETE,(()=>{try{switch(v.getLastErrorCode()){case hf.NO_ERROR:const h=v.getResponseJson();We(Qn,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(h)),p(h);break;case hf.TIMEOUT:We(Qn,`RPC '${t}' ${i} timed out`),g(new Be(_e.DEADLINE_EXCEEDED,"Request time out"));break;case hf.HTTP_ERROR:const y=v.getStatus();if(We(Qn,`RPC '${t}' ${i} failed with status:`,y,"response text:",v.getResponseText()),y>0){let x=v.getResponseJson();Array.isArray(x)&&(x=x[0]);const T=x?.error;if(T&&T.status&&T.message){const _=(function(R){const P=R.toLowerCase().replace(/_/g,"-");return Object.values(_e).indexOf(P)>=0?P:_e.UNKNOWN})(T.status);g(new Be(_,T.message))}else g(new Be(_e.UNKNOWN,"Server responded with status "+v.getStatus()))}else g(new Be(_e.UNAVAILABLE,"Connection failed."));break;default:rt(9055,{l_:t,streamId:i,h_:v.getLastErrorCode(),P_:v.getLastError()})}}finally{We(Qn,`RPC '${t}' ${i} completed.`)}}));const u=JSON.stringify(a);We(Qn,`RPC '${t}' ${i} sending request:`,a),v.send(n,"POST",u,s,15)}))}T_(t,n,s){const a=dm(),l=[this.qo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=this.createWebChannelTransport(),p={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;g!==void 0&&(p.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(p.useFetchStreams=!0),this.Go(p.initMessageHeaders,n,s),p.encodeInitMessageHeaders=!0;const v=l.join("");We(Qn,`Creating RPC '${t}' stream ${a}: ${v}`,p);const u=i.createWebChannel(v,p);this.I_(u);let h=!1,y=!1;const x=new jA({Ho:T=>{y?We(Qn,`Not sending because RPC '${t}' stream ${a} is closed:`,T):(h||(We(Qn,`Opening RPC '${t}' stream ${a} transport.`),u.open(),h=!0),We(Qn,`RPC '${t}' stream ${a} sending:`,T),u.send(T))},Jo:()=>u.close()});return Pc(u,Vc.EventType.OPEN,(()=>{y||(We(Qn,`RPC '${t}' stream ${a} transport opened.`),x.i_())})),Pc(u,Vc.EventType.CLOSE,(()=>{y||(y=!0,We(Qn,`RPC '${t}' stream ${a} transport closed`),x.o_(),this.E_(u))})),Pc(u,Vc.EventType.ERROR,(T=>{y||(y=!0,eo(Qn,`RPC '${t}' stream ${a} transport errored. Name:`,T.name,"Message:",T.message),x.o_(new Be(_e.UNAVAILABLE,"The operation could not be completed")))})),Pc(u,Vc.EventType.MESSAGE,(T=>{if(!y){const _=T.data[0];jt(!!_,16349);const E=_,R=E?.error||E[0]?.error;if(R){We(Qn,`RPC '${t}' stream ${a} received error:`,R);const P=R.status;let B=(function(K){const k=xn[K];if(k!==void 0)return ob(k)})(P),X=R.message;P==="NOT_FOUND"&&X.includes("database")&&X.includes("does not exist")&&X.includes(this.databaseId.database)&&eo(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),B===void 0&&(B=_e.INTERNAL,X="Unknown error status: "+P+" with message "+R.message),y=!0,x.o_(new Be(B,X)),u.close()}else We(Qn,`RPC '${t}' stream ${a} received:`,_),x.__(_)}})),sl.u_(),setTimeout((()=>{x.s_()}),0),x}terminate(){this.a_.forEach((t=>t.close())),this.a_=[]}I_(t){this.a_.push(t)}E_(t){this.a_=this.a_.filter((n=>n===t))}Go(t,n,s){super.Go(t,n,s),this.databaseInfo.apiKey&&(t["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return E4()}}function MA(e){return new sl(e)}function zp(){return typeof document<"u"?document:null}function hh(e){return new DC(e,!0)}sl.c_=!1;class rg{constructor(t,n,s=1e3,a=1.5,l=6e4){this.Ci=t,this.timerId=n,this.R_=s,this.A_=a,this.V_=l,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(t){this.cancel();const n=Math.floor(this.d_+this.y_()),s=Math.max(0,Date.now()-this.f_),a=Math.max(0,n-s);a>0&&We("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.d_} ms, delay with jitter: ${n} ms, last attempt: ${s} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,a,(()=>(this.f_=Date.now(),t()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const A3="PersistentStream";class xb{constructor(t,n,s,a,l,i,p,g){this.Ci=t,this.b_=s,this.S_=a,this.connection=l,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=p,this.listener=g,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new rg(t,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(t){this.q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,n){this.q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():n&&n.code===_e.RESOURCE_EXHAUSTED?(ps(n.toString()),ps("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===_e.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.t_(n)}W_(){}auth(){this.state=1;const t=this.Q_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,a])=>{this.D_===n&&this.G_(s,a)}),(s=>{t((()=>{const a=new Be(_e.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(a)}))}))}G_(t,n){const s=this.Q_(this.D_);this.stream=this.j_(t,n),this.stream.Zo((()=>{s((()=>this.listener.Zo()))})),this.stream.Yo((()=>{s((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((a=>{s((()=>this.z_(a)))})),this.stream.onMessage((a=>{s((()=>++this.F_==1?this.H_(a):this.onNext(a)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return We(A3,`close with error: ${t}`),this.stream=null,this.close(4,t)}Q_(t){return n=>{this.Ci.enqueueAndForget((()=>this.D_===t?n():(We(A3,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class RA extends xb{constructor(t,n,s,a,l,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,s,a,i),this.serializer=l}j_(t,n){return this.connection.T_("Listen",t,n)}H_(t){return this.onNext(t)}onNext(t){this.M_.reset();const n=zC(this.serializer,t),s=(function(l){if(!("targetChange"in l))return ot.min();const i=l.targetChange;return i.targetIds&&i.targetIds.length?ot.min():i.readTime?_r(i.readTime):ot.min()})(t);return this.listener.J_(n,s)}Z_(t){const n={};n.database=cm(this.serializer),n.addTarget=(function(l,i){let p;const g=i.target;if(p=sm(g)?{documents:VC(l,g)}:{query:BC(l,g).ft},p.targetId=i.targetId,i.resumeToken.approximateByteSize()>0){p.resumeToken=ub(l,i.resumeToken);const v=om(l,i.expectedCount);v!==null&&(p.expectedCount=v)}else if(i.snapshotVersion.compareTo(ot.min())>0){p.readTime=Lf(l,i.snapshotVersion.toTimestamp());const v=om(l,i.expectedCount);v!==null&&(p.expectedCount=v)}return p})(this.serializer,t);const s=qC(this.serializer,t);s&&(n.labels=s),this.K_(n)}X_(t){const n={};n.database=cm(this.serializer),n.removeTarget=t,this.K_(n)}}class kA extends xb{constructor(t,n,s,a,l,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,s,a,i),this.serializer=l}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(t,n){return this.connection.T_("Write",t,n)}H_(t){return jt(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,jt(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){jt(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const n=OC(t.writeResults,t.commitTime),s=_r(t.commitTime);return this.listener.na(s,n)}ra(){const t={};t.database=cm(this.serializer),this.K_(t)}ea(t){const n={streamToken:this.lastStreamToken,writes:t.map((s=>pb(this.serializer,s)))};this.K_(n)}}class IA{}class DA extends IA{constructor(t,n,s,a){super(),this.authCredentials=t,this.appCheckCredentials=n,this.connection=s,this.serializer=a,this.ia=!1}sa(){if(this.ia)throw new Be(_e.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,n,s,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,i])=>this.connection.Wo(t,lm(n,s),a,l,i))).catch((l=>{throw l.name==="FirebaseError"?(l.code===_e.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Be(_e.UNKNOWN,l.toString())}))}jo(t,n,s,a,l){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,p])=>this.connection.jo(t,lm(n,s),a,i,p,l))).catch((i=>{throw i.name==="FirebaseError"?(i.code===_e.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Be(_e.UNKNOWN,i.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function NA(e,t,n,s){return new DA(e,t,n,s)}class LA{constructor(t,n){this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const n=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ps(n),this.aa=!1):We("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const to="RemoteStore";class PA{constructor(t,n,s,a,l){this.localStore=t,this.datastore=n,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=l,this.Aa.Mo((i=>{s.enqueueAndForget((async()=>{ao(this)&&(We(to,"Restarting streams for network reachability change."),await(async function(g){const v=ut(g);v.Ea.add(4),await Su(v),v.Va.set("Unknown"),v.Ea.delete(4),await ph(v)})(this))}))})),this.Va=new LA(s,a)}}async function ph(e){if(ao(e))for(const t of e.Ra)await t(!0)}async function Su(e){for(const t of e.Ra)await t(!1)}function Tb(e,t){const n=ut(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),og(n)?ag(n):Ml(n).O_()&&sg(n,t))}function ig(e,t){const n=ut(e),s=Ml(n);n.Ia.delete(t),s.O_()&&Eb(n,t),n.Ia.size===0&&(s.O_()?s.L_():ao(n)&&n.Va.set("Unknown"))}function sg(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ot.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Ml(e).Z_(t)}function Eb(e,t){e.da.$e(t),Ml(e).X_(t)}function ag(e){e.da=new MC({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),Ml(e).start(),e.Va.ua()}function og(e){return ao(e)&&!Ml(e).x_()&&e.Ia.size>0}function ao(e){return ut(e).Ea.size===0}function Cb(e){e.da=void 0}async function zA(e){e.Va.set("Online")}async function OA(e){e.Ia.forEach(((t,n)=>{sg(e,t)}))}async function VA(e,t){Cb(e),og(e)?(e.Va.ha(t),ag(e)):e.Va.set("Unknown")}async function BA(e,t,n){if(e.Va.set("Online"),t instanceof cb&&t.state===2&&t.cause)try{await(async function(a,l){const i=l.cause;for(const p of l.targetIds)a.Ia.has(p)&&(await a.remoteSyncer.rejectListen(p,i),a.Ia.delete(p),a.da.removeTarget(p))})(e,t)}catch(s){We(to,"Failed to remove targets %s: %s ",t.targetIds.join(","),s),await Of(e,s)}else if(t instanceof vf?e.da.Xe(t):t instanceof lb?e.da.st(t):e.da.tt(t),!n.isEqual(ot.min()))try{const s=await _b(e.localStore);n.compareTo(s)>=0&&await(function(l,i){const p=l.da.Tt(i);return p.targetChanges.forEach(((g,v)=>{if(g.resumeToken.approximateByteSize()>0){const u=l.Ia.get(v);u&&l.Ia.set(v,u.withResumeToken(g.resumeToken,i))}})),p.targetMismatches.forEach(((g,v)=>{const u=l.Ia.get(g);if(!u)return;l.Ia.set(g,u.withResumeToken($n.EMPTY_BYTE_STRING,u.snapshotVersion)),Eb(l,g);const h=new ea(u.target,g,v,u.sequenceNumber);sg(l,h)})),l.remoteSyncer.applyRemoteEvent(p)})(e,n)}catch(s){We(to,"Failed to raise snapshot:",s),await Of(e,s)}}async function Of(e,t,n){if(!jl(t))throw t;e.Ea.add(1),await Su(e),e.Va.set("Offline"),n||(n=()=>_b(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{We(to,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await ph(e)}))}function Ab(e,t){return t().catch((n=>Of(e,n,t)))}async function mh(e){const t=ut(e),n=ha(t);let s=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:Fm;for(;UA(t);)try{const a=await wA(t.localStore,s);if(a===null){t.Ta.length===0&&n.L_();break}s=a.batchId,qA(t,a)}catch(a){await Of(t,a)}jb(t)&&Mb(t)}function UA(e){return ao(e)&&e.Ta.length<10}function qA(e,t){e.Ta.push(t);const n=ha(e);n.O_()&&n.Y_&&n.ea(t.mutations)}function jb(e){return ao(e)&&!ha(e).x_()&&e.Ta.length>0}function Mb(e){ha(e).start()}async function HA(e){ha(e).ra()}async function FA(e){const t=ha(e);for(const n of e.Ta)t.ea(n.mutations)}async function $A(e,t,n){const s=e.Ta.shift(),a=Ym.from(s,t,n);await Ab(e,(()=>e.remoteSyncer.applySuccessfulWrite(a))),await mh(e)}async function WA(e,t){t&&ha(e).Y_&&await(async function(s,a){if((function(i){return ab(i)&&i!==_e.ABORTED})(a.code)){const l=s.Ta.shift();ha(s).B_(),await Ab(s,(()=>s.remoteSyncer.rejectFailedWrite(l.batchId,a))),await mh(s)}})(e,t),jb(e)&&Mb(e)}async function j3(e,t){const n=ut(e);n.asyncQueue.verifyOperationInProgress(),We(to,"RemoteStore received new credentials");const s=ao(n);n.Ea.add(3),await Su(n),s&&n.Va.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await ph(n)}async function GA(e,t){const n=ut(e);t?(n.Ea.delete(2),await ph(n)):t||(n.Ea.add(2),await Su(n),n.Va.set("Unknown"))}function Ml(e){return e.ma||(e.ma=(function(n,s,a){const l=ut(n);return l.sa(),new RA(s,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)})(e.datastore,e.asyncQueue,{Zo:zA.bind(null,e),Yo:OA.bind(null,e),t_:VA.bind(null,e),J_:BA.bind(null,e)}),e.Ra.push((async t=>{t?(e.ma.B_(),og(e)?ag(e):e.Va.set("Unknown")):(await e.ma.stop(),Cb(e))}))),e.ma}function ha(e){return e.fa||(e.fa=(function(n,s,a){const l=ut(n);return l.sa(),new kA(s,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)})(e.datastore,e.asyncQueue,{Zo:()=>Promise.resolve(),Yo:HA.bind(null,e),t_:WA.bind(null,e),ta:FA.bind(null,e),na:$A.bind(null,e)}),e.Ra.push((async t=>{t?(e.fa.B_(),await mh(e)):(await e.fa.stop(),e.Ta.length>0&&(We(to,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))}))),e.fa}class lg{constructor(t,n,s,a,l){this.asyncQueue=t,this.timerId=n,this.targetTimeMs=s,this.op=a,this.removalCallback=l,this.deferred=new ki,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((i=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,n,s,a,l){const i=Date.now()+s,p=new lg(t,n,i,a,l);return p.start(s),p}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Be(_e.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function cg(e,t){if(ps("AsyncQueue",`${t}: ${e}`),jl(e))return new Be(_e.UNAVAILABLE,`${t}: ${e}`);throw e}class al{static emptySet(t){return new al(t.comparator)}constructor(t){this.comparator=t?(n,s)=>t(n,s)||et.comparator(n.key,s.key):(n,s)=>et.comparator(n.key,s.key),this.keyedMap=Bc(),this.sortedSet=new an(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const n=this.keyedMap.get(t);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((n,s)=>(t(n),!1)))}add(t){const n=this.delete(t.key);return n.copy(n.keyedMap.insert(t.key,t),n.sortedSet.insert(t,null))}delete(t){const n=this.get(t);return n?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(n)):this}isEqual(t){if(!(t instanceof al)||this.size!==t.size)return!1;const n=this.sortedSet.getIterator(),s=t.sortedSet.getIterator();for(;n.hasNext();){const a=n.getNext().key,l=s.getNext().key;if(!a.isEqual(l))return!1}return!0}toString(){const t=[];return this.forEach((n=>{t.push(n.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,n){const s=new al;return s.comparator=this.comparator,s.keyedMap=t,s.sortedSet=n,s}}class M3{constructor(){this.ga=new an(et.comparator)}track(t){const n=t.doc.key,s=this.ga.get(n);s?t.type!==0&&s.type===3?this.ga=this.ga.insert(n,t):t.type===3&&s.type!==1?this.ga=this.ga.insert(n,{type:s.type,doc:t.doc}):t.type===2&&s.type===2?this.ga=this.ga.insert(n,{type:2,doc:t.doc}):t.type===2&&s.type===0?this.ga=this.ga.insert(n,{type:0,doc:t.doc}):t.type===1&&s.type===0?this.ga=this.ga.remove(n):t.type===1&&s.type===2?this.ga=this.ga.insert(n,{type:1,doc:s.doc}):t.type===0&&s.type===1?this.ga=this.ga.insert(n,{type:2,doc:t.doc}):rt(63341,{Vt:t,pa:s}):this.ga=this.ga.insert(n,t)}ya(){const t=[];return this.ga.inorderTraversal(((n,s)=>{t.push(s)})),t}}class pl{constructor(t,n,s,a,l,i,p,g,v){this.query=t,this.docs=n,this.oldDocs=s,this.docChanges=a,this.mutatedKeys=l,this.fromCache=i,this.syncStateChanged=p,this.excludesMetadataChanges=g,this.hasCachedResults=v}static fromInitialDocuments(t,n,s,a,l){const i=[];return n.forEach((p=>{i.push({type:0,doc:p})})),new pl(t,n,al.emptySet(n),i,s,a,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&lh(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const n=this.docChanges,s=t.docChanges;if(n.length!==s.length)return!1;for(let a=0;a<n.length;a++)if(n[a].type!==s[a].type||!n[a].doc.isEqual(s[a].doc))return!1;return!0}}class QA{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((t=>t.Da()))}}class XA{constructor(){this.queries=R3(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,s){const a=ut(n),l=a.queries;a.queries=R3(),l.forEach(((i,p)=>{for(const g of p.ba)g.onError(s)}))})(this,new Be(_e.ABORTED,"Firestore shutting down"))}}function R3(){return new so((e=>W4(e)),lh)}async function ug(e,t){const n=ut(e);let s=3;const a=t.query;let l=n.queries.get(a);l?!l.Sa()&&t.Da()&&(s=2):(l=new QA,s=t.Da()?0:1);try{switch(s){case 0:l.wa=await n.onListen(a,!0);break;case 1:l.wa=await n.onListen(a,!1);break;case 2:await n.onFirstRemoteStoreListen(a)}}catch(i){const p=cg(i,`Initialization of query '${Yo(t.query)}' failed`);return void t.onError(p)}n.queries.set(a,l),l.ba.push(t),t.va(n.onlineState),l.wa&&t.Fa(l.wa)&&fg(n)}async function dg(e,t){const n=ut(e),s=t.query;let a=3;const l=n.queries.get(s);if(l){const i=l.ba.indexOf(t);i>=0&&(l.ba.splice(i,1),l.ba.length===0?a=t.Da()?0:1:!l.Sa()&&t.Da()&&(a=2))}switch(a){case 0:return n.queries.delete(s),n.onUnlisten(s,!0);case 1:return n.queries.delete(s),n.onUnlisten(s,!1);case 2:return n.onLastRemoteStoreUnlisten(s);default:return}}function YA(e,t){const n=ut(e);let s=!1;for(const a of t){const l=a.query,i=n.queries.get(l);if(i){for(const p of i.ba)p.Fa(a)&&(s=!0);i.wa=a}}s&&fg(n)}function KA(e,t,n){const s=ut(e),a=s.queries.get(t);if(a)for(const l of a.ba)l.onError(n);s.queries.delete(t)}function fg(e){e.Ca.forEach((t=>{t.next()}))}var fm,k3;(k3=fm||(fm={})).Ma="default",k3.Cache="cache";class hg{constructor(t,n,s){this.query=t,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(t){if(!this.options.includeMetadataChanges){const s=[];for(const a of t.docChanges)a.type!==3&&s.push(a);t=new pl(t.query,t.docs,t.oldDocs,s,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let n=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),n=!0):this.La(t,this.onlineState)&&(this.ka(t),n=!0),this.Na=t,n}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),n=!0),n}La(t,n){if(!t.fromCache||!this.Da())return!0;const s=n!=="Offline";return(!this.options.Ka||!s)&&(!t.docs.isEmpty()||t.hasCachedResults||n==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(t){t=pl.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==fm.Cache}}class Rb{constructor(t){this.key=t}}class kb{constructor(t){this.key=t}}class JA{constructor(t,n){this.query=t,this.Za=n,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=_t(),this.mutatedKeys=_t(),this.eu=G4(t),this.tu=new al(this.eu)}get nu(){return this.Za}ru(t,n){const s=n?n.iu:new M3,a=n?n.tu:this.tu;let l=n?n.mutatedKeys:this.mutatedKeys,i=a,p=!1;const g=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,v=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(t.inorderTraversal(((u,h)=>{const y=a.get(u),x=ch(this.query,h)?h:null,T=!!y&&this.mutatedKeys.has(y.key),_=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let E=!1;y&&x?y.data.isEqual(x.data)?T!==_&&(s.track({type:3,doc:x}),E=!0):this.su(y,x)||(s.track({type:2,doc:x}),E=!0,(g&&this.eu(x,g)>0||v&&this.eu(x,v)<0)&&(p=!0)):!y&&x?(s.track({type:0,doc:x}),E=!0):y&&!x&&(s.track({type:1,doc:y}),E=!0,(g||v)&&(p=!0)),E&&(x?(i=i.add(x),l=_?l.add(u):l.delete(u)):(i=i.delete(u),l=l.delete(u)))})),this.query.limit!==null)for(;i.size>this.query.limit;){const u=this.query.limitType==="F"?i.last():i.first();i=i.delete(u.key),l=l.delete(u.key),s.track({type:1,doc:u})}return{tu:i,iu:s,Ss:p,mutatedKeys:l}}su(t,n){return t.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(t,n,s,a){const l=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const i=t.iu.ya();i.sort(((u,h)=>(function(x,T){const _=E=>{switch(E){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return rt(20277,{Vt:E})}};return _(x)-_(T)})(u.type,h.type)||this.eu(u.doc,h.doc))),this.ou(s),a=a??!1;const p=n&&!a?this._u():[],g=this.Ya.size===0&&this.current&&!a?1:0,v=g!==this.Xa;return this.Xa=g,i.length!==0||v?{snapshot:new pl(this.query,t.tu,l,i,t.mutatedKeys,g===0,v,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:p}:{au:p}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new M3,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(t){return!this.Za.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((n=>this.Za=this.Za.add(n))),t.modifiedDocuments.forEach((n=>{})),t.removedDocuments.forEach((n=>this.Za=this.Za.delete(n))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Ya;this.Ya=_t(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Ya=this.Ya.add(s.key))}));const n=[];return t.forEach((s=>{this.Ya.has(s)||n.push(new kb(s))})),this.Ya.forEach((s=>{t.has(s)||n.push(new Rb(s))})),n}cu(t){this.Za=t.ks,this.Ya=_t();const n=this.ru(t.documents);return this.applyChanges(n,!0)}lu(){return pl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const pg="SyncEngine";class ZA{constructor(t,n,s){this.query=t,this.targetId=n,this.view=s}}class ej{constructor(t){this.key=t,this.hu=!1}}class tj{constructor(t,n,s,a,l,i){this.localStore=t,this.remoteStore=n,this.eventManager=s,this.sharedClientState=a,this.currentUser=l,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new so((p=>W4(p)),lh),this.Iu=new Map,this.Eu=new Set,this.Ru=new an(et.comparator),this.Au=new Map,this.Vu=new Zm,this.du={},this.mu=new Map,this.fu=hl.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function nj(e,t,n=!0){const s=zb(e);let a;const l=s.Tu.get(t);return l?(s.sharedClientState.addLocalQueryTarget(l.targetId),a=l.view.lu()):a=await Ib(s,t,n,!0),a}async function rj(e,t){const n=zb(e);await Ib(n,t,!0,!1)}async function Ib(e,t,n,s){const a=await _A(e.localStore,Ii(t)),l=a.targetId,i=e.sharedClientState.addLocalQueryTarget(l,n);let p;return s&&(p=await ij(e,t,l,i==="current",a.resumeToken)),e.isPrimaryClient&&n&&Tb(e.remoteStore,a),p}async function ij(e,t,n,s,a){e.pu=(h,y,x)=>(async function(_,E,R,P){let B=E.view.ru(R);B.Ss&&(B=await x3(_.localStore,E.query,!1).then((({documents:k})=>E.view.ru(k,B))));const X=P&&P.targetChanges.get(E.targetId),Q=P&&P.targetMismatches.get(E.targetId)!=null,K=E.view.applyChanges(B,_.isPrimaryClient,X,Q);return D3(_,E.targetId,K.au),K.snapshot})(e,h,y,x);const l=await x3(e.localStore,t,!0),i=new JA(t,l.ks),p=i.ru(l.documents),g=bu.createSynthesizedTargetChangeForCurrentChange(n,s&&e.onlineState!=="Offline",a),v=i.applyChanges(p,e.isPrimaryClient,g);D3(e,n,v.au);const u=new ZA(t,n,i);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),v.snapshot}async function sj(e,t,n){const s=ut(e),a=s.Tu.get(t),l=s.Iu.get(a.targetId);if(l.length>1)return s.Iu.set(a.targetId,l.filter((i=>!lh(i,t)))),void s.Tu.delete(t);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(a.targetId),s.sharedClientState.isActiveQueryTarget(a.targetId)||await um(s.localStore,a.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(a.targetId),n&&ig(s.remoteStore,a.targetId),hm(s,a.targetId)})).catch(Al)):(hm(s,a.targetId),await um(s.localStore,a.targetId,!0))}async function aj(e,t){const n=ut(e),s=n.Tu.get(t),a=n.Iu.get(s.targetId);n.isPrimaryClient&&a.length===1&&(n.sharedClientState.removeLocalQueryTarget(s.targetId),ig(n.remoteStore,s.targetId))}async function oj(e,t,n){const s=pj(e);try{const a=await(function(i,p){const g=ut(i),v=Yt.now(),u=p.reduce(((x,T)=>x.add(T.key)),_t());let h,y;return g.persistence.runTransaction("Locally write mutations","readwrite",(x=>{let T=ms(),_=_t();return g.xs.getEntries(x,u).next((E=>{T=E,T.forEach(((R,P)=>{P.isValidDocument()||(_=_.add(R))}))})).next((()=>g.localDocuments.getOverlayedDocuments(x,T))).next((E=>{h=E;const R=[];for(const P of p){const B=xC(P,h.get(P.key).overlayedDocument);B!=null&&R.push(new ga(P.key,B,O4(B.value.mapValue),En.exists(!0)))}return g.mutationQueue.addMutationBatch(x,v,R,p)})).next((E=>{y=E;const R=E.applyToLocalDocumentSet(h,_);return g.documentOverlayCache.saveOverlays(x,E.batchId,R)}))})).then((()=>({batchId:y.batchId,changes:X4(h)})))})(s.localStore,t);s.sharedClientState.addPendingMutation(a.batchId),(function(i,p,g){let v=i.du[i.currentUser.toKey()];v||(v=new an(wt)),v=v.insert(p,g),i.du[i.currentUser.toKey()]=v})(s,a.batchId,n),await wu(s,a.changes),await mh(s.remoteStore)}catch(a){const l=cg(a,"Failed to persist write");n.reject(l)}}async function Db(e,t){const n=ut(e);try{const s=await bA(n.localStore,t);t.targetChanges.forEach(((a,l)=>{const i=n.Au.get(l);i&&(jt(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?i.hu=!0:a.modifiedDocuments.size>0?jt(i.hu,14607):a.removedDocuments.size>0&&(jt(i.hu,42227),i.hu=!1))})),await wu(n,s,t)}catch(s){await Al(s)}}function I3(e,t,n){const s=ut(e);if(s.isPrimaryClient&&n===0||!s.isPrimaryClient&&n===1){const a=[];s.Tu.forEach(((l,i)=>{const p=i.view.va(t);p.snapshot&&a.push(p.snapshot)})),(function(i,p){const g=ut(i);g.onlineState=p;let v=!1;g.queries.forEach(((u,h)=>{for(const y of h.ba)y.va(p)&&(v=!0)})),v&&fg(g)})(s.eventManager,t),a.length&&s.Pu.J_(a),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}async function lj(e,t,n){const s=ut(e);s.sharedClientState.updateQueryState(t,"rejected",n);const a=s.Au.get(t),l=a&&a.key;if(l){let i=new an(et.comparator);i=i.insert(l,Nn.newNoDocument(l,ot.min()));const p=_t().add(l),g=new fh(ot.min(),new Map,new an(wt),i,p);await Db(s,g),s.Ru=s.Ru.remove(l),s.Au.delete(t),mg(s)}else await um(s.localStore,t,!1).then((()=>hm(s,t,n))).catch(Al)}async function cj(e,t){const n=ut(e),s=t.batch.batchId;try{const a=await yA(n.localStore,t);Lb(n,s,null),Nb(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await wu(n,a)}catch(a){await Al(a)}}async function uj(e,t,n){const s=ut(e);try{const a=await(function(i,p){const g=ut(i);return g.persistence.runTransaction("Reject batch","readwrite-primary",(v=>{let u;return g.mutationQueue.lookupMutationBatch(v,p).next((h=>(jt(h!==null,37113),u=h.keys(),g.mutationQueue.removeMutationBatch(v,h)))).next((()=>g.mutationQueue.performConsistencyCheck(v))).next((()=>g.documentOverlayCache.removeOverlaysForBatchId(v,u,p))).next((()=>g.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(v,u))).next((()=>g.localDocuments.getDocuments(v,u)))}))})(s.localStore,t);Lb(s,t,n),Nb(s,t),s.sharedClientState.updateMutationState(t,"rejected",n),await wu(s,a)}catch(a){await Al(a)}}function Nb(e,t){(e.mu.get(t)||[]).forEach((n=>{n.resolve()})),e.mu.delete(t)}function Lb(e,t,n){const s=ut(e);let a=s.du[s.currentUser.toKey()];if(a){const l=a.get(t);l&&(n?l.reject(n):l.resolve(),a=a.remove(t)),s.du[s.currentUser.toKey()]=a}}function hm(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const s of e.Iu.get(t))e.Tu.delete(s),n&&e.Pu.yu(s,n);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach((s=>{e.Vu.containsKey(s)||Pb(e,s)}))}function Pb(e,t){e.Eu.delete(t.path.canonicalString());const n=e.Ru.get(t);n!==null&&(ig(e.remoteStore,n),e.Ru=e.Ru.remove(t),e.Au.delete(n),mg(e))}function D3(e,t,n){for(const s of n)s instanceof Rb?(e.Vu.addReference(s.key,t),dj(e,s)):s instanceof kb?(We(pg,"Document no longer in limbo: "+s.key),e.Vu.removeReference(s.key,t),e.Vu.containsKey(s.key)||Pb(e,s.key)):rt(19791,{wu:s})}function dj(e,t){const n=t.key,s=n.path.canonicalString();e.Ru.get(n)||e.Eu.has(s)||(We(pg,"New document in limbo: "+n),e.Eu.add(s),mg(e))}function mg(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new et(Ot.fromString(t)),s=e.fu.next();e.Au.set(s,new ej(n)),e.Ru=e.Ru.insert(n,s),Tb(e.remoteStore,new ea(Ii(oh(n.path)),s,"TargetPurposeLimboResolution",sh.ce))}}async function wu(e,t,n){const s=ut(e),a=[],l=[],i=[];s.Tu.isEmpty()||(s.Tu.forEach(((p,g)=>{i.push(s.pu(g,t,n).then((v=>{if((v||n)&&s.isPrimaryClient){const u=v?!v.fromCache:n?.targetChanges.get(g.targetId)?.current;s.sharedClientState.updateQueryState(g.targetId,u?"current":"not-current")}if(v){a.push(v);const u=tg.Es(g.targetId,v);l.push(u)}})))})),await Promise.all(i),s.Pu.J_(a),await(async function(g,v){const u=ut(g);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",(h=>Me.forEach(v,(y=>Me.forEach(y.Ts,(x=>u.persistence.referenceDelegate.addReference(h,y.targetId,x))).next((()=>Me.forEach(y.Is,(x=>u.persistence.referenceDelegate.removeReference(h,y.targetId,x)))))))))}catch(h){if(!jl(h))throw h;We(ng,"Failed to update sequence numbers: "+h)}for(const h of v){const y=h.targetId;if(!h.fromCache){const x=u.vs.get(y),T=x.snapshotVersion,_=x.withLastLimboFreeSnapshotVersion(T);u.vs=u.vs.insert(y,_)}}})(s.localStore,l))}async function fj(e,t){const n=ut(e);if(!n.currentUser.isEqual(t)){We(pg,"User change. New user:",t.toKey());const s=await wb(n.localStore,t);n.currentUser=t,(function(l,i){l.mu.forEach((p=>{p.forEach((g=>{g.reject(new Be(_e.CANCELLED,i))}))})),l.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,s.removedBatchIds,s.addedBatchIds),await wu(n,s.Ns)}}function hj(e,t){const n=ut(e),s=n.Au.get(t);if(s&&s.hu)return _t().add(s.key);{let a=_t();const l=n.Iu.get(t);if(!l)return a;for(const i of l){const p=n.Tu.get(i);a=a.unionWith(p.view.nu)}return a}}function zb(e){const t=ut(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Db.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=hj.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=lj.bind(null,t),t.Pu.J_=YA.bind(null,t.eventManager),t.Pu.yu=KA.bind(null,t.eventManager),t}function pj(e){const t=ut(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=cj.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=uj.bind(null,t),t}class Vf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=hh(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,n){return null}Mu(t,n){return null}vu(t){return vA(this.persistence,new pA,t.initialUser,this.serializer)}Cu(t){return new Sb(eg.Vi,this.serializer)}Du(t){return new TA}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Vf.provider={build:()=>new Vf};class mj extends Vf{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,n){jt(this.persistence.referenceDelegate instanceof zf,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new ZC(s,t.asyncQueue,n)}Cu(t){const n=this.cacheSizeBytes!==void 0?cr.withCacheSize(this.cacheSizeBytes):cr.DEFAULT;return new Sb((s=>zf.Vi(s,n)),this.serializer)}}class pm{async initialize(t,n){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>I3(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=fj.bind(null,this.syncEngine),await GA(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new XA})()}createDatastore(t){const n=hh(t.databaseInfo.databaseId),s=MA(t.databaseInfo);return NA(t.authCredentials,t.appCheckCredentials,s,n)}createRemoteStore(t){return(function(s,a,l,i,p){return new PA(s,a,l,i,p)})(this.localStore,this.datastore,t.asyncQueue,(n=>I3(this.syncEngine,n,0)),(function(){return C3.v()?new C3:new EA})())}createSyncEngine(t,n){return(function(a,l,i,p,g,v,u){const h=new tj(a,l,i,p,g,v);return u&&(h.gu=!0),h})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const s=ut(n);We(to,"RemoteStore shutting down."),s.Ea.add(5),await Su(s),s.Aa.shutdown(),s.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}pm.provider={build:()=>new pm};class gg{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):ps("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,n){setTimeout((()=>{this.muted||t(n)}),0)}}let gj=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Be(_e.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const n=await(async function(a,l){const i=ut(a),p={documents:l.map((h=>Pf(i.serializer,h)))},g=await i.jo("BatchGetDocuments",i.serializer.databaseId,Ot.emptyPath(),p,l.length),v=new Map;g.forEach((h=>{const y=PC(i.serializer,h);v.set(y.key.toString(),y)}));const u=[];return l.forEach((h=>{const y=v.get(h.toString());jt(!!y,55234,{key:h}),u.push(y)})),u})(this.datastore,t);return n.forEach((s=>this.recordVersion(s))),n}set(t,n){this.write(n.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,n){try{this.write(n.toMutation(t,this.preconditionForUpdate(t)))}catch(s){this.lastTransactionError=s}this.writtenDocs.add(t.toString())}delete(t){this.write(new yu(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const t=this.readVersions;this.mutations.forEach((n=>{t.delete(n.key.toString())})),t.forEach(((n,s)=>{const a=et.fromPath(s);this.mutations.push(new sb(a,this.precondition(a)))})),await(async function(s,a){const l=ut(s),i={writes:a.map((p=>pb(l.serializer,p)))};await l.Wo("Commit",l.serializer.databaseId,Ot.emptyPath(),i)})(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let n;if(t.isFoundDocument())n=t.version;else{if(!t.isNoDocument())throw rt(50498,{Gu:t.constructor.name});n=ot.min()}const s=this.readVersions.get(t.key.toString());if(s){if(!n.isEqual(s))throw new Be(_e.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),n)}precondition(t){const n=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&n?n.isEqual(ot.min())?En.exists(!1):En.updateTime(n):En.none()}preconditionForUpdate(t){const n=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&n){if(n.isEqual(ot.min()))throw new Be(_e.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return En.updateTime(n)}return En.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};class vj{constructor(t,n,s,a,l){this.asyncQueue=t,this.datastore=n,this.options=s,this.updateFunction=a,this.deferred=l,this.zu=s.maxAttempts,this.M_=new rg(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_((async()=>{const t=new gj(this.datastore),n=this.Ju(t);n&&n.then((s=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(s)})).catch((a=>{this.Zu(a)}))))})).catch((s=>{this.Zu(s)}))}))}Ju(t){try{const n=this.updateFunction(t);return!gu(n)&&n.catch&&n.then?n:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(n){return this.deferred.reject(n),null}}Zu(t){this.zu>0&&this.Xu(t)?(this.zu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Hu(),Promise.resolve())))):this.deferred.reject(t)}Xu(t){if(t?.name==="FirebaseError"){const n=t.code;return n==="aborted"||n==="failed-precondition"||n==="already-exists"||!ab(n)}return!1}}const pa="FirestoreClient";class yj{constructor(t,n,s,a,l){this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=s,this._databaseInfo=a,this.user=Xn.UNAUTHENTICATED,this.clientId=qm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=l,this.authCredentials.start(s,(async i=>{We(pa,"Received user=",i.uid),await this.authCredentialListener(i),this.user=i})),this.appCheckCredentials.start(s,(i=>(We(pa,"Received new app check token=",i),this.appCheckCredentialListener(i,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new ki;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(n){const s=cg(n,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}async function Op(e,t){e.asyncQueue.verifyOperationInProgress(),We(pa,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let s=n.initialUser;e.setCredentialChangeListener((async a=>{s.isEqual(a)||(await wb(t.localStore,a),s=a)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function N3(e,t){e.asyncQueue.verifyOperationInProgress();const n=await bj(e);We(pa,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((s=>j3(t.remoteStore,s))),e.setAppCheckTokenChangeListener(((s,a)=>j3(t.remoteStore,a))),e._onlineComponents=t}async function bj(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){We(pa,"Using user provided OfflineComponentProvider");try{await Op(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!(function(a){return a.name==="FirebaseError"?a.code===_e.FAILED_PRECONDITION||a.code===_e.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11})(n))throw n;eo("Error using user provided cache. Falling back to memory cache: "+n),await Op(e,new Vf)}}else We(pa,"Using default OfflineComponentProvider"),await Op(e,new mj(void 0));return e._offlineComponents}async function vg(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(We(pa,"Using user provided OnlineComponentProvider"),await N3(e,e._uninitializedComponentsProvider._online)):(We(pa,"Using default OnlineComponentProvider"),await N3(e,new pm))),e._onlineComponents}function Sj(e){return vg(e).then((t=>t.syncEngine))}function wj(e){return vg(e).then((t=>t.datastore))}async function Bf(e){const t=await vg(e),n=t.eventManager;return n.onListen=nj.bind(null,t.syncEngine),n.onUnlisten=sj.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=rj.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=aj.bind(null,t.syncEngine),n}function _j(e,t,n,s){const a=new gg(s),l=new hg(t,a,n);return e.asyncQueue.enqueueAndForget((async()=>ug(await Bf(e),l))),()=>{a.Nu(),e.asyncQueue.enqueueAndForget((async()=>dg(await Bf(e),l)))}}function xj(e,t,n={}){const s=new ki;return e.asyncQueue.enqueueAndForget((async()=>(function(l,i,p,g,v){const u=new gg({next:y=>{u.Nu(),i.enqueueAndForget((()=>dg(l,h)));const x=y.docs.has(p);!x&&y.fromCache?v.reject(new Be(_e.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&y.fromCache&&g&&g.source==="server"?v.reject(new Be(_e.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):v.resolve(y)},error:y=>v.reject(y)}),h=new hg(oh(p.path),u,{includeMetadataChanges:!0,Ka:!0});return ug(l,h)})(await Bf(e),e.asyncQueue,t,n,s))),s.promise}function Tj(e,t,n={}){const s=new ki;return e.asyncQueue.enqueueAndForget((async()=>(function(l,i,p,g,v){const u=new gg({next:y=>{u.Nu(),i.enqueueAndForget((()=>dg(l,h))),y.fromCache&&g.source==="server"?v.reject(new Be(_e.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):v.resolve(y)},error:y=>v.reject(y)}),h=new hg(p,u,{includeMetadataChanges:!0,Ka:!0});return ug(l,h)})(await Bf(e),e.asyncQueue,t,n,s))),s.promise}function Ej(e,t){const n=new ki;return e.asyncQueue.enqueueAndForget((async()=>oj(await Sj(e),t,n))),n.promise}function Cj(e,t,n){const s=new ki;return e.asyncQueue.enqueueAndForget((async()=>{const a=await wj(e);new vj(e.asyncQueue,a,n,t,s).ju()})),s.promise}function Ob(e){const t={};return e.timeoutSeconds!==void 0&&(t.timeoutSeconds=e.timeoutSeconds),t}const Aj="ComponentProvider",L3=new Map;function jj(e,t,n,s,a){return new $E(e,t,n,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,Ob(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator,s)}const Vb="firestore.googleapis.com",P3=!0;class z3{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new Be(_e.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Vb,this.ssl=P3}else this.host=t.host,this.ssl=t.ssl??P3;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=bb;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<KC)throw new Be(_e.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}NE("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ob(t.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new Be(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new Be(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new Be(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(s,a){return s.timeoutSeconds===a.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class _u{constructor(t,n,s,a){this._authCredentials=t,this._appCheckCredentials=n,this._databaseId=s,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new z3({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Be(_e.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new Be(_e.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new z3(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new TE;switch(s.type){case"firstParty":return new jE(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Be(_e.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const s=L3.get(n);s&&(We(Aj,"Removing Datastore"),L3.delete(n),s.terminate())})(this),Promise.resolve()}}function Mj(e,t,n,s={}){e=Fn(e,_u);const a=xl(t),l=e._getSettings(),i={...l,emulatorOptions:e._getEmulatorOptions()},p=`${t}:${n}`;a&&(P8(`https://${p}`),z8("Firestore",!0)),l.host!==Vb&&l.host!==p&&eo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const g={...l,host:p,ssl:a,emulatorOptions:s};if(!la(g,i)&&(e._setSettings(g),s.mockUserToken)){let v,u;if(typeof s.mockUserToken=="string")v=s.mockUserToken,u=Xn.MOCK_USER;else{v=Xx(s.mockUserToken,e._app?.options.projectId);const h=s.mockUserToken.sub||s.mockUserToken.user_id;if(!h)throw new Be(_e.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Xn(h)}e._authCredentials=new EE(new A4(v,u))}}class zi{constructor(t,n,s){this.converter=n,this._query=s,this.type="query",this.firestore=t}withConverter(t){return new zi(this.firestore,t,this._query)}}class sn{constructor(t,n,s){this.converter=n,this._key=s,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new aa(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new sn(this.firestore,t,this._key)}toJSON(){return{type:sn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,n,s){if(mu(n,sn._jsonSchema))return new sn(t,s||null,new et(Ot.fromString(n.referencePath)))}}sn._jsonSchemaVersion="firestore/documentReference/1.0",sn._jsonSchema={type:Cn("string",sn._jsonSchemaVersion),referencePath:Cn("string")};class aa extends zi{constructor(t,n,s){super(t,n,oh(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new sn(this.firestore,null,new et(t))}withConverter(t){return new aa(this.firestore,t,this._path)}}function it(e,t,...n){if(e=mn(e),Hm("collection","path",t),e instanceof _u){const s=Ot.fromString(t,...n);return Yy(s),new aa(e,null,s)}{if(!(e instanceof sn||e instanceof aa))throw new Be(_e.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(Ot.fromString(t,...n));return Yy(s),new aa(e.firestore,null,s)}}function Rj(e,t){if(e=Fn(e,_u),Hm("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Be(_e.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new zi(e,null,(function(s){return new io(Ot.emptyPath(),s)})(t))}function Fe(e,t,...n){if(e=mn(e),arguments.length===1&&(t=qm.newId()),Hm("doc","path",t),e instanceof _u){const s=Ot.fromString(t,...n);return Xy(s),new sn(e,null,new et(s))}{if(!(e instanceof sn||e instanceof aa))throw new Be(_e.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(Ot.fromString(t,...n));return Xy(s),new sn(e.firestore,e instanceof aa?e.converter:null,new et(s))}}const O3="AsyncQueue";class V3{constructor(t=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new rg(this,"async_queue_retry"),this._c=()=>{const s=zp();s&&We(O3,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=t;const n=zp();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const n=zp();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new ki;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Yu.push(t),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(t){if(!jl(t))throw t;We(O3,"Operation failed with retryable error: "+t)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const n=this.ac.then((()=>(this.rc=!0,t().catch((s=>{throw this.nc=s,this.rc=!1,ps("INTERNAL UNHANDLED ERROR: ",B3(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=n,n}enqueueAfterDelay(t,n,s){this.uc(),this.oc.indexOf(t)>-1&&(n=0);const a=lg.createAndSchedule(this,t,n,s,(l=>this.hc(l)));return this.tc.push(a),a}uc(){this.nc&&rt(47125,{Pc:B3(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const n of this.tc)if(n.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((n,s)=>n.targetTimeMs-s.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),t!=="all"&&n.timerId===t)break;return this.Tc()}))}Rc(t){this.oc.push(t)}hc(t){const n=this.tc.indexOf(t);this.tc.splice(n,1)}}function B3(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+`
`+e.stack),t}class oi extends _u{constructor(t,n,s,a){super(t,n,s,a),this.type="firestore",this._queue=new V3,this._persistenceKey=a?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new V3(t),this._firestoreClient=void 0,await t}}}function kj(e,t){const n=typeof e=="object"?e:U8(),s=typeof e=="string"?e:Rf,a=Rm(n,"firestore").getImmediate({identifier:s});if(!a._initialized){const l=Gx("firestore");l&&Mj(a,...l)}return a}function Rl(e){if(e._terminated)throw new Be(_e.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||Ij(e),e._firestoreClient}function Ij(e){const t=e._freezeSettings(),n=jj(e._databaseId,e._app?.options.appId||"",e._persistenceKey,e._app?.options.apiKey,t);e._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new yj(e._authCredentials,e._appCheckCredentials,e._queue,n,e._componentsProvider&&(function(a){const l=a?._online.build();return{_offline:a?._offline.build(l),_online:l}})(e._componentsProvider))}class Sr{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Sr($n.fromBase64String(t))}catch(n){throw new Be(_e.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(t){return new Sr($n.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Sr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(mu(t,Sr._jsonSchema))return Sr.fromBase64String(t.bytes)}}Sr._jsonSchemaVersion="firestore/bytes/1.0",Sr._jsonSchema={type:Cn("string",Sr._jsonSchemaVersion),bytes:Cn("string")};class xu{constructor(...t){for(let n=0;n<t.length;++n)if(t[n].length===0)throw new Be(_e.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Hn(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Tu{constructor(t){this._methodName=t}}class Di{constructor(t,n){if(!isFinite(t)||t<-90||t>90)throw new Be(_e.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new Be(_e.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return wt(this._lat,t._lat)||wt(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Di._jsonSchemaVersion}}static fromJSON(t){if(mu(t,Di._jsonSchema))return new Di(t.latitude,t.longitude)}}Di._jsonSchemaVersion="firestore/geoPoint/1.0",Di._jsonSchema={type:Cn("string",Di._jsonSchemaVersion),latitude:Cn("number"),longitude:Cn("number")};class si{constructor(t){this._values=(t||[]).map((n=>n))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(s,a){if(s.length!==a.length)return!1;for(let l=0;l<s.length;++l)if(s[l]!==a[l])return!1;return!0})(this._values,t._values)}toJSON(){return{type:si._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(mu(t,si._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((n=>typeof n=="number")))return new si(t.vectorValues);throw new Be(_e.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}si._jsonSchemaVersion="firestore/vectorValue/1.0",si._jsonSchema={type:Cn("string",si._jsonSchemaVersion),vectorValues:Cn("object")};const Dj=/^__.*__$/;class Nj{constructor(t,n,s){this.data=t,this.fieldMask=n,this.fieldTransforms=s}toMutation(t,n){return this.fieldMask!==null?new ga(t,this.data,this.fieldMask,n,this.fieldTransforms):new vu(t,this.data,n,this.fieldTransforms)}}class Bb{constructor(t,n,s){this.data=t,this.fieldMask=n,this.fieldTransforms=s}toMutation(t,n){return new ga(t,this.data,this.fieldMask,n,this.fieldTransforms)}}function Ub(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw rt(40011,{dataSource:e})}}class gh{constructor(t,n,s,a,l,i){this.settings=t,this.databaseId=n,this.serializer=s,this.ignoreUndefinedProperties=a,l===void 0&&this.validatePath(),this.fieldTransforms=l||[],this.fieldMask=i||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(t){return new gh({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(t){const n=this.path?.child(t),s=this.contextWith({path:n,arrayElement:!1});return s.validatePathSegment(t),s}childContextForFieldPath(t){const n=this.path?.child(t),s=this.contextWith({path:n,arrayElement:!1});return s.validatePath(),s}childContextForArray(t){return this.contextWith({path:void 0,arrayElement:!0})}createError(t){return Uf(t,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(t){return this.fieldMask.find((n=>t.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>t.isPrefixOf(n.field)))!==void 0}validatePath(){if(this.path)for(let t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))}validatePathSegment(t){if(t.length===0)throw this.createError("Document fields must not be empty");if(Ub(this.dataSource)&&Dj.test(t))throw this.createError('Document fields cannot begin and end with "__"')}}class Lj{constructor(t,n,s){this.databaseId=t,this.ignoreUndefinedProperties=n,this.serializer=s||hh(t)}createContext(t,n,s,a=!1){return new gh({dataSource:t,methodName:n,targetDoc:s,path:Hn.emptyPath(),arrayElement:!1,hasConverter:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function kl(e){const t=e._freezeSettings(),n=hh(e._databaseId);return new Lj(e._databaseId,!!t.ignoreUndefinedProperties,n)}function vh(e,t,n,s,a,l={}){const i=e.createContext(l.merge||l.mergeFields?2:0,t,n,a);_g("Data must be an object, but it was:",i,s);const p=qb(s,i);let g,v;if(l.merge)g=new wr(i.fieldMask),v=i.fieldTransforms;else if(l.mergeFields){const u=[];for(const h of l.mergeFields){const y=no(t,h,n);if(!i.contains(y))throw new Be(_e.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);$b(u,y)||u.push(y)}g=new wr(u),v=i.fieldTransforms.filter((h=>g.covers(h.field)))}else g=null,v=i.fieldTransforms;return new Nj(new Zn(p),g,v)}class yh extends Tu{_toFieldTransform(t){if(t.dataSource!==2)throw t.dataSource===1?t.createError(`${this._methodName}() can only appear at the top level of your update data`):t.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof yh}}function Pj(e,t,n){return new gh({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class yg extends Tu{_toFieldTransform(t){return new nb(t.path,new iu)}isEqual(t){return t instanceof yg}}class bg extends Tu{constructor(t,n){super(t),this.Ac=n}_toFieldTransform(t){const n=Pj(this,t,!0),s=this.Ac.map((l=>Il(l,n))),a=new fl(s);return new nb(t.path,a)}isEqual(t){return t instanceof bg&&la(this.Ac,t.Ac)}}function Sg(e,t,n,s){const a=e.createContext(1,t,n);_g("Data must be an object, but it was:",a,s);const l=[],i=Zn.empty();ma(s,((g,v)=>{const u=Fb(t,g,n);v=mn(v);const h=a.childContextForFieldPath(u);if(v instanceof yh)l.push(u);else{const y=Il(v,h);y!=null&&(l.push(u),i.set(u,y))}}));const p=new wr(l);return new Bb(i,p,a.fieldTransforms)}function wg(e,t,n,s,a,l){const i=e.createContext(1,t,n),p=[no(t,s,n)],g=[a];if(l.length%2!=0)throw new Be(_e.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<l.length;y+=2)p.push(no(t,l[y])),g.push(l[y+1]);const v=[],u=Zn.empty();for(let y=p.length-1;y>=0;--y)if(!$b(v,p[y])){const x=p[y];let T=g[y];T=mn(T);const _=i.childContextForFieldPath(x);if(T instanceof yh)v.push(x);else{const E=Il(T,_);E!=null&&(v.push(x),u.set(x,E))}}const h=new wr(v);return new Bb(u,h,i.fieldTransforms)}function zj(e,t,n,s=!1){return Il(n,e.createContext(s?4:3,t))}function Il(e,t){if(Hb(e=mn(e)))return _g("Unsupported field value:",t,e),qb(e,t);if(e instanceof Tu)return(function(s,a){if(!Ub(a.dataSource))throw a.createError(`${s._methodName}() can only be used with update() and set()`);if(!a.path)throw a.createError(`${s._methodName}() is not currently supported inside arrays`);const l=s._toFieldTransform(a);l&&a.fieldTransforms.push(l)})(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&t.dataSource!==4)throw t.createError("Nested arrays are not supported");return(function(s,a){const l=[];let i=0;for(const p of s){let g=Il(p,a.childContextForArray(i));g==null&&(g={nullValue:"NULL_VALUE"}),l.push(g),i++}return{arrayValue:{values:l}}})(e,t)}return(function(s,a){if((s=mn(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return vC(a.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const l=Yt.fromDate(s);return{timestampValue:Lf(a.serializer,l)}}if(s instanceof Yt){const l=new Yt(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Lf(a.serializer,l)}}if(s instanceof Di)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Sr)return{bytesValue:ub(a.serializer,s._byteString)};if(s instanceof sn){const l=a.databaseId,i=s.firestore._databaseId;if(!i.isEqual(l))throw a.createError(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:Jm(s.firestore._databaseId||a.databaseId,s._key.path)}}if(s instanceof si)return(function(i,p){const g=i instanceof si?i.toArray():i;return{mapValue:{fields:{[P4]:{stringValue:z4},[kf]:{arrayValue:{values:g.map((u=>{if(typeof u!="number")throw p.createError("VectorValues must only contain numeric values.");return Xm(p.serializer,u)}))}}}}}})(s,a);if(yb(s))return s._toProto(a.serializer);throw a.createError(`Unsupported field value: ${ih(s)}`)})(e,t)}function qb(e,t){const n={};return R4(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ma(e,((s,a)=>{const l=Il(a,t.childContextForField(s));l!=null&&(n[s]=l)})),{mapValue:{fields:n}}}function Hb(e){return!(typeof e!="object"||e===null||e instanceof Array||e instanceof Date||e instanceof Yt||e instanceof Di||e instanceof Sr||e instanceof sn||e instanceof Tu||e instanceof si||yb(e))}function _g(e,t,n){if(!Hb(n)||!j4(n)){const s=ih(n);throw s==="an object"?t.createError(e+" a custom object"):t.createError(e+" "+s)}}function no(e,t,n){if((t=mn(t))instanceof xu)return t._internalPath;if(typeof t=="string")return Fb(e,t);throw Uf("Field path arguments must be of type string or ",e,!1,void 0,n)}const Oj=new RegExp("[~\\*/\\[\\]]");function Fb(e,t,n){if(t.search(Oj)>=0)throw Uf(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new xu(...t.split("."))._internalPath}catch{throw Uf(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Uf(e,t,n,s,a){const l=s&&!s.isEmpty(),i=a!==void 0;let p=`Function ${t}() called with invalid data`;n&&(p+=" (via `toFirestore()`)"),p+=". ";let g="";return(l||i)&&(g+=" (found",l&&(g+=` in field ${s}`),i&&(g+=` in document ${a}`),g+=")"),new Be(_e.INVALID_ARGUMENT,p+e+g)}function $b(e,t){return e.some((n=>n.isEqual(t)))}class Wb{convertValue(t,n="none"){switch(fa(t)){case 0:return null;case 1:return t.booleanValue;case 2:return pn(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,n);case 5:return t.stringValue;case 6:return this.convertBytes(da(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,n);case 11:return this.convertObject(t.mapValue,n);case 10:return this.convertVectorValue(t.mapValue);default:throw rt(62114,{value:t})}}convertObject(t,n){return this.convertObjectMap(t.fields,n)}convertObjectMap(t,n="none"){const s={};return ma(t,((a,l)=>{s[a]=this.convertValue(l,n)})),s}convertVectorValue(t){const n=t.fields?.[kf].arrayValue?.values?.map((s=>pn(s.doubleValue)));return new si(n)}convertGeoPoint(t){return new Di(pn(t.latitude),pn(t.longitude))}convertArray(t,n){return(t.values||[]).map((s=>this.convertValue(s,n)))}convertServerTimestamp(t,n){switch(n){case"previous":const s=ah(t);return s==null?null:this.convertValue(s,n);case"estimate":return this.convertTimestamp(eu(t));default:return null}}convertTimestamp(t){const n=ua(t);return new Yt(n.seconds,n.nanos)}convertDocumentKey(t,n){const s=Ot.fromString(t);jt(vb(s),9688,{name:t});const a=new tu(s.get(1),s.get(3)),l=new et(s.popFirst(5));return a.isEqual(n)||ps(`Document ${l} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),l}}class bh extends Wb{constructor(t){super(),this.firestore=t}convertBytes(t){return new Sr(t)}convertReference(t){const n=this.convertDocumentKey(t,this.firestore._databaseId);return new sn(this.firestore,null,n)}}function Ga(){return new yg("serverTimestamp")}function Vj(...e){return new bg("arrayUnion",e)}const U3="@firebase/firestore",q3="4.11.0";function H3(e){return(function(n,s){if(typeof n!="object"||n===null)return!1;const a=n;for(const l of s)if(l in a&&typeof a[l]=="function")return!0;return!1})(e,["next","error","complete"])}class qf{constructor(t,n,s,a,l){this._firestore=t,this._userDataWriter=n,this._key=s,this._document=a,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new sn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new Bj(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(t){if(this._document){const n=this._document.data.field(no("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n)}}}class Bj extends qf{data(){return super.data()}}function Gb(e){if(e.limitType==="L"&&e.explicitOrderBy.length===0)throw new Be(_e.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class xg{}class Tg extends xg{}function Kt(e,t,...n){let s=[];t instanceof xg&&s.push(t),s=s.concat(n),(function(l){const i=l.filter((g=>g instanceof Eg)).length,p=l.filter((g=>g instanceof Sh)).length;if(i>1||i>0&&p>0)throw new Be(_e.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(s);for(const a of s)e=a._apply(e);return e}class Sh extends Tg{constructor(t,n,s){super(),this._field=t,this._op=n,this._value=s,this.type="where"}static _create(t,n,s){return new Sh(t,n,s)}_apply(t){const n=this._parse(t);return Qb(t._query,n),new zi(t.firestore,t.converter,am(t._query,n))}_parse(t){const n=kl(t.firestore);return(function(l,i,p,g,v,u,h){let y;if(v.isKeyField()){if(u==="array-contains"||u==="array-contains-any")throw new Be(_e.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if(u==="in"||u==="not-in"){$3(h,u);const T=[];for(const _ of h)T.push(F3(g,l,_));y={arrayValue:{values:T}}}else y=F3(g,l,h)}else u!=="in"&&u!=="not-in"&&u!=="array-contains-any"||$3(h,u),y=zj(p,i,h,u==="in"||u==="not-in");return Tn.create(v,u,y)})(t._query,"where",n,t.firestore._databaseId,this._field,this._op,this._value)}}function us(e,t,n){const s=t,a=no("where",e);return Sh._create(a,s,n)}class Eg extends xg{constructor(t,n){super(),this.type=t,this._queryConstraints=n}static _create(t,n){return new Eg(t,n)}_parse(t){const n=this._queryConstraints.map((s=>s._parse(t))).filter((s=>s.getFilters().length>0));return n.length===1?n[0]:ai.create(n,this._getOperator())}_apply(t){const n=this._parse(t);return n.getFilters().length===0?t:((function(a,l){let i=a;const p=l.getFlattenedFilters();for(const g of p)Qb(i,g),i=am(i,g)})(t._query,n),new zi(t.firestore,t.converter,am(t._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Cg extends Tg{constructor(t,n){super(),this._field=t,this._direction=n,this.type="orderBy"}static _create(t,n){return new Cg(t,n)}_apply(t){const n=(function(a,l,i){if(a.startAt!==null)throw new Be(_e.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new Be(_e.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ru(l,i)})(t._query,this._field,this._direction);return new zi(t.firestore,t.converter,cC(t._query,n))}}function Ln(e,t="asc"){const n=t,s=no("orderBy",e);return Cg._create(s,n)}class Ag extends Tg{constructor(t,n,s){super(),this.type=t,this._limit=n,this._limitType=s}static _create(t,n,s){return new Ag(t,n,s)}_apply(t){return new zi(t.firestore,t.converter,Df(t._query,this._limit,this._limitType))}}function Uj(e){return Ag._create("limit",e,"F")}function F3(e,t,n){if(typeof(n=mn(n))=="string"){if(n==="")throw new Be(_e.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!$4(t)&&n.indexOf("/")!==-1)throw new Be(_e.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=t.path.child(Ot.fromString(n));if(!et.isDocumentKey(s))throw new Be(_e.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return i3(e,new et(s))}if(n instanceof sn)return i3(e,n._key);throw new Be(_e.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ih(n)}.`)}function $3(e,t){if(!Array.isArray(e)||e.length===0)throw new Be(_e.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Qb(e,t){const n=(function(a,l){for(const i of a)for(const p of i.getFlattenedFilters())if(l.indexOf(p.op)>=0)return p.op;return null})(e.filters,(function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(n!==null)throw n===t.op?new Be(_e.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Be(_e.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function wh(e,t,n){let s;return s=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,s}class qj extends Wb{constructor(t){super(),this.firestore=t}convertBytes(t){return new Sr(t)}convertReference(t){const n=this.convertDocumentKey(t,this.firestore._databaseId);return new sn(this.firestore,null,n)}}class Zo{constructor(t,n){this.hasPendingWrites=t,this.fromCache=n}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class oa extends qf{constructor(t,n,s,a,l,i){super(t,n,s,a,i),this._firestore=t,this._firestoreImpl=t,this.metadata=l}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const n=new yf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,n={}){if(this._document){const s=this._document.data.field(no("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Be(_e.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,n={};return n.type=oa._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}oa._jsonSchemaVersion="firestore/documentSnapshot/1.0",oa._jsonSchema={type:Cn("string",oa._jsonSchemaVersion),bundleSource:Cn("string","DocumentSnapshot"),bundleName:Cn("string"),bundle:Cn("string")};class yf extends oa{data(t={}){return super.data(t)}}class Xa{constructor(t,n,s,a){this._firestore=t,this._userDataWriter=n,this._snapshot=a,this.metadata=new Zo(a.hasPendingWrites,a.fromCache),this.query=s}get docs(){const t=[];return this.forEach((n=>t.push(n))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,n){this._snapshot.docs.forEach((s=>{t.call(n,new yf(this._firestore,this._userDataWriter,s.key,s,new Zo(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const n=!!t.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Be(_e.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(a,l){if(a._snapshot.oldDocs.isEmpty()){let i=0;return a._snapshot.docChanges.map((p=>{const g=new yf(a._firestore,a._userDataWriter,p.doc.key,p.doc,new Zo(a._snapshot.mutatedKeys.has(p.doc.key),a._snapshot.fromCache),a.query.converter);return p.doc,{type:"added",doc:g,oldIndex:-1,newIndex:i++}}))}{let i=a._snapshot.oldDocs;return a._snapshot.docChanges.filter((p=>l||p.type!==3)).map((p=>{const g=new yf(a._firestore,a._userDataWriter,p.doc.key,p.doc,new Zo(a._snapshot.mutatedKeys.has(p.doc.key),a._snapshot.fromCache),a.query.converter);let v=-1,u=-1;return p.type!==0&&(v=i.indexOf(p.doc.key),i=i.delete(p.doc.key)),p.type!==1&&(i=i.add(p.doc),u=i.indexOf(p.doc.key)),{type:Hj(p.type),doc:g,oldIndex:v,newIndex:u}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Be(_e.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=Xa._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=qm.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],s=[],a=[];return this.docs.forEach((l=>{l._document!==null&&(n.push(l._document),s.push(this._userDataWriter.convertObjectMap(l._document.data.value.mapValue.fields,"previous")),a.push(l.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function Hj(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return rt(61501,{type:e})}}Xa._jsonSchemaVersion="firestore/querySnapshot/1.0",Xa._jsonSchema={type:Cn("string",Xa._jsonSchemaVersion),bundleSource:Cn("string","QuerySnapshot"),bundleName:Cn("string"),bundle:Cn("string")};const Fj={maxAttempts:5};class $j{constructor(t,n){this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=kl(t)}set(t,n,s){this._verifyNotCommitted();const a=ta(t,this._firestore),l=wh(a.converter,n,s),i=vh(this._dataReader,"WriteBatch.set",a._key,l,a.converter!==null,s);return this._mutations.push(i.toMutation(a._key,En.none())),this}update(t,n,s,...a){this._verifyNotCommitted();const l=ta(t,this._firestore);let i;return i=typeof(n=mn(n))=="string"||n instanceof xu?wg(this._dataReader,"WriteBatch.update",l._key,n,s,a):Sg(this._dataReader,"WriteBatch.update",l._key,n),this._mutations.push(i.toMutation(l._key,En.exists(!0))),this}delete(t){this._verifyNotCommitted();const n=ta(t,this._firestore);return this._mutations=this._mutations.concat(new yu(n._key,En.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Be(_e.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ta(e,t){if((e=mn(e)).firestore!==t)throw new Be(_e.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Wj{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=kl(t)}get(t){const n=ta(t,this._firestore),s=new qj(this._firestore);return this._transaction.lookup([n._key]).then((a=>{if(!a||a.length!==1)return rt(24041);const l=a[0];if(l.isFoundDocument())return new qf(this._firestore,s,l.key,l,n.converter);if(l.isNoDocument())return new qf(this._firestore,s,n._key,null,n.converter);throw rt(18433,{doc:l})}))}set(t,n,s){const a=ta(t,this._firestore),l=wh(a.converter,n,s),i=vh(this._dataReader,"Transaction.set",a._key,l,a.converter!==null,s);return this._transaction.set(a._key,i),this}update(t,n,s,...a){const l=ta(t,this._firestore);let i;return i=typeof(n=mn(n))=="string"||n instanceof xu?wg(this._dataReader,"Transaction.update",l._key,n,s,a):Sg(this._dataReader,"Transaction.update",l._key,n),this._transaction.update(l._key,i),this}delete(t){const n=ta(t,this._firestore);return this._transaction.delete(n._key),this}}class Gj extends Wj{constructor(t,n){super(t,n),this._firestore=t}get(t){const n=ta(t,this._firestore),s=new bh(this._firestore);return super.get(t).then((a=>new oa(this._firestore,s,n._key,a._document,new Zo(!1,!1),n.converter)))}}function Xb(e,t,n){e=Fn(e,oi);const s={...Fj,...n};(function(i){if(i.maxAttempts<1)throw new Be(_e.INVALID_ARGUMENT,"Max attempts must be at least 1")})(s);const a=Rl(e);return Cj(a,(l=>t(new Gj(e,l))),s)}function Mt(e){e=Fn(e,sn);const t=Fn(e.firestore,oi),n=Rl(t);return xj(n,e._key).then((s=>Kb(t,e,s)))}function ct(e){e=Fn(e,zi);const t=Fn(e.firestore,oi),n=Rl(t),s=new bh(t);return Gb(e._query),Tj(n,e._query).then((a=>new Xa(t,s,e,a)))}function At(e,t,n){e=Fn(e,sn);const s=Fn(e.firestore,oi),a=wh(e.converter,t,n),l=kl(s);return Cu(s,[vh(l,"setDoc",e._key,a,e.converter!==null,n).toMutation(e._key,En.none())])}function Eu(e,t,n,...s){e=Fn(e,sn);const a=Fn(e.firestore,oi),l=kl(a);let i;return i=typeof(t=mn(t))=="string"||t instanceof xu?wg(l,"updateDoc",e._key,t,n,s):Sg(l,"updateDoc",e._key,t),Cu(a,[i.toMutation(e._key,En.exists(!0))])}function jg(e){return Cu(Fn(e.firestore,oi),[new yu(e._key,En.none())])}function Yb(e,t){const n=Fn(e.firestore,oi),s=Fe(e),a=wh(e.converter,t),l=kl(e.firestore);return Cu(n,[vh(l,"addDoc",s._key,a,e.converter!==null,{}).toMutation(s._key,En.exists(!1))]).then((()=>s))}function Hf(e,...t){e=mn(e);let n={includeMetadataChanges:!1,source:"default"},s=0;typeof t[s]!="object"||H3(t[s])||(n=t[s++]);const a={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(H3(t[s])){const v=t[s];t[s]=v.next?.bind(v),t[s+1]=v.error?.bind(v),t[s+2]=v.complete?.bind(v)}let l,i,p;if(e instanceof sn)i=Fn(e.firestore,oi),p=oh(e._key.path),l={next:v=>{t[s]&&t[s](Kb(i,e,v))},error:t[s+1],complete:t[s+2]};else{const v=Fn(e,zi);i=Fn(v.firestore,oi),p=v._query;const u=new bh(i);l={next:h=>{t[s]&&t[s](new Xa(i,u,v,h))},error:t[s+1],complete:t[s+2]},Gb(e._query)}const g=Rl(i);return _j(g,p,a,l)}function Cu(e,t){const n=Rl(e);return Ej(n,t)}function Kb(e,t,n){const s=n.docs.get(t._key),a=new bh(e);return new oa(e,a,t._key,s,new Zo(n.hasPendingWrites,n.fromCache),t.converter)}function Vp(e){return e=Fn(e,oi),Rl(e),new $j(e,(t=>Cu(e,t)))}(function(t,n=!0){xE(Tl),ol(new Ka("firestore",((s,{instanceIdentifier:a,options:l})=>{const i=s.getProvider("app").getImmediate(),p=new oi(new CE(s.getProvider("auth-internal")),new ME(i,s.getProvider("app-check-internal")),WE(i,a),i);return l={useFetchStreams:n,...l},p._setSettings(l),p}),"PUBLIC").setMultipleInstances(!0)),ia(U3,q3,t),ia(U3,q3,"esm2020")})();var Qj="firebase",Xj="12.9.0";ia(Qj,Xj,"app");const Yj={apiKey:"AIzaSyAlxvGxLIBUrVO3WWmEcslFpSygeYVeHpY",authDomain:"pantherlearn-d6f7c.firebaseapp.com",projectId:"pantherlearn-d6f7c",storageBucket:"pantherlearn-d6f7c.firebasestorage.app",messagingSenderId:"293205883325",appId:"1:293205883325:web:c0c21ece0b4fc26f673ad4",measurementId:"G-5Y6BKF09HF"},Jb=B8(Yj),Mg=wE(Jb),be=kj(Jb),Kj=new ss,Jj=()=>RT(Mg,Kj),Zb=()=>uT(Mg),eS=M.createContext(null);function Zj(e){if(!e)return null;const t=e.toLowerCase();return t.endsWith("@paps.net")?(t.split("@")[0].match(/\d/g)||[]).length>=3?"student":"teacher":null}function eM({children:e}){const[t,n]=M.useState(null),[s,a]=M.useState(null),[l,i]=M.useState(null),[p,g]=M.useState(!0),[v,u]=M.useState(null);M.useEffect(()=>cT(Mg,async T=>{if(T){const _=T.email,E=Zj(_);if(!E){u("Access restricted to @paps.net accounts only."),await Zb(),n(null),a(null),i(null),g(!1);return}u(null),n(T),a(E);const R=Fe(be,"users",T.uid),P=await Mt(R);if(P.exists()){const B=P.data();i(B.nickname||null),B.role!==E&&await At(R,{role:E},{merge:!0})}else await At(R,{email:T.email,displayName:T.displayName,photoURL:T.photoURL,role:E,nickname:null,createdAt:new Date}),i(null);if(E==="student")try{const B=await ct(Kt(it(be,"enrollments"),us("email","==",_.toLowerCase())));if(!B.empty){const X=await Mt(R),Q=X.exists()?X.data().enrolledCourses||{}:{},K={};if(Array.isArray(Q))Q.forEach(I=>{typeof I=="string"&&I&&(K[I]=!0)});else if(typeof Q=="object")for(const[I,N]of Object.entries(Q))N===!0&&isNaN(I)?K[I]=!0:typeof N=="string"&&N&&(K[N]=!0);let k=!1;for(const I of B.docs){const N=I.data();(!N.uid||N.uid!==T.uid)&&await Eu(I.ref,{uid:T.uid,studentUid:T.uid,displayName:T.displayName||N.name||null}),N.courseId&&!K[N.courseId]&&(K[N.courseId]=!0,k=!0)}k&&await At(R,{enrolledCourses:K},{merge:!0})}}catch(B){console.warn("Auto-link enrollments failed:",B)}}else n(null),a(null),i(null);g(!1)}),[]);const h=async()=>t?t.getIdToken():null,y=x=>{i(x||null)};return f.jsx(eS.Provider,{value:{user:t,userRole:s,nickname:l,updateNickname:y,loading:p,getToken:h,authError:v},children:e})}const un=()=>M.useContext(eS);function tS({displayName:e,nickname:t,isTeacherViewing:n=!1}){if(!e)return t||"Student";if(!t||!t.trim())return e;const s=t.trim(),a=e.trim().split(" "),l=a[0]||"",i=a.slice(1).join(" ");return s.toLowerCase()===l.toLowerCase()?e:n?i?`${l} "${s}" ${i}`:`${l} "${s}"`:i?`${s} ${i}`:s}function Ff({displayName:e,nickname:t,isTeacherViewing:n=!1}){if(!e&&!t)return"Student";if(!t||!t.trim())return e?.split(" ")[0]||"Student";const s=t.trim(),a=e?.split(" ")[0]||"";return s.toLowerCase()===a.toLowerCase()?a:n?`${a} "${s}"`:s}const tM=[{code:"en",name:"English",native:"English",flag:""},{code:"es",name:"Spanish",native:"Espaol",flag:""},{code:"zh-CN",name:"Chinese (Simplified)",native:"",flag:""},{code:"zh-TW",name:"Chinese (Traditional)",native:"",flag:""},{code:"ar",name:"Arabic",native:"",flag:""},{code:"hi",name:"Hindi",native:"",flag:""},{code:"fr",name:"French",native:"Franais",flag:""},{code:"pt",name:"Portuguese",native:"Portugus",flag:""},{code:"ru",name:"Russian",native:"",flag:""},{code:"ja",name:"Japanese",native:"",flag:""},{code:"ko",name:"Korean",native:"",flag:""},{code:"de",name:"German",native:"Deutsch",flag:""}],nS=M.createContext(null);function nM({children:e,cloudFunctionUrl:t}){const[n,s]=M.useState("en"),a=M.useRef({}),l=M.useRef({}),i=M.useCallback(async g=>{if(n==="en"||!t)return g;const v=new Array(g.length),u=[],h=[];if(g.forEach((_,E)=>{if(!_||typeof _!="string"){v[E]=_;return}const R=`${n}:${_}`;a.current[R]?v[E]=a.current[R]:(u.push(_),h.push(E))}),u.length===0)return v;const y=`${n}:${u.join("|")}`;if(l.current[y])return(await l.current[y]).forEach((E,R)=>{v[h[R]]=E}),v;const x=(async()=>{try{const E=await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({texts:u,targetLanguage:n,sourceLanguage:"en"})})).json();return E.translations?(E.translations.forEach((R,P)=>{a.current[`${n}:${u[P]}`]=R}),E.translations):u}catch{return u}finally{delete l.current[y]}})();return l.current[y]=x,(await x).forEach((_,E)=>{v[h[E]]=_}),v},[n,t]),p=M.useCallback(async g=>{if(!g||n==="en")return g;const[v]=await i([g]);return v},[i,n]);return f.jsxs(nS.Provider,{value:{language:n,setLanguage:s,translate:i,translateOne:p,languages:tM},children:[n==="ar"&&f.jsx("style",{children:"[data-translatable] { direction: rtl; text-align: right; }"}),e]})}function Rg(){const e=M.useContext(nS);if(!e)throw new Error("useTranslation must be used within TranslationProvider");return e}function rM(){const{language:e,setLanguage:t,languages:n}=Rg(),[s,a]=M.useState(!1),l=M.useRef(null),i=n.find(p=>p.code===e)||n[0];return M.useEffect(()=>{const p=g=>{l.current&&!l.current.contains(g.target)&&a(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]),f.jsxs("div",{ref:l,style:{position:"relative"},children:[f.jsxs("button",{onClick:()=>a(!s),style:{display:"flex",alignItems:"center",gap:6,padding:"6px 12px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:13,cursor:"pointer",transition:"border-color 0.2s",whiteSpace:"nowrap"},onMouseEnter:p=>p.currentTarget.style.borderColor="var(--amber)",onMouseLeave:p=>p.currentTarget.style.borderColor=s?"var(--amber)":"var(--border)",children:[f.jsx("span",{style:{fontSize:15},children:i.flag}),f.jsx("span",{children:i.native}),f.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",style:{opacity:.5,transform:s?"rotate(180deg)":"none",transition:"transform 0.15s"},children:f.jsx("path",{d:"M3 4.5L6 7.5L9 4.5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s&&f.jsxs("div",{style:{position:"absolute",top:"calc(100% + 6px)",right:0,zIndex:1e3,minWidth:220,maxHeight:380,overflowY:"auto",background:"var(--surface)",border:"1px solid var(--border)",borderRadius:10,padding:4,boxShadow:"0 8px 30px rgba(0,0,0,0.55), 0 0 0 1px rgba(255,255,255,0.04)",animation:"langMenuIn 0.14s ease-out"},children:[f.jsx("style",{children:`
            @keyframes langMenuIn {
              from { opacity: 0; transform: translateY(-5px) scale(0.97); }
              to { opacity: 1; transform: translateY(0) scale(1); }
            }
          `}),n.map(p=>f.jsxs("div",{onClick:()=>{t(p.code),a(!1)},style:{display:"flex",alignItems:"center",gap:10,padding:"9px 11px",borderRadius:7,cursor:"pointer",transition:"background 0.12s",background:p.code===e?"var(--amber-dim)":"transparent"},onMouseEnter:g=>g.currentTarget.style.background=p.code===e?"var(--amber-dim)":"rgba(255,255,255,0.05)",onMouseLeave:g=>g.currentTarget.style.background=p.code===e?"var(--amber-dim)":"transparent",children:[f.jsx("span",{style:{fontSize:17,lineHeight:1,flexShrink:0},children:p.flag}),f.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:1,flex:1},children:[f.jsx("span",{style:{fontSize:14,fontWeight:600,color:"var(--text)"},children:p.native}),f.jsx("span",{style:{fontSize:11,color:"var(--text3)"},children:p.name})]}),p.code===e&&f.jsx("span",{style:{color:"var(--amber)",fontSize:14},children:""})]},p.code))]})]})}const W3=25;function An(e){const{translateOne:t,language:n}=Rg(),[s,a]=M.useState(e);return M.useEffect(()=>{if(!e||n==="en"){a(e);return}let l=!1;return t(e).then(i=>{l||a(i)}),()=>{l=!0}},[e,n,t]),s}function on(e){const{translate:t,language:n}=Rg(),[s,a]=M.useState(e);return M.useEffect(()=>{if(!e||!e.length||n==="en"){a(e);return}let l=!1;return(async()=>{try{const i=new Array(e.length);for(let p=0;p<e.length;p+=W3){const g=e.slice(p,p+W3);(await t(g)).forEach((u,h)=>{i[p+h]=u})}l||a(i)}catch{l||a(e)}})(),()=>{l=!0}},[e?.join("|"),n,t]),s}function Vr(){const{user:e,userRole:t,nickname:n}=un(),s=ci(),a=t==="teacher",l=v=>s.pathname===v?"top-nav-link active":"top-nav-link",i=a?e?.displayName:tS({displayName:e?.displayName,nickname:n}),p=on(a?[]:["Dashboard","Character","Sign out"]),g=(v,u)=>p?.[v]??u;return f.jsxs("div",{className:"top-bar",children:[f.jsx(Xt,{to:"/",className:"top-brand",style:{textDecoration:"none"},children:"PantherLearn"}),f.jsxs("div",{className:"top-nav-links",children:[f.jsx(Xt,{to:"/",className:l("/"),"data-translatable":!0,children:a?"Dashboard":g(0,"Dashboard")}),f.jsxs(Xt,{to:"/avatar",className:l("/avatar"),"data-translatable":!0,children:[" ",a?"Character":g(1,"Character")]}),a&&f.jsx(Xt,{to:"/editor",className:l("/editor"),children:"Editor"}),a&&f.jsx(Xt,{to:"/grading",className:l("/grading"),children:"Grading"})]}),f.jsxs("div",{className:"top-bar-right",children:[f.jsx(rM,{}),e?.photoURL&&f.jsx("img",{src:e.photoURL,className:"user-avatar",alt:"",referrerPolicy:"no-referrer"}),f.jsx("span",{className:"user-name",children:i}),f.jsx("button",{className:"sign-out-btn",onClick:Zb,"data-translatable":!0,children:a?"Sign out":g(2,"Sign out")})]})]})}function iM(){ui();const{authError:e}=un(),t=async()=>{try{await Jj()}catch(n){console.error("Sign in failed:",n)}};return f.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg)",flexDirection:"column",gap:32,padding:24},children:[f.jsxs("div",{style:{textAlign:"center"},children:[f.jsx("h1",{style:{fontFamily:"var(--font-display)",fontSize:48,fontWeight:700,color:"var(--amber)",marginBottom:8},children:"PantherLearn"}),f.jsx("p",{style:{color:"var(--text2)",fontSize:16},children:"Your AI-powered learning platform"})]}),e&&f.jsx("div",{style:{background:"var(--red-dim)",border:"1px solid rgba(248,113,113,0.3)",borderRadius:10,padding:"14px 24px",maxWidth:360,textAlign:"center",color:"var(--red)",fontSize:14,lineHeight:1.6},children:e}),f.jsxs("button",{onClick:t,style:{padding:"14px 32px",borderRadius:10,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:16,fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",gap:12,transition:"all 0.2s"},onMouseOver:n=>n.currentTarget.style.borderColor="var(--amber)",onMouseOut:n=>n.currentTarget.style.borderColor="var(--border)",children:[f.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",children:[f.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"}),f.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),f.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),f.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Sign in with Google"]}),f.jsxs("p",{style:{color:"var(--text3)",fontSize:13,maxWidth:300,textAlign:"center",lineHeight:1.6},children:["Sign in with your ",f.jsx("strong",{style:{color:"var(--text2)"},children:"@paps.net"})," school account."]})]})}const au={mc_correct:20,mc_incorrect:5,short_answer:15,chat_message:5,lesson_complete:50,perfect_lesson:100,streak_bonus:25},$f=[{id:"participation",label:"Brave Participation",xp:10,icon:""},{id:"helping_peer",label:"Helped a Peer",xp:15,icon:""},{id:"great_question",label:"Great Question",xp:10,icon:""},{id:"teamwork",label:"Outstanding Teamwork",xp:15,icon:""},{id:"on_task",label:"Stayed On Task",xp:5,icon:""}],Wf={streakMultipliers:{5:1.25,10:1.5,20:1.75,30:2},qualityMultipliers:{satisfactory:1,proficient:1.25,exemplary:1.5}},sM=50;function aM(e){return e<=1?0:Math.round(sM*Math.pow(e,1.5))}const oM=[{tier:1,minLevel:1,maxLevel:5,name:"Novice",color:"#8B9DAF",icon:""},{tier:2,minLevel:6,maxLevel:10,name:"Apprentice",color:"#2ecc71",icon:""},{tier:3,minLevel:11,maxLevel:15,name:"Adept",color:"#3498db",icon:""},{tier:4,minLevel:16,maxLevel:20,name:"Veteran",color:"#9b59b6",icon:""},{tier:5,minLevel:21,maxLevel:25,name:"Champion",color:"#e67e22",icon:""},{tier:6,minLevel:26,maxLevel:30,name:"Legend",color:"#e74c3c",icon:""},{tier:7,minLevel:31,maxLevel:34,name:"Mythic",color:"#a855f7",icon:""},{tier:8,minLevel:35,maxLevel:35,name:"Panther Ascendant",color:"#f1c40f",icon:""}],Ys=Array.from({length:35},(e,t)=>{const n=t+1,s=oM.find(a=>n>=a.minLevel&&n<=a.maxLevel);return{level:n,xpRequired:aM(n),name:`${s.name} ${n-s.minLevel+1}`,tierName:s.name,tierIcon:s.icon,tierColor:s.color,tier:s.tier}}),Qo=Ys,Gf=[{id:"first_lesson",icon:"",name:"First Steps",description:"Complete your first lesson",rarity:"common",hidden:!1,check:e=>(e.lessonsCompleted||0)>=1},{id:"five_lessons",icon:"",name:"Bookworm",description:"Complete 5 lessons",rarity:"common",hidden:!1,check:e=>(e.lessonsCompleted||0)>=5},{id:"ten_lessons",icon:"",name:"Scholar",description:"Complete 10 lessons",rarity:"uncommon",hidden:!1,check:e=>(e.lessonsCompleted||0)>=10},{id:"perfect_score",icon:"",name:"Perfectionist",description:"Get 100% on any lesson",rarity:"uncommon",hidden:!1,check:e=>e.hasPerfectLesson===!0},{id:"three_streak",icon:"",name:"On Fire",description:"Reach a 3-day streak",rarity:"common",hidden:!1,check:e=>(e.currentStreak||0)>=3},{id:"seven_streak",icon:"",name:"Unstoppable",description:"Reach a 7-day streak",rarity:"uncommon",hidden:!1,check:e=>(e.currentStreak||0)>=7},{id:"thirty_streak",icon:"",name:"Streak Royalty",description:"Reach a 30-day streak",rarity:"legendary",hidden:!1,check:e=>(e.currentStreak||0)>=30},{id:"fifty_questions",icon:"",name:"Quiz Machine",description:"Answer 50 questions",rarity:"common",hidden:!1,check:e=>(e.totalAnswered||0)>=50},{id:"hundred_questions",icon:"",name:"Centurion",description:"Answer 100 questions",rarity:"uncommon",hidden:!1,check:e=>(e.totalAnswered||0)>=100},{id:"five_hundred_questions",icon:"",name:"Panther Power",description:"Answer 500 questions",rarity:"rare",hidden:!1,check:e=>(e.totalAnswered||0)>=500},{id:"level_five",icon:"",name:"Rising Star",description:"Reach Level 5",rarity:"uncommon",hidden:!1,check:e=>ls(e.totalXP||0).current.level>=5},{id:"level_ten",icon:"",name:"Journeyman",description:"Reach Level 10",rarity:"rare",hidden:!1,check:e=>ls(e.totalXP||0).current.level>=10},{id:"level_twenty",icon:"",name:"Veteran",description:"Reach Level 20",rarity:"epic",hidden:!1,check:e=>ls(e.totalXP||0).current.level>=20},{id:"level_thirty_five",icon:"",name:"Panther Elite",description:"Reach Level 35  the pinnacle",rarity:"legendary",hidden:!1,check:e=>ls(e.totalXP||0).current.level>=35},{id:"night_owl",icon:"",name:"Night Owl",description:"Complete a lesson after 9 PM",rarity:"rare",hidden:!0,check:e=>e.hasNightOwl===!0},{id:"early_bird",icon:"",name:"Early Bird",description:"Complete a lesson before 7 AM",rarity:"rare",hidden:!0,check:e=>e.hasEarlyBird===!0},{id:"speed_demon",icon:"",name:"Speed Demon",description:"Answer 10 questions correctly in under 2 minutes",rarity:"epic",hidden:!0,check:e=>e.hasSpeedDemon===!0}],G3={common:{bg:"#3a3a4a",border:"#555",label:"Common"},uncommon:{bg:"#1a3a2a",border:"#2ecc71",label:"Uncommon"},rare:{bg:"#1a2a4a",border:"#3498db",label:"Rare"},epic:{bg:"#2a1a4a",border:"#9b59b6",label:"Epic"},legendary:{bg:"#3a2a1a",border:"#f39c12",label:"Legendary"}};function ls(e){let t=Ys[0],n=Ys[1];for(let i=Ys.length-1;i>=0;i--)if(e>=Ys[i].xpRequired){t=Ys[i],n=Ys[i+1]||null;break}const s=e-t.xpRequired,a=n?n.xpRequired-t.xpRequired:0,l=n&&a>0?Math.min(s/a,1):1;return{current:t,next:n,level:t.level,tierName:t.tierName,tierIcon:t.tierIcon,tierColor:t.tierColor,xpIntoLevel:s,xpInLevel:s,xpForNext:a,progress:l}}async function lM(e){try{const t=Fe(be,"courses",e,"settings","xpConfig"),n=await Mt(t);return n.exists()?n.data():{xpValues:au,behaviorRewards:$f,multiplierConfig:Wf}}catch(t){return console.error("Error loading XP config:",t),{xpValues:au,behaviorRewards:$f,multiplierConfig:Wf}}}async function cM(e,t){try{const n=Fe(be,"courses",e,"settings","xpConfig");return await At(n,{...t,updatedAt:new Date},{merge:!0}),!0}catch(n){return console.error("Error saving XP config:",n),!1}}function uM(e){if(!e||e.length===0)return 0;const t=e.map(u=>{const h=u instanceof Date?u:u?.toDate?.()?u.toDate():new Date(u);return isNaN(h.getTime())?null:h}).filter(Boolean).sort((u,h)=>h-u);if(t.length===0)return 0;const n=u=>`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}`,s=u=>{const h=new Date(u).getDay();return h===0||h===6},a=[...new Set(t.map(n))].filter(u=>!s(u)).sort().reverse();if(a.length===0)return 0;const l=new Date;let i=new Date(l);for(;s(n(i));)i=new Date(i.getTime()-864e5);const p=n(i),g=Q3(p);if(a[0]!==p&&a[0]!==g)return 0;let v=1;for(let u=1;u<a.length;u++){const h=Q3(a[u-1]);if(a[u]===h)v++;else break}return v}function Q3(e){let t=new Date(e);do t=new Date(t.getTime()-864e5);while(t.getDay()===0||t.getDay()===6);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}async function mm(e,t,n,s){try{const a=s?Fe(be,"courses",s,"gamification",e):Fe(be,"gamification",e),l=await Mt(a),i=l.exists()?l.data():{totalXP:0};let p=1;if(s){const u=Fe(be,"courses",s),h=await Mt(u);if(h.exists()){const y=h.data();y.xpMultiplier&&y.xpMultiplierExpires&&(y.xpMultiplierExpires?.toDate?.()||new Date(y.xpMultiplierExpires))>new Date&&(p=y.xpMultiplier)}}const g=Math.round(t*p),v=(i.totalXP||0)+g;return await At(a,{...i,totalXP:v,lastXPSource:n,lastXPAmount:g,lastXPAt:new Date},{merge:!0}),{newTotal:v,awarded:g,multiplier:p}}catch(a){return console.error("Error awarding XP:",a),null}}async function dM(e,t,n,s){const a=Fe(be,"courses",e,"settings","xpConfig"),l=new Date(Date.now()+n*60*1e3);await At(a,{activeMultiplier:{value:t,label:s||`${t}x XP`,expiresAt:l,startedAt:new Date}},{merge:!0})}async function fM(e){const t=Fe(be,"courses",e,"settings","xpConfig");await At(t,{activeMultiplier:null},{merge:!0})}async function X3(e,t,n){const s=Fe(be,"gamification",e),a=await ml(e,n),l={...a,...t};l.currentStreak=uM(l.activityDates),l.longestStreak=Math.max(l.currentStreak,a.longestStreak||0);const i=[],p=Gf.filter(g=>g.check(l)).map(g=>((a.badges||[]).includes(g.id)||i.push(g),g.id));return l.badges=p,await At(s,{...l,lastUpdated:new Date},{merge:!0}),{gamification:l,newBadges:i}}async function ml(e,t){try{const n=t?Fe(be,"courses",t,"gamification",e):Fe(be,"gamification",e),s=await Mt(n);return s.exists()?s.data():{totalXP:0,totalAnswered:0,totalCorrect:0,currentStreak:0,longestStreak:0,badges:[],streakFreezes:0,perkUsage:{},activityDates:[],lessonsCompleted:0}}catch(n){return console.error("Error loading gamification data:",n),{totalXP:0,totalAnswered:0,totalCorrect:0,currentStreak:0,longestStreak:0,badges:[],streakFreezes:0,perkUsage:{},activityDates:[],lessonsCompleted:0}}}async function _h(e){return lM(e)}async function hM(e,t=null,n=50){try{const s=e?it(be,"courses",e,"gamification"):it(be,"gamification"),a=await ct(s),l=await ct(it(be,"users")),i={};l.forEach(v=>{i[v.id]=v.data()});let p={};e&&(await ct(it(be,"enrollments"))).forEach(u=>{const h=u.data();h.courseId===e&&(h.uid||h.studentUid)&&(p[h.uid||h.studentUid]=h)});const g=[];return a.forEach(v=>{const u=v.data(),h=v.id,y=i[h];if(y?.role!=="teacher"){if(t){const x=p[h];if(!x||x.section!==t)return}g.push({uid:h,...u,displayName:u.displayName||y?.displayName||y?.name||null,nickname:u.nickname||y?.nickname||null,photoURL:u.photoURL||y?.photoURL||null,section:p[h]?.section||null})}}),g.sort((v,u)=>(u.totalXP||0)-(v.totalXP||0)),g.slice(0,n)}catch(s){return console.error("Error loading leaderboard:",s),[]}}function pM(e){if(!e)return{};const t={};if(Array.isArray(e))e.forEach(n=>{typeof n=="string"&&n&&(t[n]=!0)});else if(typeof e=="object")for(const[n,s]of Object.entries(e))s===!0&&isNaN(n)?t[n]=!0:typeof s=="string"&&s&&(t[s]=!0);return t}async function mM(e){const t=e.toUpperCase().trim(),n=await ct(it(be,"courses"));for(const s of n.docs){const a=s.data();if(a.sections){for(const[l,i]of Object.entries(a.sections))if(i.enrollCode===t)return{id:s.id,...a,matchedSectionId:l,matchedSectionName:i.name}}if(a.enrollCode===t)return{id:s.id,...a,matchedSectionId:null,matchedSectionName:null}}return null}async function gM(e,t,n){const s=await mM(n);if(!s)throw new Error("Invalid enroll code. Please check with your teacher.");const a=await kg(e,s.id,t);if(a){try{(!a.uid||a.uid!==e)&&await At(Fe(be,"enrollments",a.id),{uid:e,studentUid:e},{merge:!0});const u=Fe(be,"users",e),h=await Mt(u),y=pM(h.exists()?h.data().enrolledCourses:{});y[s.id]||(y[s.id]=!0,await At(u,{enrolledCourses:y},{merge:!0}))}catch(u){console.warn("Could not repair enrolledCourses:",u)}return{...s,section:a.section||s.matchedSectionName}}const l=t.toLowerCase().replace(/[^a-z0-9]/g,"_"),i=`${s.id}_${l}`;await At(Fe(be,"enrollments",i),{courseId:s.id,studentUid:e,uid:e,teacherUid:s.ownerUid,email:t.toLowerCase(),enrollCode:n.toUpperCase().trim(),section:s.matchedSectionName||null,sectionId:s.matchedSectionId||null,enrolledAt:Ga()},{merge:!0});const p=Fe(be,"users",e),g=await Mt(p),v=g.exists()?g.data().enrolledCourses||{}:{};return v[s.id]||await At(p,{enrolledCourses:{...v,[s.id]:!0}},{merge:!0}),{...s,section:s.matchedSectionName}}async function kg(e,t,n){if(n){const l=n.toLowerCase().replace(/[^a-z0-9]/g,"_"),i=`${t}_${l}`,p=await Mt(Fe(be,"enrollments",i));if(p.exists())return{id:p.id,...p.data()}}const s=`${t}_${e}`,a=await Mt(Fe(be,"enrollments",s));return a.exists()?{id:a.id,...a.data()}:null}async function vM(e){const t=Fe(be,"users",e),n=await Mt(t);if(n.exists()){const l=n.data().enrolledCourses;if(l&&typeof l=="object"&&!Array.isArray(l)){const i=Object.keys(l);if(i.length>0)return new Set(i)}if(Array.isArray(l)&&l.length>0)return new Set(l)}const s=n.exists()?n.data().email?.toLowerCase():null,a=new Set;try{(await ct(Kt(it(be,"enrollments"),us("uid","==",e)))).forEach(i=>{i.data().courseId&&a.add(i.data().courseId)})}catch{}try{(await ct(Kt(it(be,"enrollments"),us("studentUid","==",e)))).forEach(i=>{i.data().courseId&&a.add(i.data().courseId)})}catch{}if(s&&a.size===0)try{(await ct(Kt(it(be,"enrollments"),us("email","==",s)))).forEach(i=>{i.data().courseId&&a.add(i.data().courseId)})}catch{}if(a.size>0)try{const l={};a.forEach(i=>{l[i]=!0}),await At(t,{enrolledCourses:l},{merge:!0})}catch(l){console.warn("Could not auto-fix enrolledCourses:",l)}return a}function yM(e){return e?.sections?Object.entries(e.sections).map(([t,n])=>({id:t,name:n.name,enrollCode:n.enrollCode})):[]}function c(e,t,n,s){e.fillStyle=s,e.fillRect(t,n,1,1)}const gm={};function Wt(e,t){gm[e]=t}function bM(e,t,n,s,a,l,i,p,g){e.clearRect(0,0,80,48);const v=p%4<2?0:1,u=p%8<5,h=p%6<3;e.save(),e.translate(16,0),g?.power&&LM(e,g.power,l,v,p),g?.accessory&&NM(e,g.accessory,l,v,p);const y=[e,n,s,a,l,i,v,p,u,h];gm[t]?gm[t](...y):t==="warrior"?wM(...y):t==="ranger"?_M(...y):t==="healer"?xM(...y):t==="rogue"?TM(...y):SM(...y),e.restore()}function Cr(e,t,n,s,a,l,i,p){const g=l;for(let v=18;v<=29;v++)c(e,v,6+g,t.dk),c(e,v,19+g,t.dk);for(let v=7;v<=18;v++)c(e,17,v+g,t.dk),c(e,30,v+g,t.dk);c(e,18,18+g,t.dk),c(e,29,18+g,t.dk);for(let v=7;v<=18;v++)for(let u=18;u<=29;u++){let h=t.base;v<=8?h=t.hi:v>=17?h=t.sh:u<=19||u>=28?h=t.mid:v<=10&&u>=22&&u<=25&&(h=t.hi),c(e,u,v+g,h)}for(let v=19;v<=22;v++)for(let u=11;u<=14;u++)c(e,v,u+g,"#fff");for(let v=25;v<=28;v++)for(let u=11;u<=14;u++)c(e,v,u+g,"#fff");c(e,20,12+g,s.iris),c(e,21,12+g,s.irisLight),c(e,20,13+g,s.iris),c(e,21,13+g,s.pupil),c(e,26,12+g,s.iris),c(e,27,12+g,s.irisLight),c(e,26,13+g,s.iris),c(e,27,13+g,s.pupil),p&&(c(e,20,11+g,"#fff"),c(e,26,11+g,"#fff"));for(let v=19;v<=22;v++)c(e,v,10+g,t.dk);for(let v=25;v<=28;v++)c(e,v,10+g,t.dk);c(e,19,9+g,n.sh),c(e,20,9+g,n.base),c(e,21,9+g,n.base),c(e,26,9+g,n.base),c(e,27,9+g,n.base),c(e,28,9+g,n.sh),c(e,23,15+g,t.sh),c(e,24,15+g,t.hi),c(e,22,17+g,"#c08070"),c(e,23,17+g,"#d09080"),c(e,24,17+g,"#d09080"),c(e,25,17+g,"#c08070"),c(e,19,15+g,"#ff888825"),c(e,28,15+g,"#ff888825");for(let v=16;v<=31;v++)for(let u=2;u<=8;u++){let h=n.base;u<=3?h=n.hi:u===4&&v>=20&&v<=27?h=n.br:v<=18||v>=29?h=n.sh:u>=7&&(h=n.mid),c(e,v,u+g,h)}for(let v=8;v<=22;v++){const u=Math.min(1,(v-8)/12);c(e,16,v+g,u>.6?n.sh:n.mid),c(e,17,v+g,n.base),c(e,30,v+g,n.base),c(e,31,v+g,u>.6?n.sh:n.mid)}c(e,17,10+g,n.hi),c(e,17,14+g,n.hi),c(e,30,12+g,n.hi),c(e,30,16+g,n.hi);for(let v=18;v<=21;v++)c(e,v,8+g,n.base);for(let v=26;v<=29;v++)c(e,v,8+g,n.base)}function SM(e,t,n,s,a,l,i,p,g,v){const{robe:u,robeLight:h,robeDark:y,robeMid:x,accent:T}=a;for(let E=16;E<=31;E++)c(e,E,46,"#0004");for(let E=18;E<=29;E++)c(e,E,47,"#0003");if(l>=5){for(let E=22+i;E<=44+i;E++){const R=Math.floor((E-22)*.3);for(let P=14-R;P<=15;P++)P>=10&&c(e,P,E,y);for(let P=32;P<=33+R;P++)P<=37&&c(e,P,E,y)}for(let E=24+i;E<=42+i;E++)c(e,15,E,x+"80"),c(e,32,E,x+"80")}for(let E=24;E<=44;E++){const R=(E-24)/20,P=Math.floor(3+R*7);for(let B=24-P;B<=23+P;B++){let X=u;B<24-P+2?X=y:B>23+P-2?X=x:(B===23||B===24)&&(X=y+"c0"),c(e,B,E+i,X)}}for(let E=28+i;E<=42+i;E+=3)c(e,20,E,h+"40"),c(e,27,E,h+"40");if(l>=3)for(let E=16;E<=31;E++)c(e,E,44+i,T);l>=7&&(c(e,21,36+i,h+"50"),c(e,26,38+i,h+"50"),c(e,23,40+i,h+"30"));for(let E=17;E<=30;E++)c(e,E,33+i,T);if(c(e,23,33+i,"#fff"),c(e,24,33+i,"#fff"),l>=5&&(c(e,20,33+i,h),c(e,27,33+i,h)),l>=7){for(let E=12;E<=16;E++)for(let R=21;R<=23;R++)c(e,E,R+i,x);c(e,14,21+i,T),c(e,15,22+i,h);for(let E=31;E<=35;E++)for(let R=21;R<=23;R++)c(e,E,R+i,x);c(e,33,21+i,T),c(e,32,22+i,h)}for(let E=24;E<=35;E++)c(e,14,E+i,y),c(e,15,E+i,u),c(e,32,E+i,u),c(e,33,E+i,x);c(e,14,36+i,t.base),c(e,15,36+i,t.base),c(e,14,37+i,t.sh),c(e,32,36+i,t.base),c(e,33,36+i,t.base),c(e,33,37+i,t.sh);for(let E=4;E<=42;E++)c(e,35,E+i,"#7a5a18");c(e,35,4+i,"#a08030");const _=v?0:1;if(c(e,34,3+i-_,h),c(e,35,2+i-_,"#fff"),c(e,36,3+i-_,h),c(e,35,4+i-_,u),c(e,34,4+i-_,x),c(e,36,4+i-_,x),l>=3&&(c(e,33,3+i-_,h+"50"),c(e,37,3+i-_,h+"50")),l>=7&&(c(e,35,1+i-_,h+"40"),c(e,33,2+i-_,h+"30"),c(e,37,2+i-_,h+"30")),l>=10){c(e,32,4+i-_,h+"20"),c(e,38,4+i-_,h+"20"),c(e,35,0+i-_,"#fff4");const E=16+Math.floor(Math.sin(p*.7)*4),R=10+Math.floor(Math.cos(p*.5)*3);c(e,E,R+i,h+"60"),c(e,31-E+16,R+5+i,h+"40")}for(let E=17;E<=20;E++)c(e,E,44+i,y);for(let E=27;E<=30;E++)c(e,E,44+i,y);if(c(e,17,44+i,x),c(e,27,44+i,x),Cr(e,t,n,s,l,i,p,g),l>=3){for(let E=14;E<=33;E++)c(e,E,6+i,u);for(let E=15;E<=32;E++)c(e,E,5+i,x);for(let E=0;E<=4;E++){const R=Math.max(1,Math.floor((4-E)*1.8));for(let P=24-R;P<=23+R;P++){let B=u;P<24-R+1?B=y:P>23+R-1&&(B=h),c(e,P,E+i,B)}}c(e,23,0+i,x);for(let E=18;E<=29;E++)c(e,E,4+i,T);l>=7&&(c(e,23,2+i,"#fff"),c(e,22,3+i,h),c(e,24,3+i,h)),l>=10&&(c(e,20,0+i,T),c(e,27,0+i,T),c(e,23,-1+i,"#fff"))}}function wM(e,t,n,s,a,l,i,p,g,v){const{robe:u,robeLight:h,robeDark:y,robeMid:x,accent:T}=a;for(let _=14;_<=33;_++)c(e,_,46,"#0004");if(l>=7)for(let _=20+i;_<=42+i;_++){const E=Math.floor((_-20)*.2);c(e,10-E,_,"#a02020"),c(e,37+E,_,"#a02020")}for(let _=38;_<=44;_++){for(let E=16;E<=20;E++)c(e,E,_+i,y);for(let E=27;E<=31;E++)c(e,E,_+i,y)}for(let _=15;_<=21;_++)c(e,_,44+i,l>=3?"#6a5020":"#505060");for(let _=26;_<=32;_++)c(e,_,44+i,l>=3?"#6a5020":"#505060");for(let _=22;_<=37;_++)for(let E=16;E<=31;E++){let R=u;E<=17?R=y:E>=30?R=h:E>=22&&E<=25&&(R=x),c(e,E,_+i,R)}for(let _=24;_<=30;_++)c(e,22,_+i,h),c(e,23,_+i,h+"c0");for(let _=16;_<=31;_++)c(e,_,34+i,"#6a5020");if(c(e,23,34+i,T),c(e,24,34+i,T),l>=3)for(let _=16;_<=31;_++)c(e,_,23+i,T+"80");l>=5&&(c(e,22,27+i,T),c(e,23,26+i,T),c(e,24,27+i,T),c(e,23,28+i,T));for(let _=11;_<=15;_++)for(let E=20;E<=24;E++)c(e,_,E+i,x);for(let _=32;_<=36;_++)for(let E=20;E<=24;E++)c(e,_,E+i,x);c(e,13,21+i,T),c(e,34,21+i,T);for(let _=25;_<=35;_++)c(e,13,_+i,y),c(e,14,_+i,u),c(e,33,_+i,u),c(e,34,_+i,x);for(let _=12;_<=15;_++)for(let E=35;E<=37;E++)c(e,_,E+i,l>=5?T:"#606068");for(let _=32;_<=35;_++)for(let E=35;E<=37;E++)c(e,_,E+i,l>=5?T:"#606068");for(let _=2;_<=34;_++)c(e,36,_+i,"#c0c0d8");c(e,36,2+i,"#e8e8f0"),c(e,35,2+i,"#e0e0f0"),c(e,37,2+i,"#e0e0f0");for(let _=34;_<=38;_++)c(e,_,30+i,"#8a6a20");c(e,36,31+i,"#6a5020"),l>=7&&(c(e,35,4+i,"#fff4"),c(e,37,4+i,"#fff4"));for(let _=8;_<=14;_++)for(let E=26;E<=36;E++){let R="#506080";(_===8||_===14||E===26||E===36)&&(R="#384060"),_===11&&E>=29&&E<=33&&(R=l>=5?T:"#607090"),c(e,_,E+i,R)}if(c(e,11,31+i,l>=3?T:"#708090"),l>=7&&(c(e,10,30+i,T),c(e,12,30+i,T),c(e,11,29+i,T),c(e,11,31+i,"#fff")),l>=5){for(let _=16;_<=31;_++)for(let E=4;E<=18;E++){let R=u;if(E<=5||E>=17)R=y;else if(_<=17||_>=30)R=y;else if(E<=7)R=h;else if(_>=20&&_<=27&&E===12)continue;c(e,_,E+i,R)}for(let _=20;_<=27;_++)c(e,_,12+i,"#000");if(l>=7)for(let _=1;_<=6;_++)c(e,23,_+i,"#c03030"),c(e,24,_+i,"#e04040");l>=10&&(c(e,21,3+i,T),c(e,23,2+i,T),c(e,24,2+i,"#fff"),c(e,26,3+i,T));for(let _=17;_<=30;_++)c(e,_,4+i,T+"60")}else Cr(e,t,n,s,l,i,p,g)}function _M(e,t,n,s,a,l,i,p,g,v){const u="#2a6838",h="#40a058",y="#1a4828",x="#308848",T="#d4a040";for(let _=17;_<=30;_++)c(e,_,46,"#0004");if(l>=3)for(let _=18+i;_<=44+i;_++){const E=Math.floor((_-18)*.25);for(let R=13-E;R<=14;R++)R>=8&&c(e,R,_,y);for(let R=33;R<=34+E;R++)R<=39&&c(e,R,_,y)}for(let _=18;_<=32;_++)c(e,34,_+i,"#6a5020");c(e,33,18+i,"#a08030"),c(e,35,18+i,"#a08030"),c(e,34,17+i,"#c0c0d0"),c(e,33,17+i,"#c0c0d0");for(let _=22;_<=40;_++){const E=Math.floor(3+(_-22)*.25);for(let R=24-E;R<=23+E;R++){let P="#8a6a40";R<24-E+1?P="#6a5030":R>23+E-1&&(P="#a08050"),c(e,R,_+i,P)}}for(let _=22;_<=32;_++)for(let E=19;E<=28;E++){let R=u;E<=20?R=y:E>=27&&(R=x),c(e,E,_+i,R)}for(let _=18;_<=29;_++)c(e,_,32+i,"#6a5020");c(e,23,32+i,T),c(e,24,32+i,T),l>=3&&(c(e,19,33+i,"#6a5020"),c(e,20,33+i,"#7a6030"),c(e,28,33+i,"#6a5020"),c(e,27,33+i,"#7a6030"));for(let _=34;_<=43;_++){for(let E=19;E<=22;E++)c(e,E,_+i,"#6a5030");for(let E=25;E<=28;E++)c(e,E,_+i,"#6a5030")}for(let _=18;_<=23;_++)c(e,_,44+i,"#5a4020");for(let _=24;_<=29;_++)c(e,_,44+i,"#5a4020");for(let _=23;_<=34;_++)c(e,15,_+i,"#6a5030"),c(e,16,_+i,"#8a6a40"),c(e,31,_+i,"#8a6a40"),c(e,32,_+i,"#a08050");if(l>=5)for(let _=30;_<=33;_++)c(e,15,_+i,u),c(e,32,_+i,u);c(e,15,35+i,t.base),c(e,16,35+i,t.base),c(e,31,35+i,t.base),c(e,32,35+i,t.base);for(let _=14;_<=40;_++)c(e,13,_+i,"#6a5020");c(e,13,14+i,"#8a6a30"),c(e,13,40+i,"#8a6a30");for(let _=16;_<=38;_++)c(e,12,_+i,"#c0b8a0");if(l>=3&&(c(e,11,26+i,"#a08030"),c(e,10,26+i,"#c0c0d0")),l>=5&&(c(e,23,26+i,h),c(e,24,25+i,h),c(e,24,27+i,h),c(e,25,26+i,h)),Cr(e,t,n,s,l,i,p,g),l>=3){for(let _=15;_<=32;_++)for(let E=3;E<=9;E++){let R=u;E<=4||_<=16||_>=31?R=y:E<=6&&_>=20&&_<=27&&(R=h),c(e,_,E+i,R)}for(let _=10;_<=16;_++)c(e,15,_+i,y),c(e,16,_+i,u),c(e,31,_+i,u),c(e,32,_+i,y);l>=7&&(c(e,28,3+i,"#40a058"),c(e,29,2+i,"#60c070"),c(e,29,1+i,"#80e088"))}}function xM(e,t,n,s,a,l,i,p,g,v){const u="#d0c8b0",h="#f0ece0",y="#a8a090",x="#e0d8c8",T="#40c880";for(let _=16;_<=31;_++)c(e,_,46,"#0004");for(let _=22;_<=44;_++){const E=(_-22)/22,R=Math.floor(3+E*8);for(let P=24-R;P<=23+R;P++){let B=u;P<24-R+2?B=y:P>23+R-2?B=h:P===23||P===24?B=y+"a0":_>=40&&(B=x),c(e,P,_+i,B)}}for(let _=17;_<=30;_++)c(e,_,30+i,_>=22&&_<=25?T:T+"80");c(e,23,30+i,"#60e8a0"),c(e,24,30+i,"#60e8a0");for(let _=15;_<=32;_++)c(e,_,44+i,T);if(c(e,23,26+i,T),c(e,24,26+i,T),c(e,22,27+i,T),c(e,23,27+i,"#60e8a0"),c(e,24,27+i,"#60e8a0"),c(e,25,27+i,T),c(e,23,28+i,T),c(e,24,28+i,T),l>=5)for(let _=32;_<=42;_+=3)c(e,19,_+i,T+"50"),c(e,28,_+i,T+"50");for(let _=23;_<=36;_++){const E=_>30?2:1;for(let R=0;R<E;R++)c(e,14-R,_+i,u),c(e,33+R,_+i,x)}c(e,12,36+i,t.base),c(e,13,36+i,t.base),c(e,14,36+i,t.base),c(e,33,36+i,t.base),c(e,34,36+i,t.base),c(e,35,36+i,t.base);for(let _=9;_<=13;_++)for(let E=33;E<=39;E++){let R=l>=5?"#40a068":"#5028a8";(_===9||_===13||E===33||E===39)&&(R=T),c(e,_,E+i,R)}c(e,10,35+i,"#f8f0e0"),c(e,11,35+i,"#f8f0e0"),c(e,12,35+i,"#f8f0e0");for(let _=8;_<=40;_++)c(e,36,_+i,"#a08830");if(c(e,35,8+i,T),c(e,36,7+i,T),c(e,37,8+i,T),c(e,36,9+i,T),l>=3&&(c(e,36,6+i,T+"60"),c(e,34,8+i,T+"40"),c(e,38,8+i,T+"40")),l>=7&&(c(e,36,5+i,"#80ffc040"),c(e,35,7+i,"#80ffc030"),c(e,37,7+i,"#80ffc030")),l>=7){const _=v?0:1;for(let E=19;E<=28;E++)c(e,E,3+i-_,T+"90");c(e,18,4+i-_,T+"60"),c(e,29,4+i-_,T+"60"),c(e,23,2+i-_,"#80ffc0"),c(e,24,2+i-_,"#80ffc0")}if(l>=10){const _=17+Math.floor(Math.sin(p*.6)*3),E=15+Math.floor(Math.cos(p*.4)*4);c(e,_,E+i,T+"50"),c(e,30-_+17,E+8+i,T+"30")}if(Cr(e,t,n,s,l,i,p,g),l>=3){for(let _=18;_<=29;_++)c(e,_,8+i,T+"60");c(e,23,8+i,T),c(e,24,8+i,"#80ffc0")}}function TM(e,t,n,s,a,l,i,p,g,v){const u="#303040",h="#1a1a28",y="#404050",x="#e04040";for(let T=17;T<=30;T++)c(e,T,46,"#0004");if(l>=3)for(let T=18+i;T<=38+i;T++){const _=Math.floor((T-18)*.15);c(e,12-_,T,h),c(e,35+_,T,h)}for(let T=22;T<=37;T++){const _=Math.floor(3+(T-22)*.15);for(let E=24-_;E<=23+_;E++){let R=u;E<24-_+1?R=h:E>23+_-1&&(R=y),c(e,E,T+i,R)}}for(let T=0;T<6;T++)c(e,20+T,24+T+i,h),c(e,27-T,24+T+i,h);if(l>=3)for(let T=20;T<=27;T++)c(e,T,23+i,x+"80");for(let T=38;T<=43;T++){for(let _=19;_<=22;_++)c(e,_,T+i,h);for(let _=25;_<=28;_++)c(e,_,T+i,h)}for(let T=18;T<=23;T++)c(e,T,44+i,"#181820");for(let T=24;T<=29;T++)c(e,T,44+i,"#181820");for(let T=18;T<=29;T++)c(e,T,33+i,"#4a3020");c(e,23,33+i,x),c(e,24,33+i,x),l>=3&&(c(e,19,34+i,"#3a2818"),c(e,20,34+i,"#4a3020"),c(e,27,34+i,"#3a2818"),c(e,28,34+i,"#4a3020"));for(let T=23;T<=34;T++)c(e,15,T+i,h),c(e,16,T+i,u),c(e,31,T+i,u),c(e,32,T+i,y);c(e,14,35+i,"#4a4050"),c(e,15,35+i,t.base),c(e,32,35+i,t.base),c(e,33,35+i,"#4a4050");for(let T=28;T<=38;T++)c(e,13,T+i,"#c0c0d8"),c(e,34,T+i,"#c0c0d8");if(c(e,13,27+i,"#e0e0f0"),c(e,13,26+i,"#fff"),c(e,34,27+i,"#e0e0f0"),c(e,34,26+i,"#fff"),l>=5&&(c(e,13,27+i,x+"80"),c(e,34,27+i,x+"80")),l>=7&&(c(e,13,25+i,"#ff606040"),c(e,34,25+i,"#ff606040")),l>=5&&(c(e,23,27+i,x),c(e,24,27+i,x)),l>=10){const T=15+Math.floor(Math.sin(p*.9)*3);c(e,T,20+i,y+"40"),c(e,32-T+15,24+i,y+"30")}Cr(e,t,n,s,l,i,p,g);for(let T=15;T<=32;T++)for(let _=3;_<=8;_++){let E=u;_<=4||T<=16||T>=31?E=h:_<=5&&(E=y),c(e,T,_+i,E)}for(let T=9;T<=14;T++)c(e,15,T+i,h),c(e,16,T+i,u),c(e,31,T+i,u),c(e,32,T+i,h);l>=5&&(c(e,19,10+i,x+"60"),c(e,28,10+i,x+"60")),l>=7&&(c(e,23,4+i,"#fff"),c(e,24,4+i,"#fff"),c(e,23,5+i,x),c(e,24,5+i,x))}const vm={};function er(e,t){vm[e]=t}function EM(e,t,n){e.clearRect(0,0,36,36);const s=n%4<2?0:1,a=n%3;vm[t]?vm[t](e,n,s,a):t==="fire_spirit"?Y3(e,n,s,a):t==="wolf"?CM(e,n,s):t==="owl"?AM(e,n,s):t==="drake"?jM(e,n,s,a):t==="cat"?MM(e,n,s):t==="phoenix"?RM(e,n,s,a):t==="slime"?kM(e,n,s):t==="fairy"?IM(e,n,s):t==="dragon"?DM(e,n,s,a):Y3(e,n,s,a)}function Y3(e,t,n,s){for(let i=12;i<=24;i++)c(e,i,33,"#0003");[[16,10],[17,10],[18,10],[19,10],[15,11],[16,11],[17,11],[18,11],[19,11],[20,11],[14,12],[15,12],[16,12],[17,12],[18,12],[19,12],[20,12],[21,12],[13,13],[14,13],[15,13],[16,13],[17,13],[18,13],[19,13],[20,13],[21,13],[22,13],[13,14],[14,14],[15,14],[16,14],[17,14],[18,14],[19,14],[20,14],[21,14],[22,14],[13,15],[14,15],[15,15],[16,15],[17,15],[18,15],[19,15],[20,15],[21,15],[22,15],[14,16],[15,16],[16,16],[17,16],[18,16],[19,16],[20,16],[21,16],[14,17],[15,17],[16,17],[17,17],[18,17],[19,17],[20,17],[21,17],[15,18],[16,18],[17,18],[18,18],[19,18],[20,18],[15,19],[16,19],[17,19],[18,19],[19,19],[20,19],[16,20],[17,20],[18,20],[19,20],[16,21],[17,21],[18,21],[19,21],[17,22],[18,22]].forEach(([i,p])=>c(e,i,p-n,"#e67e22")),[[16,12],[17,12],[18,12],[19,12],[15,13],[16,13],[17,13],[18,13],[19,13],[20,13],[15,14],[16,14],[17,14],[18,14],[19,14],[20,14],[16,15],[17,15],[18,15],[19,15],[16,16],[17,16],[18,16],[19,16],[17,17],[18,17]].forEach(([i,p])=>c(e,i,p-n,"#f39c12")),[[17,13],[18,13],[17,14],[18,14],[17,15],[18,15],[17,16],[18,16]].forEach(([i,p])=>c(e,i,p-n,"#ffed4a")),[[17,14],[18,14],[17,15],[18,15]].forEach(([i,p])=>c(e,i,p-n,"#fff8e0")),(s===0?[[17,8],[18,9],[16,9]]:s===1?[[18,8],[17,9],[19,9]]:[[17,9],[18,8],[16,9],[19,9]]).forEach(([i,p])=>c(e,i,p-n,"#f39c12")),s===0&&c(e,17,7-n,"#ffed4a"),s===1&&c(e,18,7-n,"#ffed4a"),s===2&&(c(e,17,8-n,"#ffed4a"),c(e,18,7-n,"#fff8e0")),c(e,15,14-n,"#1a0505"),c(e,16,14-n,"#1a0505"),c(e,19,14-n,"#1a0505"),c(e,20,14-n,"#1a0505"),c(e,15,13-n,"#fff8"),c(e,19,13-n,"#fff8"),c(e,17,18-n,"#c06020"),c(e,18,18-n,"#c06020"),c(e,14,20-n,"#e67e2280"),c(e,21,20-n,"#e67e2280"),c(e,13,19-n,"#f39c1250"),c(e,22,19-n,"#f39c1250")}function CM(e,t,n){for(let s=10;s<=26;s++)c(e,s,33,"#0003");for(let s=16;s<=24;s++)for(let a=10;a<=24;a++){let l="#808898";s<=17?l="#9098a8":s>=23&&(l="#707888"),a<=11?l="#606878":a>=23&&(l="#9098a8"),c(e,a,s-n,l)}for(let s=20;s<=23;s++)for(let a=14;a<=20;a++)c(e,a,s-n,"#a8b0c0");for(let s=12;s<=18;s++)for(let a=20;a<=28;a++){let l="#9098a8";s<=13&&(l="#a0a8b8"),a>=27&&(l="#808898"),c(e,a,s-n,l)}for(let s=27;s<=30;s++)for(let a=15;a<=17;a++)c(e,s,a-n,"#a0a8b8");c(e,30,16-n,"#303040"),c(e,24,14-n,"#f0c040"),c(e,25,14-n,"#f0c040"),c(e,24,15-n,"#000"),c(e,25,15-n,"#806020"),c(e,24,13-n,"#fff8"),c(e,22,11-n,"#a0a8b8"),c(e,23,10-n,"#b0b8c8"),c(e,23,11-n,"#d8a0a0"),c(e,26,11-n,"#a0a8b8"),c(e,26,10-n,"#b0b8c8"),c(e,26,11-n,"#d8a0a0");for(let s=24;s<=29;s++)c(e,12,s-n,"#707888"),c(e,13,s-n,"#808898"),c(e,17,s-n,"#707888"),c(e,18,s-n,"#808898"),c(e,21,s-n,"#808898"),c(e,22,s-n,"#707888");for(let s=11;s<=14;s++)c(e,s,30-n,"#606878");for(let s=16;s<=19;s++)c(e,s,30-n,"#606878");for(let s=20;s<=23;s++)c(e,s,30-n,"#606878");c(e,8,16-n,"#9098a8"),c(e,9,15-n,"#a0a8b8"),c(e,9,16-n,"#9098a8"),c(e,7,15-n,"#a0a8b8"),c(e,7,14-n+(t%4<2?0:1),"#b0b8c8")}function AM(e,t,n){for(let a=12;a<=24;a++)c(e,a,33,"#0003");for(let a=14;a<=28;a++){const l=Math.floor(3+(a-14)/14*4);for(let i=18-l;i<=18+l;i++){let p="#a08050";a<=16?p="#b89060":a>=26&&(p="#907040"),i<=18-l+1&&(p="#806030"),c(e,i,a-n,p)}}for(let a=18;a<=26;a+=2)for(let l=15;l<=21;l+=2)c(e,l,a-n,"#c0a870");for(let a=8;a<=15;a++)for(let l=13;l<=23;l++){let i="#b89060";a<=9&&(i="#c0a870"),(l<=14||l>=22)&&(i="#a08050"),c(e,l,a-n,i)}for(let a=10;a<=14;a++)for(let l=14;l<=22;l++)c(e,l,a-n,"#d0b880");if(c(e,15,11-n,"#fff"),c(e,16,11-n,"#f0d040"),c(e,17,11-n,"#f0d040"),c(e,19,11-n,"#fff"),c(e,20,11-n,"#f0d040"),c(e,21,11-n,"#f0d040"),c(e,16,12-n,"#000"),c(e,20,12-n,"#000"),c(e,15,12-n,"#d0a020"),c(e,17,12-n,"#d0a020"),c(e,19,12-n,"#d0a020"),c(e,21,12-n,"#d0a020"),t%20===0){for(let a=15;a<=17;a++)c(e,a,11-n,"#a08050");for(let a=19;a<=21;a++)c(e,a,11-n,"#a08050")}c(e,17,13-n,"#d4a040"),c(e,18,13-n,"#e8b850"),c(e,19,13-n,"#d4a040"),c(e,18,14-n,"#c09030"),c(e,13,8-n,"#c0a870"),c(e,12,7-n,"#b89060"),c(e,12,6-n,"#a08050"),c(e,23,8-n,"#c0a870"),c(e,24,7-n,"#b89060"),c(e,24,6-n,"#a08050");const s=t%8<4;for(let a=16;a<=24;a++)c(e,12-(s?1:0),a-n,"#907040"),c(e,11-(s?1:0),a-n,"#806030"),c(e,24+(s?1:0),a-n,"#907040"),c(e,25+(s?1:0),a-n,"#806030");s&&(c(e,10,18-n,"#a08050"),c(e,26,18-n,"#a08050")),c(e,16,29-n,"#d4a040"),c(e,17,29-n,"#d4a040"),c(e,19,29-n,"#d4a040"),c(e,20,29-n,"#d4a040")}function jM(e,t,n,s){for(let l=10;l<=26;l++)c(e,l,33,"#0003");for(let l=16;l<=24;l++)for(let i=12;i<=24;i++){let p="#308848";l<=17?p="#409058":l>=23&&(p="#287038"),i<=13&&(p="#207030"),c(e,i,l-n,p)}for(let l=19;l<=23;l++)for(let i=15;i<=21;i++)c(e,i,l-n,"#60c078");for(let l=17;l<=22;l+=2)for(let i=13;i<=23;i+=2)c(e,i,l-n,"#287038");for(let l=10;l<=17;l++)for(let i=20;i<=28;i++){let p="#409058";l<=11&&(p="#50a868"),i>=27&&(p="#308040"),c(e,i,l-n,p)}for(let l=27;l<=31;l++)for(let i=13;i<=15;i++)c(e,l,i-n,"#50a868");c(e,31,13-n,"#308040"),c(e,31,15-n,"#308040"),s===0&&(c(e,32,14-n,"#f39c12"),c(e,33,14-n,"#ffed4a")),c(e,23,12-n,"#ff4040"),c(e,24,12-n,"#ff4040"),c(e,23,13-n,"#a02020"),c(e,24,13-n,"#cc3030"),c(e,23,11-n,"#fff8"),c(e,22,9-n,"#d4a040"),c(e,22,8-n,"#e8b850"),c(e,25,9-n,"#d4a040"),c(e,25,8-n,"#e8b850");for(let l=14;l<=22;l+=2)c(e,l,15-n,"#287038");const a=t%6<3;for(let l=12;l<=18;l++)c(e,10,l-n-(a?1:0),"#40a060"),c(e,11,l-n-(a?1:0),"#308848");if(c(e,9,12-n-(a?2:0),"#50b870"),c(e,9,13-n-(a?2:0),"#40a060"),a)for(let l=13;l<=16;l++)c(e,8,l-n-2,"#40a06080");for(let l=24;l<=28;l++)c(e,14,l-n,"#287038"),c(e,15,l-n,"#308848"),c(e,20,l-n,"#308848"),c(e,21,l-n,"#287038");c(e,13,29-n,"#d4a040"),c(e,14,29-n,"#d4a040"),c(e,15,29-n,"#d4a040"),c(e,19,29-n,"#d4a040"),c(e,20,29-n,"#d4a040"),c(e,21,29-n,"#d4a040");for(let l=0;l<6;l++)c(e,11-l,22+Math.floor(l*.5)-n,"#308848"),c(e,11-l,23+Math.floor(l*.5)-n,"#287038");c(e,5,24-n,"#d4a040"),c(e,5,25-n,"#d4a040")}function MM(e,t,n){for(let s=12;s<=24;s++)c(e,s,33,"#0003");for(let s=18;s<=26;s++)for(let a=13;a<=23;a++){const l=Math.sqrt((a-18)**2+((s-22)*1.4)**2);if(l<5.5){let i="#1a1828";l>4&&(i="#100e18"),c(e,a,s-n,i)}}for(let s=22;s<=25;s++)for(let a=16;a<=20;a++)c(e,a,s-n,"#282838");for(let s=10;s<=18;s++)for(let a=14;a<=22;a++)Math.sqrt((a-18)**2+((s-14)*1.1)**2)<4.5&&c(e,a,s-n,"#1a1828");c(e,14,9-n,"#1a1828"),c(e,13,8-n,"#1a1828"),c(e,13,7-n,"#100e18"),c(e,22,9-n,"#1a1828"),c(e,23,8-n,"#1a1828"),c(e,23,7-n,"#100e18"),c(e,14,8-n,"#403050"),c(e,22,8-n,"#403050"),c(e,16,13-n,"#40c060"),c(e,20,13-n,"#40c060"),c(e,16,14-n,"#000"),c(e,20,14-n,"#000"),t%8<2&&(c(e,16,13-n,"#60e080"),c(e,20,13-n,"#60e080")),c(e,18,15-n,"#403050"),c(e,14,15-n,"#30283840"),c(e,13,14-n,"#30283840"),c(e,22,15-n,"#30283840"),c(e,23,14-n,"#30283840");for(let s=26;s<=29;s++)c(e,14,s-n,"#100e18"),c(e,15,s-n,"#100e18"),c(e,21,s-n,"#100e18"),c(e,22,s-n,"#100e18");c(e,14,30-n,"#282838"),c(e,15,30-n,"#282838"),c(e,21,30-n,"#282838"),c(e,22,30-n,"#282838"),c(e,23,22-n,"#1a1828"),c(e,24,21-n,"#1a1828"),c(e,25,20-n,"#1a1828"),c(e,26,19-n,"#100e18"),c(e,26,18-n,"#1a1828"),c(e,25,17-n,"#100e18")}function RM(e,t,n,s){for(let l=14;l<=24;l++)for(let i=13;i<=23;i++){const p=Math.sqrt((i-18)**2+((l-19)*1.3)**2);if(p<5.5){let g="#e67e22";p>4?g="#c06018":p<2.5&&(g="#f39c12"),c(e,i,l-n,g)}}for(let l=18;l<=22;l++)for(let i=16;i<=20;i++)c(e,i,l-n,"#ffed4a");for(let l=8;l<=14;l++)for(let i=15;i<=21;i++){const p=Math.sqrt((i-18)**2+((l-11)*1.2)**2);if(p<4){let g="#e67e22";p<2&&(g="#f39c12"),c(e,i,l-n,g)}}c(e,17,6-n,"#f39c12"),c(e,18,5-n,"#ffed4a"),c(e,19,6-n,"#f39c12"),c(e,16,7-n,"#e67e22"),c(e,20,7-n,"#e67e22"),c(e,16,10-n,"#fff"),c(e,20,10-n,"#fff"),c(e,16,11-n,"#c03030"),c(e,20,11-n,"#c03030"),c(e,22,11-n,"#d4a040"),c(e,23,12-n,"#c09030");const a=t%6<3;for(let l=12;l<=22;l++){const i=Math.floor(Math.sin((l-12)/10*Math.PI)*(4+(a?2:0)));for(let p=13-i;p<=13;p++)p>=4&&c(e,p,l-n,l%2===0?"#e67e22":"#c06018");for(let p=23;p<=23+i;p++)p<=32&&c(e,p,l-n,l%2===0?"#e67e22":"#c06018")}a&&(c(e,6,16-n,"#ffed4a80"),c(e,30,16-n,"#ffed4a80"));for(let l=0;l<3;l++){const i=16+l*2;for(let p=24;p<=30;p++){const g=s===l?"#ffed4a":"#e67e22";c(e,i,p-n,g)}c(e,i,31-n,"#f39c1280")}t%4<2&&(c(e,14,26-n,"#ffed4a40"),c(e,22,28-n,"#f39c1240"))}function kM(e,t,n){for(let l=12;l<=24;l++)c(e,l,33,"#0003");const s=Math.sin(t*.2)*1;for(let l=14;l<=28;l++)for(let i=12;i<=24;i++){const p=21+s,g=Math.sqrt(((i-18)*.9)**2+((l-p)*1.2)**2);g<7&&(g<2?c(e,i,l-n,"#80f0a0"):g<4?c(e,i,l-n,"#50c870"):g<6?c(e,i,l-n,"#30a050"):c(e,i,l-n,"#208838"))}c(e,15,16-n,"#c0ffd880"),c(e,16,15-n,"#c0ffd860"),c(e,16,16-n,"#a0f0c040");for(let l=15;l<=16;l++)for(let i=19;i<=21;i++)c(e,l,i-n,"#000");for(let l=20;l<=21;l++)for(let i=19;i<=21;i++)c(e,l,i-n,"#000");c(e,15,19-n,"#fff8"),c(e,20,19-n,"#fff8"),c(e,17,23-n,"#208838"),c(e,18,24-n,"#208838"),c(e,19,23-n,"#208838");const a=t%12;a<6&&(c(e,14,28+Math.floor(a/3)-n,"#30a05060"),c(e,22,28+Math.floor(a/2)-n,"#30a05040"))}function IM(e,t,n,s){const a=Math.sin(t*.15)*1.5,l=Math.floor(a),i=t%4<2;for(let p=10;p<=20;p++){const g=Math.floor(Math.sin((p-10)/10*Math.PI)*(3+(i?2:0)));for(let v=14-g;v<=14;v++)v>=6&&c(e,v,p-n+l,"#c0a0f040");for(let v=22;v<=22+g;v++)v<=30&&c(e,v,p-n+l,"#c0a0f040")}t%6<2&&(c(e,10,14-n+l,"#fff6"),c(e,26,14-n+l,"#fff6"));for(let p=12;p<=20;p++)for(let g=15;g<=21;g++){const v=Math.sqrt((g-18)**2+((p-16)*1.3)**2);v<4&&(v<1.5?c(e,g,p-n+l,"#f0d0ff"):v<3?c(e,g,p-n+l,"#d0a0e0"):c(e,g,p-n+l,"#b080c0"))}c(e,16,15-n+l,"#2020a0"),c(e,20,15-n+l,"#2020a0");for(let p=0;p<4;p++){const g=t*.1+p/4*Math.PI*2,v=6+Math.sin(t*.06+p)*2,u=18+Math.floor(Math.cos(g)*v),h=16+Math.floor(Math.sin(g)*v*.8)-n+l;u>=0&&u<36&&h>=0&&h<36&&c(e,u,h,"#f0c0ff30")}for(let p=0;p<3;p++){const g=22+p*3,v=16+Math.floor(Math.sin(t*.12+p*2)*2);c(e,v,g-n+l,"#f0d06020")}}function DM(e,t,n,s){for(let l=6;l<=30;l++)c(e,l,33,"#0003");const a=t%8<4;for(let l=6;l<=20;l++){const i=Math.floor(Math.sin((l-6)/14*Math.PI)*(5+(a?3:0)));for(let p=10-i;p<=10;p++)p>=0&&c(e,p,l-n,"#702838");for(let p=26;p<=26+i;p++)p<=35&&c(e,p,l-n,"#702838")}if(a)for(let l=8;l<=16;l++)c(e,6,l-n,"#903848"),c(e,30,l-n,"#903848");for(let l=12;l<=26;l++)for(let i=10;i<=26;i++){const p=Math.sqrt(((i-18)*.85)**2+((l-19)*1.2)**2);if(p<7){let g="#802838";p>5?g="#601828":p<3&&(g="#a03848"),c(e,i,l-n,g)}}for(let l=16;l<=24;l++)for(let i=14;i<=22;i++)Math.sqrt((i-18)**2+((l-20)*1.4)**2)<4&&c(e,i,l-n,"#d0a060");for(let l=16;l<=26;l++)for(let i=6;i<=14;i++){const p=Math.sqrt(((l-21)*.9)**2+((i-10)*1.1)**2);if(p<5){let g="#802838";p<2&&(g="#a03848"),c(e,l,i-n,g)}}c(e,17,5-n,"#d4a040"),c(e,16,4-n,"#e8b850"),c(e,15,3-n,"#d4a040"),c(e,24,5-n,"#d4a040"),c(e,25,4-n,"#e8b850"),c(e,26,3-n,"#d4a040"),c(e,19,9-n,"#ff4040"),c(e,20,9-n,"#ff4040"),c(e,23,9-n,"#ff4040"),c(e,24,9-n,"#ff4040"),c(e,19,10-n,"#a02020"),c(e,24,10-n,"#a02020");for(let l=24;l<=28;l++)for(let i=10;i<=12;i++)c(e,l,i-n,"#903040");s<1&&(c(e,29,11-n,"#e67e22"),c(e,30,11-n,"#f39c12"),c(e,31,10-n,"#ffed4a"));for(let l=24;l<=30;l++)c(e,12,l-n,"#601828"),c(e,13,l-n,"#802838"),c(e,22,l-n,"#802838"),c(e,23,l-n,"#601828");c(e,11,30-n,"#d4a040"),c(e,12,30-n,"#d4a040"),c(e,13,30-n,"#d4a040"),c(e,22,30-n,"#d4a040"),c(e,23,30-n,"#d4a040"),c(e,24,30-n,"#d4a040");for(let l=0;l<6;l++)c(e,10-l,22+Math.floor(l*.6)-n,"#802838"),c(e,10-l,23+Math.floor(l*.6)-n,"#601828");c(e,4,25-n,"#d4a040"),c(e,3,25-n,"#e8b850");for(let l=0;l<4;l++)c(e,14+l*3,12-n,"#d4a040"),c(e,14+l*3,11-n,"#e8b850")}function NM(e,t,n,s,a){if(t==="scarf_red"){for(let l=20;l<=32;l++){const i=Math.sin(a*.15+(l-20)*.3)*2;c(e,33+Math.floor(i),l+s,"#c03030"),c(e,34+Math.floor(i),l+s,"#a02020")}c(e,22,20+s,"#c03030"),c(e,23,20+s,"#c03030"),c(e,24,20+s,"#c03030"),c(e,25,20+s,"#c03030")}else if(t==="shield_wood"){for(let l=24;l<=36;l++)for(let i=8;i<=14;i++){const p=Math.sqrt((i-11)**2+((l-30)*.8)**2);if(p<4.5){let g="#8a6830";p>3.5?g="#705020":p<2&&(g="#a08040"),c(e,i,l+s,g)}}c(e,11,28+s,"#604018"),c(e,11,32+s,"#604018"),c(e,9,30+s,"#604018"),c(e,13,30+s,"#604018")}else if(t==="shield_iron"){for(let l=24;l<=36;l++)for(let i=7;i<=14;i++){const p=Math.sqrt((i-10.5)**2+((l-30)*.75)**2);if(p<5){let g="#808898";p>4?g="#606878":p<2&&(g="#a0a8b8"),c(e,i,l+s,g)}}c(e,10,28+s,"#a0a8b8"),c(e,11,28+s,"#a0a8b8"),c(e,10,30+s,"#c0c8d0"),c(e,11,30+s,"#c0c8d0");for(let l=26;l<=34;l++)c(e,10,l+s,"#606878")}else if(t==="shield_energy"){const l=.7+Math.sin(a*.15)*.3,i=24,p=26,g=16,v=22;for(let h=0;h<Math.PI*2;h+=.06){const y=i+Math.cos(h)*g,x=p-Math.sin(h)*v,T=Math.floor(y),_=Math.floor(x)+s;if(T>=0&&T<48&&_>=0&&_<48){const E=Math.sin(h)>0?.9:.6,R=Math.floor(l*E*120);c(e,T,_,`#60d0ff${Math.min(R,255).toString(16).padStart(2,"0")}`);const P=Math.floor(i+Math.cos(h)*(g-1)),B=Math.floor(p-Math.sin(h)*(v-1))+s;P>=0&&P<48&&B>=0&&B<48&&c(e,P,B,`#80e0ff${Math.floor(R*.5).toString(16).padStart(2,"0")}`)}}for(let h=4;h<=46;h+=3){const x=Math.floor((h-4)/3)%2===0?0:2;for(let T=i-g+2+x;T<=i+g-2;T+=4){const _=(T-i)/g,E=(h-p)/v;if(_*_+E*E<.82){const R=Math.sin(a*.14+T*.4+h*.3)*.5+.5,P=Math.floor(R*l*60);if(P>3){const B=P.toString(16).padStart(2,"0");c(e,T,h-1+s,`#60d0ff${B}`),c(e,T-1,h+s,`#60d0ff${B}`),c(e,T+1,h+s,`#60d0ff${B}`),c(e,T,h+1+s,`#60d0ff${B}`),c(e,T-1,h-1+s,`#40b0e0${Math.floor(P*.4).toString(16).padStart(2,"0")}`),c(e,T+1,h-1+s,`#40b0e0${Math.floor(P*.4).toString(16).padStart(2,"0")}`)}}}}const u=a*.08;for(let h=3;h<g+2;h++){const y=i+Math.cos(u)*h,x=p-Math.sin(u)*h*(v/g),T=Math.floor(y),_=Math.floor(x)+s;T>=0&&T<48&&_>=0&&_<48&&c(e,T,_,"#a0f0ffe0");for(let E=1;E<=3;E++){const R=u-E*.06,P=Math.floor(i+Math.cos(R)*h),B=Math.floor(p-Math.sin(R)*h*(v/g))+s,X=1-E/4,Q=Math.floor(X*100);P>=0&&P<48&&B>=0&&B<48&&c(e,P,B,`#80e0ff${Q.toString(16).padStart(2,"0")}`)}}for(let h=0;h<4;h++)if((a+h*7)%14<3){const y=(a+h*7)%14*.4+h*1.8,x=Math.floor(i+Math.cos(y)*(g-1)),T=Math.floor(p-Math.sin(y)*(v-1))+s;if(x>=0&&x<48&&T>=0&&T<48){c(e,x,T,"#ffffffe0");for(let _=1;_<=2;_++){const E=_===1?"b0":"50";x-_>=0&&c(e,x-_,T,`#80e0ff${E}`),x+_<48&&c(e,x+_,T,`#80e0ff${E}`),T-_>=0&&c(e,x,T-_,`#80e0ff${E}`),T+_<48&&c(e,x,T+_,`#80e0ff${E}`)}}}for(let h=p-v+4;h<=p+v-4;h++)for(let y=i-g+4;y<=i+g-4;y++){const x=(y-i)/g,T=(h-p)/v,_=x*x+T*T;if(_<.6){const E=Math.floor((1-_/.6)*l*12);E>1&&c(e,y,h+s,`#60d0ff${E.toString(16).padStart(2,"0")}`)}}for(let h=i-g;h<=i+g;h++){const y=Math.abs(h-i);if(y<=g){const x=1-y/g,T=Math.floor(x*l*80);T>2&&(c(e,h,46+s,`#60d0ff${Math.min(T,255).toString(16).padStart(2,"0")}`),x>.5&&c(e,h,45+s,`#40b0e0${Math.floor(T*.4).toString(16).padStart(2,"0")}`))}}for(let h=i-8;h<=i+8;h++){const y=Math.abs(h-i),x=Math.floor((1-y/9)*l*70);if(x>2){const T=p-v+1;T+s>=0&&c(e,h,T+s,`#a0f0ff${x.toString(16).padStart(2,"0")}`)}}}else if(t==="halo_basic"){const l=1+s;for(let i=15;i<=32;i++){const g=(i-23.5)/8.5,v=Math.floor(Math.sqrt(1-g*g)*2);c(e,i,l-v,"#f0d060"),c(e,i,l-v+1,"#f0d060")}for(let i=17;i<=30;i++)c(e,i,l,"#ffe88090");c(e,19,l-1+s,"#fff8"),c(e,28,l-1+s,"#fff8"),a%6<3&&(c(e,16,l,"#fff6"),c(e,31,l,"#fff6")),a%4<2&&(c(e,23,l-2,"#ffe88050"),c(e,24,l-2,"#ffe88050"))}else if(t==="halo_fire"){const l=1+s;for(let p=14;p<=33;p++){c(e,p,l+2,"#c0501880"),c(e,p,l+1,"#e67e22");const g=Math.sin(a*.3+p*.6);c(e,p,l,"#f39c12"),g>0&&c(e,p,l-1,"#f5b041"),g>.3&&c(e,p,l-2,"#ffed4a90"),g>.7&&c(e,p,l-3,"#ffed4a50")}[15,19,23,27,31].forEach(p=>{const g=Math.sin(a*.25+p*.8);g>.2&&c(e,p,l-3,"#ffed4a70"),g>.5&&c(e,p,l-4,"#fff4")}),a%3<2&&(c(e,16+a%8,l-4,"#ffed4a50"),c(e,30-a%6,l-5,"#f39c1240")),a%5<2&&c(e,20+a%4,l-5,"#fff3")}else if(t==="shoulder_pads"){for(let l=18;l<=22;l++){for(let i=12;i<=16;i++){let p="#808898";l===18&&(p="#a0a8b8"),c(e,i,l+s,p)}for(let i=31;i<=35;i++){let p="#808898";l===18&&(p="#a0a8b8"),c(e,i,l+s,p)}}c(e,12,17+s,"#a0a8b8"),c(e,11,16+s,"#c0c8d0"),c(e,35,17+s,"#a0a8b8"),c(e,36,16+s,"#c0c8d0")}else if(t==="floating_book"){const l=a%8<4?0:1;for(let i=5;i<=12;i++)for(let p=24;p<=30;p++){let g="#6030a0";(p===24||p===30)&&(g="#482080"),(i===5||i===12)&&(g="#482080"),c(e,i,p-l+s,g)}for(let i=6;i<=11;i++)c(e,i,27-l+s,"#e8e0d8");c(e,5,25-l+s,"#402070"),c(e,5,26-l+s,"#402070"),c(e,5,28-l+s,"#402070"),c(e,5,29-l+s,"#402070"),a%6<3&&c(e,8,26-l+s,"#c080f040"),a%8<2&&(c(e,4,23-l+s,"#fff4"),c(e,13,28-l+s,"#fff4"))}else if(t==="floating_orbs")for(let i=0;i<3;i++){const p=a*.1+i/3*Math.PI*2,g=18+Math.sin(a*.05+i)*3,v=24+Math.floor(Math.cos(p)*g),u=24+Math.floor(Math.sin(p)*g*.55)+s;if(v>=-15&&v<63&&u>=1&&u<47){const y=["#60d0ff","#f060a0","#60f0a0"][i];c(e,v-1,u,y+"30"),c(e,v+1,u,y+"30"),c(e,v,u-1,y+"30"),c(e,v,u+1,y+"30"),c(e,v,u,y+"c0"),c(e,v+1,u,y+"a0"),c(e,v,u+1,y+"80"),c(e,v+1,u+1,y+"60"),c(e,v,u-1,y+"50");const x=p-.3,T=24+Math.floor(Math.cos(x)*g),_=24+Math.floor(Math.sin(x)*g*.55)+s;T>=0&&T<48&&_>=0&&_<48&&c(e,T,_,y+"25")}}else if(t==="floating_swords"){const l=Math.sin(a*.12)*1.5;for(let i=8;i<=24;i++)c(e,8,Math.floor(i+l)+s,"#a0a8b860"),i>=8&&i<=12&&c(e,9,Math.floor(i+l)+s,"#c0c8d040");c(e,8,Math.floor(7+l)+s,"#e0e0f080");for(let i=10;i<=26;i++)c(e,38,Math.floor(i-l)+s,"#a0a8b860"),i>=10&&i<=14&&c(e,37,Math.floor(i-l)+s,"#c0c8d040");c(e,38,Math.floor(9-l)+s,"#e0e0f080"),c(e,7,Math.floor(24+l)+s,"#d4a040"),c(e,9,Math.floor(24+l)+s,"#d4a040"),c(e,37,Math.floor(26-l)+s,"#d4a040"),c(e,39,Math.floor(26-l)+s,"#d4a040")}else if(t==="tech_drones")for(let l=0;l<3;l++){const i=a*.12+l/3*Math.PI*2,p=24+Math.floor(Math.cos(i)*20),g=22+Math.floor(Math.sin(i)*14)+s;if(p>=-14&&p<62&&g>=2&&g<46){c(e,p-1,g,"#606878"),c(e,p,g,"#808898"),c(e,p+1,g,"#606878"),c(e,p-1,g+1,"#505868"),c(e,p,g+1,"#707888"),c(e,p+1,g+1,"#505868"),a%2===0?(c(e,p-2,g-1,"#a0a8b880"),c(e,p+2,g-1,"#a0a8b880"),c(e,p-3,g-1,"#a0a8b840"),c(e,p+3,g-1,"#a0a8b840")):(c(e,p-1,g-1,"#a0a8b880"),c(e,p+1,g-1,"#a0a8b880"),c(e,p-2,g-2,"#a0a8b840"),c(e,p+2,g-2,"#a0a8b840"));const v=l===0?"#60d0ff":"#ff4040";c(e,p,g,v+"a0"),(a+l*4)%8<3&&(c(e,p,g+2,v+"30"),c(e,p,g+3,v+"15"))}}else if(t==="chain_wrap"){for(let l=14;l<=42;l++){const i=Math.sin(a*.1+(l-14)*.25)*2.5,p=Math.floor(8+i);p>=1&&p<47&&(c(e,p,l+s,"#b0b8c860"),c(e,p+1,l+s,"#a0a8b840"),l%3===0&&(c(e,p,l+s,"#c8d0d880"),c(e,p-1,l+s,"#b0b8c830")))}for(let l=16;l<=44;l++){const i=Math.sin(a*.1+2.5+(l-16)*.25)*2.5,p=Math.floor(38+i);p>=1&&p<47&&(c(e,p,l+s,"#b0b8c860"),c(e,p-1,l+s,"#a0a8b840"),l%3===0&&(c(e,p,l+s,"#c8d0d880"),c(e,p+1,l+s,"#b0b8c830")))}for(let l=22;l<=38;l++){const i=Math.sin(a*.08+4.5+(l-22)*.2)*3,p=Math.floor(24+i);l%4<2&&c(e,p,l+s,"#a0a8b825")}c(e,8,43+s,"#b0b8c850"),c(e,8,44+s,"#a0a8b830"),c(e,38,45+s,"#b0b8c850"),c(e,38,46,"#a0a8b830")}else if(t==="cape_basic"){for(let l=20+s;l<=44+s;l++){const i=Math.floor((l-20)*.3);for(let p=13-i;p<=14;p++)p>=8&&c(e,p,l,"#802020");for(let p=33;p<=34+i;p++)p<=39&&c(e,p,l,"#802020")}for(let l=22+s;l<=42+s;l++)c(e,14,l,"#a03030"),c(e,33,l,"#a03030");for(let l=22+s;l<=44+s;l++)c(e,22,l,"#70181880"),c(e,25,l,"#70181880")}else if(t==="cape_royal"){for(let l=18+s;l<=44+s;l++){const i=Math.floor((l-18)*.35),p=(l-18)/26,g=Math.floor(80+p*60),v=Math.floor(10+p*5),u=Math.floor(80-p*50),h=`rgb(${g},${v},${u})`;for(let y=12-i;y<=14;y++)y>=6&&c(e,y,l,h);for(let y=33;y<=35+i;y++)y<=41&&c(e,y,l,h)}for(let l=20+s;l<=44+s;l++){const i=Math.floor((l-18)*.35);c(e,Math.max(6,12-i),l,"#d4a040"),c(e,Math.min(41,35+i),l,"#d4a040")}c(e,22,20+s,"#f0c848"),c(e,25,20+s,"#f0c848"),c(e,23,20+s,"#d4a040"),c(e,24,20+s,"#d4a040")}else if(t==="wings_small"){const i=a%6<3?2:0;for(let p=-1;p<=1;p+=2){const g=p<0?14:33,v=p;for(let u=0;u<14;u++){const h=u/13,y=g+v*Math.floor(h*16+i*h*2),x=Math.floor(16-Math.sin(h*Math.PI)*6)+s;y>=-16&&y<64&&x>=0&&x<48&&(c(e,y,x,"#88ccff35"),c(e,y,x+1,"#88ccff25"),u%3===0&&c(e,y,x,"#aaddff50"))}for(let u=12-i;u<=20;u++){const h=u-(12-i),y=Math.floor(Math.sin(h/8*Math.PI)*12*(1+i*.1));for(let x=0;x<y;x++){const T=g+v*x;T>=-16&&T<64&&c(e,T,u+s,"#88ccff18")}}for(let u=0;u<3;u++)for(let h=0;h<10;h++){const y=h/9,x=(u-1)*.3,T=g+v*Math.floor(y*14),_=Math.floor(16+x*h*1.5-i*y)+s;T>=-16&&T<64&&_>=0&&_<48&&c(e,T,_,"#aaddff30")}for(let u=20;u<=30;u++){const h=u-20,y=Math.floor(Math.sin(h/10*Math.PI)*10*(1+i*.08));for(let x=0;x<y;x++){const T=g+v*x;T>=-16&&T<64&&c(e,T,u+s,"#88ccff14")}}for(let u=0;u<8;u++){const h=u/7,y=g+v*Math.floor(h*10),x=Math.floor(25-Math.sin(h*Math.PI)*4)+s;y>=-16&&y<64&&x>=0&&x<48&&c(e,y,x,"#aaddff28")}}a%4<2&&(c(e,6,14+s,"#d0f0ff50"),c(e,41,16+s,"#ffd0f050")),a%6<2&&(c(e,4,18+s,"#fff4"),c(e,43,18+s,"#fff4"))}else if(t==="wings_bat"){const i=a%6<3?2:0;for(let p=-1;p<=1;p+=2){const g=p<0?14:33,v=22+s,u=p,h=[[u*20,-18-i],[u*22,-10-i],[u*19,-3-i],[u*13,4]],y=h.map(([E,R])=>[g+E,v+R]);for(let E=0;E<y.length-1;E++){const[R,P]=y[E],[B,X]=y[E+1],Q=Math.min(g,R,B),K=Math.max(g,R,B);for(let k=Q;k<=K;k++){if(k<-16||k>=64)continue;const I=B-R||1,N=Math.max(0,Math.min(1,(k-R)/I)),U=p<0?k<=g?Math.floor(v+(P-v)*((g-k)/(g-R||1))):v:k>=g?Math.floor(v+(P-v)*((k-g)/(R-g||1))):v,z=p<0?k<=g?Math.floor(v+(X-v)*((g-k)/(g-B||1))):v:k>=g?Math.floor(v+(X-v)*((k-g)/(B-g||1))):v,q=Math.min(U,z),D=Math.floor(P+(X-P)*N),de=Math.floor(Math.sin(N*Math.PI)*6),je=D+de;for(let W=q;W<=je;W++)if(W>=0&&W<48){const J=(W-q)/(je-q+1);J<.3?c(e,k,W,"#D4B896"):J<.6?c(e,k,W,"#C8A882"):J<.85?c(e,k,W,"#B89870"):c(e,k,W,"#8B7355")}}}const[x,T]=y[y.length-1],_=Math.max(Math.abs(x-g),Math.abs(T-v),1);for(let E=0;E<=_;E++){const R=E/_,P=Math.floor(x+(g-x)*R),B=Math.floor(T+(v-T)*R);P>=-16&&P<64&&B>=0&&B<48&&c(e,P,B,"#C8A882")}h.forEach(([E,R],P)=>{const B=Math.max(Math.abs(E),Math.abs(R));for(let K=0;K<=B;K++){const k=K/B,I=Math.sin(k*Math.PI)*2*u,N=Math.floor(g+E*k+I),U=Math.floor(v+R*k);N>=-16&&N<64&&U>=0&&U<48&&(c(e,N,U,"#604838"),K<3&&c(e,N,U,"#785848"))}const X=g+E,Q=v+R;P===0&&X>=-16&&X<64&&Q>=0&&Q<48&&(c(e,X+u,Q,"#785848"),c(e,X+u,Q-1,"#685040"))})}}else if(t==="wings_angel"){const l=a%8<4,i=l?3:0;for(let p=14;p<=34;p++){const g=p-14,v=Math.floor(Math.sin(g/20*Math.PI)*(7+i));for(let u=14-v;u<=14;u++)u>=2&&c(e,u,p+s,u%2===0?"#e8e8f0":"#d0d0e0");for(let u=33;u<=33+v;u++)u<=45&&c(e,u,p+s,u%2===0?"#e8e8f0":"#d0d0e0")}if(l)for(let p=18;p<=30;p+=3)c(e,6,p+s,"#f0f0f8"),c(e,41,p+s,"#f0f0f8");a%6<2&&(c(e,8,20+s,"#fff4"),c(e,39,22+s,"#fff4"))}else if(t==="wings_dragon"){const i=a%8<4?3:0;for(let p=-1;p<=1;p+=2){const g=p<0?14:33,v=20+s,u=p,h=[[u*22,-20-i],[u*24,-12-i],[u*21,-4-i],[u*15,4],[u*8,10]],y=h.map(([E,R])=>[g+E,v+R]);for(let E=0;E<y.length-1;E++){const[R,P]=y[E],[B,X]=y[E+1],Q=Math.min(g,R,B),K=Math.max(g,R,B);for(let k=Q;k<=K;k++){if(k<-16||k>=64)continue;const I=B-R||1,N=Math.max(0,Math.min(1,(k-R)/I)),U=p<0?k<=g?Math.floor(v+(P-v)*((g-k)/(g-R||1))):v:k>=g?Math.floor(v+(P-v)*((k-g)/(R-g||1))):v,z=p<0?k<=g?Math.floor(v+(X-v)*((g-k)/(g-B||1))):v:k>=g?Math.floor(v+(X-v)*((k-g)/(B-g||1))):v,q=Math.min(U,z),D=Math.floor(P+(X-P)*N),de=Math.floor(Math.sin(N*Math.PI)*8),je=D+de;for(let W=q;W<=je;W++)if(W>=0&&W<48){const J=(W-q)/(je-q+1);J<.2?c(e,k,W,"#E8944C"):J<.45?c(e,k,W,"#E07840"):J<.7?c(e,k,W,"#D06838"):J<.9?c(e,k,W,"#C05830"):c(e,k,W,"#8B3020")}}}const[x,T]=y[y.length-1],_=Math.max(Math.abs(x-g),Math.abs(T-v),1);for(let E=0;E<=_;E++){const R=E/_,P=Math.floor(x+(g-x)*R),B=Math.floor(T+(v-T)*R);P>=-16&&P<64&&B>=0&&B<48&&c(e,P,B,"#D06838")}h.forEach(([E,R],P)=>{const B=Math.max(Math.abs(E),Math.abs(R));for(let K=0;K<=B;K++){const k=K/B,I=Math.sin(k*Math.PI)*2.5*u,N=Math.floor(g+E*k+I),U=Math.floor(v+R*k);N>=-16&&N<64&&U>=0&&U<48&&(c(e,N,U,"#483020"),K<4&&(c(e,N,U,"#604030"),c(e,N,U+1,"#503828")))}const X=g+E,Q=v+R;P===0&&X>=-16&&X<64&&Q>=0&&Q<48&&(c(e,X+u,Q,"#604030"),c(e,X+u,Q-1,"#705040"),c(e,X+u*2,Q-1,"#d4a040")),P>0&&P<3&&X>=-16&&X<64&&Q>=0&&Q<48&&c(e,X,Q+1,"#503828")})}}else if(t==="crown_divine"){const l=1+s,i=.7+Math.sin(a*.1)*.3;for(let h=l-6;h<=l+4;h++)for(let y=10;y<=37;y++){const x=(y-23.5)/14,T=(h-(l-1))/5,_=x*x+T*T;if(_<1){const E=Math.floor((1-_)*i*30);E>1&&c(e,y,h,`#ffe880${E.toString(16).padStart(2,"0")}`)}}for(let h=13;h<=34;h++)c(e,h,l+2,"#b88818"),c(e,h,l+1,"#d4a020"),c(e,h,l,"#f0c030"),(h-13)%3===1&&c(e,h,l+1,"#f0d860");const p=[14,19,23,27,32],g=[4,5,7,5,4];p.forEach((h,y)=>{const x=g[y];for(let _=1;_<=x;_++){const E=_>x-2?0:1;c(e,h,l-_,"#f0c030"),E&&(c(e,h-1,l-_,"#d4a020"),c(e,h+1,l-_,"#d4a020"))}const T=Math.sin(a*.15+y*1.2)*.5+.5;for(let _=x+1;_<=x+6;_++){const E=1-(_-x-1)/6,R=Math.floor(E*T*50);R>1&&l-_>=0&&c(e,h,l-_,`#ffe880${R.toString(16).padStart(2,"0")}`)}});for(let h=0;h<p.length-1;h++){const y=Math.floor((p[h]+p[h+1])/2);c(e,y,l-1,"#d4a020"),c(e,y-1,l-1,"#d4a02080"),c(e,y+1,l-1,"#d4a02080"),c(e,y,l-2,"#f0c03060")}[{color:"#e03050",glow:"#ff506080"},{color:"#2868e0",glow:"#4888ff80"},{color:"#20c050",glow:"#40e07080"},{color:"#c040d0",glow:"#e060f080"}].forEach((h,y)=>{const x=a*.06+y/4*Math.PI*2,T=16+Math.sin(a*.04+y)*2,_=Math.floor(23.5+Math.cos(x)*T),E=Math.floor(l-1+Math.sin(x)*3);if(_>=0&&_<48&&E>=0&&E<48){c(e,_-1,E,h.glow),c(e,_+1,E,h.glow),c(e,_,E-1,h.glow),c(e,_,E+1,h.glow),c(e,_,E,h.color);const R=x-.15,P=Math.floor(23.5+Math.cos(R)*T),B=Math.floor(l-1+Math.sin(R)*3);P>=0&&P<48&&B>=0&&B<48&&c(e,P,B,"#fff4")}}),c(e,16,l,"#e03040"),c(e,20,l,"#2868d0"),c(e,24,l,"#60d0f0"),c(e,28,l,"#30b050"),c(e,31,l,"#e03040");const u=a%6<3;c(e,23,l-6,u?"#a0e0ff":"#60d0f0"),c(e,22,l-5,"#80d0ff80"),c(e,24,l-5,"#80d0ff80"),c(e,23,l-5,u?"#ffffff":"#a0e0ff"),u&&["#ff404040","#f0c03040","#40e06040","#4080ff40","#c040d040"].forEach((y,x)=>{const T=x/5*Math.PI-Math.PI/2+Math.sin(a*.05)*.3;for(let _=2;_<7;_++){const E=Math.floor(23+Math.cos(T)*_),R=Math.floor(l-6+Math.sin(T)*_);E>=0&&E<48&&R>=0&&R<48&&c(e,E,R,y)}});for(let h=0;h<8;h++){const y=12+(h*4+a)%24,x=(a*.08+h*1.5)%10,T=Math.floor(l-8+x);if(T>=0&&T<48&&y<48){const _=x/10;c(e,y,T,_>.5?"#ffe88030":"#fff6")}}}}function LM(e,t,n,s,a){if(t==="aura_basic"){for(let i=0;i<14;i++){const p=.09+i%3*.02,g=a*p+i/14*Math.PI*2,v=12+i%4*2,u=10+i%3*3,h=24+Math.floor(Math.cos(g)*v),y=24+Math.floor(Math.sin(g)*u)+s;if(h>=0&&h<48&&y>=0&&y<48){c(e,h,y,n.robeLight+"80");const x=g-p*2,T=24+Math.floor(Math.cos(x)*v),_=24+Math.floor(Math.sin(x)*u)+s;T>=0&&T<48&&_>=0&&_<48&&c(e,T,_,n.robeLight+"30")}}for(let i=0;i<8;i++){const p=-a*.12+i/8*Math.PI*2,g=24+Math.floor(Math.cos(p)*6),v=24+Math.floor(Math.sin(p)*5)+s;g>=0&&g<48&&v>=0&&v<48&&c(e,g,v,"#fff3")}for(let i=0;i<5;i++)if((a+i*7)%5<2){const p=8+(a*3+i*13)%32,g=4+(a*5+i*17)%38;c(e,p,g+s,"#fff6")}for(let i=14;i<=33;i++){const p=Math.abs(i-23.5);p<8&&c(e,i,45+s,n.robeLight+"20"),p<5&&c(e,i,46+s,n.robeLight+"15")}}else if(t==="aura_fire"){for(let l=0;l<2;l++){const i=l===0?10:35,p=l===0?-1:1;for(let g=44;g>=8;g--){const v=(44-g)/36,u=Math.sin(a*.3+g*.4+l*3)*2,h=i+Math.floor(u);h>=0&&h<48&&(v<.3?c(e,h,g+s,"#e67e22a0"):v<.5?c(e,h,g+s,"#f39c1280"):v<.7?c(e,h,g+s,"#ffed4a60"):c(e,h,g+s,"#fff8e040"),v<.5&&(c(e,h+p,g+s,"#e67e2250"),v<.2&&c(e,h+p*2,g+s,"#e67e2225")))}}for(let l=0;l<18;l++){const i=.1+l%5*.04,p=8+l*7%32,g=(a*i+l*5.7)%28,v=Math.floor(46-g)+s,u=Math.sin(a*.15+l*2.3)*3,h=Math.floor(p+u);if(v>=0&&v<48&&h>=0&&h<48){const y=g/28;y<.2?c(e,h,v,"#ff4500b0"):y<.4?c(e,h,v,"#e67e2290"):y<.6?c(e,h,v,"#f39c1260"):y<.8?c(e,h,v,"#ffed4a40"):c(e,h,v,"#fff8e020")}}for(let l=10;l<=37;l++)(a+l*3)%4<2?c(e,l,45+s,"#e67e2260"):c(e,l,45+s,"#f39c1240"),l>=14&&l<=33&&c(e,l,46+s,"#e67e2230");for(let l=38;l>=10;l-=4){const i=Math.floor(Math.sin(a*.2+l*.3)*1.5);c(e,23+i,l+s,"#ff450010"),c(e,24+i,l+s,"#ff450010")}}else if(t==="aura_holy"){const l=.7+Math.sin(a*.12)*.3;for(let g=0;g<=47;g++){const v=(1-Math.abs(g-22)/26)*l,u=Math.floor(Math.max(0,v)*55);if(u>2){const h=Math.floor(5+Math.sin(g*.15+a*.08)*2);for(let y=24-h;y<=23+h;y++){const x=1-Math.abs(y-23.5)/(h+1),T=Math.floor(u*Math.max(0,x));T>1&&c(e,y,g+s,`#f0d060${T.toString(16).padStart(2,"0")}`)}}}for(let g=0;g<8;g++){const v=g/8*Math.PI*2+a*.03;for(let u=6;u<20;u++){const h=Math.sin(a*.1+u*.3+g)*.15,y=24+Math.floor(Math.cos(v+h)*u),x=22+Math.floor(Math.sin(v+h)*u*.85)+s,T=1-(u-6)/14,_=Math.floor(T*35*l);y>=0&&y<48&&x>=0&&x<48&&_>1&&c(e,y,x,`#ffe880${_.toString(16).padStart(2,"0")}`)}}const i=[{y:4,r:14,rY:3,count:20,speed:.06,color:"#f0d060"},{y:22,r:18,rY:16,count:28,speed:-.04,color:"#ffe880"},{y:40,r:12,rY:3,count:16,speed:.08,color:"#f0c030"}];for(const g of i)for(let v=0;v<g.count;v++){const u=a*g.speed+v/g.count*Math.PI*2,h=24+Math.floor(Math.cos(u)*g.r),y=g.y+Math.floor(Math.sin(u)*g.rY)+s;if(h>=0&&h<48&&y>=0&&y<48){const x=v%4===0?"90":"40";c(e,h,y,g.color+x)}}for(let g=0;g<14;g++){const v=.08+g%5*.025,u=8+g*4%32,h=((-a*v+g*3.7)%48+48)%48,y=Math.floor(47-h)+s,x=Math.sin(a*.1+g*2.1)*3,T=Math.floor(u+x);if(y>=0&&y<48&&T>=0&&T<48){const _=h/48,E=Math.floor(_*70);E>2&&c(e,T,y,`#ffe880${E.toString(16).padStart(2,"0")}`),(a+g*3)%8<2&&_>.5&&c(e,T,y,"#ffffffa0")}}const p=a%6<3;for(let g=14;g<=33;g++){const v=Math.abs(g-23.5),u=Math.floor((1-v/10)*(p?80:50));u>2&&(c(e,g,0+s,`#f0d060${u.toString(16).padStart(2,"0")}`),c(e,g,1+s,`#ffe880${Math.floor(u*.7).toString(16).padStart(2,"0")}`))}c(e,23,0+s,p?"#ffffffc0":"#ffe880a0"),c(e,24,0+s,p?"#ffffffc0":"#ffe880a0");for(let g=10;g<=37;g++){const v=Math.abs(g-23.5);if(v<14){const u=Math.floor((1-v/14)*4+Math.sin(a*.2+g*.7)*2);for(let h=0;h<u;h++){const y=46-h+s;y>=0&&y<48&&c(e,g,y,["#f0d06060","#ffe88050","#fff8e040","#ffffff30"][Math.min(h,3)])}}}if(a%20<3){const g=a%20,v=8+g*5;for(let u=0;u<16;u++){const h=u/16*Math.PI*2;for(let y=v-3;y<=v;y++){const x=24+Math.floor(Math.cos(h)*y),T=22+Math.floor(Math.sin(h)*y*.8)+s,_=1-g/3,E=Math.floor(_*40);x>=0&&x<48&&T>=0&&T<48&&E>1&&c(e,x,T,`#ffffff${E.toString(16).padStart(2,"0")}`)}}}}else if(t==="aura_lightning"){const l=[a%12,(a+4)%12,(a+8)%12];for(const i of l)if(i<4){let v=24+(i%2===0?-1:1)*(6+i%3*3),u=6;for(let h=0;h<8;h++){const y=v+Math.floor(((i*7+h*13)%5-2)*1.5),x=u+4+h%2,T=y-v,_=Math.max(Math.abs(T),x-u);for(let E=0;E<=_;E++){const R=Math.floor(v+T*E/_),P=Math.floor(u+(x-u)*E/_)+s;R>=0&&R<48&&P>=0&&P<48&&(c(e,R,P,i<2?"#60e0ffb0":"#60e0ff60"),R>0&&c(e,R-1,P,"#60e0ff20"),R<47&&c(e,R+1,P,"#60e0ff20"))}if(v=y,u=x,u>=44)break}}for(let i=0;i<12;i++)if((a*3+i*11)%7<3){const p=6+(a*5+i*19)%36,g=4+(a*3+i*23)%38;p<48&&g<48&&c(e,p,g+s,i%3===0?"#ffffff90":"#60e0ff70")}for(let i=14;i<=33;i++)(a+i*5)%8<2&&(c(e,i,45+s,"#60e0ff50"),(a+i)%6<1&&c(e,i,44+s,"#ffffff40"));for(let i=0;i<6;i++){const p=a*.15+i/6*Math.PI*2,g=24+Math.floor(Math.cos(p)*11),v=24+Math.floor(Math.sin(p)*10)+s;g>=0&&g<48&&v>=0&&v<48&&c(e,g,v,"#60e0ff25")}}else if(t==="power_sparkle"){for(let l=0;l<20;l++){const i=.08+l%4*.02,p=a*i+l/20*Math.PI*2,g=16+l%3*4,v=24+Math.floor(Math.cos(p)*g),u=24+Math.floor(Math.sin(p)*g*.65)+s;if(v>=-16&&v<64&&u>=0&&u<48){const y=["#fff","#ffe080","#80d0ff","#f0a0f0"][l%4];c(e,v,u,y),c(e,v,u-1,y+"80");const x=p-i*3,T=24+Math.floor(Math.cos(x)*g),_=24+Math.floor(Math.sin(x)*g*.65)+s;T>=-16&&T<64&&_>=0&&_<48&&c(e,T,_,y+"40");const E=p-i*5,R=24+Math.floor(Math.cos(E)*g),P=24+Math.floor(Math.sin(E)*g*.65)+s;R>=-16&&R<64&&P>=0&&P<48&&c(e,R,P,y+"20")}}for(let l=0;l<8;l++)if((a+l*5)%7<2){const i=-8+(a*3+l*11)%56,p=2+(a*5+l*17)%42;c(e,i,p+s,"#fff")}for(let l=10;l<=37;l++)(l+a)%3===0&&c(e,l,45+s,"#ffe08040")}else if(t==="power_leaves"){for(let l=0;l<16;l++){const i=.06+l%3*.03,p=a*i+l/16*Math.PI*2,g=14+l%4*3+Math.sin(a*.04+l)*2,v=24+Math.floor(Math.cos(p)*g),u=22+Math.floor(Math.sin(p)*g*.6)+s;if(v>=-16&&v<64&&u>=0&&u<48){const y=["#40a040","#60c060","#80d060","#308830"][l%4];c(e,v,u,y),c(e,v+1,u,y+"80"),l%3===0&&(c(e,v,u+1,y+"60"),c(e,v-1,u,y+"40"))}}for(let l=0;l<4;l++){const i=10+l*9+Math.floor(Math.sin(a*.1+l)*2);for(let p=-10;p<50;p+=3){const g=p+(a*2+l*5)%6;g>=-16&&g<64&&c(e,g,i+s,"#60c06015")}}for(let l=12;l<=35;l+=2)c(e,l,45+s,"#40a04030")}else if(t==="power_bubbles"){for(let l=0;l<12;l++){const i=l*13+7,p=4+(i*7+Math.floor(a*1.5))%40-4,g=(i*5+a*2)%50,v=Math.floor(46-g)+s;if(p>=-16&&p<64&&v>=0&&v<48){const u=l%3;c(e,p,v,"#60c0f0"),c(e,p+1,v,"#60c0f0"),c(e,p,v-1,"#80d8ff80"),c(e,p+1,v-1,"#80d8ff80"),u>0&&(c(e,p-1,v,"#60c0f060"),c(e,p+2,v,"#60c0f060"),c(e,p,v+1,"#60c0f040")),u>1&&(c(e,p,v-2,"#80d8ff40"),c(e,p+1,v-2,"#80d8ff40")),c(e,p,v-1,"#fff8")}}for(let l=0;l<24;l++){const i=l/24*Math.PI*2+a*.04,p=24+Math.floor(Math.cos(i)*18),g=24+Math.floor(Math.sin(i)*15)+s;p>=-16&&p<64&&g>=0&&g<48&&c(e,p,g,"#60c0f030")}}else if(t==="power_music"){for(let i=0;i<8;i++){const p=a*.09+i/8*Math.PI*2,g=16+Math.sin(a*.05+i*2)*3,v=24+Math.floor(Math.cos(p)*g),u=22+Math.floor(Math.sin(p)*g*.6)+s;if(v>=-16&&v<64&&u>=0&&u<48){const y=["#f060a0","#60a0f0","#f0c040","#60f0a0","#c060f0","#f08060","#80f0f0","#f0f060"][i%8];c(e,v,u,y),c(e,v,u-1,y+"80"),c(e,v-1,u,y+"40"),i%2===0&&c(e,v+1,u,y+"60")}}for(let i=0;i<3;i++){const p=8+(a*2+i*12)%24;if(p<24){const g=Math.floor((1-p/24)*60).toString(16).padStart(2,"0");for(let v=0;v<16;v++){const u=v/16*Math.PI*2,h=24+Math.floor(Math.cos(u)*p),y=24+Math.floor(Math.sin(u)*p*.6)+s;h>=-16&&h<64&&y>=0&&y<48&&c(e,h,y,`#f060a0${g}`)}}}}else if(t==="power_snowflake"){for(let l=0;l<18;l++){const i=l*13+7,p=(i*3+a*1.5)%52-4,g=(i*5+a*2.5)%48,v=Math.sin(a*.06+l)*3;p>=-16&&p<64&&(c(e,Math.floor(p+v),Math.floor(g)+s,"#d0e8ff"),l%3===0&&(c(e,Math.floor(p+v)+1,Math.floor(g)+s,"#d0e8ff80"),c(e,Math.floor(p+v),Math.floor(g)+1+s,"#d0e8ff60")),l%6===0&&c(e,Math.floor(p+v),Math.floor(g)+s,"#fff"))}for(let l=0;l<20;l++){const i=l/20*Math.PI*2+a*.03,p=16+Math.sin(i*3)*2,g=24+Math.floor(Math.cos(i)*p),v=24+Math.floor(Math.sin(i)*p*.65)+s;g>=-16&&g<64&&v>=0&&v<48&&c(e,g,v,"#a0d0ff40")}for(let l=8;l<=39;l++)(l+a)%4<2&&c(e,l,45+s,"#d0e8ff30"),(l+a)%6===0&&c(e,l,44+s,"#a0d0ff20");for(let l=28;l<=44;l+=3)c(e,-2+Math.floor(Math.sin(l*.5)*2),l+s,"#d0e8ff30"),c(e,49+Math.floor(Math.sin(l*.5)*2),l+s,"#d0e8ff30")}else if(t==="power_hearts"){for(let l=0;l<8;l++){const i=a*.06+l/8*Math.PI*2,p=16+Math.sin(a*.04+l*2)*3,g=24+Math.floor(Math.cos(i)*p),v=22+Math.floor(Math.sin(i)*p*.6)+s;if(g>=-16&&g<64&&v>=0&&v<48){const u=l%2===0?"#f06080":"#f0a0b0";c(e,g-1,v-1,u),c(e,g+1,v-1,u),c(e,g-2,v,u+"80"),c(e,g,v,u),c(e,g+2,v,u+"80"),c(e,g-1,v,u),c(e,g+1,v,u),c(e,g,v+1,u+"a0")}}for(let l=0;l<2;l++){const i=6+(a*2+l*10)%24;if(i<24){const p=Math.floor((1-i/24)*80).toString(16).padStart(2,"0");for(let g=0;g<20;g++){const v=g/20*Math.PI*2,u=24+Math.floor(Math.cos(v)*i),h=24+Math.floor(Math.sin(v)*i*.6)+s;u>=-16&&u<64&&h>=0&&h<48&&c(e,u,h,`#f06080${p}`)}}}}else if(t==="power_matrix"){for(let i=0;i<10;i++){const p=-6+i*6,g=2+i%3;for(let v=0;v<10;v++){const u=(a*g+i*11+v*5)%52-4,h=1-v/10,y=v===0;if(u>=-4&&u<48)if(y)c(e,p,u+s,"#80ff80");else{const x=Math.floor(h*80).toString(16).padStart(2,"0");c(e,p,u+s,`#40c060${x}`)}}}const l=a*3%48;for(let i=-10;i<=57;i+=2)c(e,i,l+s,"#40c06025");for(let i=-10;i<=57;i+=2)i!==24&&c(e,i,(l+1)%48+s,"#40c06010");for(let i=0;i<48;i+=4)(i+a)%8<4&&(c(e,-8,i+s,"#40c06040"),c(e,55,i+s,"#40c06040"))}else if(t==="power_shadow"){for(let l=0;l<8;l++){const i=-4+l*7,p=Math.sin(a*.08+l*1.7)*4;for(let g=46;g>=10;g--){const v=(46-g)/36,u=p*v,h=Math.floor(i+u);if(h>=-16&&h<64&&v>0){const y=l%2===0?"#b060e0":"#60c0d0";v<.3?c(e,h,g+s,y):v<.6?c(e,h,g+s,y+"a0"):c(e,h,g+s,y+"50"),v<.4&&(c(e,h+1,g+s,y+"40"),c(e,h-1,g+s,y+"30"))}}}for(let l=-8;l<=55;l++)if(l>=-16&&l<64){const i=Math.abs(l-24);if(i<22){const p=(l+a)%4<2;c(e,l,45+s,p?"#b060e0":"#60c0d0"),c(e,l,46+s,p?"#60c0d080":"#b060e080"),i<14&&c(e,l,44+s,p?"#b060e040":"#60c0d040")}}for(let l=0;l<6;l++){const i=a*.08+l*1.05,p=14+l*2,g=24+Math.floor(Math.cos(i)*p),v=26+Math.floor(Math.sin(i)*p*.5)+s;if(g>=-16&&g<64&&v>=0&&v<48){const u=l%3===0?"#e0a0ff":l%3===1?"#80e0e0":"#c080f0";c(e,g,v,u),c(e,g+1,v,u+"80"),c(e,g,v-1,u+"60");const h=i-.3,y=24+Math.floor(Math.cos(h)*p),x=26+Math.floor(Math.sin(h)*p*.5)+s;y>=-16&&y<64&&x>=0&&x<48&&c(e,y,x,u+"40")}}for(let l=0;l<10;l++)if((a+l*3)%6<3){const i=-6+(a*2+l*11)%56,p=6+(a*3+l*17)%36;i>=-16&&i<64&&c(e,i,p+s,l%2===0?"#e0a0ff":"#80e0e0")}if(a%4<2)for(let l=-2;l<=2;l++)for(let i=-1;i<=1;i++)c(e,24+l,36+i+s,"#b060e018")}else if(t==="power_vortex"){for(let i=0;i<3;i++){const p=10+i*6,g=(i===1?-1:1)*(.08+i*.02),v=14+i*4;for(let u=0;u<v;u++){const h=a*g+u/v*Math.PI*2,y=24+Math.floor(Math.cos(h)*p),x=24+Math.floor(Math.sin(h)*p*.6)+s;if(y>=-16&&y<64&&x>=0&&x<48){const T=i===0?"#c080f0":i===1?"#80c0f0":"#d0a0ff";c(e,y,x,T),u%4===0&&(c(e,y,x-1,T+"80"),c(e,y+1,x,T+"60"))}}}for(let i=0;i<6;i++){const p=a*.06+i/6*Math.PI*2;for(let g=10;g<=22;g+=2){const v=24+Math.floor(Math.cos(p)*g),u=24+Math.floor(Math.sin(p)*g*.6)+s;v>=-16&&v<64&&u>=0&&u<48&&c(e,v,u,"#c080f018")}}const l=(Math.sin(a*.15)+1)*2;for(let i=-1;i<=1;i++)for(let p=-1;p<=1;p++)c(e,24+p,24+i+s,"#c080f0"+Math.floor(20+l*10).toString(16).padStart(2,"0"))}else if(t==="power_sakura"){for(let l=0;l<20;l++){const i=l*11+5,p=(i*7+a*1.2)%60-8,g=(i*5+a*1.8)%48,v=Math.sin(a*.06+l)*4,h=["#f8b0c0","#f0a0b8","#f8c0d0","#e890a8"][l%4],y=Math.floor(p+v),x=Math.floor(g)+s;y>=-16&&y<64&&x>=0&&x<48&&(c(e,y,x,h),l%3===0&&(c(e,y+1,x,h+"80"),c(e,y,x+1,h+"60")),l%5===0&&(c(e,y-1,x,h+"40"),c(e,y+1,x+1,h+"30")))}for(let l=0;l<3;l++){const i=12+l*10;for(let p=-10;p<55;p+=4){const g=p+(a*3+l*7)%8;g>=-16&&g<64&&c(e,g,i+s,"#f8b0c010")}}for(let l=6;l<=41;l+=2)c(e,l,45+s,"#f8b0c030"),l%4===0&&c(e,l,44+s,"#f0a0b818")}else if(t==="power_galaxy"){for(let l=0;l<3;l++)for(let i=0;i<30;i++){const p=i/30,g=p*Math.PI*3.5+l*(Math.PI*2/3)+a*.05,v=2+p*20,u=24+Math.floor(Math.cos(g)*v),h=24+Math.floor(Math.sin(g)*v*.55)+s;if(u>=-16&&u<64&&h>=0&&h<48){const y=["#4060c0","#6060d0","#8060c0","#c06080","#e08060","#f0a060"],x=Math.min(5,Math.floor(p*6));c(e,u,h,y[x]),i%3===0&&c(e,u+1,h,y[x]+"60")}}for(let l=-1;l<=1;l++)for(let i=-1;i<=1;i++){const p=Math.abs(i)+Math.abs(l);c(e,24+i,24+l+s,p===0?"#fff":"#ffe080a0")}for(let l=0;l<10;l++)if((a+l*5)%8<3){const i=-8+(a*3+l*13)%56,p=2+(a*5+l*17)%42;i>=-16&&i<64&&c(e,i,p+s,"#fff")}for(let l=0;l<6;l++){const i=a*.03+l,p=24+Math.floor(Math.cos(i)*12),g=24+Math.floor(Math.sin(i)*8)+s;p>=-16&&p<64&&g>=0&&g<48&&c(e,p,g,"#8060c020")}}else if(t==="power_phoenix"){const i=a%8<4?4:0;for(let p=6;p<=32;p++){const g=(p-6)/26,v=Math.floor(Math.sin(g*Math.PI)*(14+i));for(let u=14-v;u<=14;u++)if(u>=-16){const h=(14-u)/(v||1),y=h>.7?"#ffed4a":"#f39c12";c(e,u,p+s,y+(h>.5?"50":"30"))}for(let u=33;u<=33+v;u++)if(u<64){const h=(u-33)/(v||1),y=h>.7?"#ffed4a":"#f39c12";c(e,u,p+s,y+(h>.5?"50":"30"))}}for(let p=0;p<=24;p++){const g=(24-p)/24,v=Math.floor(2+g*3+Math.sin(p*.4+a*.2)*1.5);for(let u=-v;u<=v;u++){const h=24+u;if(h>=-16&&h<64){const y=Math.abs(u)/(v||1);c(e,h,p+s,y<.3?"#fff8e060":y<.6?"#ffed4a40":"#f39c1225")}}}for(let p=0;p<10;p++){const g=-4+(a*3+p*11)%56,v=(a*2+p*7)%24;g>=-16&&g<64&&c(e,g,v+s,p%2===0?"#f39c12":"#ffed4a")}for(let p=6;p<=41;p++)(p+a)%3<2&&c(e,p,45+s,"#e67e22"),(p+a)%5===0&&c(e,p,44+s,"#f39c1280")}else if(t==="power_glitch"){for(let i=0;i<8;i++){const p=(a*7+i*31)%150,g=-8+p%56,v=2+p*3%42,u=3+p%5,h=1+p%2;for(let y=0;y<h;y++)for(let x=0;x<u;x++){const T=g+x;if(T>=-16&&T<64&&v+y>=0&&v+y<48){const _=i%3===0?"#60d0ff":i%3===1?"#f04040":"#40ff40";c(e,T,v+y+s,_)}}}const l=a*4%48;for(let i=-14;i<=61;i++)i>=-16&&i<64&&(c(e,i,l+s,"#60d0ff40"),c(e,i+1,(l+1)%48+s,"#f0404030"),c(e,i-1,(l+2)%48+s,"#40ff4030"));for(let i=0;i<15;i++){const p=(a*13+i*29)%60-6,g=(a*17+i*23)%44+2;p>=-16&&p<64&&c(e,p,g+s,i%2===0?"#fff":"#60d0ff")}for(let i=0;i<4;i++){const p=8+i*10;(a+i)%3===0&&(c(e,-10,p+s,"#f04040"),c(e,57,p+s,"#40ff40"))}}else if(t==="power_void"){for(let l=0;l<4;l++){const i=6+l*5,p=.08+l*.02,g=l%2===0?1:-1,v=16+l*4;for(let u=0;u<v;u++){const h=a*p*g+u/v*Math.PI*2,y=24+Math.floor(Math.cos(h)*i),x=24+Math.floor(Math.sin(h)*i*.65)+s;if(y>=-16&&y<64&&x>=0&&x<48){const T=l<3?["#201038","#401860","#6030a0"][l]:"#8040c0";c(e,y,x,T),u%4===0&&c(e,y+1,x,T+"80")}}}for(let l=-3;l<=3;l++)for(let i=-3;i<=3;i++){const p=Math.sqrt(i*i+l*l);p<=3&&c(e,24+i,24+l+s,p<1.5?"#080418":"#100828")}for(let l=0;l<8;l++){const i=a*.12+l*.78,p=(a+l*8)%20/20,g=20*(1-p),v=24+Math.floor(Math.cos(i)*g),u=24+Math.floor(Math.sin(i)*g*.6)+s;if(v>=-16&&v<64&&u>=0&&u<48){const h=p<.5?"#c080f0":"#8040c0";c(e,v,u,h),p<.3&&c(e,v+1,u,h+"60")}}for(let l=0;l<6;l++){const i=6+l*7;c(e,-6+a%4,i+s,"#401860"),c(e,53-a%4,i+s,"#401860")}}else if(t==="power_rainbow"){const l=["#ff4040","#ff8020","#f0d040","#40c060","#4080f0","#8040c0"];for(let i=0;i<6;i++){const p=14+i*1.5,g=24;for(let v=0;v<g;v++){const u=a*.04+i*.2+v/g*Math.PI*2,h=24+Math.floor(Math.cos(u)*p),y=24+Math.floor(Math.sin(u)*p*.6)+s;h>=-16&&h<64&&y>=0&&y<48&&(c(e,h,y,l[i]),v%3===0&&c(e,h,y-1,l[i]+"60"))}}for(let i=0;i<6;i++){const p=a*.06+i/6*Math.PI*2;for(let g=10;g<=22;g++){const v=24+Math.floor(Math.cos(p)*g),u=24+Math.floor(Math.sin(p)*g*.6)+s;v>=-16&&v<64&&u>=0&&u<48&&c(e,v,u,l[i]+"40")}}for(let i=0;i<8;i++)if((a+i*4)%6<2){const p=-6+(a*3+i*13)%56,g=4+(a*5+i*17)%38;p>=-16&&p<64&&c(e,p,g+s,l[i%6])}for(let i=6;i<=41;i++)c(e,i,45+s,l[(i+a)%6]+"40")}}const PM={techforger:{id:"techforger",name:"Techforger",icon:"",pack:"hero",description:"Armored genius with repulsor technology",unlockLevel:4,color:{robe:"#a02020",robeMid:"#c03030",robeDark:"#701010",robeLight:"#e04040",accent:"#f0c848"},abilities:{passive:"Arc Reactor  +15% XP from perfect lesson scores",active:"Repulsor Blast  Deal 4 damage on next correct answer (5 question cooldown)"}},stormcaller:{id:"stormcaller",name:"Stormcaller",icon:"",pack:"hero",description:"Thunder god wielding an enchanted hammer",unlockLevel:11,color:{robe:"#3848a0",robeMid:"#4858b8",robeDark:"#202870",robeLight:"#6080d0",accent:"#f0c848"},abilities:{passive:"Worthy  Streak bonuses are 50% more effective",active:"Thunder Strike  All teams deal +2 damage for 1 question (6 question cooldown)"}},razorfang:{id:"razorfang",name:"Razorfang",icon:"",pack:"hero",description:"Feral fighter with indestructible claws",unlockLevel:13,color:{robe:"#c0a020",robeMid:"#d8b830",robeDark:"#806810",robeLight:"#f0d848",accent:"#303030"},abilities:{passive:"Regeneration  Heal 1 class HP every 5 questions",active:"Berserker Slash  Triple damage but take 1 class HP damage (3 question cooldown)"}},titan:{id:"titan",name:"Titan",icon:"",pack:"hero",description:"Unstoppable green powerhouse of pure rage",unlockLevel:23,color:{robe:"#408030",robeMid:"#509840",robeDark:"#285020",robeLight:"#70c050",accent:"#806040"},abilities:{passive:"Rage Build  Each consecutive correct answer deals +1 more damage (resets on wrong)",active:"Smash  Deal 6 damage, ignores boss armor (8 question cooldown)"}},nightprowler:{id:"nightprowler",name:"Nightprowler",icon:"",pack:"hero",description:"Fearless vigilante who fights without sight",unlockLevel:14,color:{robe:"#a02028",robeMid:"#c03038",robeDark:"#701018",robeLight:"#e04850",accent:"#a02028"},abilities:{passive:"Radar Sense  See hint for every other question automatically",active:"Pressure Point  Stun boss, preventing counterattack for 2 questions (5 question cooldown)"}},paragon:{id:"paragon",name:"Paragon",icon:"",pack:"hero",description:"Invulnerable hero of truth and justice",unlockLevel:25,color:{robe:"#2848a0",robeMid:"#3860c0",robeDark:"#183070",robeLight:"#5080e0",accent:"#c03030"},abilities:{passive:"Invulnerable  Class takes 50% less counterattack damage (rounded down)",active:"Solar Flare  Heal full class HP to max (10 question cooldown)"}},shadowknight:{id:"shadowknight",name:"Shadowknight",icon:"",pack:"hero",description:"Dark armored detective who strikes from shadows",unlockLevel:27,color:{robe:"#282838",robeMid:"#383848",robeDark:"#181820",robeLight:"#484860",accent:"#f0c848"},abilities:{passive:"Prepared  Start each boss battle with a free shield charge",active:"Smoke Bomb  Team is immune to counterattack for 2 questions (6 question cooldown)"}},tempest:{id:"tempest",name:"Tempest",icon:"",pack:"hero",description:"Weather controller with power over wind and lightning",unlockLevel:16,color:{robe:"#e0e0f0",robeMid:"#f0f0ff",robeDark:"#b0b0c8",robeLight:"#ffffff",accent:"#6090e0"},abilities:{passive:"Wind Shield  25% chance to deflect counterattack damage to boss",active:"Hurricane  Deal 2 damage to boss for each teammate who answered correctly this round (4 question cooldown)"}},blinker:{id:"blinker",name:"Blinker",icon:"",pack:"hero",description:"Teleporting acrobat with a devilish tail",unlockLevel:17,color:{robe:"#2828a0",robeMid:"#3838c0",robeDark:"#181870",robeLight:"#5050e0",accent:"#c03030"},abilities:{passive:"Teleport  Dodge counterattack entirely on correct answers",active:"Bamf Strike  Teleport behind boss, guaranteed crit on next answer (4 question cooldown)"}},webslinger:{id:"webslinger",name:"Webslinger",icon:"",pack:"hero",description:"Wisecracking acrobat who swings between buildings",unlockLevel:6,color:{robe:"#a02020",robeMid:"#c03030",robeDark:"#701010",robeLight:"#e04040",accent:"#2040a0"},abilities:{passive:"Spider Sense  Preview next question's category before answering",active:"Web Trap  Boss can't attack for 3 questions (6 question cooldown)"}},shellstrike:{id:"shellstrike",name:"Shellstrike",icon:"",pack:"hero",description:"Masked mutant warrior trained in ancient combat arts",unlockLevel:7,color:{robe:"#308030",robeMid:"#409840",robeDark:"#206020",robeLight:"#50b850",accent:"#c07020"},abilities:{passive:"Shell Defense  Take 1 less counterattack damage (min 0)",active:"Cowabunga  Deal double damage and heal 1 class HP on correct answer (5 question cooldown)"}},sparkpaw:{id:"sparkpaw",name:"Sparkpaw",icon:"",pack:"hero",description:"Tiny electric creature with shocking power",unlockLevel:9,color:{robe:"#d0b020",robeMid:"#e0c830",robeDark:"#a08010",robeLight:"#f0e040",accent:"#c03020"},abilities:{passive:"Static  Correct answers have 20% chance to deal +2 bonus damage",active:"Thunderbolt  Deal 5 damage (4 question cooldown)"}},blazewing:{id:"blazewing",name:"Blazewing",icon:"",pack:"hero",description:"Fearsome winged fire beast",unlockLevel:33,color:{robe:"#d06020",robeMid:"#e07830",robeDark:"#a04010",robeLight:"#f09040",accent:"#f0c030"},abilities:{passive:"Flame Body  Wrong answers against you deal 1 damage back to boss",active:"Fire Blast  Deal 4 damage and burn boss for 1 per question for 3 questions (7 question cooldown)"}},thornbeast:{id:"thornbeast",name:"Thornbeast",icon:"",pack:"hero",description:"Ancient plant beast with regenerating vines",unlockLevel:19,color:{robe:"#307848",robeMid:"#409858",robeDark:"#205030",robeLight:"#50b868",accent:"#d04060"},abilities:{passive:"Overgrowth  Heal 1 class HP every 4 questions",active:"Solar Beam  Charge for 1 question, then deal 8 damage (6 question cooldown)"}},tidalshell:{id:"tidalshell",name:"Tidalshell",icon:"",pack:"hero",description:"Armored water fortress with twin cannons",unlockLevel:21,color:{robe:"#3060a0",robeMid:"#4078c0",robeDark:"#204070",robeLight:"#6098e0",accent:"#e0e0f0"},abilities:{passive:"Torrent  Deal +2 bonus damage when class HP is below 50%",active:"Hydro Pump  Deal 5 damage and push boss back 1 phase (6 question cooldown)"}}};function Dl(e,t,n,s,a,l){for(let i=a;i<=l;i++)for(let p=24-s;p<=23+s;p++){let g=t.robe;p<24-s+2?g=t.robeDark:p>23+s-2&&(g=t.robeLight),c(e,p,i+n,g)}}function zM(e,t,n,s,a,l,i,p,g,v){for(let h=15;h<=32;h++)c(e,h,46,"#0004");Dl(e,a,i,6,22,40);const u=p%6<3?1:0;c(e,23,28+i,"#60d0ff"),c(e,24,28+i,"#60d0ff"),c(e,23,29+i,"#80e0ff"),c(e,24,29+i,"#80e0ff"),u&&(c(e,22,28+i,"#60d0ff60"),c(e,25,29+i,"#60d0ff60"));for(let h=18;h<=29;h++)c(e,h,34+i,a.accent);for(let h=18;h<=29;h++)c(e,h,22+i,a.accent);for(let h=40;h<=44;h++){for(let y=18;y<=22;y++)c(e,y,h+i,a.robeDark);for(let y=25;y<=29;y++)c(e,y,h+i,a.robeDark)}for(let h=17;h<=23;h++)c(e,h,44+i,a.accent);for(let h=24;h<=30;h++)c(e,h,44+i,a.accent);for(let h=23;h<=36;h++)c(e,14,h+i,a.robeDark),c(e,15,h+i,a.robe),c(e,32,h+i,a.robe),c(e,33,h+i,a.robeLight);c(e,13,36+i,"#60d0ff"),c(e,14,37+i,"#60d0ff80"),c(e,34,36+i,"#60d0ff"),c(e,33,37+i,"#60d0ff80");for(let h=17;h<=30;h++)for(let y=4;y<=19;y++){let x=a.robe;y<=6?x=a.robeLight:(h<=18||h>=29)&&(x=a.robeDark),c(e,h,y+i,x)}for(let h=19;h<=28;h++)for(let y=9;y<=16;y++)c(e,h,y+i,a.accent);for(let h=19;h<=22;h++)c(e,h,12+i,"#fff");for(let h=25;h<=28;h++)c(e,h,12+i,"#fff");for(let h=20;h<=27;h++)c(e,h,4+i,a.robeLight);l>=7&&(c(e,23,3+i,"#60d0ff"),c(e,24,3+i,"#60d0ff"))}function OM(e,t,n,s,a,l,i,p,g,v){for(let u=14;u<=33;u++)c(e,u,46,"#0004");for(let u=20+i;u<=44+i;u++){const h=Math.floor((u-20)*.25);c(e,12-h,u,"#a02020"),c(e,35+h,u,"#a02020")}Dl(e,a,i,7,22,40),c(e,21,26+i,"#c0c0d0"),c(e,22,26+i,"#c0c0d0"),c(e,25,26+i,"#c0c0d0"),c(e,26,26+i,"#c0c0d0");for(let u=17;u<=30;u++)c(e,u,34+i,a.accent);for(let u=35;u<=44;u++){for(let h=18;h<=22;h++)c(e,h,u+i,a.robe);for(let h=25;h<=29;h++)c(e,h,u+i,a.robe)}for(let u=17;u<=23;u++)c(e,u,44+i,a.robeDark);for(let u=24;u<=30;u++)c(e,u,44+i,a.robeDark);for(let u=23;u<=36;u++)c(e,14,u+i,a.robeDark),c(e,15,u+i,a.robe),c(e,32,u+i,a.robe),c(e,33,u+i,a.robeLight);c(e,14,37+i,t.base),c(e,15,37+i,t.base),c(e,32,37+i,t.base),c(e,33,37+i,t.base);for(let u=10;u<=38;u++)c(e,36,u+i,"#7a5a18");for(let u=34;u<=39;u++)for(let h=8;h<=14;h++)c(e,u,h+i,"#808898");c(e,35,8+i,"#a0a8b8"),c(e,38,8+i,"#a0a8b8"),l>=7&&(c(e,36,7+i,"#60d0ff80"),c(e,37,7+i,"#60d0ff60")),Cr(e,t,n,s,l,i,p,g);for(let u=17;u<=30;u++)c(e,u,5+i,a.robeDark);for(let u=18;u<=29;u++)c(e,u,4+i,a.robe);c(e,15,6+i,"#fff"),c(e,14,5+i,"#fff"),c(e,13,4+i,"#fff"),c(e,32,6+i,"#fff"),c(e,33,5+i,"#fff"),c(e,34,4+i,"#fff")}function VM(e,t,n,s,a,l,i,p,g,v){for(let u=16;u<=31;u++)c(e,u,46,"#0004");for(let u=22;u<=40;u++)for(let h=18;h<=29;h++){let y=a.robe;(h<=19||h>=28)&&(y=a.accent),c(e,h,u+i,y)}for(let u=18;u<=29;u++)c(e,u,34+i,a.accent);c(e,23,34+i,a.robe),c(e,24,34+i,a.robe);for(let u=40;u<=44;u++){for(let h=18;h<=22;h++)c(e,h,u+i,a.accent);for(let h=25;h<=29;h++)c(e,h,u+i,a.accent)}for(let u=23;u<=35;u++)c(e,15,u+i,a.accent),c(e,16,u+i,a.robe),c(e,31,u+i,a.robe),c(e,32,u+i,a.accent);c(e,14,36+i,t.base),c(e,15,36+i,t.base),c(e,32,36+i,t.base),c(e,33,36+i,t.base);for(let u=0;u<3;u++){for(let h=30;h<=40;h++)c(e,11+u*2,h+i,"#c0c0d8"),c(e,34+u*2,h+i,"#c0c0d8");c(e,11+u*2,29+i,"#e0e0f0"),c(e,34+u*2,29+i,"#e0e0f0")}Cr(e,t,n,s,l,i,p,g);for(let u=0;u<5;u++){const h=17+u*3;c(e,h,2+i,n.base),c(e,h,1+i,n.hi),c(e,h+1,3+i,n.mid)}c(e,17,4+i,a.accent),c(e,16,3+i,a.accent),c(e,15,2+i,a.accent),c(e,30,4+i,a.accent),c(e,31,3+i,a.accent),c(e,32,2+i,a.accent)}function BM(e,t,n,s,a,l,i,p,g,v){for(let u=12;u<=35;u++)c(e,u,46,"#0004");for(let u=20;u<=40;u++)for(let h=15;h<=32;h++){let y=a.robe;h<=16?y=a.robeDark:h>=31&&(y=a.robeLight),c(e,h,u+i,y)}for(let u=36;u<=44;u++){for(let h=16;h<=22;h++)c(e,h,u+i,"#806040");for(let h=25;h<=31;h++)c(e,h,u+i,"#806040");u===36&&(c(e,16,u+i,a.robe),c(e,22,u+i,a.robe),c(e,25,u+i,a.robe),c(e,31,u+i,a.robe))}for(let u=21;u<=38;u++)c(e,11,u+i,a.robeDark),c(e,12,u+i,a.robe),c(e,13,u+i,a.robe),c(e,34,u+i,a.robe),c(e,35,u+i,a.robe),c(e,36,u+i,a.robeLight);for(let u=10;u<=14;u++)for(let h=38;h<=40;h++)c(e,u,h+i,a.robeLight);for(let u=33;u<=37;u++)for(let h=38;h<=40;h++)c(e,u,h+i,a.robeLight);for(let u=19;u<=28;u++)for(let h=8;h<=19;h++){let y=a.robe;h<=9?y=a.robeLight:h>=18&&(y=a.robeDark),c(e,u,h+i,y)}for(let u=20;u<=22;u++)c(e,u,13+i,"#fff");for(let u=25;u<=27;u++)c(e,u,13+i,"#fff");c(e,21,14+i,"#000"),c(e,26,14+i,"#000"),c(e,20,12+i,a.robeDark),c(e,21,11+i,a.robeDark),c(e,22,12+i,a.robeDark),c(e,25,12+i,a.robeDark),c(e,26,11+i,a.robeDark),c(e,27,12+i,a.robeDark),c(e,22,17+i,a.robeDark),c(e,23,17+i,a.robeDark),c(e,24,17+i,a.robeDark),c(e,25,17+i,a.robeDark);for(let u=18;u<=29;u++)for(let h=6;h<=9;h++)c(e,u,h+i,n.base)}function UM(e,t,n,s,a,l,i,p,g,v){for(let u=16;u<=31;u++)c(e,u,46,"#0004");Dl(e,a,i,5,22,42);for(let u=38;u<=44;u++){for(let h=19;h<=22;h++)c(e,h,u+i,a.robeDark);for(let h=25;h<=28;h++)c(e,h,u+i,a.robeDark)}for(let u=23;u<=35;u++)c(e,16,u+i,a.robeDark),c(e,17,u+i,a.robe),c(e,30,u+i,a.robe),c(e,31,u+i,a.robeLight);c(e,15,36+i,t.base),c(e,16,36+i,t.base),c(e,31,36+i,t.base),c(e,32,36+i,t.base);for(let u=16;u<=38;u++)c(e,34,u+i,"#808080");c(e,34,15+i,"#a0a0a0"),Cr(e,t,n,s,l,i,p,g);for(let u=18;u<=29;u++)for(let h=10;h<=14;h++)c(e,u,h+i,a.robe);c(e,19,7+i,a.robe),c(e,28,7+i,a.robe),c(e,19,6+i,a.robeLight),c(e,28,6+i,a.robeLight)}function qM(e,t,n,s,a,l,i,p,g,v){for(let u=14;u<=33;u++)c(e,u,46,"#0004");for(let u=20+i;u<=44+i;u++){const h=Math.floor((u-20)*.3);c(e,12-h,u,a.accent),c(e,35+h,u,a.accent)}Dl(e,a,i,7,22,40),c(e,23,26+i,a.accent),c(e,24,26+i,a.accent),c(e,22,27+i,a.accent),c(e,23,27+i,"#f0c848"),c(e,24,27+i,"#f0c848"),c(e,25,27+i,a.accent),c(e,23,28+i,a.accent),c(e,24,28+i,a.accent);for(let u=17;u<=30;u++)c(e,u,34+i,a.accent);for(let u=35;u<=44;u++){for(let h=18;h<=22;h++)c(e,h,u+i,a.robe);for(let h=25;h<=29;h++)c(e,h,u+i,a.robe)}for(let u=17;u<=23;u++)c(e,u,44+i,a.accent);for(let u=24;u<=30;u++)c(e,u,44+i,a.accent);for(let u=23;u<=36;u++)c(e,14,u+i,a.robeDark),c(e,15,u+i,a.robe),c(e,32,u+i,a.robe),c(e,33,u+i,a.robeLight);c(e,14,37+i,t.base),c(e,15,37+i,t.base),c(e,32,37+i,t.base),c(e,33,37+i,t.base),Cr(e,t,n,s,l,i,p,g),c(e,22,4+i,n.base),c(e,23,3+i,n.hi),c(e,24,4+i,n.base)}function HM(e,t,n,s,a,l,i,p,g,v){for(let u=14;u<=33;u++)c(e,u,46,"#0004");for(let u=18+i;u<=44+i;u++){const h=Math.floor((u-18)*.35);for(let y=12-h;y<=13;y++)y>=4&&c(e,y,u,a.robeDark);for(let y=34;y<=35+h;y++)y<=43&&c(e,y,u,a.robeDark)}for(let u=0;u<4;u++)c(e,6+u*3,44+i,a.robe),c(e,36+u*3,44+i,a.robe);Dl(e,a,i,6,22,40),c(e,21,27+i,a.accent),c(e,22,26+i,a.accent),c(e,23,27+i,a.accent),c(e,24,27+i,a.accent),c(e,25,26+i,a.accent),c(e,26,27+i,a.accent);for(let u=18;u<=29;u++)c(e,u,34+i,a.accent);c(e,20,35+i,a.accent),c(e,23,35+i,a.accent),c(e,27,35+i,a.accent);for(let u=36;u<=44;u++){for(let h=18;h<=22;h++)c(e,h,u+i,a.robeDark);for(let h=25;h<=29;h++)c(e,h,u+i,a.robeDark)}for(let u=23;u<=36;u++)c(e,15,u+i,a.robeDark),c(e,16,u+i,a.robe),c(e,31,u+i,a.robe),c(e,32,u+i,a.robeLight);for(let u=14;u<=16;u++)for(let h=32;h<=36;h++)c(e,u,h+i,a.robe);c(e,13,33+i,a.robe),c(e,12,34+i,a.robe);for(let u=17;u<=30;u++)for(let h=5;h<=19;h++){let y=a.robeDark;h>=11&&h<=15&&u>=20&&u<=27||c(e,u,h+i,y)}for(let u=20;u<=27;u++)for(let h=11;h<=15;h++)c(e,u,h+i,t.base);for(let u=21;u<=23;u++)c(e,u,12+i,"#fff");for(let u=25;u<=27;u++)c(e,u,12+i,"#fff");c(e,18,4+i,a.robeDark),c(e,18,3+i,a.robeDark),c(e,18,2+i,a.robe),c(e,29,4+i,a.robeDark),c(e,29,3+i,a.robeDark),c(e,29,2+i,a.robe)}function FM(e,t,n,s,a,l,i,p,g,v){for(let h=14;h<=33;h++)c(e,h,46,"#0004");for(let h=20+i;h<=44+i;h++){const y=Math.floor((h-20)*.25);c(e,13-y,h,a.robeDark),c(e,34+y,h,a.robeDark)}Dl(e,a,i,5,22,42),c(e,23,27+i,a.accent),c(e,22,28+i,a.accent),c(e,23,29+i,a.accent),c(e,24,28+i,a.accent);for(let h=19;h<=28;h++)c(e,h,34+i,a.accent);for(let h=36;h<=44;h++){for(let y=19;y<=22;y++)c(e,y,h+i,a.robe);for(let y=25;y<=28;y++)c(e,y,h+i,a.robe)}for(let h=23;h<=35;h++)c(e,16,h+i,a.robeDark),c(e,17,h+i,a.robe),c(e,30,h+i,a.robe),c(e,31,h+i,a.robeLight);const u=p%4;c(e,14,36+i,"#60d0ff"),c(e,15,35+i,"#80e0ff"),c(e,33,36+i,"#60d0ff"),c(e,32,35+i,"#80e0ff"),u<2&&(c(e,13,37+i,"#60d0ff80"),c(e,34,37+i,"#60d0ff80")),Cr(e,t,{base:"#d0d0e0",hi:"#e8e8f0",mid:"#b8b8c8",sh:"#9898a8",br:"#ffffff"},s,l,i,p,g);for(let h=18;h<=29;h++)c(e,h,7+i,a.accent);c(e,23,6+i,a.accent),c(e,24,6+i,"#fff")}Wt("techforger",zM);Wt("stormcaller",OM);Wt("razorfang",VM);Wt("titan",BM);Wt("nightprowler",UM);Wt("paragon",qM);Wt("shadowknight",HM);Wt("tempest",FM);function rS(e,t,n,s,a,l){for(let i=a;i<=l;i++)for(let p=24-s;p<=23+s;p++){let g=t.robe;p<24-s+2?g=t.robeDark:p>23+s-2&&(g=t.robeLight),c(e,p,i+n,g)}}function $M(e,t,n,s,a,l,i,p,g,v){for(let u=16;u<=31;u++)c(e,u,46,"#0004");rS(e,a,i,5,22,40);for(let u=24;u<=38;u+=2)c(e,19,u+i,a.accent),c(e,28,u+i,a.accent);for(let u=40;u<=44;u++){for(let h=19;h<=22;h++)c(e,h,u+i,a.robeDark);for(let h=25;h<=28;h++)c(e,h,u+i,a.robeDark)}for(let u=23;u<=35;u++)c(e,16,u+i,a.robeDark),c(e,17,u+i,a.robe),c(e,30,u+i,a.robe),c(e,31,u+i,a.robeLight);for(let u=12;u<=36;u++)c(e,14,u+i,"#c0c0d8"),c(e,33,u+i,"#c0c0d8");c(e,14,11+i,"#e0e0f0"),c(e,33,11+i,"#e0e0f0"),c(e,22,42+i,a.robe),c(e,20,43+i,a.robe),c(e,18,44+i,a.robe),c(e,16,44+i,a.robeLight),c(e,15,43+i,a.robeLight);for(let u=18;u<=29;u++)for(let h=6;h<=19;h++){let y=a.robe;h<=7?y=a.robeLight:h>=18&&(y=a.robeDark),c(e,u,h+i,y)}c(e,16,10+i,a.robe),c(e,15,9+i,a.robeLight),c(e,31,10+i,a.robe),c(e,32,9+i,a.robeLight),c(e,20,12+i,"#f0d040"),c(e,21,12+i,"#f0d040"),c(e,26,12+i,"#f0d040"),c(e,27,12+i,"#f0d040"),c(e,20,13+i,"#000"),c(e,27,13+i,"#000"),p%6<3&&(c(e,12+p%8,20+i,"#8040c060"),c(e,30-p%6,38+i,"#8040c060"))}function WM(e,t,n,s,a,l,i,p,g,v){for(let u=16;u<=31;u++)c(e,u,46,"#0004");rS(e,a,i,5,22,42);for(let u=34;u<=44;u++)for(let h=18;h<=29;h++)(h<=20||h>=27)&&c(e,h,u+i,a.accent);for(let u=24;u<=32;u+=2)c(e,21,u+i,a.robeDark),c(e,26,u+i,a.robeDark);for(let u=20;u<=27;u+=2)c(e,u,28+i,a.robeDark);for(let u=23;u<=35;u++)c(e,16,u+i,a.robeDark),c(e,17,u+i,a.robe),c(e,30,u+i,a.accent),c(e,31,u+i,a.accent);if(p%8<5)for(let u=4;u<=20;u++)c(e,14-Math.floor((20-u)*.3),u+i,"#c0c0c040");for(let u=17;u<=30;u++)for(let h=4;h<=19;h++){let y=a.robe;(h<=5||u<=18||u>=29)&&(y=a.robeDark),c(e,u,h+i,y)}for(let u=19;u<=22;u++)for(let h=10;h<=14;h++)c(e,u,h+i,"#fff");for(let u=25;u<=28;u++)for(let h=10;h<=14;h++)c(e,u,h+i,"#fff");for(let u=19;u<=22;u++)c(e,u,9+i,a.robeDark),c(e,u,15+i,a.robeDark);for(let u=25;u<=28;u++)c(e,u,9+i,a.robeDark),c(e,u,15+i,a.robeDark);c(e,18,11+i,a.robeDark),c(e,18,13+i,a.robeDark),c(e,29,11+i,a.robeDark),c(e,29,13+i,a.robeDark)}function GM(e,t,n,s,a,l,i,p,g,v){for(let u=14;u<=33;u++)c(e,u,46,"#0004");for(let u=16;u<=31;u++)for(let h=18;h<=38;h++){let y="#705830";(u<=18||u>=29)&&(y="#604820"),(h<=20||h>=36)&&(y="#604820"),c(e,u,h+i,y)}c(e,23,24+i,"#503818"),c(e,24,24+i,"#503818"),c(e,20,28+i,"#503818"),c(e,27,28+i,"#503818"),c(e,23,32+i,"#503818"),c(e,24,32+i,"#503818");for(let u=22;u<=40;u++)for(let h=19;h<=28;h++){let y=a.robe;h<=20&&(y=a.robeDark),c(e,h,u+i,y)}for(let u=24;u<=36;u++)for(let h=21;h<=26;h++)c(e,h,u+i,"#d0b060");for(let u=18;u<=29;u++)c(e,u,34+i,"#604020");c(e,23,34+i,a.accent),c(e,24,34+i,a.accent);for(let u=38;u<=44;u++){for(let h=17;h<=22;h++)c(e,h,u+i,a.robe);for(let h=25;h<=30;h++)c(e,h,u+i,a.robe)}for(let u=23;u<=35;u++)c(e,14,u+i,a.robeDark),c(e,15,u+i,a.robe),c(e,32,u+i,a.robe),c(e,33,u+i,a.robeLight);for(let u=14;u<=36;u++)c(e,12,u+i,"#808080"),c(e,35,u+i,"#808080");for(let u=18;u<=29;u++)for(let h=6;h<=19;h++){let y=a.robe;h<=7?y=a.robeLight:h>=18&&(y=a.robeDark),c(e,u,h+i,y)}for(let u=17;u<=30;u++)for(let h=10;h<=13;h++)c(e,u,h+i,a.accent);for(let u=19;u<=22;u++)c(e,u,11+i,"#fff");for(let u=25;u<=28;u++)c(e,u,11+i,"#fff");c(e,21,12+i,"#000"),c(e,27,12+i,"#000"),c(e,22,16+i,"#205020"),c(e,23,16+i,a.robeDark),c(e,24,16+i,a.robeDark),c(e,25,16+i,"#205020")}function QM(e,t,n,s,a,l,i,p,g,v){for(let u=16;u<=31;u++)c(e,u,46,"#0004");for(let u=22;u<=38;u++){const h=Math.floor(6-Math.abs(u-30)*.3);for(let y=24-h;y<=23+h;y++){let x=a.robe;y<=24-h+1?x=a.robeDark:y>=23+h-1&&(x=a.robeLight),c(e,y,u+i,x)}}c(e,18,16+i,a.accent),c(e,19,16+i,a.accent),c(e,28,16+i,a.accent),c(e,29,16+i,a.accent),c(e,20,39+i,a.robeDark),c(e,21,39+i,a.robeDark),c(e,26,39+i,a.robeDark),c(e,27,39+i,a.robeDark);for(let u=26;u<=32;u++)c(e,16,u+i,a.robeDark),c(e,31,u+i,a.robeLight);c(e,32,30+i,a.robe),c(e,34,28+i,a.robe),c(e,36,26+i,a.robe),c(e,35,24+i,a.robe),c(e,37,22+i,a.robe),c(e,38,20+i,a.robe),c(e,37,18+i,a.robeDark),c(e,36,20+i,a.robeDark);for(let u=17;u<=30;u++)for(let h=8;h<=20;h++){let y=a.robe;h<=9?y=a.robeLight:h>=19&&(y=a.robeDark),c(e,u,h+i,y)}for(let u=19;u<=21;u++)for(let h=12;h<=15;h++)c(e,u,h+i,"#000");for(let u=26;u<=28;u++)for(let h=12;h<=15;h++)c(e,u,h+i,"#000");c(e,20,12+i,"#fff"),c(e,27,12+i,"#fff"),c(e,23,15+i,"#000"),c(e,24,15+i,"#000"),c(e,22,17+i,a.robeDark),c(e,25,17+i,a.robeDark),c(e,18,7+i,a.robe),c(e,17,5+i,a.robe),c(e,16,3+i,a.robe),c(e,15,1+i,"#000"),c(e,29,7+i,a.robe),c(e,30,5+i,a.robe),c(e,31,3+i,a.robe),c(e,32,1+i,"#000"),p%4<2&&(c(e,14,28+i,"#60d0ff80"),c(e,33,26+i,"#60d0ff80"))}function XM(e,t,n,s,a,l,i,p,g,v){for(let y=12;y<=35;y++)c(e,y,46,"#0004");const u=p%6<3;for(let y=12;y<=28;y++)c(e,10-(u?1:0),y+i,a.robeDark),c(e,9-(u?2:0),y+i,a.robe),c(e,37+(u?1:0),y+i,a.robeDark),c(e,38+(u?2:0),y+i,a.robe);u&&(c(e,7,14+i,a.robeLight),c(e,40,14+i,a.robeLight));for(let y=18;y<=40;y++)for(let x=17;x<=30;x++){let T=a.robe;x<=18?T=a.robeDark:x>=29&&(T=a.robeLight),c(e,x,y+i,T)}for(let y=24;y<=36;y++)for(let x=20;x<=27;x++)c(e,x,y+i,"#f0d070");for(let y=38;y<=44;y++){for(let x=17;x<=22;x++)c(e,x,y+i,a.robeDark);for(let x=25;x<=30;x++)c(e,x,y+i,a.robeDark)}for(let y=24;y<=34;y++)c(e,13,y+i,a.robe),c(e,14,y+i,a.robe),c(e,33,y+i,a.robe),c(e,34,y+i,a.robe);c(e,12,34+i,"#fff"),c(e,35,34+i,"#fff");for(let y=18;y<=29;y++)for(let x=6;x<=17;x++){let T=a.robe;x<=7&&(T=a.robeLight),c(e,y,x+i,T)}for(let y=28;y<=32;y++)for(let x=12;x<=15;x++)c(e,y,x+i,a.robe);c(e,21,10+i,"#fff"),c(e,22,10+i,"#2050a0"),c(e,22,11+i,"#000"),c(e,26,10+i,"#fff"),c(e,27,10+i,"#2050a0"),c(e,27,11+i,"#000"),c(e,19,5+i,a.robeDark),c(e,19,4+i,a.robe),c(e,28,5+i,a.robeDark),c(e,28,4+i,a.robe);const h=p%3;c(e,16,38+i,a.robe),c(e,14,36+i,a.robe),c(e,12,34+i,"#e67e22"),h===0?(c(e,11,33+i,"#f39c12"),c(e,10,32+i,"#ffed4a")):h===1?(c(e,11,32+i,"#f39c12"),c(e,12,33+i,"#ffed4a")):(c(e,10,33+i,"#ffed4a"),c(e,11,34+i,"#f39c12")),p%12<3&&(c(e,33,13+i,"#e67e22"),c(e,34,13+i,"#f39c12"),c(e,35,12+i,"#ffed4a"))}function YM(e,t,n,s,a,l,i,p,g,v){for(let h=10;h<=37;h++)c(e,h,46,"#0004");for(let h=16;h<=31;h++)for(let y=8;y<=20;y++){const x=Math.sqrt((h-23.5)**2+(y-14)**2);if(x<8){let T=a.accent;x<4&&(T="#e05070"),x<2&&(T="#f0c040"),c(e,h,y+i,T)}}c(e,14,14+i,a.robeLight),c(e,13,12+i,a.robeLight),c(e,12,10+i,a.robe),c(e,33,14+i,a.robeLight),c(e,34,12+i,a.robeLight),c(e,35,10+i,a.robe);for(let h=22;h<=40;h++)for(let y=15;y<=32;y++){let x=a.robe;y<=16?x=a.robeDark:y>=31&&(x=a.robeLight),c(e,y,h+i,x)}c(e,18,28+i,a.robeDark),c(e,22,32+i,a.robeDark),c(e,28,26+i,a.robeDark),c(e,26,34+i,a.robeDark);for(let h=40;h<=44;h++)c(e,16,h+i,a.robeDark),c(e,17,h+i,a.robe),c(e,18,h+i,a.robe),c(e,22,h+i,a.robe),c(e,23,h+i,a.robe),c(e,24,h+i,a.robe),c(e,28,h+i,a.robe),c(e,29,h+i,a.robe),c(e,30,h+i,a.robe);for(let h=19;h<=28;h++)for(let y=14;y<=22;y++){let x=a.robe;y<=15&&(x=a.robeLight),c(e,h,y+i,x)}c(e,21,17+i,"#c03030"),c(e,22,17+i,"#000"),c(e,26,17+i,"#c03030"),c(e,27,17+i,"#000"),c(e,23,19+i,a.robeDark),c(e,24,19+i,a.robeDark);const u=p%4<2;c(e,12,30+i,a.robe),c(e,10,28+i,a.robeLight),c(e,8-(u?1:0),26+i,a.robe),c(e,35,30+i,a.robe),c(e,37,28+i,a.robeLight),c(e,39+(u?1:0),26+i,a.robe)}function KM(e,t,n,s,a,l,i,p,g,v){for(let u=10;u<=37;u++)c(e,u,46,"#0004");for(let u=14;u<=33;u++)for(let h=14;h<=34;h++){let y="#705830";(u<=16||u>=31)&&(y="#604820"),(h<=16||h>=32)&&(y="#604820"),c(e,u,h+i,y)}for(let u=10;u<=18;u++)c(e,17,u+i,"#808898"),c(e,18,u+i,"#909aa8"),c(e,29,u+i,"#808898"),c(e,30,u+i,"#909aa8");c(e,17,9+i,"#606878"),c(e,18,9+i,"#606878"),c(e,29,9+i,"#606878"),c(e,30,9+i,"#606878"),p%8<3&&(c(e,17,8+i,"#60a0e0"),c(e,18,7+i,"#80c0f0"),c(e,30,8+i,"#60a0e0"),c(e,29,7+i,"#80c0f0"));for(let u=22;u<=40;u++)for(let h=16;h<=31;h++){let y=a.robe;h<=17?y=a.robeDark:h>=30&&(y=a.robeLight),c(e,h,u+i,y)}for(let u=26;u<=36;u++)for(let h=20;h<=27;h++)c(e,h,u+i,"#d0c890");for(let u=38;u<=44;u++){for(let h=15;h<=21;h++)c(e,h,u+i,a.robeDark);for(let h=26;h<=32;h++)c(e,h,u+i,a.robeDark)}for(let u=24;u<=36;u++)c(e,12,u+i,a.robeDark),c(e,13,u+i,a.robe),c(e,34,u+i,a.robe),c(e,35,u+i,a.robeLight);c(e,11,36+i,"#fff"),c(e,12,37+i,"#fff"),c(e,36,36+i,"#fff"),c(e,35,37+i,"#fff");for(let u=19;u<=28;u++)for(let h=14;h<=22;h++){let y=a.robe;h<=15?y=a.robeLight:h>=21&&(y=a.robeDark),c(e,u,h+i,y)}c(e,21,17+i,"#c03030"),c(e,22,17+i,"#000"),c(e,26,17+i,"#c03030"),c(e,27,17+i,"#000"),c(e,23,20+i,a.robeDark),c(e,24,20+i,a.robeDark),c(e,18,15+i,a.robe),c(e,29,15+i,a.robe)}Wt("blinker",$M);Wt("webslinger",WM);Wt("shellstrike",GM);Wt("sparkpaw",QM);Wt("blazewing",XM);Wt("thornbeast",YM);Wt("tidalshell",KM);const JM={dreadlord:{id:"dreadlord",name:"Dreadlord",icon:"",pack:"villain",description:"Cosmic tyrant who seeks ultimate power",unlockLevel:22,color:{robe:"#6030a0",robeMid:"#7840b8",robeDark:"#402070",robeLight:"#9060d0",accent:"#f0c030"},abilities:{passive:"Inevitability  Cannot lose more than 2 class HP per question",active:"Snap  Instantly deal half of boss's remaining HP (10 question cooldown)"}},jestermind:{id:"jestermind",name:"Jestermind",icon:"",pack:"villain",description:"Chaotic genius with a sinister smile",unlockLevel:10,color:{robe:"#5020a0",robeMid:"#6830b8",robeDark:"#381070",robeLight:"#8050d0",accent:"#30a040"},abilities:{passive:"Wild Card  30% chance any answer counts as correct (still learn from mistakes)",active:"Chaos Bomb  Randomize boss's next attack target (4 question cooldown)"}},voidlord:{id:"voidlord",name:"Voidlord",icon:"",pack:"villain",description:"Dark armored enforcer with mechanical breathing",unlockLevel:24,color:{robe:"#1a1a28",robeMid:"#282838",robeDark:"#0e0e18",robeLight:"#383848",accent:"#c03030"},abilities:{passive:"Dark Side  Incorrect answers by opponents deal 1 damage to boss",active:"Force Choke  Boss loses next attack and takes 3 damage (6 question cooldown)"}},ironwarden:{id:"ironwarden",name:"Ironwarden",icon:"",pack:"villain",description:"Master of magnetic forces",unlockLevel:12,color:{robe:"#802040",robeMid:"#a03058",robeDark:"#601030",robeLight:"#c04870",accent:"#8040a0"},abilities:{passive:"Magnetic Shield  Reflect 1 counterattack damage back to boss",active:"Metal Storm  Deal 2 damage per team member present (5 question cooldown)"}},trickster:{id:"trickster",name:"Trickster",icon:"",pack:"villain",description:"Silver-tongued shapeshifter with illusion magic",unlockLevel:5,color:{robe:"#207838",robeMid:"#309848",robeDark:"#105028",robeLight:"#40b858",accent:"#f0c848"},abilities:{passive:"Illusion  First wrong answer each battle is forgiven",active:"Mirror Image  Copy the highest-damage teammate's last attack (4 question cooldown)"}},symbiote:{id:"symbiote",name:"Symbiote",icon:"",pack:"villain",description:"Living alien organism bonded to a host",unlockLevel:15,color:{robe:"#101018",robeMid:"#181828",robeDark:"#080810",robeLight:"#282838",accent:"#e0e0f0"},abilities:{passive:"Consume  Heal 1 class HP on every 3rd correct answer",active:"Tendril Strike  Deal 3 damage to boss and steal 1 HP (5 question cooldown)"}},steeltyrant:{id:"steeltyrant",name:"Steeltyrant",icon:"",pack:"villain",description:"Iron-masked ruler who combines science and sorcery",unlockLevel:26,color:{robe:"#207830",robeMid:"#309040",robeDark:"#105020",robeLight:"#40a850",accent:"#a0a8b8"},abilities:{passive:"Doombot  If class HP hits 0, survive once at 1 HP per battle",active:"Arcane Blast  Deal 5 damage, ignore all boss defenses (7 question cooldown)"}},psyborn:{id:"psyborn",name:"Psyborn",icon:"",pack:"villain",description:"Psychic entity of immense mental power",unlockLevel:28,color:{robe:"#8848c0",robeMid:"#a060d8",robeDark:"#603090",robeLight:"#b878e8",accent:"#d0d0e8"},abilities:{passive:"Telekinesis  Move your answer submission after seeing the question hint",active:"Psychic Surge  Deal damage equal to your current streak count (5 question cooldown)"}},hexglider:{id:"hexglider",name:"Hexglider",icon:"",pack:"villain",description:"Cackling menace on a flying machine",unlockLevel:18,color:{robe:"#308030",robeMid:"#409840",robeDark:"#206020",robeLight:"#50b850",accent:"#d060d0"},abilities:{passive:"Pumpkin Bombs  Correct answers have 25% chance to deal +3 splash damage",active:"Glider Rush  Deal 4 damage and dodge next counterattack (5 question cooldown)"}},frostlord:{id:"frostlord",name:"Frostlord",icon:"",pack:"villain",description:"Alien emperor with terrifying transformations",unlockLevel:31,color:{robe:"#d0c0e0",robeMid:"#e0d8f0",robeDark:"#a090c0",robeLight:"#f0e8ff",accent:"#8040a0"},abilities:{passive:"Final Form  Gain +1 damage for every 25% of class HP lost",active:"Death Beam  Deal 6 damage to boss (7 question cooldown)"}},nightclaw:{id:"nightclaw",name:"Nightclaw",icon:"",pack:"villain",description:"Agile thief with razor-sharp reflexes",unlockLevel:8,color:{robe:"#181828",robeMid:"#282838",robeDark:"#0e0e18",robeLight:"#383848",accent:"#d0a040"},abilities:{passive:"Nine Lives  Survive 3 would-be killing blows at 1 HP",active:"Cat Burglar  Steal 2 boss HP and add to class HP (5 question cooldown)"}},flameshell:{id:"flameshell",name:"Flameshell",icon:"",pack:"villain",description:"Massive spiked beast king who breathes fire",unlockLevel:34,color:{robe:"#308030",robeMid:"#409840",robeDark:"#206020",robeLight:"#50b850",accent:"#c83030"},abilities:{passive:"Spiky Shell  Attackers take 1 damage when they deal counterattack damage",active:"Fire Breath  Deal 3 damage per turn for 3 turns (8 question cooldown)"}}};function xh(e,t,n,s,a,l){for(let i=a;i<=l;i++)for(let p=24-s;p<=23+s;p++){let g=t.robe;p<24-s+2?g=t.robeDark:p>23+s-2&&(g=t.robeLight),c(e,p,i+n,g)}}function ZM(e,t,n,s,a,l,i,p,g,v){for(let u=12;u<=35;u++)c(e,u,46,"#0004");for(let u=20;u<=40;u++)for(let h=14;h<=33;h++){let y="#4030a0";h<=16?y="#302078":h>=31&&(y="#5848b8"),u>=34&&(y="#302078"),c(e,h,u+i,y)}for(let u=18;u<=29;u++)for(let h=24;h<=30;h++){let y=a.accent;(h===24||h===30)&&(y="#d4a020"),c(e,u,h+i,y)}for(let u=14;u<=33;u++)c(e,u,34+i,a.accent);for(let u=36;u<=44;u++){for(let h=15;h<=21;h++)c(e,h,u+i,"#302078");for(let h=26;h<=32;h++)c(e,h,u+i,"#302078")}for(let u=14;u<=22;u++)c(e,u,44+i,a.accent);for(let u=25;u<=33;u++)c(e,u,44+i,a.accent);for(let u=22;u<=36;u++)c(e,11,u+i,"#302078"),c(e,12,u+i,"#4030a0"),c(e,13,u+i,"#4030a0"),c(e,34,u+i,"#4030a0"),c(e,35,u+i,"#4030a0"),c(e,36,u+i,"#5848b8");for(let u=10;u<=14;u++)for(let h=36;h<=39;h++)c(e,u,h+i,a.accent);p%6<3&&(c(e,11,37+i,"#fff"),c(e,12,38+i,"#60d0ff"),c(e,13,37+i,"#ff4040"));for(let u=33;u<=37;u++)for(let h=36;h<=39;h++)c(e,u,h+i,"#5848b8");for(let u=17;u<=30;u++)for(let h=6;h<=19;h++){let y="#7050b0";h<=8?y="#8060c0":h>=17&&(y="#5040a0"),(u<=18||u>=29)&&(y="#5040a0"),c(e,u,h+i,y)}for(let u=16;u<=19;u++)c(e,20,u+i,"#4030a0"),c(e,22,u+i,"#4030a0"),c(e,25,u+i,"#4030a0"),c(e,27,u+i,"#4030a0");for(let u=19;u<=22;u++)c(e,u,12+i,"#fff");for(let u=25;u<=28;u++)c(e,u,12+i,"#fff");c(e,21,13+i,"#4030a0"),c(e,27,13+i,"#4030a0");for(let u=18;u<=29;u++)c(e,u,5+i,a.accent);c(e,23,4+i,a.accent),c(e,24,4+i,a.accent)}function eR(e,t,n,s,a,l,i,p,g,v){for(let u=16;u<=31;u++)c(e,u,46,"#0004");xh(e,a,i,6,22,42);for(let u=22;u<=30;u++)c(e,20,u+i,a.robeLight),c(e,27,u+i,a.robeLight);for(let u=24;u<=32;u++)for(let h=21;h<=26;h++)c(e,h,u+i,a.accent);c(e,23,24+i,"#e04040"),c(e,24,24+i,"#e04040"),c(e,23,25+i,"#c03030"),c(e,24,26+i,"#c03030"),c(e,23,27+i,"#a02020"),c(e,20,24+i,"#e06080"),c(e,20,23+i,"#e06080"),c(e,19,24+i,"#e06080");for(let u=36;u<=44;u++){for(let h=19;h<=22;h++)c(e,h,u+i,a.robeDark);for(let h=25;h<=28;h++)c(e,h,u+i,a.robeDark)}for(let u=23;u<=35;u++)c(e,15,u+i,a.robeDark),c(e,16,u+i,a.robe),c(e,31,u+i,a.robe),c(e,32,u+i,a.robeLight);for(let u=33;u<=36;u++)for(let h=32;h<=37;h++)c(e,u,h+i,"#f0f0f0");c(e,34,34+i,"#c03030"),c(e,35,35+i,"#c03030");for(let u=18;u<=29;u++)for(let h=7;h<=19;h++){let y="#e8e0d8";h<=8?y="#f0ece8":h>=18&&(y="#d0c8c0"),c(e,u,h+i,y)}for(let u=16;u<=31;u++)for(let h=2;h<=9;h++){let y=a.accent;h<=3&&(y="#40c858"),(u<=17||u>=30)&&(y="#208030"),c(e,u,h+i,y)}for(let u=10;u<=16;u++)c(e,16,u+i,a.accent),c(e,17,u+i,a.accent),c(e,30,u+i,a.accent),c(e,31,u+i,a.accent);c(e,15,3+i,a.accent),c(e,14,2+i,a.accent),c(e,32,4+i,a.accent),c(e,33,3+i,a.accent),c(e,22,1+i,"#40c858"),c(e,26,1+i,"#40c858");for(let u=19;u<=22;u++)c(e,u,12+i,"#fff");for(let u=25;u<=28;u++)c(e,u,12+i,"#fff");c(e,21,13+i,"#30a040"),c(e,27,13+i,"#30a040");for(let u=19;u<=28;u++)c(e,u,17+i,"#c03030");c(e,18,16+i,"#c03030"),c(e,29,16+i,"#c03030"),c(e,20,17+i,"#fff"),c(e,22,17+i,"#fff"),c(e,25,17+i,"#fff"),c(e,27,17+i,"#fff")}function tR(e,t,n,s,a,l,i,p,g,v){for(let u=14;u<=33;u++)c(e,u,46,"#0004");for(let u=18+i;u<=44+i;u++){const h=Math.floor((u-18)*.3);for(let y=12-h;y<=13;y++)y>=4&&c(e,y,u,a.robeDark);for(let y=34;y<=35+h;y++)y<=43&&c(e,y,u,a.robeDark)}xh(e,a,i,7,20,40);for(let u=20;u<=27;u++)for(let h=26;h<=30;h++)c(e,u,h+i,"#383848");c(e,22,27+i,"#c03030"),c(e,24,27+i,"#30a040"),c(e,26,28+i,"#3060c0"),c(e,21,29+i,"#808090"),c(e,23,29+i,"#808090"),c(e,25,29+i,"#808090");for(let u=17;u<=30;u++)c(e,u,34+i,"#383848");c(e,23,34+i,"#808090"),c(e,24,34+i,"#808090");for(let u=36;u<=44;u++){for(let h=17;h<=22;h++)c(e,h,u+i,a.robeDark);for(let h=25;h<=30;h++)c(e,h,u+i,a.robeDark)}for(let u=22;u<=36;u++)c(e,14,u+i,a.robeDark),c(e,15,u+i,a.robe),c(e,32,u+i,a.robe),c(e,33,u+i,a.robeLight);for(let u=4;u<=34;u++)c(e,36,u+i,a.accent);v&&(c(e,35,10+i,a.accent+"60"),c(e,37,10+i,a.accent+"60"),c(e,35,20+i,a.accent+"40"),c(e,37,20+i,a.accent+"40"));for(let u=34;u<=38;u++)c(e,36,u+i,"#808090");for(let u=16;u<=31;u++)for(let h=4;h<=19;h++){let y=a.robe;h<=5?y=a.robeLight:h>=18&&(y=a.robeDark),(u<=17||u>=30)&&(y=a.robeDark),c(e,u,h+i,y)}for(let u=19;u<=22;u++)c(e,u,11+i,"#383848");for(let u=25;u<=28;u++)c(e,u,11+i,"#383848");c(e,20,12+i,"#383848"),c(e,21,12+i,"#383848"),c(e,26,12+i,"#383848"),c(e,27,12+i,"#383848");for(let u=21;u<=26;u+=2)for(let h=14;h<=17;h++)c(e,u,h+i,"#383848");for(let u=4;u<=10;u++)c(e,23,u+i,"#383848");c(e,24,4+i,"#383848")}function nR(e,t,n,s,a,l,i,p,g,v){for(let u=14;u<=33;u++)c(e,u,46,"#0004");for(let u=18+i;u<=44+i;u++){const h=Math.floor((u-18)*.3);c(e,12-h,u,a.accent),c(e,35+h,u,a.accent)}xh(e,a,i,6,22,40),c(e,22,27+i,"#e0e0f0"),c(e,23,26+i,"#e0e0f0"),c(e,24,26+i,"#e0e0f0"),c(e,25,27+i,"#e0e0f0"),c(e,23,28+i,"#e0e0f0"),c(e,24,28+i,"#e0e0f0");for(let u=17;u<=30;u++)c(e,u,34+i,a.accent);for(let u=36;u<=44;u++){for(let h=18;h<=22;h++)c(e,h,u+i,a.robeDark);for(let h=25;h<=29;h++)c(e,h,u+i,a.robeDark)}for(let u=23;u<=36;u++)c(e,15,u+i,a.robeDark),c(e,16,u+i,a.robe),c(e,31,u+i,a.robe),c(e,32,u+i,a.robeLight);p%4<2?(c(e,10,24+i,"#a0a8b8"),c(e,11,23+i,"#c0c8d0"),c(e,37,26+i,"#a0a8b8"),c(e,36,25+i,"#c0c8d0")):(c(e,11,26+i,"#a0a8b8"),c(e,10,25+i,"#c0c8d0"),c(e,36,24+i,"#a0a8b8"),c(e,37,23+i,"#c0c8d0")),Cr(e,t,n,s,l,i,p,g);for(let u=16;u<=31;u++)for(let h=6;h<=10;h++)u>=20&&u<=27&&h<=8||c(e,u,h+i,a.robe);for(let u=16;u<=31;u++)c(e,u,6+i,a.robeLight);c(e,16,10+i,a.robe),c(e,17,10+i,a.robe),c(e,30,10+i,a.robe),c(e,31,10+i,a.robe),c(e,23,5+i,a.robeLight),c(e,24,5+i,a.robeLight)}function rR(e,t,n,s,a,l,i,p,g,v){for(let u=16;u<=31;u++)c(e,u,46,"#0004");xh(e,a,i,5,22,42);for(let u=19;u<=28;u++)c(e,u,22+i,a.accent);for(let u=19;u<=28;u++)c(e,u,33+i,a.accent);for(let u=0;u<5;u++)c(e,21+u,24+u+i,a.accent),c(e,26-u,24+u+i,a.accent);for(let u=20+i;u<=42+i;u++){const h=Math.floor((u-20)*.2);c(e,14-h,u,a.robeDark),c(e,33+h,u,a.robeDark)}for(let u=36;u<=44;u++){for(let h=19;h<=22;h++)c(e,h,u+i,a.robeDark);for(let h=25;h<=28;h++)c(e,h,u+i,a.robeDark)}for(let u=23;u<=35;u++)c(e,16,u+i,a.robeDark),c(e,17,u+i,a.robe),c(e,30,u+i,a.robe),c(e,31,u+i,a.robeLight);for(let u=6;u<=38;u++)c(e,34,u+i,a.accent);c(e,33,5+i,"#60d0ff"),c(e,34,4+i,"#80e0ff"),c(e,35,5+i,"#60d0ff"),c(e,34,6+i,"#60d0ff60"),v&&(c(e,33,3+i,"#60d0ff40"),c(e,35,3+i,"#60d0ff40")),Cr(e,t,n,s,l,i,p,g);for(let u=17;u<=30;u++)c(e,u,6+i,a.accent);for(let u=18;u<=29;u++)c(e,u,5+i,a.accent);c(e,17,5+i,a.accent),c(e,16,4+i,a.accent),c(e,15,3+i,a.accent),c(e,14,2+i,a.accent),c(e,13,1+i,a.accent),c(e,30,5+i,a.accent),c(e,31,4+i,a.accent),c(e,32,3+i,a.accent),c(e,33,2+i,a.accent),c(e,34,1+i,a.accent)}function iR(e,t,n,s,a,l,i,p,g,v){for(let h=14;h<=33;h++)c(e,h,46,"#0004");for(let h=18;h<=42;h++){const y=7+Math.floor(Math.sin(h*.3+p*.2)*.8);for(let x=24-y;x<=23+y;x++){let T=a.robe;x<=24-y+1?T=a.robeDark:x>=23+y-1&&(T=a.robeLight),c(e,x,h+i,T)}}c(e,23,26+i,"#fff"),c(e,24,26+i,"#fff"),c(e,22,27+i,"#fff"),c(e,25,27+i,"#fff"),c(e,21,28+i,"#fff"),c(e,26,28+i,"#fff"),c(e,20,29+i,"#ddd"),c(e,27,29+i,"#ddd"),c(e,23,28+i,"#fff"),c(e,24,28+i,"#fff"),c(e,23,30+i,"#ddd"),c(e,24,30+i,"#ddd");for(let h=40;h<=44;h++){for(let y=17;y<=22;y++)c(e,y,h+i,a.robeDark);for(let y=25;y<=30;y++)c(e,y,h+i,a.robeDark)}for(let h=20;h<=38;h++)c(e,12,h+i,a.robeDark),c(e,13,h+i,a.robe),c(e,34,h+i,a.robe),c(e,35,h+i,a.robeLight);c(e,11,38+i,"#fff"),c(e,12,39+i,"#fff"),c(e,36,38+i,"#fff"),c(e,35,39+i,"#fff");const u=p%4;c(e,10-(u<2?1:0),30+i,a.robe),c(e,9-(u<2?2:0),28+i,a.robe),c(e,37+(u>=2?1:0),32+i,a.robe),c(e,38+(u>=2?2:0),30+i,a.robe);for(let h=16;h<=31;h++)for(let y=4;y<=18;y++){let x=a.robe;y<=5?x=a.robeLight:y>=17&&(x=a.robeDark),c(e,h,y+i,x)}for(let h=18;h<=22;h++)for(let y=9;y<=13;y++)y-9<=h-18&&c(e,h,y+i,"#fff");for(let h=25;h<=29;h++)for(let y=9;y<=13;y++)y-9<=29-h&&c(e,h,y+i,"#fff");for(let h=19;h<=28;h++)c(e,h,16+i,"#c03030");c(e,20,15+i,"#fff"),c(e,22,15+i,"#fff"),c(e,25,15+i,"#fff"),c(e,27,15+i,"#fff"),c(e,21,17+i,"#fff"),c(e,24,17+i,"#fff"),c(e,26,17+i,"#fff")}Wt("dreadlord",ZM);Wt("jestermind",eR);Wt("voidlord",tR);Wt("ironwarden",nR);Wt("trickster",rR);Wt("symbiote",iR);function sR(e,t,n,s,a,l){for(let i=a;i<=l;i++)for(let p=24-s;p<=23+s;p++){let g=t.robe;p<24-s+2?g=t.robeDark:p>23+s-2&&(g=t.robeLight),c(e,p,i+n,g)}}function aR(e,t,n,s,a,l,i,p,g,v){for(let u=14;u<=33;u++)c(e,u,46,"#0004");for(let u=8+i;u<=44+i;u++){const h=Math.floor((u-8)*.25);for(let y=12-h;y<=14;y++)y>=4&&c(e,y,u,a.robe);for(let y=33;y<=35+h;y++)y<=43&&c(e,y,u,a.robe)}for(let u=15;u<=32;u++)for(let h=2;h<=10;h++){let y=a.robe;h<=3?y=a.robeLight:(u<=16||u>=31)&&(y=a.robeDark),c(e,u,h+i,y)}for(let u=22;u<=40;u++)for(let h=17;h<=30;h++){let y="#808898";h<=18?y="#606878":h>=29&&(y="#a0a8b8"),c(e,h,u+i,y)}for(let u=17;u<=30;u++)c(e,u,33+i,a.accent);for(let u=34;u<=40;u++)for(let h=19;h<=28;h++)c(e,h,u+i,a.robe);for(let u=40;u<=44;u++){for(let h=17;h<=22;h++)c(e,h,u+i,"#606878");for(let h=25;h<=30;h++)c(e,h,u+i,"#606878")}for(let u=23;u<=36;u++)c(e,14,u+i,"#606878"),c(e,15,u+i,"#808898"),c(e,32,u+i,"#808898"),c(e,33,u+i,"#a0a8b8");for(let u=13;u<=16;u++)for(let h=34;h<=38;h++)c(e,u,h+i,"#a0a8b8");for(let u=31;u<=34;u++)for(let h=34;h<=38;h++)c(e,u,h+i,"#a0a8b8");for(let u=18;u<=29;u++)for(let h=10;h<=19;h++){let y="#909aa8";h<=11?y="#a0a8b8":h>=18&&(y="#808898"),c(e,u,h+i,y)}for(let u=19;u<=22;u++)c(e,u,13+i,"#202838");for(let u=25;u<=28;u++)c(e,u,13+i,"#202838");for(let u=21;u<=26;u+=2)for(let h=16;h<=18;h++)c(e,u,h+i,"#606878");c(e,18,12+i,"#c0c8d0"),c(e,29,12+i,"#c0c8d0"),c(e,18,17+i,"#c0c8d0"),c(e,29,17+i,"#c0c8d0"),p%6<3&&(c(e,12,36+i,"#40c060"),c(e,11,35+i,"#40c06080"))}function oR(e,t,n,s,a,l,i,p,g,v){for(let h=16;h<=31;h++)c(e,h,46,"#0004");const u=p*.1;for(let h=0;h<6;h++){const y=u+h/6*Math.PI*2,x=24+Math.floor(Math.cos(y)*12),T=24+Math.floor(Math.sin(y)*10)+i;x>=0&&x<48&&T>=0&&T<48&&c(e,x,T,"#c080f030")}for(let h=22;h<=40;h++){const y=4+Math.floor(Math.sin((h-22)*.15)*1);for(let x=24-y;x<=23+y;x++){let T=a.accent;x<=24-y+1&&(T="#b8b8d0"),c(e,x,h+i,T)}}for(let h=24;h<=30;h++)for(let y=21;y<=26;y++)c(e,y,h+i,a.robe);c(e,26,40+i,a.robe),c(e,28,41+i,a.robe),c(e,30,42+i,a.robe),c(e,32,42+i,a.robeLight),c(e,34,41+i,a.robeLight),c(e,36,40+i,a.robeLight),c(e,37,39+i,a.robe),c(e,38,38+i,a.robe),c(e,39,37+i,a.robeLight),c(e,39,38+i,a.robe);for(let h=38;h<=44;h++){for(let y=19;y<=22;y++)c(e,y,h+i,a.accent);for(let y=25;y<=28;y++)c(e,y,h+i,a.accent)}c(e,18,44+i,a.robe),c(e,19,44+i,a.robe),c(e,28,44+i,a.robe),c(e,29,44+i,a.robe);for(let h=24;h<=34;h++)c(e,16,h+i,a.accent),c(e,31,h+i,a.accent);c(e,15,34+i,a.robe),c(e,32,34+i,a.robe),p%4<2&&(c(e,14,33+i,"#c080f060"),c(e,33,33+i,"#c080f060"));for(let h=17;h<=30;h++)for(let y=4;y<=20;y++){let x=a.accent;y<=5?x="#e0e0f0":y>=19&&(x="#c0c0d0"),(h<=18||h>=29)&&(x=a.robe),c(e,h,y+i,x)}for(let h=19;h<=22;h++)for(let y=10;y<=13;y++)c(e,h,y+i,a.robe);for(let h=25;h<=28;h++)for(let y=10;y<=13;y++)c(e,h,y+i,a.robe);if(c(e,20,11+i,"#fff"),c(e,27,11+i,"#fff"),c(e,23,3+i,a.robe),c(e,24,3+i,a.robe),c(e,23,2+i,a.robeLight),c(e,24,2+i,a.robeLight),c(e,16,8+i,a.robe),c(e,15,7+i,a.robe),c(e,31,8+i,a.robe),c(e,32,7+i,a.robe),p%8<4)for(let h=19;h<=28;h++)c(e,h,46,"#c080f010")}function lR(e,t,n,s,a,l,i,p,g,v){for(let u=12;u<=35;u++)c(e,u,46,"#0004");for(let u=12;u<=35;u++)for(let h=42;h<=44;h++){let y="#808898";h===42&&(y="#a0a8b8"),c(e,u,h+i,y)}for(let u=8;u<=14;u++)c(e,u,43+i,"#606878");for(let u=33;u<=39;u++)c(e,u,43+i,"#606878");c(e,7,42+i,"#808898"),c(e,40,42+i,"#808898"),p%4<2&&(c(e,20,45+i,"#f09020"),c(e,27,45+i,"#f09020"),c(e,20,46,"#f0902040"),c(e,27,46,"#f0902040")),sR(e,a,i,6,22,40);for(let u=18;u<=29;u++)c(e,u,22+i,a.accent);for(let u=18;u<=29;u++)c(e,u,34+i,a.accent);c(e,28,35+i,"#806020"),c(e,29,35+i,"#806020"),c(e,28,36+i,"#906830"),c(e,29,36+i,"#906830");for(let u=36;u<=41;u++){for(let h=19;h<=22;h++)c(e,h,u+i,a.robeDark);for(let h=25;h<=28;h++)c(e,h,u+i,a.robeDark)}for(let u=23;u<=35;u++)c(e,15,u+i,a.robeDark),c(e,16,u+i,a.robe),c(e,31,u+i,a.robe),c(e,32,u+i,a.robeLight);c(e,13,34+i,"#d08020"),c(e,14,34+i,"#e09030"),c(e,13,35+i,"#e09030"),c(e,14,35+i,"#d08020"),p%8<3&&c(e,13,33+i,"#40c04060");for(let u=17;u<=30;u++)for(let h=4;h<=19;h++){let y=a.robe;h<=6?y=a.robeLight:h>=17&&(y=a.robeDark),c(e,u,h+i,y)}c(e,15,8+i,a.robe),c(e,14,7+i,a.robeLight),c(e,32,8+i,a.robe),c(e,33,7+i,a.robeLight);for(let u=19;u<=22;u++)c(e,u,11+i,"#f0d040");for(let u=25;u<=28;u++)c(e,u,11+i,"#f0d040");c(e,21,12+i,"#c03030"),c(e,27,12+i,"#c03030");for(let u=20;u<=27;u++)c(e,u,16+i,a.robeDark);c(e,21,16+i,"#fff"),c(e,24,16+i,"#fff"),c(e,26,16+i,"#fff");for(let u=20;u<=27;u++)c(e,u,3+i,a.accent);c(e,23,2+i,a.accent),c(e,24,2+i,a.accent)}function cR(e,t,n,s,a,l,i,p,g,v){for(let u=16;u<=31;u++)c(e,u,46,"#0004");for(let u=22;u<=40;u++)for(let y=20;y<=27;y++){let x=a.robe;y<=21?x=a.robeDark:y>=26&&(x=a.robeLight),c(e,y,u+i,x)}for(let u=24;u<=32;u++)for(let h=20;h<=27;h++){let y=a.accent;u<=25&&(y=a.robeLight),c(e,h,u+i,y)}c(e,23,27+i,"#f040a0"),c(e,24,27+i,"#f040a0");for(let u=38;u<=44;u++){for(let h=19;h<=22;h++)c(e,h,u+i,a.robe);for(let h=25;h<=28;h++)c(e,h,u+i,a.robe)}for(let u=24;u<=34;u++)c(e,16,u+i,a.robeDark),c(e,17,u+i,a.robe),c(e,30,u+i,a.robe),c(e,31,u+i,a.robeLight);c(e,22,42+i,a.robe),c(e,20,43+i,a.robe),c(e,18,44+i,a.robe),c(e,16,44+i,a.accent),c(e,15,43+i,a.accent);for(let u=17;u<=30;u++)for(let h=6;h<=19;h++){let y=a.robe;h<=7?y=a.robeLight:h>=18&&(y=a.robeDark),c(e,u,h+i,y)}for(let u=18;u<=21;u++)for(let h=6;h<=9;h++)c(e,u,h+i,a.accent);for(let u=26;u<=29;u++)for(let h=6;h<=9;h++)c(e,u,h+i,a.accent);c(e,20,12+i,"#c03030"),c(e,21,12+i,"#c03030"),c(e,26,12+i,"#c03030"),c(e,27,12+i,"#c03030"),c(e,21,13+i,"#000"),c(e,27,13+i,"#000"),c(e,22,16+i,a.robeDark),c(e,23,16+i,a.robeDark),c(e,24,16+i,a.robeDark),c(e,25,16+i,a.robeDark),c(e,16,7+i,a.accent),c(e,15,6+i,a.accent),c(e,14,5+i,a.accent),c(e,31,7+i,a.accent),c(e,32,6+i,a.accent),c(e,33,5+i,a.accent),p%8<3&&(c(e,15,34+i,"#f040a060"),c(e,32,34+i,"#f040a060"))}function uR(e,t,n,s,a,l,i,p,g,v){for(let h=16;h<=31;h++)c(e,h,46,"#0004");for(let h=22;h<=44;h++)for(let x=20;x<=27;x++){let T=a.robe;x<=21?T=a.robeDark:x>=26&&(T=a.robeLight),c(e,x,h+i,T)}for(let h=20;h<=27;h++)c(e,h,33+i,a.accent);c(e,23,34+i,a.accent),c(e,24,34+i,a.accent);for(let h=38;h<=44;h++){for(let y=19;y<=22;y++)c(e,y,h+i,a.robeDark);for(let y=25;y<=28;y++)c(e,y,h+i,a.robeDark)}for(let h=18;h<=22;h++)c(e,h,44+i,a.robe);for(let h=25;h<=29;h++)c(e,h,44+i,a.robe);for(let h=23;h<=34;h++)c(e,16,h+i,a.robeDark),c(e,17,h+i,a.robe),c(e,30,h+i,a.robe),c(e,31,h+i,a.robeLight);c(e,15,35+i,"#c0c0d0"),c(e,14,36+i,"#c0c0d0"),c(e,32,35+i,"#c0c0d0"),c(e,33,36+i,"#c0c0d0");const u=p%6;for(let h=0;h<8;h++){const y=13-h,x=36+Math.floor(Math.sin(h*.5+u*.5)*2);y>=2&&c(e,y,x+i,"#504030")}Cr(e,t,{base:"#181828",hi:"#282838",mid:"#101018",sh:"#080810",br:"#181828"},s,l,i,p,g);for(let h=18;h<=29;h++)for(let y=5;y<=8;y++)c(e,h,y+i,a.robe);c(e,18,4+i,a.robe),c(e,17,3+i,a.robe),c(e,17,2+i,a.robeLight),c(e,29,4+i,a.robe),c(e,30,3+i,a.robe),c(e,30,2+i,a.robeLight);for(let h=19;h<=28;h++)c(e,h,8+i,a.accent);c(e,19,7+i,"#80d0f0"),c(e,20,7+i,"#80d0f0"),c(e,27,7+i,"#80d0f0"),c(e,28,7+i,"#80d0f0"),c(e,20,12+i,"#40c060"),c(e,21,12+i,"#40c060"),c(e,26,12+i,"#40c060"),c(e,27,12+i,"#40c060"),c(e,21,13+i,"#000"),c(e,27,13+i,"#000")}function dR(e,t,n,s,a,l,i,p,g,v){for(let h=10;h<=37;h++)c(e,h,46,"#0004");for(let h=14;h<=33;h++)for(let y=14;y<=36;y++){let x="#508030";(h<=16||h>=31)&&(x="#306818"),(y<=16||y>=34)&&(x="#306818"),c(e,h,y+i,x)}c(e,18,12+i,"#f0f0d0"),c(e,18,11+i,"#e0e0c0"),c(e,23,10+i,"#f0f0d0"),c(e,23,9+i,"#e0e0c0"),c(e,29,12+i,"#f0f0d0"),c(e,29,11+i,"#e0e0c0"),c(e,15,16+i,"#f0f0d0"),c(e,32,16+i,"#f0f0d0");for(let h=14;h<=33;h++)c(e,h,14+i,"#e0e0c0"),c(e,h,36+i,"#e0e0c0");for(let h=20;h<=40;h++)for(let y=17;y<=30;y++){let x="#e0c040";y<=18?x="#c0a030":y>=29&&(x="#f0d060"),c(e,y,h+i,x)}for(let h=24;h<=36;h+=4)for(let y=19;y<=28;y+=3)c(e,y,h+i,"#c8a830");for(let h=38;h<=44;h++){for(let y=14;y<=22;y++)c(e,y,h+i,"#e0c040");for(let y=25;y<=33;y++)c(e,y,h+i,"#e0c040")}c(e,13,44+i,"#fff"),c(e,14,44+i,"#fff"),c(e,34,44+i,"#fff"),c(e,33,44+i,"#fff");for(let h=22;h<=36;h++)c(e,12,h+i,"#e0c040"),c(e,13,h+i,"#e0c040"),c(e,34,h+i,"#e0c040"),c(e,35,h+i,"#e0c040");c(e,11,36+i,"#fff"),c(e,36,36+i,"#fff");for(let h=11;h<=14;h++)c(e,h,28+i,"#383848");c(e,12,27+i,"#f0f0d0");for(let h=33;h<=36;h++)c(e,h,28+i,"#383848");c(e,35,27+i,"#f0f0d0");for(let h=17;h<=30;h++)for(let y=6;y<=19;y++){let x="#e0c040";y<=7?x="#f0d060":y>=18&&(x="#c0a030"),c(e,h,y+i,x)}c(e,17,5+i,"#f0f0d0"),c(e,16,4+i,"#e0e0c0"),c(e,15,3+i,"#f0f0d0"),c(e,30,5+i,"#f0f0d0"),c(e,31,4+i,"#e0e0c0"),c(e,32,3+i,"#f0f0d0");for(let h=18;h<=22;h++)c(e,h,10+i,"#c83030");for(let h=25;h<=29;h++)c(e,h,10+i,"#c83030");for(let h=19;h<=22;h++)c(e,h,12+i,"#fff");for(let h=25;h<=28;h++)c(e,h,12+i,"#fff");c(e,21,13+i,"#000"),c(e,27,13+i,"#000"),c(e,19,11+i,"#c83030"),c(e,28,11+i,"#c83030");for(let h=20;h<=27;h++)c(e,h,16+i,"#c0a030");for(let h=20;h<=27;h++)c(e,h,17+i,"#a08020");c(e,21,17+i,"#fff"),c(e,24,17+i,"#fff"),c(e,26,17+i,"#fff");for(let h=18;h<=29;h++)for(let y=4;y<=7;y++)c(e,h,y+i,"#c83030");c(e,17,6+i,"#a02020"),c(e,30,6+i,"#a02020"),p%4<2&&(c(e,31,14+i,"#e67e22"),c(e,32,13+i,"#f39c12"),c(e,33,12+i,"#ffed4a"),c(e,34,13+i,"#f39c1280"))}Wt("steeltyrant",aR);Wt("psyborn",oR);Wt("hexglider",lR);Wt("frostlord",cR);Wt("nightclaw",uR);Wt("flameshell",dR);const fR=[{id:"byte_bot",name:"Byte Bot",icon:"",unlockLevel:1},{id:"wisp",name:"Wisp",icon:"",unlockLevel:1},{id:"bunbun",name:"Bun-Bun",icon:"",unlockLevel:1},{id:"kitsune",name:"Kitsune",icon:"",unlockLevel:7},{id:"nebula_jelly",name:"Nebula Jelly",icon:"",unlockLevel:10},{id:"shade_bat",name:"Shade Bat",icon:"",unlockLevel:13},{id:"crystal_stag",name:"Crystal Stag",icon:"",unlockLevel:16},{id:"leviathan_pup",name:"Leviathan Pup",icon:"",unlockLevel:19},{id:"mini_griffin",name:"Mini Griffin",icon:"",unlockLevel:22},{id:"hover_drone",name:"Hover Drone",icon:"",unlockLevel:25},{id:"spirit_fox",name:"Spirit Fox",icon:"",unlockLevel:28},{id:"void_skull",name:"Void Skull",icon:"",unlockLevel:31},{id:"cosmic_egg",name:"Cosmic Egg",icon:"",unlockLevel:33},{id:"mecha_hound",name:"Mecha Hound",icon:"",unlockLevel:34},{id:"celestial_serpent",name:"Celestial Serpent",icon:"",unlockLevel:35}];function hR(e,t,n,s){for(let a=12;a<=24;a++)c(e,a,33,"#0003");for(let a=13;a<=23;a++)for(let l=16;l<=28;l++){let i="#808898";a<=14?i="#606878":a>=22&&(i="#a0a8b8"),c(e,a,l-n,i)}for(let a=15;a<=21;a++)for(let l=17;l<=23;l++)c(e,a,l-n,"#1a2840");t%12<10&&(c(e,16,19-n,"#60d0ff"),c(e,17,19-n,"#60d0ff"),c(e,20,19-n,"#60d0ff"),c(e,19,19-n,"#60d0ff")),c(e,16,22-n,"#60d0ff"),c(e,18,22-n,"#60d0ff"),c(e,20,22-n,"#60d0ff"),c(e,18,15-n,"#a0a8b8"),c(e,18,14-n,"#a0a8b8"),c(e,18,13-n,"#a0a8b8"),t%4<2?c(e,18,12-n,"#ff4040"):c(e,18,12-n,"#60d0ff"),c(e,11,20-n,"#808898"),c(e,12,20-n,"#808898"),c(e,11,21-n,"#808898"),c(e,24,20-n,"#808898"),c(e,25,20-n,"#808898"),c(e,25,21-n,"#808898"),c(e,15,29-n,"#606878"),c(e,16,29-n,"#606878"),c(e,15,30-n,"#808898"),c(e,16,30-n,"#808898"),c(e,20,29-n,"#606878"),c(e,21,29-n,"#606878"),c(e,20,30-n,"#808898"),c(e,21,30-n,"#808898"),c(e,18,26-n,s<1?"#40c06080":"#40c060")}function pR(e,t,n,s){for(let i=14;i<=22;i++)c(e,i,33,"#0002");const l=t%6<3?6:5;for(let i=12;i<=24;i++)for(let p=12;p<=24;p++){const g=Math.sqrt((p-18)**2+(i-18)**2);g<l&&(g<2?c(e,p,i-n,"#fff8e0"):g<3.5?c(e,p,i-n,"#a0e0ff80"):c(e,p,i-n,"#60c0ff40"))}for(let i=0;i<4;i++){const p=25+i*2,g=18+Math.floor(Math.sin(t*.2+i)*2);c(e,g,p-n,"#60c0ff20"),c(e,g-1,p-n,"#60c0ff10"),c(e,g+1,p-n,"#60c0ff10")}for(let i=0;i<3;i++){const p=t*.12+i/3*Math.PI*2,g=18+Math.floor(Math.cos(p)*8),v=18+Math.floor(Math.sin(p)*6)-n;g>=0&&g<36&&v>=0&&v<36&&c(e,g,v,"#fff6")}c(e,16,17-n,"#102840"),c(e,20,17-n,"#102840")}function mR(e,t,n,s){for(let a=12;a<=24;a++)c(e,a,33,"#0003");for(let a=18;a<=28;a++)for(let l=13;l<=23;l++){const i=Math.sqrt((l-18)**2+((a-23)*1.3)**2);if(i<6){let p="#e8e0d8";i>4&&(p="#d0c8c0"),c(e,l,a-n,p)}}for(let a=22;a<=27;a++)for(let l=16;l<=20;l++)Math.sqrt((l-18)**2+((a-25)*1.5)**2)<3&&c(e,l,a-n,"#f8f0e8");for(let a=12;a<=20;a++)for(let l=14;l<=22;l++){const i=Math.sqrt((l-18)**2+((a-16)*1.2)**2);if(i<5){let p="#e8e0d8";i>3.5&&(p="#d0c8c0"),c(e,l,a-n,p)}}c(e,15,11-n,"#e8e0d8"),c(e,14,10-n,"#e8e0d8"),c(e,14,9-n,"#e8e0d8"),c(e,13,8-n,"#d0c8c0"),c(e,13,7-n,"#d0c8c0"),c(e,14,9-n,"#f0b0b0"),c(e,21,11-n,"#e8e0d8"),c(e,22,10-n,"#e8e0d8"),c(e,22,9-n,"#e8e0d8"),c(e,23,8-n,"#d0c8c0"),c(e,23,7-n,"#d0c8c0"),c(e,22,9-n,"#f0b0b0"),c(e,16,15-n,"#000"),c(e,20,15-n,"#000"),c(e,16,14-n,"#fff8"),c(e,20,14-n,"#fff8"),c(e,18,17-n,"#f0a0a0"),c(e,14,17-n,"#c0b8b0"),c(e,13,16-n,"#c0b8b0"),c(e,22,17-n,"#c0b8b0"),c(e,23,16-n,"#c0b8b0"),c(e,15,29-n,"#d0c8c0"),c(e,16,29-n,"#d0c8c0"),c(e,20,29-n,"#d0c8c0"),c(e,21,29-n,"#d0c8c0"),c(e,22,24-n,"#f8f0e8"),c(e,23,24-n,"#e8e0d8")}function gR(e,t,n,s){for(let l=10;l<=26;l++)c(e,l,33,"#0003");for(let l=18;l<=28;l++)for(let i=12;i<=24;i++){const p=Math.sqrt((i-18)**2+((l-23)*1.2)**2);if(p<6){let g="#d06020";p>4&&(g="#b04818"),c(e,i,l-n,g)}}for(let l=22;l<=27;l++)for(let i=16;i<=20;i++)Math.sqrt((i-18)**2+((l-25)*1.4)**2)<3&&c(e,i,l-n,"#f0e8d8");const a=Math.sin(t*.2);for(let l=-1;l<=1;l++){const i=22+l*2;for(let p=24;p<=30;p++){const g=i+Math.floor(a*(p-24)*.3*l);g>=0&&g<36&&c(e,g,p-n,"#d06020")}c(e,i+Math.floor(a*6*.3*l),30-n,"#f0e8d8"),s===l+1&&c(e,i+Math.floor(a*6*.3*l),29-n,"#f0a030")}for(let l=10;l<=18;l++)for(let i=14;i<=22;i++){const p=Math.sqrt((i-18)**2+((l-14)*1.1)**2);if(p<5){let g="#d06020";p>3&&(g="#b04818"),c(e,i,l-n,g)}}c(e,14,9-n,"#d06020"),c(e,13,8-n,"#d06020"),c(e,13,7-n,"#b04818"),c(e,22,9-n,"#d06020"),c(e,23,8-n,"#d06020"),c(e,23,7-n,"#b04818"),c(e,14,8-n,"#f0b070"),c(e,22,8-n,"#f0b070"),c(e,16,13-n,"#f0d040"),c(e,20,13-n,"#f0d040"),c(e,16,14-n,"#000"),c(e,20,14-n,"#000"),c(e,18,16-n,"#000"),c(e,14,29-n,"#b04818"),c(e,15,29-n,"#b04818"),c(e,21,29-n,"#b04818"),c(e,22,29-n,"#b04818")}function vR(e,t,n,s){for(let a=8;a<=18;a++)for(let l=12;l<=24;l++)if(Math.sqrt((l-18)**2+((a-13)*1.4)**2)<6){const p=(a-8)/10;p<.3?c(e,l,a-n,"#c080f080"):p<.6?c(e,l,a-n,"#8050c080"):c(e,l,a-n,"#5030a080")}c(e,17,12-n,"#f0c0ff40"),c(e,18,12-n,"#f0c0ff40"),c(e,19,12-n,"#f0c0ff40");for(let a=0;a<5;a++){const l=13+a*2.5;for(let i=19;i<=30;i++){const p=Math.sin(t*.15+a*1.5+(i-19)*.3)*1.5,g=Math.floor(l+p),v=1-(i-19)/12;if(g>=0&&g<36&&v>0){const u=Math.floor(v*80).toString(16).padStart(2,"0");c(e,g,i-n,`#c080f0${u}`)}}}for(let a=0;a<3;a++)if((t+a*5)%8<3){const l=10+(t*3+a*11)%16,i=8+(t*5+a*7)%18;c(e,l,i-n,"#fff4")}c(e,16,14-n,"#fff8"),c(e,20,14-n,"#fff8")}function yR(e,t,n,s){for(let l=10;l<=26;l++)c(e,l,33,"#0003");const a=t%6<3;for(let l=12;l<=22;l++){const i=l-12,p=Math.floor(Math.sin(i/10*Math.PI)*(5+(a?2:0)));for(let g=14-p;g<=14;g++)g>=2&&c(e,g,l-n,"#382848");for(let g=22;g<=22+p;g++)g<=33&&c(e,g,l-n,"#382848")}a&&(c(e,8,16-n,"#483860"),c(e,28,16-n,"#483860"));for(let l=14;l<=24;l++)for(let i=14;i<=22;i++){const p=Math.sqrt((i-18)**2+((l-19)*1.3)**2);if(p<5){let g="#2a1838";p>3&&(g="#1a0e28"),c(e,i,l-n,g)}}for(let l=10;l<=16;l++)for(let i=15;i<=21;i++)Math.sqrt((i-18)**2+((l-13)*1.2)**2)<4&&c(e,i,l-n,"#2a1838");c(e,15,9-n,"#2a1838"),c(e,14,8-n,"#382848"),c(e,21,9-n,"#2a1838"),c(e,22,8-n,"#382848"),c(e,16,12-n,"#ff3040"),c(e,20,12-n,"#ff3040"),t%8<4&&(c(e,16,12-n,"#ff5060"),c(e,20,12-n,"#ff5060")),c(e,17,15-n,"#e0e0f0"),c(e,19,15-n,"#e0e0f0"),c(e,16,25-n,"#1a0e28"),c(e,20,25-n,"#1a0e28")}function bR(e,t,n,s){for(let l=10;l<=26;l++)c(e,l,33,"#0003");for(let l=18;l<=26;l++)for(let i=12;i<=24;i++){const p=Math.sqrt(((i-18)*.9)**2+((l-22)*1.6)**2);if(p<5){let g="#a0b8d0";p>3.5&&(g="#8098b0"),c(e,i,l-n,g)}}for(let l=26;l<=31;l++)c(e,14,l-n,"#8098b0"),c(e,16,l-n,"#8098b0"),c(e,20,l-n,"#8098b0"),c(e,22,l-n,"#8098b0");c(e,14,31-n,"#607890"),c(e,16,31-n,"#607890"),c(e,20,31-n,"#607890"),c(e,22,31-n,"#607890");for(let l=12;l<=18;l++)for(let i=14;i<=22;i++)Math.sqrt((i-18)**2+((l-15)*1.3)**2)<4&&c(e,i,l-n,"#a0b8d0");const a=t%4<2;c(e,14,11-n,"#80d0f0"),c(e,13,10-n,"#60c0e0"),c(e,12,9-n,"#80d0f0"),c(e,11,8-n,a?"#a0e0ff":"#60c0e0"),c(e,14,10-n,"#60c0e0"),c(e,13,9-n,"#80d0f0"),c(e,22,11-n,"#80d0f0"),c(e,23,10-n,"#60c0e0"),c(e,24,9-n,"#80d0f0"),c(e,25,8-n,a?"#a0e0ff":"#60c0e0"),c(e,22,10-n,"#60c0e0"),c(e,23,9-n,"#80d0f0"),t%6<2&&(c(e,11,7-n,"#fff6"),c(e,25,7-n,"#fff6")),c(e,16,14-n,"#2040a0"),c(e,20,14-n,"#2040a0"),c(e,18,16-n,"#607890"),c(e,24,20-n,"#a0b8d0"),c(e,25,19-n,"#a0b8d0")}function SR(e,t,n,s){for(let v=10;v<=26;v++)c(e,v,33,"#0003");const a=[];for(let v=0;v<12;v++){const u=v/11,h=12+Math.floor(Math.sin(u*Math.PI*2+t*.15)*3+u*10),y=14+Math.floor(u*16);a.push([h,y])}a.forEach(([v,u],h)=>{const y=h<3?3:h<8?2:1;for(let x=-y;x<=y;x++){let T="#3080c0";Math.abs(x)>=y&&(T="#2060a0"),v+x>=0&&v+x<36&&c(e,v+x,u-n,T)}}),a.slice(0,8).forEach(([v,u])=>{c(e,v,u-n,"#80c8e0")});const[l,i]=a[0];for(let v=-2;v<=2;v++)for(let u=-3;u<=3;u++){const h=Math.sqrt(u*u+v*v);if(h<3.5){let y="#3080c0";h>2&&(y="#2060a0"),l+u>=0&&l+u<36&&c(e,l+u,i+v-n,y)}}c(e,l-1,i-1-n,"#fff"),c(e,l+1,i-1-n,"#fff"),c(e,l-1,i-n,"#000"),c(e,l+1,i-n,"#000"),c(e,l-3,i-2-n,"#80c8e0"),c(e,l-4,i-3-n,"#60a8d0"),c(e,l+3,i-2-n,"#80c8e0"),c(e,l+4,i-3-n,"#60a8d0"),t%6<2&&(c(e,l+2,i-3-n,"#80d0f040"),c(e,l-3,i+1-n,"#80d0f040"));const[p,g]=a[a.length-1];c(e,p-1,g+1-n,"#2060a0"),c(e,p+1,g+1-n,"#2060a0"),c(e,p,g+2-n,"#3080c0")}er("byte_bot",hR);er("wisp",pR);er("bunbun",mR);er("kitsune",gR);er("nebula_jelly",vR);er("shade_bat",yR);er("crystal_stag",bR);er("leviathan_pup",SR);function wR(e,t,n,s){for(let l=10;l<=26;l++)c(e,l,33,"#0003");const a=t%6<3;for(let l=12;l<=20;l++){const i=Math.floor(Math.sin((l-12)/8*Math.PI)*(3+(a?1:0)));for(let p=14-i;p<=14;p++)p>=6&&c(e,p,l-n,"#c09848");for(let p=22;p<=22+i;p++)p<=30&&c(e,p,l-n,"#c09848")}a&&(c(e,8,15-n,"#d0a858"),c(e,28,15-n,"#d0a858"));for(let l=18;l<=28;l++)for(let i=12;i<=24;i++){const p=Math.sqrt((i-18)**2+((l-23)*1.3)**2);if(p<6){let g="#d0a858";p>4&&(g="#b89040"),c(e,i,l-n,g)}}for(let l=10;l<=18;l++)for(let i=14;i<=22;i++)Math.sqrt((i-18)**2+((l-14)*1.2)**2)<4.5&&c(e,i,l-n,"#e0d0a0");c(e,22,14-n,"#d08020"),c(e,23,14-n,"#d08020"),c(e,24,15-n,"#c07018"),c(e,19,13-n,"#f0c040"),c(e,20,13-n,"#000"),c(e,15,9-n,"#c09848"),c(e,14,8-n,"#d0a858"),c(e,21,9-n,"#c09848"),c(e,22,8-n,"#d0a858");for(let l=26;l<=30;l++)c(e,14,l-n,"#b89040"),c(e,15,l-n,"#b89040"),c(e,21,l-n,"#b89040"),c(e,22,l-n,"#b89040");c(e,13,30-n,"#d0a858"),c(e,14,30-n,"#d0a858"),c(e,22,30-n,"#d0a858"),c(e,23,30-n,"#d0a858"),c(e,24,22-n,"#d0a858"),c(e,26,21-n,"#d0a858"),c(e,27,20-n,"#c09848"),c(e,28,19-n,"#b89040"),c(e,28,20-n,"#b89040")}function _R(e,t,n,s){const a=t%8<4?0:1,l=t%2;for(let i=12;i<=24;i++)c(e,i,12-a,"#60687890");l?(c(e,10,12-a,"#808898"),c(e,26,12-a,"#808898")):(c(e,11,12-a,"#808898"),c(e,25,12-a,"#808898"));for(let i=14;i<=24;i++)for(let p=13;p<=23;p++){const g=Math.sqrt((p-18)**2+((i-19)*1)**2);if(g<5.5){let v="#e0e0e8";g>4?v="#b0b0b8":g<2&&(v="#f0f0f8"),c(e,p,i-a,v)}}for(let i=16;i<=20;i++)for(let p=17;p<=21;p++){const g=Math.sqrt((i-18)**2+(p-19)**2);g<2.5&&c(e,i,p-a,g<1.5?"#60d0ff":"#2080c0")}if(t%10<4){const i=25+Math.floor(t%10/4*6);for(let p=15;p<=21;p++)c(e,p,i-a,"#60d0ff20");c(e,18,i-a,"#60d0ff40")}c(e,13,19-a,t%4<2?"#40c060":"#40c06060"),c(e,23,19-a,t%4<2?"#ff404060":"#ff4040");for(let i=15;i<=21;i++)c(e,i,25-a,"#808898")}function xR(e,t,n,s){for(let a=10;a<=26;a++)c(e,a,33,"#0002");for(let a=18;a<=26;a++)for(let l=12;l<=24;l++){const i=Math.sqrt((l-18)**2+((a-22)*1.3)**2);i<6&&c(e,l,a-n,i<3?"#80c8f060":"#60a0d040")}for(let a=-4;a<=4;a++){const l=22+a;for(let i=22;i<=32;i++){const p=Math.sin(t*.12+a*.8+(i-22)*.2)*1.5,g=Math.floor(l+p+a*(i-22)*.15),v=1-(i-22)/10;if(g>=0&&g<36&&v>0){const u=Math.floor(v*40).toString(16).padStart(2,"0");c(e,g,i-n,`#80c8f0${u}`)}}}for(let a=10;a<=18;a++)for(let l=14;l<=22;l++){const i=Math.sqrt((l-18)**2+((a-14)*1.1)**2);i<5&&c(e,l,a-n,i<2.5?"#a0e0ff60":"#80c0e040")}c(e,14,9-n,"#80c8f050"),c(e,13,8-n,"#60a0d040"),c(e,22,9-n,"#80c8f050"),c(e,23,8-n,"#60a0d040"),c(e,16,13-n,"#fff8"),c(e,20,13-n,"#fff8"),c(e,16,14-n,"#60d0ff"),c(e,20,14-n,"#60d0ff"),c(e,18,16-n,"#a0e0ff30");for(let a=0;a<4;a++){const l=t*.1+a/4*Math.PI*2,i=18+Math.floor(Math.cos(l)*10),p=18+Math.floor(Math.sin(l)*8)-n;i>=0&&i<36&&p>=0&&p<36&&c(e,i,p,"#80c8f020")}c(e,15,27-n,"#60a0d030"),c(e,21,27-n,"#60a0d030")}function TR(e,t,n,s){for(let a=0;a<5;a++){const l=14+a*2,i=8-Math.floor(Math.sin(t*.2+a*1.2)*2);c(e,l,i-n,"#8040c0"),i>6&&c(e,l,i-1-n,"#a060e080"),t%4===a%4&&c(e,l,i-2-n,"#c080f060")}for(let a=10;a<=24;a++)for(let l=12;l<=24;l++){const i=Math.sqrt((l-18)**2+((a-16)*1.1)**2);if(i<7){if(a>=20&&(l<=15||l>=21))continue;let p="#e8e0d8";i>5?p="#c8c0b8":i<3&&(p="#f0ece8"),c(e,l,a-n,p)}}for(let a=14;a<=16;a++)for(let l=14;l<=17;l++)c(e,a,l-n,"#1a0828");for(let a=20;a<=22;a++)for(let l=14;l<=17;l++)c(e,a,l-n,"#1a0828");c(e,15,15-n,t%4<2?"#c060f0":"#a040d0"),c(e,21,15-n,t%4<2?"#c060f0":"#a040d0"),c(e,17,18-n,"#1a0828"),c(e,18,18-n,"#1a0828"),c(e,19,18-n,"#1a0828");for(let a=15;a<=21;a+=2)c(e,a,22-n,"#e8e0d8");for(let a=16;a<=20;a++)c(e,a,23-n,"#c8c0b8");for(let a=0;a<3;a++){const l=26+a*2,i=16+Math.floor(Math.sin(t*.15+a*2)*2);c(e,i,l-n,"#8040c030"),c(e,i+2,l-n,"#8040c020")}}function ER(e,t,n,s){for(let l=10;l<=28;l++)for(let i=12;i<=24;i++){const p=l<18?(l-10)/8:(l-18)/10+1,g=Math.floor(Math.sin(Math.min(p,1)*Math.PI)*6),v=Math.abs(i-18);v<=g&&(v>=g-1?c(e,i,l-n,"#d0c8e0"):c(e,i,l-n,"#e8e0f0"))}c(e,16,14-n,"#1a0828"),c(e,17,15-n,"#1a0828"),c(e,16,16-n,"#1a0828"),c(e,20,18-n,"#1a0828"),c(e,21,19-n,"#1a0828"),c(e,20,20-n,"#1a0828");const a=t%4<2;c(e,16,14-n,a?"#f0d060":"#c0a040"),c(e,17,15-n,a?"#fff8e0":"#f0d060"),c(e,20,18-n,a?"#80d0ff":"#60a0d0"),c(e,21,19-n,a?"#a0e0ff":"#80c0e0");for(let l=0;l<4;l++){const i=t*.08+l/4*Math.PI*2,p=8+Math.sin(t*.05+l)*2,g=18+Math.floor(Math.cos(i)*p),v=19+Math.floor(Math.sin(i)*p*.7)-n;g>=0&&g<36&&v>=0&&v<36&&c(e,g,v,["#f0d060","#80d0ff","#f080a0","#80f0a0"][l]+"60")}for(let l=14;l<=22;l++)c(e,l,29-n,"#c080f010")}function CR(e,t,n,s){for(let a=8;a<=28;a++)c(e,a,33,"#0003");for(let a=16;a<=24;a++)for(let l=10;l<=26;l++){const i=Math.sqrt(((l-18)*.8)**2+((a-20)*1.5)**2);if(i<6){let p="#808898";i>4?p="#606878":i<2&&(p="#a0a8b8"),c(e,l,a-n,p)}}for(let a=12;a<=24;a++)c(e,a,16-n,"#a0a8b8");for(let a=14;a<=22;a++)c(e,a,24-n,"#606878");c(e,18,18-n,"#50586860"),c(e,18,20-n,"#50586860"),c(e,18,22-n,"#50586860");for(let a=24;a<=30;a++)c(e,12,a-n,"#606878"),c(e,13,a-n,"#808898"),c(e,16,a-n,"#606878"),c(e,17,a-n,"#808898"),c(e,19,a-n,"#808898"),c(e,20,a-n,"#606878"),c(e,23,a-n,"#808898"),c(e,24,a-n,"#606878");c(e,12,27-n,"#a0a8b8"),c(e,17,27-n,"#a0a8b8"),c(e,19,27-n,"#a0a8b8"),c(e,24,27-n,"#a0a8b8");for(let a=0;a<3;a++)c(e,11+a,31-n,"#505868"),c(e,16+a,31-n,"#505868"),c(e,19+a,31-n,"#505868"),c(e,23+a,31-n,"#505868");for(let a=12;a<=24;a++)for(let l=10;l<=16;l++){let i="#808898";a<=13?i="#606878":a>=23&&(i="#a0a8b8"),l<=11&&(i="#a0a8b8"),c(e,a,l-n,i)}for(let a=22;a<=27;a++)for(let l=12;l<=15;l++){let i="#707888";l===12&&(i="#909aa8"),c(e,a,l-n,i)}c(e,14,12-n,"#ff3040"),c(e,15,12-n,"#ff3040"),t%6<2&&(c(e,14,12-n,"#ff6070"),c(e,13,11-n,"#ff304040")),c(e,19,12-n,"#60d0ff"),c(e,20,12-n,"#60d0ff"),c(e,13,9-n,"#a0a8b8"),c(e,12,8-n,"#808898"),c(e,22,9-n,"#a0a8b8"),c(e,23,8-n,"#808898"),c(e,10,18-n,"#808898"),c(e,8,16-n,"#808898"),c(e,7,15-n,"#a0a8b8"),t%4<2&&c(e,7,14-n,"#60d0ff80")}function AR(e,t,n,s){for(let T=0;T<8;T++){const _=8+(t*2+T*17)%22,E=4+(t+T*11)%26,R=["#8040c018","#4060d018","#d040a018","#40a0d018"];_<36&&E<36&&c(e,_,E-n,R[T%4])}const a=[];for(let T=0;T<16;T++){const _=T/15,E=Math.sin(_*Math.PI*3+t*.08)*5,R=6+Math.floor(E+_*22),P=6+Math.floor(_*24);a.push([R,P])}a.forEach(([T,_],E)=>{const R=E<4?4:E<8?3:E<12?2:1;for(let P=-R;P<=R;P++)for(let B=-1;B<=0;B++){const X=Math.abs(P);let Q;X===0?Q="#c0a0ff":X===1?Q="#8060d0":X<R?Q="#4040a0":Q="#28287080";const K=T+P,k=_+B;K>=0&&K<36&&k>=0&&k<36&&c(e,K,k-n,Q)}E<12&&T>=0&&T<36&&c(e,T,_-1-n,"#f0d06080")});const l=[];for(let T=1;T<a.length-2;T+=2){const[_,E]=a[T],R=(t+T*5)%8<4;_>=0&&_<36&&E>=0&&E<36&&(c(e,_,E-n,R?"#ffffffc0":"#ffe88080"),l.push([_,E]))}for(let T=0;T<l.length-1;T++){const[_,E]=l[T],[R,P]=l[T+1],B=Math.max(Math.abs(R-_),Math.abs(P-E));if(B>0&&B<12)for(let X=1;X<B;X+=2){const Q=Math.floor(_+(R-_)*X/B),K=Math.floor(E+(P-E)*X/B);Q>=0&&Q<36&&K>=0&&K<36&&c(e,Q,K-n,"#8080ff20")}}const i=Math.sin(t*.1);a.slice(2,7).forEach(([T,_],E)=>{const R=Math.floor((3-Math.abs(E-2))*(2.5+i));for(let P=1;P<=R;P++){const B=T-P-Math.floor(E*.5),X=_-Math.floor(P*.3)-1,Q=1-P/(R+1),K=Math.floor(Q*35);B>=0&&X>=0&&B<36&&X<36&&K>1&&(c(e,B,X-n,`#8060d0${K.toString(16).padStart(2,"0")}`),P===R&&(t+E)%6<2&&c(e,B,X-n,"#c0a0ff40"))}for(let P=1;P<=R;P++){const B=T+P+Math.floor(E*.5),X=_-Math.floor(P*.3)-1,Q=1-P/(R+1),K=Math.floor(Q*35);B>=0&&X>=0&&B<36&&X<36&&K>1&&(c(e,B,X-n,`#6040b0${K.toString(16).padStart(2,"0")}`),P===R&&(t+E+3)%6<2&&c(e,B,X-n,"#c0a0ff40"))}});const[g,v]=a[0];for(let T=-4;T<=3;T++)for(let _=-5;_<=5;_++){const E=Math.sqrt(_*_+(T*1.1)**2);if(E<5.5&&E>4){const R=g+_,P=v+T;R>=0&&R<36&&P>=0&&P<36&&c(e,R,P-n,"#c0a0ff20")}}for(let T=-3;T<=3;T++)for(let _=-4;_<=4;_++){const E=Math.sqrt((_*.9)**2+(T*1.1)**2);if(E<4){let R;E<1.5?R="#d0c0ff":E<2.5?R="#a080e0":R="#6050b0";const P=g+_,B=v+T;P>=0&&P<36&&B>=0&&B<36&&c(e,P,B-n,R)}}[{dx:-3,dy:-3,len:3,c1:"#f0d060",c2:"#ffe880"},{dx:-2,dy:-4,len:4,c1:"#f0c030",c2:"#f0d060"},{dx:-1,dy:-5,len:3,c1:"#ffe880",c2:"#ffffff90"}].forEach(T=>{for(let _=0;_<T.len;_++){const E=g+T.dx-_,R=v+T.dy-_;E>=0&&R>=0&&E<36&&R<36&&c(e,E,R-n,_<T.len-1?T.c1:T.c2)}for(let _=0;_<T.len;_++){const E=g-T.dx+_,R=v+T.dy-_;E>=0&&R>=0&&E<36&&R<36&&c(e,E,R-n,_<T.len-1?T.c1:T.c2)}});const h=t%6<3;if(c(e,g-2,v-1-n,h?"#ffffff":"#e0e0ff"),c(e,g-1,v-1-n,"#000"),c(e,g+2,v-1-n,h?"#ffffff":"#e0e0ff"),c(e,g+3,v-1-n,"#000"),h&&(c(e,g-3,v-1-n,"#80d0ff40"),c(e,g+4,v-1-n,"#80d0ff40")),t%10<4){const T=t%10;for(let _=0;_<3;_++){const E=g+4+T+_,R=v+Math.floor(Math.sin(t*.3+_)*1.5)-n,P=["#c0a0ff60","#80d0ff40","#f0d06040"];E>=0&&E<36&&R>=0&&R<36&&c(e,E,R,P[_])}}const[y,x]=a[a.length-1];for(let T=-1;T<=1;T++){for(let R=1;R<=4;R++){const P=y+R+Math.floor(Math.sin(t*.12+T*2)*1.5),B=x+T*R*.8,X=1-R/5,Q=Math.floor(X*50);P>=0&&P<36&&B>=0&&B<36&&Q>1&&c(e,Math.floor(P),Math.floor(B)-n,`#c0a0ff${Q.toString(16).padStart(2,"0")}`)}const _=Math.floor(y+4+Math.sin(t*.12+T*2)*1.5),E=Math.floor(x+T*3.2);_>=0&&_<36&&E>=0&&E<36&&(t+T*3)%6<4&&c(e,_,E-n,"#ffffffa0")}for(let T=0;T<10;T++){const _=t*.06+T/10*Math.PI*2,E=14+Math.sin(t*.03+T*1.5)*3,R=18+Math.floor(Math.cos(_)*E),P=16+Math.floor(Math.sin(_)*E*.6)-n;if(R>=0&&R<36&&P>=0&&P<36){c(e,R,P,["#f0d06050","#80d0ff40","#ff80a040","#80ff8040","#c0a0ff50"][T%5]);const X=_-.12,Q=18+Math.floor(Math.cos(X)*E),K=16+Math.floor(Math.sin(X)*E*.6)-n;Q>=0&&Q<36&&K>=0&&K<36&&c(e,Q,K,"#ffffff18")}}if(t%24<4){const T=4+t%24*3;for(let _=0;_<12;_++){const E=_/12*Math.PI*2,R=Math.floor(18+Math.cos(E)*T),P=Math.floor(16+Math.sin(E)*T*.6)-n,B=1-t%24/4,X=Math.floor(B*40);R>=0&&R<36&&P>=0&&P<36&&X>1&&c(e,R,P,`#c0a0ff${X.toString(16).padStart(2,"0")}`)}}}er("mini_griffin",wR);er("hover_drone",_R);er("spirit_fox",xR);er("void_skull",TR);er("cosmic_egg",ER);er("mecha_hound",CR);er("celestial_serpent",AR);const qr={mage:{id:"mage",name:"Mage",icon:"",description:"Masters of arcane knowledge",unlockLevel:1,color:{robe:"#5828a8",robeMid:"#6838c0",robeDark:"#3a1878",robeLight:"#7848d8",accent:"#f0c848"},abilities:{passive:"Arcane Mind  +10% XP from quiz questions",active:"Mana Burst  Double damage on next boss battle answer (3 question cooldown)"}},warrior:{id:"warrior",name:"Warrior",icon:"",description:"Stalwart defenders of the class",unlockLevel:1,color:{robe:"#808898",robeMid:"#909aa8",robeDark:"#505868",robeLight:"#a0a8b8",accent:"#d4a040"},abilities:{passive:"Iron Will  Shield blocks +1 extra class HP damage",active:"Rally Cry  Give all teammates +1 damage on their next answer (5 question cooldown)"}},ranger:{id:"ranger",name:"Ranger",icon:"",description:"Swift scouts and sharpshooters",unlockLevel:1,color:{robe:"#2a6838",robeMid:"#308848",robeDark:"#1a4828",robeLight:"#40a058",accent:"#d4a040"},abilities:{passive:"Keen Eye  Hint ability eliminates 2 wrong answers instead of 1",active:"Precision Shot  Guaranteed correct answer counts as crit (4 question cooldown)"}},healer:{id:"healer",name:"Healer",icon:"",description:"Restorers of hope and health",unlockLevel:1,color:{robe:"#d0c8b0",robeMid:"#e0d8c8",robeDark:"#a8a090",robeLight:"#f0ece0",accent:"#40c880"},abilities:{passive:"Healing Aura  Wrong answers deal 1 less class HP damage (min 0)",active:"Restoration  Heal 2 class HP (5 question cooldown)"}},rogue:{id:"rogue",name:"Rogue",icon:"",description:"Masters of stealth and cunning",unlockLevel:1,color:{robe:"#303040",robeMid:"#404050",robeDark:"#1a1a28",robeLight:"#484858",accent:"#e04040"},abilities:{passive:"Evasion  20% chance to dodge counterattack damage on wrong answer",active:"Backstab  Triple damage on next correct answer (5 question cooldown)"}},paladin:{id:"paladin",name:"Paladin",icon:"",description:"Holy knights who protect and inspire",unlockLevel:20,color:{robe:"#c0a030",robeMid:"#d4b440",robeDark:"#907020",robeLight:"#e0c850",accent:"#f0e880"},abilities:{passive:"Divine Shield  Shield ability has 1 less cooldown",active:"Consecrate  Heal 1 class HP and deal 1 boss damage (4 question cooldown)"}},necromancer:{id:"necromancer",name:"Necromancer",icon:"",description:"Dark scholars who harness forbidden power",unlockLevel:28,color:{robe:"#2a1a2a",robeMid:"#3a2840",robeDark:"#140e18",robeLight:"#4a3850",accent:"#80ff80"},abilities:{passive:"Life Drain  Correct answers heal 1 class HP",active:"Soul Harvest  Convert team's wrong answers into boss damage (1 per 2 wrong, 6 question cooldown)"}},bard:{id:"bard",name:"Bard",icon:"",description:"Charismatic performers who buff allies",unlockLevel:10,color:{robe:"#a03050",robeMid:"#c04068",robeDark:"#702038",robeLight:"#e05880",accent:"#f0c848"},abilities:{passive:"Inspiration  Teammates get +5% XP when you answer correctly",active:"Battle Song  All teams get +1 damage for 2 questions (5 question cooldown)"}},...PM,...JM},Qf=[{id:"medium",label:"",base:"#d4a878",hi:"#e8c4a0",mid:"#c49468",sh:"#a07850",dk:"#805830"},{id:"light",label:"",base:"#f5d0a9",hi:"#fff0e0",mid:"#e8c098",sh:"#d0a878",dk:"#b89068"},{id:"medium-light",label:"",base:"#c8a07a",hi:"#d8b898",mid:"#b89068",sh:"#987450",dk:"#785838"},{id:"medium-dark",label:"",base:"#8d5524",hi:"#a06830",mid:"#7a4820",sh:"#603818",dk:"#482810"},{id:"dark",label:"",base:"#4a2c11",hi:"#5a3818",mid:"#3e240e",sh:"#301a08",dk:"#221005"}],gl=[{id:"purple",label:"Purple",base:"#2a1848",hi:"#5a3890",mid:"#3a2060",sh:"#1a0e30",br:"#8060b0"},{id:"black",label:"Black",base:"#1a1a28",hi:"#3a3a50",mid:"#282838",sh:"#0e0e18",br:"#505068"},{id:"blonde",label:"Blonde",base:"#d4a040",hi:"#f0c860",mid:"#c09030",sh:"#a07820",br:"#ffe088"},{id:"red",label:"Red",base:"#c03020",hi:"#e04838",mid:"#a02818",sh:"#801810",br:"#ff6858"},{id:"white",label:"White",base:"#d0d0e0",hi:"#e8e8f0",mid:"#b8b8c8",sh:"#9898a8",br:"#ffffff"},{id:"blue",label:"Blue",base:"#2040a0",hi:"#3868d0",mid:"#2850b8",sh:"#182878",br:"#5888f0"},{id:"green",label:"Green",base:"#1a6040",hi:"#30a068",mid:"#208050",sh:"#0e4028",br:"#48c080"},{id:"pink",label:"Pink",base:"#c04888",hi:"#e068a8",mid:"#a83870",sh:"#802858",br:"#f088c0"},{id:"silver",label:"Silver",base:"#a0a8b8",hi:"#c8d0e0",mid:"#8890a0",sh:"#687080",br:"#e0e8f0"}],vl=[{id:"purple",label:"Purple",iris:"#5030a0",irisLight:"#6040b8",pupil:"#100818"},{id:"brown",label:"Brown",iris:"#6a4020",irisLight:"#8a5830",pupil:"#2a1808"},{id:"blue",label:"Blue",iris:"#2050a0",irisLight:"#3868c0",pupil:"#081028"},{id:"green",label:"Green",iris:"#207040",irisLight:"#309858",pupil:"#082010"},{id:"amber",label:"Amber",iris:"#a07020",irisLight:"#c09030",pupil:"#281808"},{id:"red",label:"Red",iris:"#a02030",irisLight:"#c03848",pupil:"#280810"},{id:"gold",label:"Gold",iris:"#b09020",irisLight:"#d4b030",pupil:"#282008"}],ou=[{id:"fire_spirit",name:"Fire Spirit",icon:"",unlockLevel:1},{id:"wolf",name:"Wolf",icon:"",unlockLevel:1},{id:"owl",name:"Owl",icon:"",unlockLevel:1},{id:"drake",name:"Drake",icon:"",unlockLevel:1},{id:"cat",name:"Shadow Cat",icon:"",unlockLevel:7},{id:"phoenix",name:"Phoenix",icon:"",unlockLevel:18},{id:"slime",name:"Slime",icon:"",unlockLevel:9},{id:"fairy",name:"Fairy",icon:"",unlockLevel:24},{id:"dragon",name:"Elder Dragon",icon:"",unlockLevel:35},...fR],Xc=[{id:"none",name:"None",icon:"",slot:"accessory",unlockLevel:1},{id:"scarf_red",name:"Red Scarf",icon:"",slot:"accessory",unlockLevel:1},{id:"shield_wood",name:"Wooden Shield",icon:"",slot:"accessory",unlockLevel:1},{id:"halo_basic",name:"Halo",icon:"",slot:"accessory",unlockLevel:5},{id:"shoulder_pads",name:"Shoulder Pads",icon:"",slot:"accessory",unlockLevel:7},{id:"floating_book",name:"Arcane Tome",icon:"",slot:"accessory",unlockLevel:9},{id:"cape_basic",name:"Basic Cape",icon:"",slot:"accessory",unlockLevel:11},{id:"wings_small",name:"Fairy Wings",icon:"",slot:"accessory",unlockLevel:13},{id:"shield_iron",name:"Iron Shield",icon:"",slot:"accessory",unlockLevel:15},{id:"floating_orbs",name:"Orbit Orbs",icon:"",slot:"accessory",unlockLevel:17},{id:"chain_wrap",name:"Ghost Chains",icon:"",slot:"accessory",unlockLevel:19},{id:"wings_bat",name:"Bat Wings",icon:"",slot:"accessory",unlockLevel:21},{id:"cape_royal",name:"Royal Cape",icon:"",slot:"accessory",unlockLevel:23},{id:"floating_swords",name:"Phantom Blades",icon:"",slot:"accessory",unlockLevel:25},{id:"halo_fire",name:"Fire Halo",icon:"",slot:"accessory",unlockLevel:27},{id:"tech_drones",name:"Nano Drones",icon:"",slot:"accessory",unlockLevel:29},{id:"wings_angel",name:"Angel Wings",icon:"",slot:"accessory",unlockLevel:31},{id:"shield_energy",name:"Quantum Barrier",icon:"",slot:"accessory",unlockLevel:32},{id:"wings_dragon",name:"Dragon Wings",icon:"",slot:"accessory",unlockLevel:34},{id:"crown_divine",name:"Crown of the Pantheon",icon:"",slot:"accessory",unlockLevel:35},{id:"aura_none",name:"None",icon:"",slot:"power",unlockLevel:1},{id:"power_sparkle",name:"Sparkle Trail",icon:"",slot:"power",unlockLevel:1},{id:"power_leaves",name:"Leaf Storm",icon:"",slot:"power",unlockLevel:1},{id:"power_bubbles",name:"Bubble Shield",icon:"",slot:"power",unlockLevel:5},{id:"power_music",name:"Battle Anthem",icon:"",slot:"power",unlockLevel:7},{id:"power_snowflake",name:"Frost Aura",icon:"",slot:"power",unlockLevel:9},{id:"aura_basic",name:"Starfield",icon:"",slot:"power",unlockLevel:11},{id:"power_hearts",name:"Heart Pulse",icon:"",slot:"power",unlockLevel:13},{id:"power_matrix",name:"Data Stream",icon:"",slot:"power",unlockLevel:15},{id:"power_shadow",name:"Shadow Cloak",icon:"",slot:"power",unlockLevel:17},{id:"power_vortex",name:"Arcane Vortex",icon:"",slot:"power",unlockLevel:21},{id:"power_sakura",name:"Cherry Blossom",icon:"",slot:"power",unlockLevel:23},{id:"aura_fire",name:"Inferno",icon:"",slot:"power",unlockLevel:25},{id:"aura_lightning",name:"Lightning Storm",icon:"",slot:"power",unlockLevel:27},{id:"power_galaxy",name:"Galaxy Swirl",icon:"",slot:"power",unlockLevel:29},{id:"power_phoenix",name:"Phoenix Flame",icon:"",slot:"power",unlockLevel:31},{id:"power_glitch",name:"Glitch Field",icon:"",slot:"power",unlockLevel:32},{id:"aura_holy",name:"Divine Radiance",icon:"",slot:"power",unlockLevel:33},{id:"power_void",name:"Void Rift",icon:"",slot:"power",unlockLevel:34},{id:"power_rainbow",name:"Prismatic",icon:"",slot:"power",unlockLevel:35}],el=[{minLevel:1,name:"Novice",features:["Base outfit","Basic weapon"]},{minLevel:6,name:"Apprentice",features:["Class headgear","Gold trim","Weapon upgrade"]},{minLevel:11,name:"Adept",features:["Pauldrons/bracers","Belt gems","Weapon glow","Class emblem"]},{minLevel:16,name:"Veteran",features:["Cape","Advanced headgear","Rune patterns","Special powers"]},{minLevel:21,name:"Champion",features:["Enhanced armor","Weapon effects","Ambient particles"]},{minLevel:26,name:"Legend",features:["Full aura","Legendary weapon","Elite cosmetics"]},{minLevel:31,name:"Mythic",features:["Mythic glow","Max effects","Prestige cosmetics"]},{minLevel:35,name:"Panther Ascendant",features:["Divine crown","Ascendant aura","Ultimate form","Legendary title"]}];function jR(e){let t=el[0];for(const n of el)e>=n.minLevel&&(t=n);return t}const MR={classId:"mage",skinTone:"medium",hairColor:"black",eyeColor:"brown",petId:"fire_spirit",accessory:"none",specialPower:"none",createdAt:null,updatedAt:null};function zc(e){return e[Math.floor(Math.random()*e.length)]}function K3(e=0){const t=sS(e),n=zc(t.classes)||Object.values(qr)[0],s=zc(Qf),a=zc(t.hairColors.length?t.hairColors:gl),l=zc(t.eyeColors.length?t.eyeColors:vl),i=zc(t.pets)||ou[0];return{classId:n.id,skinTone:s.id,hairColor:a.id,eyeColor:l.id,petId:i.id,accessory:"none",specialPower:"none",createdAt:null,updatedAt:null}}async function iS(e){const t=Fe(be,"gamification",e),n=await Mt(t);return n.exists()&&n.data().avatar||null}async function RR(e,t){const n=Fe(be,"gamification",e),s={avatar:{...t,updatedAt:new Date().toISOString(),createdAt:t.createdAt||new Date().toISOString()}};return await At(n,s,{merge:!0}),s.avatar}function sS(e){const{current:t}=ls(e),n=t.level;return{classes:Object.values(qr).filter(s=>n>=s.unlockLevel),lockedClasses:Object.values(qr).filter(s=>n<s.unlockLevel),hairColors:gl.filter(s=>n>=(s.unlockLevel||1)),lockedHairColors:gl.filter(s=>n<(s.unlockLevel||1)),eyeColors:vl.filter(s=>n>=(s.unlockLevel||1)),lockedEyeColors:vl.filter(s=>n<(s.unlockLevel||1)),pets:ou.filter(s=>n>=s.unlockLevel),lockedPets:ou.filter(s=>n<s.unlockLevel),accessories:Xc.filter(s=>n>=s.unlockLevel),lockedAccessories:Xc.filter(s=>n<s.unlockLevel),level:n,visualTier:jR(n)}}function aS({avatar:e,level:t=1,size:n=192,animate:s=!0,showLabel:a=!1,style:l={}}){const i=M.useRef(null),p=M.useRef(0),g=M.useRef(null),v=e?.classId||"mage",u=e?.skinTone||"medium",h=e?.hairColor||"black",y=e?.eyeColor||"brown",x=Qf.find(X=>X.id===u)||Qf[0],T=gl.find(X=>X.id===h)||gl[0],_=vl.find(X=>X.id===y)||vl[0],E=qr[v]||qr.mage,R=E.color,P={accessory:e?.accessory&&e.accessory!=="none"?e.accessory:null,power:e?.specialPower&&e.specialPower!=="aura_none"&&e.specialPower!=="none"?e.specialPower:null},B=M.useCallback(X=>{const Q=i.current;Q&&bM(Q.getContext("2d"),v,x,T,_,R,t,X,P)},[v,x,T,_,R,t,P.accessory,P.power]);return M.useEffect(()=>{if(B(0),!s)return;const X=()=>{p.current++,B(p.current),g.current=setTimeout(X,200)};return g.current=setTimeout(X,200),()=>clearTimeout(g.current)},[B,s]),f.jsxs("div",{style:{display:"inline-flex",flexDirection:"column",alignItems:"center",...l},children:[f.jsx("canvas",{ref:i,width:80,height:48,style:{width:n*(80/48),height:n,imageRendering:"pixelated",borderRadius:8}}),a&&f.jsxs("div",{style:{marginTop:6,fontSize:Math.max(10,n/18),fontWeight:800,color:R.accent,textAlign:"center",textShadow:`0 0 8px ${R.accent}44`},children:[E.icon," ",E.name]})]})}function kR({petId:e="fire_spirit",size:t=144,animate:n=!0,style:s={}}){const a=M.useRef(null),l=M.useRef(0),i=M.useRef(null),p=M.useCallback(g=>{const v=a.current;v&&EM(v.getContext("2d"),e,g)},[e]);return M.useEffect(()=>{if(p(0),!n)return;const g=()=>{l.current++,p(l.current),i.current=setTimeout(g,200)};return i.current=setTimeout(g,200),()=>clearTimeout(i.current)},[p,n]),f.jsx("canvas",{ref:a,width:36,height:36,style:{width:t,height:t,imageRendering:"pixelated",borderRadius:8,...s}})}function oS({avatar:e,level:t=1,charSize:n=192,petSize:s=144,animate:a=!0}){const l=Math.round(n*-.65),i=Math.round(n*.02);return f.jsxs("div",{style:{display:"flex",alignItems:"flex-end",justifyContent:"center"},children:[f.jsx(aS,{avatar:e,level:t,size:n,animate:a}),e?.petId&&f.jsx(kR,{petId:e.petId,size:s,animate:a,style:{marginLeft:l,marginBottom:i}})]})}function IR({earnedBadgeIds:e=[],showHidden:t=!1,compact:n=!1}){const[s,a]=M.useState(null),l=on(["Earned","Locked","hidden badge","hidden badges","left to discover...","Keep exploring to discover this badge!"]),i=(x,T)=>l?.[x]??T,p=Gf.filter(x=>!(x.hidden&&!e.includes(x.id)&&!t)),g=p.filter(x=>e.includes(x.id)),v=p.filter(x=>!e.includes(x.id)),u=Gf.filter(x=>x.hidden&&!e.includes(x.id)).length;function h(x){e.includes(x.id)&&(a(x.id),setTimeout(()=>a(null),800))}const y={display:"grid",gridTemplateColumns:n?"repeat(auto-fill, minmax(80px, 1fr))":"repeat(auto-fill, minmax(140px, 1fr))",gap:n?8:12};return f.jsxs("div",{children:[g.length>0&&f.jsxs("div",{style:{marginBottom:16},children:[f.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text2, #aaa)",marginBottom:10},"data-translatable":!0,children:[i(0,"Earned")," (",g.length,")"]}),f.jsx("div",{style:y,children:g.map(x=>f.jsx(J3,{badge:x,unlocked:!0,celebrating:s===x.id,compact:n,onClick:()=>h(x),hiddenHint:i(5,"Keep exploring to discover this badge!")},x.id))})]}),v.length>0&&f.jsxs("div",{style:{marginBottom:16},children:[f.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text2, #aaa)",marginBottom:10},"data-translatable":!0,children:[i(1,"Locked")," (",v.length,")"]}),f.jsx("div",{style:y,children:v.map(x=>f.jsx(J3,{badge:x,unlocked:!1,compact:n,hiddenHint:i(5,"Keep exploring to discover this badge!")},x.id))})]}),u>0&&!t&&f.jsxs("div",{style:{marginTop:12,padding:"10px 14px",background:"var(--surface2, #252535)",borderRadius:8,fontSize:13,color:"var(--text2, #aaa)",textAlign:"center",fontStyle:"italic"},"data-translatable":!0,children:[" ",u," ",u>1?i(3,"hidden badges"):i(2,"hidden badge")," ",i(4,"left to discover...")]})]})}function J3({badge:e,unlocked:t,celebrating:n=!1,compact:s=!1,onClick:a,hiddenHint:l}){const[i,p]=M.useState(!1),g=G3[e.rarity]||G3.common,v={position:"relative",background:t?g.bg:"var(--surface2, #252535)",border:`2px solid ${t?g.border:"var(--border, #2a2a3a)"}`,borderRadius:10,padding:s?"10px 6px":"14px 10px",textAlign:"center",cursor:t?"pointer":"default",transition:"all 0.2s ease",transform:n?"scale(1.1)":i&&t?"translateY(-2px)":"none",boxShadow:n?`0 0 20px ${g.border}88`:t&&i?`0 4px 12px ${g.border}33`:"none",opacity:t?1:.5,filter:t?"none":"grayscale(0.6)",overflow:"hidden"},u={fontSize:s?24:32,marginBottom:s?4:8,display:"block",filter:t?"none":"grayscale(1) brightness(0.7)"},h={fontSize:s?11:13,fontWeight:600,color:t?"var(--text1, #e8e8e8)":"var(--text2, #aaa)",marginBottom:s?0:4,lineHeight:1.2},y={fontSize:11,color:"var(--text2, #aaa)",lineHeight:1.3},x={position:"absolute",top:4,right:4,fontSize:9,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:g.border,opacity:.8},T=n?{position:"absolute",inset:0,background:`radial-gradient(circle, ${g.border}33 0%, transparent 70%)`,animation:"badgePulse 0.8s ease-out",pointerEvents:"none"}:{};return f.jsxs("div",{style:v,onClick:a,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),title:t?`${e.name}  ${e.description}`:` ${e.description}`,children:[n&&f.jsx("div",{style:T}),!s&&e.rarity!=="common"&&f.jsx("div",{style:x,children:g.label}),f.jsx("span",{style:u,children:e.hidden&&!t?"":e.icon}),f.jsx("div",{style:h,children:e.hidden&&!t?"???":e.name}),!s&&f.jsx("div",{style:y,children:e.hidden&&!t?l:e.description}),t&&f.jsx("div",{style:{position:"absolute",bottom:4,left:4,fontSize:10,background:g.border,color:"#fff",borderRadius:10,padding:"1px 5px",fontWeight:700},children:""})]})}function lS({currentStreak:e=0,longestStreak:t=0,streakFreezes:n=0,compact:s=!1}){const[a,l]=M.useState(!1),i=on(["day","days","Keep it going!","Start a streak by being active today","Best:","Streak Info","Be active each day to build your streak","Weekends don't break your streak","Earn streak freezes every 7 days (max 3)","Longer streaks = XP multiplier bonus!","Streak freeze available","Empty freeze slot","Streak freezes available"]),p=(u,h)=>i?.[u]??h,g=e!==1?p(1,"days"):p(0,"day"),v=e>=30?"#9b59b6":e>=14?"#e74c3c":e>=7?"#f39c12":e>=3?"#f1c40f":"var(--text2, #aaa)";return s?f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,color:e>0?v:"var(--text2, #aaa)"},children:[f.jsx("span",{style:{fontSize:16},children:e>0?"":""}),f.jsxs("span",{style:{fontWeight:600},children:[e," ",g]}),n>0&&f.jsxs("span",{title:p(12,"Streak freezes available"),style:{fontSize:12},children:["",n]})]}):f.jsxs("div",{style:{position:"relative",background:"var(--surface1, #1e1e2e)",borderRadius:12,padding:"16px",border:`1px solid ${e>=7?v+"44":"var(--border, #2a2a3a)"}`,transition:"all 0.3s ease"},onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[f.jsx("div",{style:{fontSize:32,filter:e>0?"none":"grayscale(1)",transition:"all 0.3s ease"},children:e>=30?"":e>0?"":""}),f.jsxs("div",{children:[f.jsxs("div",{style:{fontSize:22,fontWeight:800,color:e>0?v:"var(--text2, #aaa)",fontFamily:"var(--font-display, var(--font-body))"},"data-translatable":!0,children:[e," ",e!==1?p(1,"Days"):p(0,"Day")]}),f.jsx("div",{style:{fontSize:12,color:"var(--text2, #aaa)"},"data-translatable":!0,children:e>0?p(2,"Keep it going!"):p(3,"Start a streak by being active today")})]})]}),f.jsxs("div",{style:{textAlign:"right"},children:[f.jsx("div",{style:{display:"flex",alignItems:"center",gap:4,justifyContent:"flex-end",marginBottom:4},children:[...Array(3)].map((u,h)=>f.jsx("span",{style:{fontSize:16,filter:h<n?"none":"grayscale(1) opacity(0.3)"},title:h<n?p(10,"Streak freeze available"):p(11,"Empty freeze slot"),children:""},h))}),f.jsxs("div",{style:{fontSize:11,color:"var(--text2, #aaa)"},"data-translatable":!0,children:[p(4,"Best:")," ",t," ",t!==1?p(1,"days"):p(0,"day")]})]})]}),e>0&&f.jsx("div",{style:{marginTop:12,display:"flex",gap:3,alignItems:"center"},children:[3,7,14,21,30].map(u=>f.jsxs("div",{style:{flex:1,textAlign:"center"},children:[f.jsx("div",{style:{height:4,borderRadius:2,background:e>=u?v:"var(--border, #2a2a3a)",transition:"background 0.3s ease",marginBottom:3}}),f.jsxs("span",{style:{fontSize:9,color:e>=u?v:"var(--text2, #666)",fontWeight:e>=u?700:400},children:[u,"d"]})]},u))}),a&&f.jsxs("div",{style:{position:"absolute",bottom:"calc(100% + 8px)",right:0,background:"var(--surface2, #252535)",border:"1px solid var(--border, #2a2a3a)",borderRadius:8,padding:"10px 14px",fontSize:12,color:"var(--text2, #aaa)",maxWidth:240,zIndex:10,boxShadow:"0 4px 16px rgba(0,0,0,0.3)"},children:[f.jsx("div",{style:{fontWeight:600,color:"var(--text1, #e8e8e8)",marginBottom:4},"data-translatable":!0,children:p(5,"Streak Info")}),f.jsxs("div",{"data-translatable":!0,children:[" ",p(6,"Be active each day to build your streak")]}),f.jsxs("div",{"data-translatable":!0,children:[" ",p(7,"3-hour grace period after midnight")]}),f.jsxs("div",{"data-translatable":!0,children:[" ",p(8,"Earn streak freezes every 7 days (max 3)")]}),f.jsxs("div",{"data-translatable":!0,children:[" ",p(9,"Longer streaks = XP multiplier bonus!")]})]})]})}function cS({activeMultiplier:e,compact:t=!1}){const[n,s]=M.useState(""),[a,l]=M.useState(!1),i=on(["Active!","All XP earned is multiplied right now"]),p=(g,v)=>i?.[g]??v;return M.useEffect(()=>{if(!e){l(!1);return}const g=e.expiresAt?.toDate?.()?e.expiresAt.toDate():new Date(e.expiresAt);function v(){const y=g-new Date;if(y<=0){l(!1),s("");return}l(!0);const x=Math.floor(y/36e5),T=Math.floor(y%36e5/6e4),_=Math.floor(y%6e4/1e3);x>0?s(`${x}h ${T}m`):T>0?s(`${T}m ${_}s`):s(`${_}s`)}v();const u=setInterval(v,1e3);return()=>clearInterval(u)},[e]),a?t?f.jsxs("div",{style:{background:"linear-gradient(135deg, #f39c12, #e74c3c)",borderRadius:8,padding:"8px 12px",display:"flex",alignItems:"center",gap:6,color:"#fff",fontSize:12,fontWeight:600,marginBottom:8},children:[f.jsx("span",{children:""}),f.jsx("span",{children:e.label}),f.jsx("span",{style:{opacity:.8,marginLeft:"auto",fontSize:11},children:n})]}):f.jsxs("div",{style:{background:"linear-gradient(135deg, #f39c1222, #e74c3c22)",border:"1px solid #f39c1255",borderRadius:12,padding:"14px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:20,animation:"multiplierGlow 2s ease-in-out infinite alternate"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[f.jsx("span",{style:{fontSize:28},children:""}),f.jsxs("div",{children:[f.jsxs("div",{style:{fontWeight:700,fontSize:15,color:"#f39c12"},"data-translatable":!0,children:[e.label," ",p(0,"Active!")]}),f.jsx("div",{style:{fontSize:12,color:"var(--text2, #aaa)"},"data-translatable":!0,children:p(1,"All XP earned is multiplied right now")})]})]}),f.jsxs("div",{style:{background:"#f39c1233",borderRadius:8,padding:"8px 14px",fontWeight:700,color:"#f39c12",fontSize:14,fontFamily:"monospace"},children:[" ",n]})]}):null}function DR({currentNickname:e,onSave:t}){const{user:n}=un(),[s,a]=M.useState(!1),[l,i]=M.useState(e||""),[p,g]=M.useState(!1);async function v(){const h=l.trim();g(!0);try{await At(Fe(be,"users",n.uid),{nickname:h||null},{merge:!0}),t&&t(h||null),a(!1)}catch(y){console.error("Failed to save nickname:",y)}g(!1)}function u(h){h.key==="Enter"&&v(),h.key==="Escape"&&(a(!1),i(e||""))}return s?f.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[f.jsx("input",{type:"text",value:l,onChange:h=>i(h.target.value),onKeyDown:u,placeholder:"Enter nickname...",maxLength:20,autoFocus:!0,style:{padding:"4px 10px",borderRadius:6,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontSize:13,fontFamily:"var(--font-body)",width:140}}),f.jsx("button",{onClick:v,disabled:p,style:{padding:"4px 10px",borderRadius:6,border:"none",background:"var(--amber)",color:"var(--bg)",fontSize:12,fontWeight:600,cursor:"pointer"},children:p?"...":"Save"}),f.jsx("button",{onClick:()=>{a(!1),i(e||"")},style:{padding:"4px 8px",borderRadius:6,border:"1px solid var(--border)",background:"transparent",color:"var(--text3)",fontSize:12,cursor:"pointer"},children:""})]}):f.jsx("button",{onClick:()=>a(!0),style:{background:"none",border:"none",cursor:"pointer",color:"var(--text3)",fontSize:12,padding:0,textDecoration:"underline",textDecorationStyle:"dotted"},children:e?` Nickname: ${e}`:" Set a nickname"})}const Ya=100,Bp=50,Z3=.1,uS=[{id:"drop-lowest",name:"Drop Lowest Quiz",description:"Drop the lowest quiz score for everyone",cost:40,icon:""},{id:"free-time",name:"5-Min Free Time",description:"Earn 5 minutes of free time in class",cost:20,icon:""},{id:"choose-topic",name:"Choose Next Topic",description:"The class votes on the next lesson topic",cost:35,icon:""},{id:"extension",name:"Assignment Extension",description:"Extend the next assignment deadline by 1 day",cost:30,icon:""}];function e8(){return{currentMP:0,powers:uS,history:[],votes:{},activeVote:null,lastDecay:null,enabled:!1}}async function Fr(e,t){if(!t)return e8();const n=Fe(be,"courses",e,"mana",t),s=await Mt(n);return s.exists()?s.data():e8()}async function xr(e,t,n){if(!t)return;const s=Fe(be,"courses",e,"mana",t);await At(s,{...n,lastUpdated:new Date})}async function t8(e,t,n,s,a="system"){const l=await Fr(e,t),i=Math.min(l.currentMP+n,Ya),p=i-l.currentMP;return l.currentMP=i,l.history=[{type:"gain",amount:p,reason:s,awardedBy:a,timestamp:new Date().toISOString()},...(l.history||[]).slice(0,49)],await xr(e,t,l),{newMP:i,actualGain:p}}async function NR(e,t,n){const s=await Fr(e,t),a=(s.powers||[]).find(l=>l.id===n);if(!a)throw new Error("Power not found");if(s.currentMP<a.cost)throw new Error("Not enough mana");return s.currentMP-=a.cost,s.history=[{type:"spend",amount:a.cost,reason:`Activated: ${a.name}`,powerId:n,timestamp:new Date().toISOString()},...(s.history||[]).slice(0,49)],s.votes={},s.activeVote=null,await xr(e,t,s),{newMP:s.currentMP,power:a}}async function ym(e,t,n,s){const a=await Fr(e,t),l=Math.max(a.currentMP-n,0),i=a.currentMP-l;return a.currentMP=l,a.history=[{type:"loss",amount:i,reason:s,timestamp:new Date().toISOString()},...(a.history||[]).slice(0,49)],await xr(e,t,a),{newMP:l,actualLoss:i}}async function LR(e,t){const n=await Fr(e,t),s=new Date;if(n.lastDecay&&(s-new Date(n.lastDecay))/864e5<6)return{decayed:!1};if(n.currentMP<=Bp)return n.lastDecay=s.toISOString(),await xr(e,t,n),{decayed:!1};const a=n.currentMP-Bp,l=Math.ceil(a*Z3);return n.currentMP-=l,n.history=[{type:"decay",amount:l,reason:`Weekly decay (${Z3*100}% of ${a} MP above ${Bp})`,timestamp:s.toISOString()},...(n.history||[]).slice(0,49)],n.lastDecay=s.toISOString(),await xr(e,t,n),{decayed:!0,decayAmount:l,newMP:n.currentMP}}async function PR(e,t,n){const s=await Fr(e,t);s.activeVote=n,s.votes={[n]:[]},await xr(e,t,s)}async function zR(e,t,n,s,a){const l=await Fr(e,t);if(l.activeVote!==n)throw new Error("No active vote for this power");const p=(l.votes?.[n]||[]).filter(g=>g.uid!==s);return p.push({uid:s,vote:a,timestamp:new Date().toISOString()}),l.votes={...l.votes,[n]:p},await xr(e,t,l),l.votes[n]}async function OR(e,t){const n=await Fr(e,t);n.activeVote=null,await xr(e,t,n)}async function VR(e,t,n){const s=await Fr(e,t),l={id:n.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")+"-"+Date.now().toString(36),...n};return s.powers=[...s.powers||[],l],await xr(e,t,s),l}async function BR(e,t,n){const s=await Fr(e,t);s.powers=(s.powers||[]).filter(a=>a.id!==n),s.activeVote===n&&(s.activeVote=null),await xr(e,t,s)}async function UR(e,t){if(!t)return null;const n=Fe(be,"courses",e,"mana",t);if((await Mt(n)).exists())return t;const a=Fe(be,"courses",e),l=await Mt(a);if(!l.exists())return t;const i=l.data().sections||{};if(i[t])return t;for(const[p,g]of Object.entries(i))if(g.name===t)return p;return t}function dS({courseId:e,sectionId:t,compact:n=!1}){const{user:s,userRole:a}=un(),[l,i]=M.useState(null),[p,g]=M.useState(!0),[v,u]=M.useState(!1),[h,y]=M.useState(t||null),[x,T]=M.useState(!1),_=on(["Class Mana","Class Mana Pool","Earn mana together, unlock class powers","Vote: Activate","Yes","No","Recent","How Mana Works","Earn Mana","Lose Mana","Good class behavior","Quiz scores above 80%","Perfect attendance day","Great class participation","Class disruption","Widespread off-task behavior","Mana above 50 MP decays 10% weekly","Spend mana to activate class powers!"]),E=(D,de)=>_?.[D]??de;M.useEffect(()=>{if(!e)return;async function D(){try{let de=t;if(!de&&s&&a!=="teacher"){const W=await kg(s.uid,e);de=W?.sectionId||W?.section||null}if(!de)return;const je=await UR(e,de);je&&y(je)}catch(de){console.error("Error resolving section:",de)}}D()},[e,s,t,a]),M.useEffect(()=>{if(!e||!h){g(!1);return}R()},[e,h]);async function R(){try{const D=await Fr(e,h);i(D)}catch(D){console.error("Error loading mana:",D)}g(!1)}async function P(D,de){if(!(!s||v||!h)){u(!0);try{await zR(e,h,D,s.uid,de),await R()}catch(je){console.error("Vote error:",je)}u(!1)}}if(p||!l||!l.enabled||!h)return null;const B=Math.min(l.currentMP/Ya*100,100),X=B<20,Q=B>70,K=X?"#8b5cf6":Q?"#06b6d4":"#a78bfa",k=X?"linear-gradient(90deg, #7c3aed, #8b5cf6)":Q?"linear-gradient(90deg, #8b5cf6, #06b6d4)":"linear-gradient(90deg, #8b5cf6, #a78bfa)",I=l.activeVote?(l.powers||[]).find(D=>D.id===l.activeVote):null,N=I?(l.votes?.[l.activeVote]||[]).find(D=>D.uid===s?.uid):null,U=I?(l.votes?.[l.activeVote]||[]).filter(D=>D.vote===!0).length:0,z=I?(l.votes?.[l.activeVote]||[]).filter(D=>D.vote===!1).length:0,q=U+z;return n?f.jsxs("div",{style:{background:"var(--surface)",border:"1px solid var(--border)",borderRadius:10,padding:"12px 14px"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6},children:[f.jsxs("span",{style:{fontSize:12,fontWeight:700,color:"var(--text3)",textTransform:"uppercase",letterSpacing:"0.08em"},"data-translatable":!0,children:[" ",E(0,"Class Mana")]}),f.jsxs("span",{style:{fontSize:13,fontWeight:700,color:K},children:[l.currentMP,"/",Ya]})]}),f.jsx("div",{style:{height:6,background:"var(--surface2)",borderRadius:3,overflow:"hidden"},children:f.jsx("div",{style:{width:`${B}%`,height:"100%",background:k,borderRadius:3,transition:"width 0.6s ease",boxShadow:`0 0 8px ${K}44`}})})]}):f.jsxs("div",{style:{background:"var(--surface)",border:`1px solid ${K}33`,borderRadius:14,padding:"20px 24px",marginBottom:20,boxShadow:`0 0 20px ${K}11`},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[f.jsx("span",{style:{fontSize:24},children:""}),f.jsxs("div",{children:[f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:18,fontWeight:700},"data-translatable":!0,children:E(1,"Class Mana Pool")}),f.jsx("div",{style:{fontSize:12,color:"var(--text3)"},"data-translatable":!0,children:E(2,"Earn mana together, unlock class powers")})]})]}),f.jsxs("div",{style:{fontFamily:"var(--font-display)",fontSize:28,fontWeight:700,color:K},children:[l.currentMP,f.jsxs("span",{style:{fontSize:14,color:"var(--text3)",fontWeight:400},children:["/",Ya," MP"]})]})]}),f.jsx("div",{style:{height:18,background:"var(--surface2)",borderRadius:10,overflow:"hidden",position:"relative",marginBottom:12,boxShadow:"inset 0 2px 4px rgba(0,0,0,0.3)"},children:f.jsx("div",{style:{width:`${B}%`,height:"100%",background:k,borderRadius:10,transition:"width 0.8s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:`0 0 16px ${K}55, inset 0 1px 2px rgba(255,255,255,0.2)`,position:"relative"},children:f.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.15) 50%, transparent 100%)",backgroundSize:"200% 100%",animation:"manaShimmer 3s linear infinite"}})})}),f.jsxs("button",{onClick:()=>T(!x),style:{background:"none",border:"none",cursor:"pointer",fontSize:12,color:"var(--text3)",fontWeight:600,padding:"2px 0",marginBottom:x?0:14,display:"flex",alignItems:"center",gap:4},children:[f.jsx("span",{style:{transition:"transform 0.2s",transform:x?"rotate(90deg)":"rotate(0deg)",display:"inline-block"},children:""}),f.jsx("span",{"data-translatable":!0,children:E(7,"How Mana Works")})]}),x&&f.jsxs("div",{style:{background:`${K}08`,border:`1px solid ${K}22`,borderRadius:10,padding:"14px 18px",marginTop:8,marginBottom:14,display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[f.jsxs("div",{children:[f.jsxs("div",{style:{fontSize:12,fontWeight:700,color:"var(--green)",marginBottom:8,display:"flex",alignItems:"center",gap:4},"data-translatable":!0,children:[" ",E(8,"Earn Mana")]}),[{icon:"",text:E(10,"Good class behavior"),amount:"+5"},{icon:"",text:E(11,"Quiz scores above 80%"),amount:"+5"},{icon:"",text:E(12,"Perfect attendance day"),amount:"+15"},{icon:"",text:E(13,"Great class participation"),amount:"+10"}].map((D,de)=>f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6,fontSize:12},children:[f.jsx("span",{children:D.icon}),f.jsx("span",{style:{flex:1,color:"var(--text2)"},"data-translatable":!0,children:D.text}),f.jsx("span",{style:{color:"var(--green)",fontWeight:700,fontFamily:"var(--font-display)",fontSize:11},children:D.amount})]},de))]}),f.jsxs("div",{children:[f.jsxs("div",{style:{fontSize:12,fontWeight:700,color:"var(--red)",marginBottom:8,display:"flex",alignItems:"center",gap:4},"data-translatable":!0,children:[" ",E(9,"Lose Mana")]}),[{icon:"",text:E(14,"Class disruption"),amount:"5"},{icon:"",text:E(15,"Widespread off-task behavior"),amount:"10"},{icon:"",text:E(16,"Mana above 50 MP decays 10% weekly"),amount:""}].map((D,de)=>f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6,fontSize:12},children:[f.jsx("span",{children:D.icon}),f.jsx("span",{style:{flex:1,color:"var(--text2)"},"data-translatable":!0,children:D.text}),D.amount&&f.jsx("span",{style:{color:"var(--red)",fontWeight:700,fontFamily:"var(--font-display)",fontSize:11},children:D.amount})]},de)),f.jsxs("div",{style:{marginTop:8,fontSize:11,color:"var(--text3)",fontStyle:"italic"},"data-translatable":!0,children:[" ",E(17,"Spend mana to activate class powers!")]})]})]}),I&&f.jsxs("div",{style:{background:`${K}11`,border:`1px solid ${K}33`,borderRadius:10,padding:"14px 18px",marginBottom:14},children:[f.jsxs("div",{style:{fontSize:14,fontWeight:700,marginBottom:8,display:"flex",alignItems:"center",gap:8},children:[f.jsx("span",{children:""}),f.jsxs("span",{"data-translatable":!0,children:[E(3,"Vote: Activate"),' "',I.name,'"?']}),f.jsxs("span",{style:{fontSize:12,color:"var(--text3)",fontWeight:400},children:["(",I.cost," MP)"]})]}),f.jsx("div",{style:{fontSize:13,color:"var(--text2)",marginBottom:12},children:I.description}),a!=="teacher"&&f.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10},children:[f.jsxs("button",{onClick:()=>P(I.id,!0),disabled:v,style:{flex:1,padding:"8px 16px",borderRadius:8,border:"none",background:N?.vote===!0?"var(--green)":"var(--surface2)",color:N?.vote===!0?"var(--bg)":"var(--text2)",fontWeight:600,fontSize:13,cursor:"pointer"},"data-translatable":!0,children:[" ",E(4,"Yes")," ",U>0&&`(${U})`]}),f.jsxs("button",{onClick:()=>P(I.id,!1),disabled:v,style:{flex:1,padding:"8px 16px",borderRadius:8,border:"none",background:N?.vote===!1?"var(--red)":"var(--surface2)",color:N?.vote===!1?"#fff":"var(--text2)",fontWeight:600,fontSize:13,cursor:"pointer"},"data-translatable":!0,children:[" ",E(5,"No")," ",z>0&&`(${z})`]})]}),q>0&&f.jsxs("div",{style:{height:6,background:"var(--surface2)",borderRadius:3,overflow:"hidden",display:"flex"},children:[f.jsx("div",{style:{width:`${U/q*100}%`,background:"var(--green)",transition:"width 0.3s"}}),f.jsx("div",{style:{width:`${z/q*100}%`,background:"var(--red)",transition:"width 0.3s"}})]})]}),f.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:(l.powers||[]).map(D=>{const de=l.currentMP>=D.cost;return f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 12px",borderRadius:8,background:de?`${K}11`:"var(--surface2)",border:`1px solid ${de?`${K}33`:"var(--border)"}`,opacity:de?1:.5,fontSize:12},children:[f.jsx("span",{children:D.icon||""}),f.jsx("span",{style:{fontWeight:600},children:D.name}),f.jsxs("span",{style:{color:"var(--text3)"},children:[D.cost," MP"]})]},D.id)})}),(l.history||[]).length>0&&f.jsxs("div",{style:{marginTop:14,paddingTop:12,borderTop:"1px solid var(--border)"},children:[f.jsx("div",{style:{fontSize:11,color:"var(--text3)",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:6},"data-translatable":!0,children:E(6,"Recent")}),(l.history||[]).slice(0,3).map((D,de)=>f.jsxs("div",{style:{fontSize:12,color:"var(--text2)",marginBottom:3,display:"flex",gap:6},children:[f.jsxs("span",{style:{color:D.type==="gain"?"var(--green)":D.type==="decay"?"var(--text3)":"var(--red)",fontWeight:600},children:[D.type==="gain"?"+":"",D.amount," MP"]}),f.jsx("span",{children:D.reason})]},de))]}),f.jsx("style",{children:`
        @keyframes manaShimmer {
          0% { background-position: -200% center; }
          100% { background-position: 200% center; }
        }
      `})]})}function qR({lessonMap:e,allCourses:t}){if(!e||Object.keys(e).length===0)return null;const n=new Date,s=n.toISOString().slice(0,10),a=new Date(n);a.setDate(a.getDate()+1);const l=a.toISOString().slice(0,10),i=[];for(const[p,g]of Object.entries(e)){if(!g.dueDate||g.visible===!1)continue;const v=g.dueDate,u=v<s,h=v===s,y=v===l;if(u||h||y){const x=t.find(T=>T.id===g.courseId);i.push({lessonId:p,title:g.title||"Untitled",courseId:g.courseId,courseName:x?.title||g.courseId,courseIcon:x?.icon||"",dueDate:v,isPastDue:u,isToday:h,isTomorrow:y,sortKey:u?0:h?1:2})}}return i.sort((p,g)=>p.sortKey-g.sortKey||p.dueDate.localeCompare(g.dueDate)),i.length===0?f.jsxs("div",{style:{flex:1,padding:"14px 18px",borderRadius:12,background:"var(--surface)",border:"1px solid var(--border)",display:"flex",alignItems:"center",gap:12,minHeight:80},children:[f.jsx("span",{style:{fontSize:24},children:""}),f.jsxs("div",{children:[f.jsx("div",{style:{fontWeight:700,fontSize:15,color:"var(--green)"},children:"All caught up!"}),f.jsx("div",{style:{fontSize:12,color:"var(--text3)"},children:"Nothing due today or tomorrow"})]})]}):f.jsxs("div",{style:{flex:1,padding:"14px 18px",borderRadius:12,background:"var(--surface)",border:"1px solid var(--border)",minHeight:80},children:[f.jsx("div",{style:{fontSize:12,fontWeight:700,color:"var(--text3)",marginBottom:10,textTransform:"uppercase",letterSpacing:"0.05em"},children:" Due Soon"}),f.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[i.slice(0,4).map(p=>f.jsx(Xt,{to:`/course/${p.courseId}/lesson/${p.lessonId}`,style:{textDecoration:"none",color:"inherit"},children:f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 12px",borderRadius:8,background:"var(--surface2)",cursor:"pointer",borderLeft:`3px solid ${p.isPastDue?"var(--red)":p.isToday?"var(--amber)":"var(--text3)"}`,transition:"background 0.15s"},children:[f.jsxs("div",{style:{flex:1,minWidth:0},children:[f.jsx("div",{style:{fontWeight:600,fontSize:13,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:p.title}),f.jsxs("div",{style:{fontSize:11,color:"var(--text3)"},children:[p.courseIcon," ",p.courseName]})]}),f.jsx("div",{style:{fontSize:11,fontWeight:700,whiteSpace:"nowrap",color:p.isPastDue?"var(--red)":p.isToday?"var(--amber)":"var(--text3)"},children:p.isPastDue?" Overdue":p.isToday?" Today":"Tomorrow"})]})},p.lessonId)),i.length>4&&f.jsxs("div",{style:{fontSize:11,color:"var(--text3)",textAlign:"center",paddingTop:4},children:["+",i.length-4," more"]})]})]})}function HR({user:e,onEnrolled:t,onClose:n}){const[s,a]=M.useState(""),[l,i]=M.useState(!1),[p,g]=M.useState(null),[v,u]=M.useState(null),h=on(["Join a Course","Enter the enroll code from your teacher","Cancel","Joining...","Join Course"]),y=(T,_)=>h?.[T]??_,x=async T=>{if(T.preventDefault(),!!s.trim()){i(!0),g(null),u(null);try{const _=await gM(e.uid,e.email,s.trim());u(`Enrolled in ${_.title}!`),setTimeout(()=>{t?.(_),n?.()},1200)}catch(_){g(_.message)}finally{i(!1)}}};return f.jsx("div",{style:ti.overlay,onClick:n,children:f.jsxs("div",{style:ti.modal,onClick:T=>T.stopPropagation(),children:[f.jsxs("div",{style:ti.header,children:[f.jsx("span",{style:{fontSize:28},children:""}),f.jsx("h2",{style:ti.title,"data-translatable":!0,children:y(0,"Join a Course")}),f.jsx("p",{style:ti.subtitle,"data-translatable":!0,children:y(1,"Enter the enroll code from your teacher")})]}),f.jsxs("form",{onSubmit:x,style:ti.form,children:[f.jsx("input",{type:"text",value:s,onChange:T=>{let _=T.target.value.toUpperCase().replace(/[^A-Z0-9-]/g,"");_.length===4&&!_.includes("-")&&s.length<4&&(_+="-"),_.length>9&&(_=_.slice(0,9)),a(_),g(null)},placeholder:"XXXX-XXXX",maxLength:9,style:ti.input,autoFocus:!0,disabled:l}),p&&f.jsxs("div",{style:ti.error,children:[f.jsx("span",{children:""})," ",p]}),v&&f.jsxs("div",{style:ti.success,children:[f.jsx("span",{children:""})," ",v]}),f.jsxs("div",{style:ti.buttons,children:[f.jsx("button",{type:"button",onClick:n,style:ti.cancelBtn,disabled:l,"data-translatable":!0,children:y(2,"Cancel")}),f.jsx("button",{type:"submit",disabled:l||s.replace("-","").length<8,className:"btn btn-primary",style:{opacity:l||s.replace("-","").length<8?.5:1},"data-translatable":!0,children:l?y(3,"Joining..."):y(4,"Join Course")})]})]})]})})}const ti={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},modal:{background:"var(--surface1)",border:"1px solid var(--border)",borderRadius:16,padding:32,width:"100%",maxWidth:420,boxShadow:"0 20px 60px rgba(0,0,0,0.4)"},header:{textAlign:"center",marginBottom:24},title:{fontFamily:"var(--font-display)",fontSize:22,fontWeight:700,marginTop:8,marginBottom:4},subtitle:{color:"var(--text3)",fontSize:14},form:{display:"flex",flexDirection:"column",gap:16},input:{width:"100%",padding:"14px 16px",fontSize:24,fontFamily:"var(--font-display)",fontWeight:700,letterSpacing:4,textAlign:"center",background:"var(--surface2)",border:"2px solid var(--border)",borderRadius:10,color:"var(--text1)",outline:"none",transition:"border-color 0.2s",boxSizing:"border-box"},error:{background:"rgba(231,76,60,0.1)",border:"1px solid rgba(231,76,60,0.3)",borderRadius:8,padding:"10px 14px",color:"#e74c3c",fontSize:13,display:"flex",alignItems:"center",gap:8},success:{background:"rgba(46,204,113,0.1)",border:"1px solid rgba(46,204,113,0.3)",borderRadius:8,padding:"10px 14px",color:"#2ecc71",fontSize:13,display:"flex",alignItems:"center",gap:8},buttons:{display:"flex",gap:12,justifyContent:"flex-end",marginTop:8},cancelBtn:{padding:"10px 20px",background:"var(--surface2)",border:"1px solid var(--border)",borderRadius:8,color:"var(--text2)",cursor:"pointer",fontSize:14}};function FR(){const{user:e,userRole:t,nickname:n,updateNickname:s}=un(),[a,l]=M.useState([]),[i,p]=M.useState(null),[g,v]=M.useState(!0),[u,h]=M.useState(null),[y,x]=M.useState(null),[T,_]=M.useState(!1),[E,R]=M.useState({}),[P,B]=M.useState(!1),[X,Q]=M.useState(!1),[K,k]=M.useState(null),[I,N]=M.useState({}),[U,z]=M.useState(null),q=t==="teacher",D=n||e?.displayName?.split(" ")[0]||"there",de=on(q?[]:["Badges","My Courses"," Join a Course","No courses yet","Get an enroll code from your teacher to get started.","Enter Enroll Code"," Enter enroll code to access this course"," Class Leaderboard","Progress","lessons","questions","accuracy","Rank","You","Level"]),je=(J,ve)=>de?.[J]??ve;M.useEffect(()=>{(async()=>{try{let ve;if(q){const H=Kt(it(be,"courses"),Ln("order","asc"));ve=(await ct(H)).docs.map(te=>({id:te.id,...te.data()})).filter(te=>!te.ownerUid||te.ownerUid===e.uid)}else{const H=Kt(it(be,"courses"),Ln("order","asc"));ve=(await ct(H)).docs.map(te=>({id:te.id,...te.data()}))}l(ve);let Se=null;if(!q&&e){try{Se=await vM(e.uid)}catch(H){console.warn("Failed to get enrolled courses:",H),Se=new Set}p(Se)}const Re={};for(const H of ve)if(!(!q&&Se&&!Se.has(H.id)))try{(await ct(Kt(it(be,"courses",H.id,"lessons"),Ln("order","asc")))).forEach(te=>{Re[te.id]={...te.data(),courseId:H.id}})}catch(Z){console.warn("Could not fetch lessons for",H.id,Z)}if(N(Re),!q&&e&&Se){const H=ve.filter(F=>Se.has(F.id)),Z=H[0]?.id,te=await ml(e.uid,Z);h(te);try{const F=await iS(e.uid);F?(x(F),_(!0)):(x(K3(te.totalXP||0)),_(!1))}catch{x(K3(0)),_(!1)}for(const F of H)try{const O=await _h(F.id);if(O.activeMultiplier&&(O.activeMultiplier.expiresAt?.toDate?.()?O.activeMultiplier.expiresAt.toDate():new Date(O.activeMultiplier.expiresAt))>new Date){z(O.activeMultiplier);break}}catch{}const fe={};for(const F of H){const xe=(await ct(Kt(it(be,"courses",F.id,"lessons"),Ln("order","asc")))).docs.map(re=>({id:re.id,...re.data()}));let Le=0,Oe=0,De=0;for(const re of xe){const Ie=(re.blocks||[]).filter(Ue=>Ue.type==="question");Le+=Ie.length;const Xe=Fe(be,"progress",e.uid,"courses",F.id,"lessons",re.id),se=await Mt(Xe);if(se.exists()){const Ue=se.data().answers||{};Ie.forEach($=>{Ue[$.id]?.submitted&&(Oe++,Ue[$.id]?.correct&&De++)})}}fe[F.id]={totalLessons:xe.length,totalQuestions:Le,answeredQuestions:Oe,correctQuestions:De,accuracy:Oe>0?Math.round(De/Oe*100):null,completion:Le>0?Math.round(Oe/Le*100):0}}R(fe)}q&&ve.length>0&&k(ve[0].id)}catch(ve){console.error("Error fetching dashboard data:",ve)}v(!1)})()},[e,q]);const W=J=>{p(ve=>new Set([...ve||[],J.id])),Q(!1),window.location.reload()};if(g)return f.jsx("div",{className:"page-container",style:{display:"flex",justifyContent:"center",paddingTop:120},children:f.jsx("div",{className:"spinner"})});if(!q){const J=u?ls(u.totalXP):null,ve=a.filter(Re=>i?.has(Re.id)),Se=a.filter(Re=>!i?.has(Re.id));return f.jsxs("div",{className:"page-container",style:{padding:"48px 40px"},children:[f.jsxs("div",{style:{maxWidth:960,margin:"0 auto"},children:[f.jsx(cS,{activeMultiplier:U}),y&&f.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:24},children:f.jsx(Xt,{to:"/avatar",style:{textDecoration:"none"},children:f.jsxs("div",{style:{position:"relative",background:"var(--surface1)",border:"2px solid var(--border)",borderRadius:20,padding:"16px 16px 10px",cursor:"pointer",transition:"border-color 0.2s, box-shadow 0.2s"},onMouseEnter:Re=>{Re.currentTarget.style.borderColor="var(--amber)",Re.currentTarget.style.boxShadow="0 0 16px rgba(243,156,18,0.15)"},onMouseLeave:Re=>{Re.currentTarget.style.borderColor="var(--border)",Re.currentTarget.style.boxShadow="none"},children:[f.jsx(oS,{avatar:y,level:J?.level||1,charSize:240,petSize:156,animate:!0}),f.jsx("div",{style:{textAlign:"center",marginTop:6,fontSize:12,fontWeight:700,color:T?"var(--text3)":"var(--amber)"},children:T?" Edit Character":" Customize Me!"})]})})}),f.jsxs("div",{style:{marginBottom:32},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[f.jsxs("div",{children:[f.jsxs("h1",{style:{fontFamily:"var(--font-display)",fontSize:28,fontWeight:700,marginBottom:4},children:["Hey ",D," "]}),f.jsx(DR,{nickname:n,onSave:s})]}),J&&f.jsxs("div",{style:{textAlign:"right"},children:[f.jsxs("div",{style:{fontFamily:"var(--font-display)",fontSize:14,fontWeight:700,color:"var(--amber)"},"data-translatable":!0,children:[je(14,"Level")," ",J.level,"  ",J.tierName]}),f.jsxs("div",{style:{fontSize:12,color:"var(--text3)"},children:[u.totalXP," XP"]})]})]}),J&&f.jsxs("div",{style:{marginBottom:12},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:"var(--text3)",marginBottom:3},children:[f.jsxs("span",{children:["Lv ",J.level]}),f.jsxs("span",{children:[J.xpIntoLevel,"/",J.xpForNext," XP"]}),f.jsxs("span",{children:["Lv ",J.level+1]})]}),f.jsx("div",{style:{height:8,background:"var(--surface2)",borderRadius:4},children:f.jsx("div",{style:{width:`${J.progress*100}%`,height:"100%",background:"linear-gradient(90deg, var(--amber), #f39c12)",borderRadius:4,transition:"width 0.5s"}})})]}),f.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"stretch"},children:[u&&f.jsx(lS,{streak:u.currentStreak}),f.jsx(qR,{lessonMap:I,allCourses:a})]})]}),u&&(u.badges||[]).length>0&&f.jsxs("div",{style:{marginBottom:32},children:[f.jsx("h2",{style:{fontFamily:"var(--font-display)",fontSize:20,fontWeight:600,color:"var(--text2)",marginBottom:14},"data-translatable":!0,children:je(0,"Badges")}),f.jsx(IR,{earnedBadgeIds:u.badges||[]})]}),f.jsxs("div",{style:{marginBottom:32},children:[ve.length>0&&f.jsx("div",{style:{marginBottom:20},children:ve.map(Re=>f.jsx(dS,{courseId:Re.id},Re.id))}),f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14},children:[f.jsx("h2",{style:{fontFamily:"var(--font-display)",fontSize:20,fontWeight:600,color:"var(--text2)"},"data-translatable":!0,children:je(1,"My Courses")}),f.jsx("button",{className:"btn btn-primary",style:{fontSize:13,padding:"8px 16px"},onClick:()=>Q(!0),"data-translatable":!0,children:je(2," Join a Course")})]}),ve.length===0&&Se.length===0?f.jsxs("div",{className:"card",style:{textAlign:"center",padding:60},children:[f.jsx("p",{style:{fontSize:40,marginBottom:12},children:""}),f.jsx("p",{style:{fontWeight:600},"data-translatable":!0,children:je(3,"No courses yet")}),f.jsx("p",{style:{color:"var(--text2)",fontSize:14,marginTop:8,marginBottom:16},"data-translatable":!0,children:je(4,"Get an enroll code from your teacher to get started.")}),f.jsx("button",{className:"btn btn-primary",onClick:()=>Q(!0),"data-translatable":!0,children:je(5,"Enter Enroll Code")})]}):f.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:16},children:[ve.map(Re=>{const H=E[Re.id]||{};return f.jsx(Xt,{to:`/course/${Re.id}`,style:{textDecoration:"none",color:"inherit"},children:f.jsxs("div",{className:"card fade-in",style:{cursor:"pointer"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:14},children:[f.jsx("div",{style:{fontSize:28,width:48,height:48,borderRadius:10,background:"var(--amber-dim)",display:"flex",alignItems:"center",justifyContent:"center"},children:Re.icon||""}),f.jsxs("div",{children:[f.jsx("div",{className:"card-title",style:{fontSize:16,marginBottom:2},children:Re.title}),f.jsxs("div",{className:"card-subtitle",children:[H.totalLessons||0," ",je(9,"lessons")]})]})]}),f.jsxs("div",{style:{marginBottom:10},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12,marginBottom:4},children:[f.jsx("span",{style:{color:"var(--text3)"},"data-translatable":!0,children:je(8,"Progress")}),f.jsxs("span",{style:{color:"var(--amber)",fontWeight:600},children:[H.completion||0,"%"]})]}),f.jsx("div",{style:{height:6,background:"var(--surface2)",borderRadius:3},children:f.jsx("div",{style:{width:`${H.completion||0}%`,height:"100%",background:"var(--amber)",borderRadius:3,transition:"width 0.3s"}})})]}),f.jsxs("div",{style:{display:"flex",gap:16,fontSize:12,color:"var(--text3)"},children:[f.jsxs("span",{children:[H.answeredQuestions||0,"/",H.totalQuestions||0," ",je(10,"questions")]}),H.accuracy!==null&&H.accuracy!==void 0&&f.jsxs("span",{style:{color:H.accuracy>=70?"var(--green)":"var(--red)"},children:[H.accuracy,"% ",je(11,"accuracy")]})]})]})},Re.id)}),Se.map(Re=>f.jsxs("div",{className:"card fade-in",style:{cursor:"pointer",opacity:.6,position:"relative"},onClick:()=>Q(!0),children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:14},children:[f.jsx("div",{style:{fontSize:28,width:48,height:48,borderRadius:10,background:"var(--surface2)",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),f.jsxs("div",{children:[f.jsx("div",{className:"card-title",style:{fontSize:16,marginBottom:2},children:Re.title}),f.jsx("div",{className:"card-subtitle",children:Re.description})]})]}),f.jsx("div",{style:{background:"rgba(243,156,18,0.1)",border:"1px solid rgba(243,156,18,0.2)",borderRadius:8,padding:"10px 14px",textAlign:"center",fontSize:13,color:"var(--amber)",fontWeight:600},"data-translatable":!0,children:je(6," Enter enroll code to access this course")})]},Re.id))]})]})]}),X&&f.jsx(HR,{user:e,onEnrolled:W,onClose:()=>Q(!1)})]})}return f.jsx("div",{className:"page-container",style:{padding:"48px 40px"},children:f.jsxs("div",{style:{maxWidth:1100,margin:"0 auto"},children:[f.jsxs("div",{style:{marginBottom:32},children:[f.jsxs("h1",{style:{fontFamily:"var(--font-display)",fontSize:32,fontWeight:700,marginBottom:6},children:["Hey ",D," "]}),f.jsx("p",{style:{color:"var(--text2)",fontSize:15},children:"Manage your courses, edit lessons, and review student progress."})]}),f.jsxs("div",{style:{display:"flex",gap:12,marginBottom:36,flexWrap:"wrap"},children:[f.jsx(Xt,{to:"/editor",className:"btn btn-primary",style:{textDecoration:"none"},children:" Lesson Editor"}),f.jsx(Xt,{to:"/progress",className:"btn btn-secondary",style:{textDecoration:"none"},children:" Student Progress"}),f.jsx(Xt,{to:"/grading",className:"btn btn-secondary",style:{textDecoration:"none"},children:" Grading Dashboard"}),f.jsx(Xt,{to:"/rosters",className:"btn btn-secondary",style:{textDecoration:"none"},children:" Roster"})]}),f.jsxs("div",{children:[f.jsx("h2",{style:{fontFamily:"var(--font-display)",fontSize:20,fontWeight:600,color:"var(--text2)",marginBottom:14},children:"Your Courses"}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:16},children:a.map(J=>f.jsxs("div",{className:"card fade-in",children:[f.jsxs(Xt,{to:`/course/${J.id}`,style:{textDecoration:"none",color:"inherit"},children:[f.jsx("div",{style:{fontSize:32,marginBottom:12,width:56,height:56,borderRadius:12,background:"var(--amber-dim)",display:"flex",alignItems:"center",justifyContent:"center"},children:J.icon||""}),f.jsx("div",{className:"card-title",children:J.title}),f.jsx("div",{className:"card-subtitle",children:J.description})]}),J.sections&&Object.keys(J.sections).length>0?f.jsxs("div",{style:{marginTop:12,padding:"10px 12px",background:"var(--surface2)",borderRadius:8,fontSize:12},children:[f.jsx("div",{style:{color:"var(--text3)",marginBottom:6,fontWeight:600},children:"Enroll Codes:"}),Object.entries(J.sections).map(([ve,Se])=>f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"3px 0"},children:[f.jsx("span",{style:{color:"var(--text2)"},children:Se.name}),f.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:700,fontSize:13,color:"var(--amber)",letterSpacing:1.5},children:Se.enrollCode})]},ve))]}):J.enrollCode?f.jsxs("div",{style:{marginTop:12,padding:"8px 12px",background:"var(--surface2)",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[f.jsx("span",{style:{fontSize:12,color:"var(--text3)"},children:"Enroll Code:"}),f.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:700,fontSize:15,color:"var(--amber)",letterSpacing:2},children:J.enrollCode})]}):null,f.jsxs("div",{style:{marginTop:12,paddingTop:12,borderTop:"1px solid var(--border)",display:"flex",gap:14},children:[f.jsx(Xt,{to:`/xp-controls/${J.id}`,style:{fontSize:13,color:"var(--amber)",textDecoration:"none",fontWeight:600},children:" XP Controls"}),f.jsx(Xt,{to:`/teams/${J.id}`,style:{fontSize:13,color:"var(--amber)",textDecoration:"none",fontWeight:600},children:" Teams"}),f.jsx(Xt,{to:`/mana/${J.id}`,style:{fontSize:13,color:"#8b5cf6",textDecoration:"none",fontWeight:600},children:" Mana"})]})]},J.id))})]})]})})}const Ni=[{id:"red",label:"Crimson",hex:"#e74c3c",dim:"#e74c3c22"},{id:"blue",label:"Sapphire",hex:"#3498db",dim:"#3498db22"},{id:"green",label:"Emerald",hex:"#2ecc71",dim:"#2ecc7122"},{id:"purple",label:"Amethyst",hex:"#9b59b6",dim:"#9b59b622"},{id:"orange",label:"Amber",hex:"#f39c12",dim:"#f39c1222"},{id:"cyan",label:"Aqua",hex:"#00cec9",dim:"#00cec922"},{id:"pink",label:"Rose",hex:"#fd79a8",dim:"#fd79a822"},{id:"yellow",label:"Gold",hex:"#fdcb6e",dim:"#fdcb6e22"}];async function Ig(e){try{const t=Fe(be,"courses",e,"settings","teamConfig"),n=await Mt(t);if(n.exists())return n.data()}catch(t){console.error("Error loading team config:",t)}return{enabled:!1,teamSize:4,draftMode:!1,xpSharePercent:25}}async function $R(e,t){const n=Fe(be,"courses",e,"settings","teamConfig");await At(n,{...t,lastUpdated:new Date},{merge:!0})}async function Au(e){return(await ct(it(be,"courses",e,"teams"))).docs.map(n=>({id:n.id,...n.data()}))}async function fS(e,t){const n=Fe(be,"courses",e,"teams",t),s=await Mt(n);return s.exists()?{id:s.id,...s.data()}:null}async function hS(e,{name:t,color:n,members:s=[],section:a=""}){const l=t.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")+"-"+Date.now().toString(36),i=Fe(be,"courses",e,"teams",l),p={name:t,color:n||Ni[0].id,members:s,section:a,teamXP:0,createdAt:new Date};return await At(i,p),{id:l,...p}}async function pS(e,t,n){const s=Fe(be,"courses",e,"teams",t);await Eu(s,{...n,lastUpdated:new Date})}async function n8(e,t){const n=Fe(be,"courses",e,"teams",t);await jg(n)}async function mS(e,t,n){const s=Fe(be,"courses",e,"teams",t);await Eu(s,{members:Vj(n)})}async function bm(e,t,n){const s=await fS(e,t);if(!s)return;const a=s.members.filter(l=>l.uid!==n);await Eu(Fe(be,"courses",e,"teams",t),{members:a})}async function Dg(e,t){return(await Au(e)).find(s=>s.members.some(a=>a.uid===t))||null}async function WR(e){return(await Au(e)).map(n=>({id:n.id,name:n.name,color:n.color,teamXP:n.teamXP||0,memberCount:n.members.length,members:n.members})).sort((n,s)=>s.teamXP-n.teamXP)}async function GR(e,t,n=4,s=null,a=""){const l=[...t].sort(()=>Math.random()-.5),i=Math.ceil(l.length/n),p=["Alpha","Bravo","Charlie","Delta","Echo","Foxtrot","Golf","Hotel","India","Juliet"],g=[];for(let v=0;v<i;v++){const u=l.slice(v*n,(v+1)*n),h=s?.[v]||p[v]||`Team ${v+1}`,y=Ni[v%Ni.length].id,x=await hS(e,{name:h,color:y,members:u,section:a});g.push(x)}return g}async function QR(e,t,n){const s=await Ig(e);if(!s.draftMode)throw new Error("Draft mode is not enabled");const a=await fS(e,t);if(!a)throw new Error("Team not found");if(a.members.length>=s.teamSize)throw new Error("Team is full  ask your teacher to add you");if(await Dg(e,n.uid))throw new Error("Already on a team");await mS(e,t,n)}async function XR(e,t){const n=await Dg(e,t);if(!n)throw new Error("Not on a team");await bm(e,n.id,t)}function YR({courseId:e,compact:t=!1}){const{user:n,userRole:s}=un(),a=s==="teacher",[l,i]=M.useState(null),[p,g]=M.useState([]),[v,u]=M.useState(null),[h,y]=M.useState([]),[x,T]=M.useState(!0),[_,E]=M.useState(!1),[R,P]=M.useState(null),[B,X]=M.useState(!1),[Q,K]=M.useState(""),k=on(["Join a Team","Pick a team to join! Teams earn bonus XP together.","members","Team XP","Teammates","You","Team Rankings","Your team","Leave team","Leave your team?","Click to rename your team"]),I=(W,J)=>k?.[W]??J;M.useEffect(()=>{!n||!e||N()},[n,e]);async function N(){T(!0);try{const W=await Ig(e);if(u(W),!W.enabled){T(!1);return}const J=await Dg(e,n.uid),ve=await WR(e),Se=await ct(it(be,"users")),Re={};Se.forEach(Z=>{const te=Z.data();te.nickname&&(Re[Z.id]=te.nickname)});const H=Z=>Z.map(te=>({...te,nickname:Re[te.uid]||null}));if(J&&(J.members=H(J.members)),ve.forEach(Z=>{Z.members=H(Z.members)}),i(J),g(ve),W.draftMode&&!J){const Z=await Au(e);y(Z)}}catch(W){console.error("Error loading team:",W)}T(!1)}async function U(W){E(!0),P(null);try{await QR(e,W,{uid:n.uid,displayName:n.displayName||n.email,email:n.email||"",photoURL:n.photoURL||""}),await N()}catch(J){P(J.message)}E(!1)}async function z(){if(confirm(I(9,"Leave your team?")))try{await XR(e,n.uid),await N()}catch(W){P(W.message)}}async function q(){const W=Q.trim();if(!(!W||!l))try{await pS(e,l.id,{name:W}),X(!1),await N()}catch(J){console.error("Rename failed:",J)}}function D(W){return Ni.find(J=>J.id===W)||Ni[0]}if(x||!v?.enabled)return null;if(!l&&v.draftMode)return f.jsxs("div",{style:{background:"var(--surface, #1e1e2e)",borderRadius:12,padding:"20px",border:"1px solid var(--border, #2a2a3a)",marginBottom:20},children:[f.jsxs("div",{style:{fontSize:16,fontWeight:700,marginBottom:8},"data-translatable":!0,children:[" ",I(0,"Join a Team")]}),f.jsx("p",{style:{fontSize:13,color:"var(--text2)",marginBottom:14},"data-translatable":!0,children:I(1,"Pick a team to join! Teams earn bonus XP together.")}),R&&f.jsx("div",{style:{fontSize:12,color:"#e74c3c",marginBottom:8},children:R}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))",gap:10},children:h.map(W=>{const J=D(W.color),ve=W.members.length>=v.teamSize;return f.jsxs("button",{onClick:()=>!ve&&U(W.id),disabled:ve||_,style:{padding:"14px 12px",borderRadius:10,cursor:ve?"not-allowed":"pointer",background:J.dim,border:`2px solid ${J.hex}44`,color:"var(--text1)",textAlign:"center",opacity:ve?.5:1,transition:"all 0.2s"},children:[f.jsx("div",{style:{fontWeight:700,fontSize:14,marginBottom:4},children:W.name}),f.jsxs("div",{style:{fontSize:11,color:"var(--text2)"},children:[W.members.length,"/",v.teamSize," ",I(2,"members")]})]},W.id)})})]});if(!l)return null;const de=D(l.color),je=p.findIndex(W=>W.id===l.id)+1;return t?f.jsxs("div",{style:{background:de.dim,borderRadius:10,padding:"12px 14px",border:`1px solid ${de.hex}44`,marginBottom:12},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[f.jsx("div",{style:{width:10,height:10,borderRadius:3,background:de.hex}}),f.jsx("span",{style:{fontWeight:700,fontSize:13},children:l.name}),je>0&&f.jsxs("span",{style:{fontSize:11,color:"var(--text2)",marginLeft:"auto"},children:["#",je]})]}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[f.jsxs("span",{style:{fontSize:12,color:de.hex,fontWeight:600},children:[l.teamXP||0," ",I(3,"Team XP")]}),f.jsxs("span",{style:{fontSize:11,color:"var(--text3)"},children:[" ",l.members.length," ",I(2,"members")]})]})]}):f.jsxs("div",{style:{background:"var(--surface, #1e1e2e)",borderRadius:12,padding:"20px",border:`1px solid ${de.hex}44`,borderTop:`3px solid ${de.hex}`,marginBottom:20},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1,minWidth:0},children:[f.jsx("div",{style:{width:14,height:14,borderRadius:4,background:de.hex,flexShrink:0}}),B?f.jsx("input",{type:"text",value:Q,autoFocus:!0,maxLength:30,onChange:W=>K(W.target.value),onKeyDown:W=>{W.key==="Enter"&&q(),W.key==="Escape"&&X(!1)},onBlur:()=>q(),style:{fontWeight:700,fontSize:18,fontFamily:"var(--font-display)",padding:"2px 8px",borderRadius:6,border:`1px solid ${de.hex}`,background:"var(--surface2, #252535)",color:"var(--text1)",width:180}}):f.jsxs("span",{onClick:()=>{X(!0),K(l.name)},style:{fontWeight:700,fontSize:18,fontFamily:"var(--font-display)",cursor:"text"},title:I(10,"Click to rename your team"),children:[l.name," ",f.jsx("span",{style:{fontSize:12,color:"var(--text3)",fontWeight:400},children:""})]}),je>0&&f.jsxs("span",{style:{background:je<=3?de.hex:"var(--surface2)",color:je<=3?"#fff":"var(--text2)",padding:"2px 8px",borderRadius:10,fontSize:11,fontWeight:700},children:["#",je]})]}),f.jsxs("div",{style:{fontSize:18,fontWeight:700,color:de.hex,fontFamily:"var(--font-display)"},children:[l.teamXP||0," ",f.jsx("span",{style:{fontSize:12,fontWeight:400},"data-translatable":!0,children:I(3,"Team XP")})]})]}),f.jsxs("div",{style:{marginBottom:16},children:[f.jsx("div",{style:{fontSize:12,fontWeight:600,color:"var(--text3)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:8},"data-translatable":!0,children:I(4,"Teammates")}),f.jsx("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:l.members.map(W=>{const J=W.uid===n?.uid;return f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 12px",background:J?de.dim:"var(--surface2, #252535)",border:J?`1px solid ${de.hex}44`:"1px solid var(--border, #2a2a3a)",borderRadius:10},children:[W.photoURL?f.jsx("img",{src:W.photoURL,style:{width:28,height:28,borderRadius:"50%",border:J?`2px solid ${de.hex}`:"2px solid var(--border)"},alt:"",referrerPolicy:"no-referrer"}):f.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:"var(--border)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12},children:""}),f.jsx("div",{children:f.jsxs("div",{style:{fontSize:13,fontWeight:J?700:500},children:[Ff({displayName:W.displayName,nickname:W.nickname,isTeacherViewing:a}),J&&f.jsx("span",{style:{color:de.hex,fontSize:11,marginLeft:4},"data-translatable":!0,children:I(5,"You")})]})})]},W.uid)})})]}),p.length>1&&f.jsxs("div",{children:[f.jsx("div",{style:{fontSize:12,fontWeight:600,color:"var(--text3)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:8},"data-translatable":!0,children:I(6,"Team Rankings")}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:p.map((W,J)=>{const ve=D(W.color),Se=W.id===l.id;return f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 12px",borderRadius:8,background:Se?ve.dim:"transparent",border:Se?`1px solid ${ve.hex}33`:"1px solid transparent"},children:[f.jsx("span",{style:{width:22,height:22,borderRadius:"50%",fontSize:11,fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center",background:J<3?ve.hex:"var(--surface2)",color:J<3?"#fff":"var(--text3)"},children:J+1}),f.jsx("div",{style:{width:10,height:10,borderRadius:3,background:ve.hex}}),f.jsxs("span",{style:{flex:1,fontSize:13,fontWeight:Se?700:400},children:[W.name,Se&&f.jsx("span",{style:{color:ve.hex,fontSize:11,marginLeft:4},"data-translatable":!0,children:I(7,"Your team")})]}),f.jsxs("span",{style:{fontSize:12,color:"var(--text2)"},children:[W.memberCount," ",I(2,"members")]}),f.jsxs("span",{style:{fontSize:13,fontWeight:600,color:ve.hex},children:[W.teamXP," XP"]})]},W.id)})})]}),v.draftMode&&f.jsx("div",{style:{marginTop:12,textAlign:"center"},children:f.jsx("button",{onClick:z,style:{fontSize:11,color:"var(--text3)",background:"none",border:"none",cursor:"pointer",textDecoration:"underline"},"data-translatable":!0,children:I(8,"Leave team")})})]})}function KR(){const{courseId:e}=_l(),{user:t,userRole:n}=un(),[s,a]=M.useState(null),[l,i]=M.useState([]),[p,g]=M.useState(!0),[v,u]=M.useState([]),[h,y]=M.useState(null),[x,T]=M.useState(null),[_,E]=M.useState({}),R=n==="teacher",P=on(["Course not found"," Back to Dashboard","No lessons yet","Your teacher is still building this course.","questions"]),B=(I,N)=>P?.[I]??N,X=An(s?.title),Q=An(s?.description),K=l.flatMap(I=>[I.title,I.unit||""]),k=on(K);return M.useEffect(()=>{(async()=>{try{const N=await Mt(Fe(be,"courses",e));N.exists()&&a({id:N.id,...N.data()});try{const z=(await ct(Kt(it(be,"courses",e,"lessons"),Ln("order","asc")))).docs.map(q=>({id:q.id,...q.data()}));z.sort((q,D)=>(q.order||0)-(D.order||0)),i(z)}catch(U){console.warn("Could not fetch lessons:",U)}if(n!=="teacher"&&t)try{const U=await kg(t.uid,e,t.email),z=U?.section||null;y(z);let q=U?.sectionId||null;if(!q&&z&&N.exists()){const de=N.data().sections||{};for(const[je,W]of Object.entries(de))if(W.name===z){q=je;break}}T(q||z||null);const D=await hM(e,z);u(D)}catch(U){console.warn("Could not load leaderboard:",U)}}catch(N){console.error("Error fetching course:",N)}g(!1)})()},[e,t,n]),p?f.jsx("div",{className:"page-container",style:{display:"flex",justifyContent:"center",paddingTop:120},children:f.jsx("div",{className:"spinner"})}):s?f.jsx("div",{className:"page-container",style:{padding:"48px 40px"},children:f.jsxs("div",{style:{maxWidth:R?700:1060,margin:"0 auto"},children:[f.jsx(Xt,{to:"/",style:{fontSize:13,color:"var(--text3)",marginBottom:16,display:"block"},"data-translatable":!0,children:B(1," Back to Dashboard")}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:24},children:[f.jsx("div",{style:{fontSize:40,width:64,height:64,borderRadius:14,background:"var(--amber-dim)",display:"flex",alignItems:"center",justifyContent:"center"},children:s.icon||""}),f.jsxs("div",{children:[f.jsx("h1",{style:{fontFamily:"var(--font-display)",fontSize:28,fontWeight:700},"data-translatable":!0,children:X}),f.jsx("p",{style:{color:"var(--text2)",fontSize:14},"data-translatable":!0,children:Q})]})]}),R&&f.jsxs("div",{style:{display:"flex",gap:10,marginBottom:20,flexWrap:"wrap"},children:[f.jsx(Xt,{to:`/xp-controls/${e}`,style:{fontSize:13,color:"var(--amber)",textDecoration:"none",fontWeight:600,padding:"6px 12px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)"},children:" XP Controls"}),f.jsx(Xt,{to:`/teams/${e}`,style:{fontSize:13,color:"var(--amber)",textDecoration:"none",fontWeight:600,padding:"6px 12px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)"},children:" Manage Teams"}),f.jsx(Xt,{to:`/mana/${e}`,style:{fontSize:13,color:"#8b5cf6",textDecoration:"none",fontWeight:600,padding:"6px 12px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)"},children:" Mana Pool"}),f.jsx(Xt,{to:`/boss-battle/${e}`,style:{fontSize:13,color:"#e74c3c",textDecoration:"none",fontWeight:600,padding:"6px 12px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)"},children:" Boss Battle"})]}),f.jsx(YR,{courseId:e}),f.jsx(dS,{courseId:e,sectionId:x}),f.jsxs("div",{style:{display:R?"block":"grid",gridTemplateColumns:R?void 0:"1fr 280px",gap:R?void 0:24,alignItems:"start"},children:[f.jsx("div",{children:l.length===0?f.jsxs("div",{className:"card",style:{textAlign:"center",padding:60},children:[f.jsx("p",{"data-translatable":!0,children:B(2,"No lessons yet")}),f.jsx("p",{style:{color:"var(--text2)",fontSize:14,marginTop:8},"data-translatable":!0,children:B(3,"Your teacher is still building this course.")})]}):f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:(()=>{const I=l.filter(D=>R||D.visible!==!1),N=[];let U=null,z=null,q=0;for(const D of I){const de=D.unit||"";de!==U&&(U=de,z={unit:de,lessons:[]},N.push(z)),q++,z.lessons.push({lesson:D,num:q})}return N.map(D=>{const de=D.unit.trim()!=="",je=de&&_[D.unit];return f.jsxs("div",{children:[de&&f.jsxs("button",{onClick:()=>E(W=>({...W,[D.unit]:!W[D.unit]})),className:"card",style:{display:"flex",alignItems:"center",gap:14,width:"100%",padding:"16px 20px",marginBottom:8,marginTop:N.indexOf(D)>0?20:0,cursor:"pointer",transition:"all 0.15s",borderLeft:"4px solid var(--amber)",textAlign:"left",color:"inherit"},children:[f.jsx("span",{style:{transition:"transform 0.2s",transform:je?"rotate(-90deg)":"rotate(0deg)",display:"inline-block",fontSize:14,color:"var(--amber)"},children:""}),f.jsxs("div",{style:{flex:1},children:[f.jsx("div",{style:{fontFamily:"var(--font-display)",fontWeight:700,fontSize:18,color:"var(--text1, #e8e8e8)"},children:D.unit}),f.jsxs("div",{style:{fontSize:12,color:"var(--text3)",marginTop:2},children:[D.lessons.length," ",D.lessons.length===1?"lesson":"lessons"]})]})]}),!je&&D.lessons.map(({lesson:W,num:J},ve)=>{const Se=l.indexOf(W),Re=k?.[Se*2]??W.title;k?.[Se*2+1];const H=(W.blocks||[]).filter(Z=>Z.type==="question").length;return f.jsx(Xt,{to:`/course/${e}/lesson/${W.id}`,style:{textDecoration:"none",color:"inherit"},children:f.jsxs("div",{className:"card fade-in",style:{display:"flex",alignItems:"center",gap:16,cursor:"pointer",animationDelay:`${ve*.05}s`,marginLeft:de?12:0},children:[f.jsx("div",{style:{width:36,height:36,borderRadius:8,background:"var(--surface2)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"var(--font-display)",fontWeight:700,fontSize:14,color:"var(--amber)"},children:J}),f.jsx("div",{children:f.jsx("div",{style:{fontWeight:600,fontSize:15},"data-translatable":!0,children:Re})}),f.jsxs("div",{style:{marginLeft:"auto",textAlign:"right",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:2},children:[f.jsxs("div",{style:{color:"var(--text3)",fontSize:13},children:[H," ",B(4,"questions")]}),W.dueDate&&(()=>{const Z=new Date(W.dueDate+"T23:59:59"),te=new Date,fe=Z<te,F=W.dueDate===te.toISOString().slice(0,10),O=!fe&&!F&&Z-te<2880*60*1e3;return f.jsxs("div",{style:{fontSize:11,fontWeight:600,color:fe?"var(--red)":F||O?"var(--amber)":"var(--text3)"},children:[fe?" ":F?" ":"","Due ",new Date(W.dueDate+"T00:00:00").toLocaleDateString(void 0,{month:"short",day:"numeric"})]})})()]})]})},W.id)})]},D.unit||"__no_unit__")})})()})}),!R&&f.jsxs("div",{style:{position:"sticky",top:80},children:[v.length>0&&(()=>{const I=v.findIndex(N=>N.uid===t?.uid)+1;return I>0?f.jsxs("div",{className:"card",style:{padding:"12px 16px",marginBottom:12,textAlign:"center"},children:[f.jsx("div",{style:{fontSize:11,color:"var(--text3)",fontWeight:600,marginBottom:4},children:"Your Rank"}),f.jsxs("div",{style:{fontFamily:"var(--font-display)",fontWeight:700,fontSize:28,color:"var(--amber)"},children:["#",I]}),f.jsxs("div",{style:{fontSize:11,color:"var(--text3)"},children:["of ",v.length," in ",h||"class"]})]}):null})(),f.jsxs("h3",{style:{fontFamily:"var(--font-display)",fontSize:15,fontWeight:600,color:"var(--text2)",marginBottom:10},children:[" ",h?`${h} Leaderboard`:"Class Leaderboard"]}),v.length>0?f.jsx("div",{className:"card",style:{padding:0,overflow:"hidden"},children:v.slice(0,10).map((I,N)=>{const U=I.uid===t?.uid;return f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",background:U?"var(--amber-dim)":"transparent",borderBottom:N<Math.min(v.length,10)-1?"1px solid var(--border)":"none"},children:[f.jsx("div",{style:{width:22,height:22,borderRadius:"50%",background:N<3?["var(--amber)","var(--text2)","#cd7f32"][N]:"var(--surface2)",color:N<3?"var(--bg)":"var(--text3)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:10,flexShrink:0},children:N+1}),I.photoURL?f.jsx("img",{src:I.photoURL,alt:"",style:{width:26,height:26,borderRadius:"50%",border:U?"2px solid var(--amber)":"2px solid var(--border)",flexShrink:0}}):f.jsx("div",{style:{width:26,height:26,borderRadius:"50%",background:"var(--surface2)",border:"2px solid var(--border)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"var(--text3)",flexShrink:0},children:""}),f.jsx("div",{style:{flex:1,minWidth:0},children:f.jsxs("div",{style:{fontWeight:U?700:500,fontSize:12,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[Ff({displayName:I.displayName,nickname:I.nickname,isTeacherViewing:!1}),U&&f.jsx("span",{style:{color:"var(--amber)",fontSize:10,marginLeft:4},children:"You"})]})}),f.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:700,fontSize:11,color:"var(--amber)",flexShrink:0},children:I.totalXP||0})]},I.uid)})}):f.jsx("div",{className:"card",style:{textAlign:"center",padding:24,color:"var(--text3)",fontSize:12},children:"Complete lessons to earn XP and climb the leaderboard! "})]})]})]})}):f.jsx("div",{className:"page-container",style:{textAlign:"center",paddingTop:120},children:f.jsx("h2",{"data-translatable":!0,children:B(0,"Course not found")})})}function ro(e){return e?e.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/\n/g,"<br/>"):""}function bf(){return Math.random().toString(36).slice(2,9)}function JR({block:e}){const t=An(e.content);return f.jsx("div",{className:"text-block","data-translatable":!0,dangerouslySetInnerHTML:{__html:ro(t)}})}function ZR(e){if(!e)return null;const t=e.trim();if(t.includes("/embed/"))return t;const n=t.match(/youtube\.com\/shorts\/([a-zA-Z0-9_-]+)/);if(n)return`https://www.youtube.com/embed/${n[1]}`;const s=t.match(/youtu\.be\/([a-zA-Z0-9_-]+)/);if(s)return`https://www.youtube.com/embed/${s[1]}`;const a=t.match(/youtube\.com\/watch\?.*v=([a-zA-Z0-9_-]+)/);return a?`https://www.youtube.com/embed/${a[1]}`:/^[a-zA-Z0-9_-]{11}$/.test(t)?`https://www.youtube.com/embed/${t}`:t}function ek({block:e}){const t=An(e.caption),n=ZR(e.url);return n?f.jsxs("div",{style:{margin:"24px 0"},children:[f.jsx("div",{style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",borderRadius:"var(--radius, 12px)",border:"1px solid var(--border, #2a2f3d)"},children:f.jsx("iframe",{src:n,title:t||"Video",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"},allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),t&&f.jsx("p",{style:{fontSize:13,color:"var(--text3, #888)",marginTop:8,fontStyle:"italic"},children:t})]}):null}function tk({block:e,studentData:t,onAnswer:n,courseId:s,lessonCompleted:a}){const{user:l}=un(),i=t[e.id]||{},[p,g]=M.useState(i.answer??null),[v,u]=M.useState(i.answer??""),[h,y]=M.useState(i.submitted||!1),[x,T]=M.useState(null),[_,E]=M.useState(null),R=An(e.prompt),P=on(e.options||[]),B=An(e.explanation),X=on(["Question","Written Response","Submit Answer","Submit Response","Type your answer here...","Explanation:","Submitted  awaiting teacher review"]),Q=z=>X?.[z];M.useEffect(()=>{s&&_h(s).then(E).catch(()=>E(null))},[s]);const K=z=>_?.xpValues?.[z]??au[z]??0,k=z=>{T(z),setTimeout(()=>T(null),1500)},I=async()=>{if(p===null)return;const z=p===e.correctIndex;if(n(e.id,{answer:p,correct:z,submitted:!0,submittedAt:new Date().toISOString()}),y(!0),l){const q=K(z?"mc_correct":"mc_incorrect"),D=await ml(l.uid),de=await mm(l.uid,q,z?"mc_correct":"mc_incorrect",s);await X3(l.uid,{totalAnswered:(D.totalAnswered||0)+1,totalCorrect:(D.totalCorrect||0)+(z?1:0)});const je=de?.gamification?.totalXP?de.gamification.totalXP-(D.totalXP||0):q;k(je)}},N=async()=>{if(v.trim()&&(n(e.id,{answer:v,submitted:!0,needsGrading:!0,submittedAt:new Date().toISOString()}),y(!0),l)){const z=K("short_answer"),q=await ml(l.uid),D=await mm(l.uid,z,"short_answer",s);await X3(l.uid,{totalAnswered:(q.totalAnswered||0)+1});const de=D?.gamification?.totalXP?D.gamification.totalXP-(q.totalXP||0):z;k(de)}},U={position:"absolute",top:-8,right:-8,background:"var(--amber)",color:"var(--bg)",fontFamily:"var(--font-display)",fontWeight:700,fontSize:13,padding:"4px 10px",borderRadius:12,animation:"xpFloat 1.5s ease-out forwards",pointerEvents:"none",zIndex:10};if(e.questionType==="multiple_choice"){const z=h&&p===e.correctIndex;return f.jsxs("div",{className:`question-block ${h?z?"correct":"incorrect":""}`,style:{position:"relative"},children:[x&&f.jsxs("div",{style:U,children:["+",x," XP"]}),f.jsx("div",{className:"question-badge","data-translatable":!0,children:Q(0)||"Question"}),f.jsx("p",{className:"question-prompt","data-translatable":!0,children:R}),f.jsx("div",{className:"mc-options",children:(P||e.options).map((q,D)=>{let de="mc-option";return h&&D===e.correctIndex&&(de+=" correct-answer"),h&&D===p&&D!==e.correctIndex&&(de+=" wrong-answer"),!h&&D===p&&(de+=" selected"),f.jsxs("button",{className:de,onClick:()=>!h&&g(D),disabled:h,children:[f.jsx("span",{className:"option-letter",children:String.fromCharCode(65+D)}),f.jsx("span",{className:"option-text",children:q}),h&&D===e.correctIndex&&f.jsx("span",{className:"check-icon",children:""}),h&&D===p&&D!==e.correctIndex&&f.jsx("span",{className:"x-icon",children:""})]},D)})}),!h&&f.jsx("button",{className:"btn btn-primary",onClick:I,disabled:p===null,"data-translatable":!0,children:Q(2)||"Submit Answer"}),h&&e.explanation&&f.jsxs("div",{className:"explanation","data-translatable":!0,children:[f.jsx("strong",{children:Q(5)||"Explanation:"})," ",B]})]})}if(e.questionType==="short_answer"){const z=h&&a;return f.jsxs("div",{className:`question-block ${h?"submitted-sa":""}`,style:{position:"relative"},children:[x&&f.jsxs("div",{style:U,children:["+",x," XP"]}),f.jsx("div",{className:"question-badge sa","data-translatable":!0,children:Q(1)||"Written Response"}),f.jsx("p",{className:"question-prompt","data-translatable":!0,children:R}),h?f.jsxs("div",{className:"sa-submitted",children:[f.jsx("div",{className:"sa-answer-display",children:v}),f.jsxs("div",{className:"sa-status","data-translatable":!0,children:[" ",Q(6)||"Submitted  awaiting teacher review"]}),!z&&f.jsx("button",{className:"btn",onClick:()=>{y(!1),n(e.id,{answer:v,submitted:!1})},style:{marginTop:8,fontSize:13,color:"var(--text3)",background:"var(--surface2)",border:"1px solid var(--border)"},children:" Edit Response"})]}):f.jsxs(f.Fragment,{children:[f.jsx("textarea",{className:"sa-input",rows:4,placeholder:Q(4)||"Type your answer here...",value:v,onChange:q=>u(q.target.value)}),f.jsx("button",{className:"btn btn-primary",onClick:N,disabled:!v.trim(),"data-translatable":!0,children:Q(3)||"Submit Response"})]})]})}return null}const nk="https://us-central1-pantherlearn-d6f7c.cloudfunctions.net/geminiChat";async function gS({authToken:e,courseId:t,lessonId:n,blockId:s,systemPrompt:a,messages:l}){const i=await fetch(nk,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({courseId:t,lessonId:n,blockId:s,systemPrompt:a,messages:l})}),p=await i.json();if(!i.ok)throw new Error(p.error||"Request failed");return p.response}const rk=Object.freeze(Object.defineProperty({__proto__:null,sendChatMessage:gS},Symbol.toStringTag,{value:"Module"})),vS=M.createContext(null),Xf={new:{label:"New Student",description:"No progress  first time opening the lesson",icon:"",studentData:{},chatLogs:{},totalXP:0,level:1,lessonsCompleted:0},midway:{label:"Mid-Lesson",description:"Some questions answered, partial progress",icon:"",studentData:null,chatLogs:null,totalXP:350,level:4,lessonsCompleted:3},complete:{label:"Completed",description:"All questions answered, all chats used",icon:"",studentData:null,chatLogs:null,totalXP:1200,level:8,lessonsCompleted:7}};function ik({children:e}){const[t,n]=M.useState(!1),[s,a]=M.useState("new"),[l,i]=M.useState(null),p=M.useCallback((h="new",y=null)=>{a(h),i(y),n(!0)},[]),g=M.useCallback(()=>{n(!1),a("new"),i(null)},[]),v=M.useCallback(h=>{a(h)},[]),u={isPreview:t,scenario:s,scenarioConfig:Xf[s],scenarios:Xf,sourceLocation:l,enterPreview:p,exitPreview:g,switchScenario:v};return f.jsx(vS.Provider,{value:u,children:e})}const ju=()=>{const e=M.useContext(vS);return e||{isPreview:!1,scenario:"new",scenarioConfig:Xf.new,scenarios:Xf,sourceLocation:null,enterPreview:()=>{},exitPreview:()=>{},switchScenario:()=>{}}};function sk({block:e,lessonId:t,courseId:n,getToken:s,onLog:a}){const[l,i]=M.useState([{role:"assistant",content:e.starterMessage}]),[p,g]=M.useState(""),[v,u]=M.useState(!1),[h,y]=M.useState(!0),x=M.useRef(null),T=M.useRef(null),{isPreview:_}=ju(),E=An(e.title),R=An(e.instructions),P=on(["AI","You",e.placeholder||"Type a message...","Powered by Google Gemini  Conversations are logged for your teacher to review","Hmm, I had trouble connecting. Please try again!"]),B=(N,U)=>P?.[N]??U,X=l.map(N=>N.content),Q=on(X),K=M.useRef(!1);M.useEffect(()=>{if(!K.current){K.current=!0;return}x.current?.scrollIntoView({behavior:"smooth"})},[l]);const k=async()=>{if(!p.trim()||v)return;const N={role:"user",content:p.trim()},U=[...l,N];if(i(U),g(""),_){u(!0),await new Promise(q=>setTimeout(q,600));const z={role:"assistant",content:"*(Preview mode  this is a simulated response. Students will see real AI responses here.)*"};i(q=>[...q,z]),u(!1),setTimeout(()=>T.current?.focus(),100);return}u(!0);try{const z=await s(),D={role:"assistant",content:await gS({authToken:z,courseId:n,lessonId:t,blockId:e.id,systemPrompt:e.systemPrompt,messages:U})};i(de=>[...de,D]),a&&a(e.id,[...U,D])}catch(z){const q=z.message.includes("Slow down")?z.message:B(4,"Hmm, I had trouble connecting. Please try again!");i(D=>[...D,{role:"assistant",content:q}])}u(!1),setTimeout(()=>T.current?.focus(),100)},I=N=>{N.key==="Enter"&&!N.shiftKey&&(N.preventDefault(),k())};return f.jsxs("div",{className:"chatbot-block",children:[f.jsxs("div",{className:"chatbot-header",onClick:()=>y(!h),children:[f.jsxs("div",{className:"chatbot-header-left",children:[f.jsx("span",{className:"chatbot-icon",children:e.icon}),f.jsx("h3",{className:"chatbot-title","data-translatable":!0,children:E})]}),f.jsx("span",{className:"chatbot-toggle",children:h?"":""})]}),h&&f.jsxs(f.Fragment,{children:[e.instructions&&f.jsx("div",{className:"chatbot-instructions","data-translatable":!0,dangerouslySetInnerHTML:{__html:ro(R||e.instructions)}}),_&&f.jsx("div",{className:"chatbot-preview-notice",children:" Preview mode  responses are simulated. No API calls or chat logs are created."}),f.jsxs("div",{className:"chatbot-conversation",children:[l.map((N,U)=>f.jsxs("div",{className:`chat-message ${N.role}`,children:[f.jsx("div",{className:"chat-avatar",children:N.role==="assistant"?"":""}),f.jsxs("div",{className:"chat-bubble",children:[f.jsx("div",{className:"chat-role","data-translatable":!0,children:N.role==="assistant"?B(0,"AI"):B(1,"You")}),f.jsx("div",{className:"chat-text","data-translatable":!0,dangerouslySetInnerHTML:{__html:ro(Q?.[U]??N.content)}})]})]},U)),v&&f.jsxs("div",{className:"chat-message assistant",children:[f.jsx("div",{className:"chat-avatar",children:""}),f.jsxs("div",{className:"chat-bubble",children:[f.jsx("div",{className:"chat-role","data-translatable":!0,children:B(0,"AI")}),f.jsxs("div",{className:"chat-typing",children:[f.jsx("span",{}),f.jsx("span",{}),f.jsx("span",{})]})]})]}),f.jsx("div",{ref:x})]}),f.jsxs("div",{className:"chatbot-input-row",children:[f.jsx("input",{ref:T,className:"chatbot-input",value:p,onChange:N=>g(N.target.value),onKeyDown:I,placeholder:B(2,e.placeholder||"Type a message..."),disabled:v}),f.jsx("button",{className:"chatbot-send",onClick:k,disabled:!p.trim()||v,children:f.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[f.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),f.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]})})]}),f.jsx("div",{className:"chatbot-footer","data-translatable":!0,children:B(3,"Powered by Google Gemini  Conversations are logged for your teacher to review")})]})]})}function ak({block:e}){const t=on([e.term,e.definition]);return f.jsxs("div",{className:"definition-block",children:[f.jsx("div",{className:"def-term","data-translatable":!0,children:t?.[0]??e.term}),f.jsx("div",{className:"def-text","data-translatable":!0,children:t?.[1]??e.definition})]})}function ok({block:e}){const t=An(e.content);return f.jsxs("div",{className:`callout-block callout-${e.style}`,children:[f.jsx("span",{className:"callout-icon",children:e.icon}),f.jsx("div",{className:"callout-content","data-translatable":!0,dangerouslySetInnerHTML:{__html:ro(t)}})]})}function lk({block:e}){const t=[e.title,...e.items||[]],n=on(t),s=n?.[0]??e.title,a=n?n.slice(1):e.items;return f.jsxs("div",{className:"objectives-block",children:[f.jsxs("h3",{className:"objectives-title","data-translatable":!0,children:[" ",s]}),f.jsx("ul",{className:"objectives-list",children:(a||e.items).map((l,i)=>f.jsx("li",{"data-translatable":!0,children:l},i))})]})}function ck({block:e}){const t=An(e.title),n=An(e.instructions);return f.jsxs("div",{className:"activity-block",children:[f.jsxs("div",{className:"activity-header",children:[f.jsx("span",{className:"activity-icon",children:e.icon}),f.jsx("h3",{className:"activity-title","data-translatable":!0,children:t})]}),f.jsx("div",{className:"activity-body","data-translatable":!0,dangerouslySetInnerHTML:{__html:ro(n)}})]})}function uk({block:e}){const t=e.terms||[],n=t.flatMap(a=>[a.term,a.definition]),s=on(n);return f.jsx("div",{className:"vocab-list-block",children:t.map((a,l)=>f.jsxs("div",{className:"vocab-item",children:[f.jsx("span",{className:"vocab-term","data-translatable":!0,children:s?.[l*2]??a.term}),f.jsx("span",{className:"vocab-def","data-translatable":!0,children:s?.[l*2+1]??a.definition})]},l))})}function dk({block:e}){const t=An(e.title),n=An(e.subtitle);return f.jsxs("div",{className:"section-header-block",children:[f.jsx("div",{className:"section-icon",children:e.icon}),f.jsxs("div",{children:[f.jsx("h2",{className:"section-title","data-translatable":!0,children:t}),e.subtitle&&f.jsx("p",{className:"section-subtitle","data-translatable":!0,children:n})]})]})}function fk({block:e}){const t=An(e.caption);return e.url?f.jsxs("div",{style:{margin:"24px 0"},children:[f.jsx("img",{src:e.url,alt:e.alt||t||"Lesson image",style:{width:"100%",maxWidth:700,borderRadius:"var(--radius, 12px)",border:"1px solid var(--border, #2a2f3d)"}}),t&&f.jsx("p",{style:{fontSize:13,color:"var(--text3, #888)",marginTop:8,fontStyle:"italic",textAlign:"center"},children:t})]}):null}function hk({block:e}){const t=An(e.title),n=on(e.items||[]),[s,a]=M.useState({}),l=g=>a(v=>({...v,[g]:!v[g]})),i=e.items||[],p=Object.values(s).filter(Boolean).length;return f.jsxs("div",{style:{margin:"24px 0",padding:"20px 24px",background:"var(--surface, #1e2132)",borderRadius:"var(--radius, 12px)",border:"1px solid var(--border, #2a2f3d)"},children:[t&&f.jsxs("h3",{style:{fontFamily:"var(--font-display, 'DM Sans', sans-serif)",fontSize:16,fontWeight:700,color:"var(--text, #e0e0e0)",marginBottom:12},children:[" ",t]}),i.length>0&&f.jsxs("div",{style:{marginBottom:14},children:[f.jsx("div",{style:{height:4,borderRadius:2,background:"var(--border, #2a2f3d)",overflow:"hidden"},children:f.jsx("div",{style:{height:"100%",width:`${p/i.length*100}%`,background:"var(--green, #22c55e)",borderRadius:2,transition:"width 0.3s ease"}})}),f.jsxs("p",{style:{fontSize:11,color:"var(--text3, #888)",marginTop:4},children:[p,"/",i.length," completed"]})]}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:i.map((g,v)=>f.jsxs("label",{onClick:()=>l(v),style:{display:"flex",alignItems:"flex-start",gap:10,padding:"8px 10px",borderRadius:8,cursor:"pointer",background:s[v]?"rgba(34, 197, 94, 0.08)":"transparent",transition:"background 0.15s"},children:[f.jsx("span",{style:{width:22,height:22,minWidth:22,borderRadius:6,border:s[v]?"2px solid var(--green, #22c55e)":"2px solid var(--border, #2a2f3d)",background:s[v]?"var(--green, #22c55e)":"transparent",display:"flex",alignItems:"center",justifyContent:"center",fontSize:13,color:"#fff",transition:"all 0.15s",marginTop:1},children:s[v]?"":""}),f.jsx("span",{style:{fontSize:14,color:s[v]?"var(--text3, #888)":"var(--text, #e0e0e0)",textDecoration:s[v]?"line-through":"none",transition:"all 0.15s",lineHeight:1.5},children:n[v]??g})]},v))})]})}function pk({block:e}){const t=An(e.caption),n=e.height||400;return e.url?f.jsxs("div",{style:{margin:"24px 0"},children:[f.jsx("div",{style:{borderRadius:"var(--radius, 12px)",border:"1px solid var(--border, #2a2f3d)",overflow:"hidden",background:"#fff"},children:f.jsx("iframe",{src:e.url,title:t||"Embedded content",width:"100%",height:n,style:{border:"none",display:"block"},allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope",allowFullScreen:!0})}),t&&f.jsx("p",{style:{fontSize:13,color:"var(--text3, #888)",marginTop:8,fontStyle:"italic",textAlign:"center"},children:t})]}):null}function mk(){return f.jsx("hr",{style:{border:"none",height:1,background:"var(--border, #2a2f3d)",margin:"32px 0"}})}function gk({block:e}){const{title:t="Sort It!",icon:n="",instructions:s="",leftLabel:a="Category A",rightLabel:l="Category B",items:i=[]}=e,[p,g]=M.useState([]),[v,u]=M.useState([]),[h,y]=M.useState([]),[x,T]=M.useState(0),[_,E]=M.useState(!1),[R,P]=M.useState(!1),[B,X]=M.useState(null),Q=M.useRef(null),K=M.useRef(0),k=M.useRef(0),I=M.useRef(!1);M.useEffect(()=>{const fe=[...i].sort(()=>Math.random()-.5);g(fe),u([]),y([]),P(!1),X(null)},[i.length]);const N=p[0],U=80,z=(fe,F)=>{K.current=fe,k.current=F,I.current=!0,E(!0),T(0)},q=fe=>{if(!I.current)return;const F=fe-K.current;T(F)},D=()=>{I.current&&(I.current=!1,E(!1),x<-U?de("left"):x>U&&de("right"),T(0))},de=fe=>{N&&(fe==="left"?u(F=>[...F,N]):y(F=>[...F,N]),g(F=>F.slice(1)))},je=fe=>{N&&de(fe)},W=()=>{let fe=0;const F=i.length;v.forEach(O=>{O.correct==="left"&&fe++}),h.forEach(O=>{O.correct==="right"&&fe++}),X({correct:fe,total:F}),P(!0)},J=()=>{const fe=[...i].sort(()=>Math.random()-.5);g(fe),u([]),y([]),P(!1),X(null)},ve=p.length===0&&i.length>0,Se=i.length>0?(i.length-p.length)/i.length*100:0,Re=x*.08,H=Math.max(.3,1-Math.abs(x)/300),Z=x<-30?Math.min(1,Math.abs(x+30)/100):0,te=x>30?Math.min(1,(x-30)/100):0;return f.jsxs("div",{className:"card",style:{padding:"28px 24px",overflow:"visible"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:8},children:[f.jsx("span",{style:{fontSize:22},children:n}),f.jsx("h3",{style:{fontFamily:"var(--font-display)",fontSize:18,fontWeight:700,margin:0},children:t})]}),s&&f.jsx("p",{style:{color:"var(--text2)",fontSize:14,marginBottom:16,lineHeight:1.5},children:s}),f.jsx("div",{style:{height:6,background:"var(--surface2)",borderRadius:3,marginBottom:20,overflow:"hidden"},children:f.jsx("div",{style:{width:`${Se}%`,height:"100%",background:"var(--amber)",borderRadius:3,transition:"width 0.3s ease"}})}),f.jsxs("div",{style:{display:"flex",alignItems:"stretch",gap:12,marginBottom:16,minHeight:200},children:[f.jsxs("div",{style:{flex:"0 0 90px",display:"flex",flexDirection:"column",alignItems:"center",gap:8,padding:"12px 8px",borderRadius:12,background:Z>0?`rgba(239, 68, 68, ${Z*.15})`:"var(--surface2)",border:`2px solid ${Z>0?`rgba(239, 68, 68, ${Z*.6})`:"transparent"}`,transition:Z>0?"none":"all 0.3s ease"},children:[f.jsx("span",{style:{fontSize:13,fontWeight:700,color:"var(--text)",textAlign:"center",lineHeight:1.3},children:a}),f.jsx("div",{style:{fontSize:20,fontWeight:700,color:"var(--text3)"},children:v.length}),R&&v.map((fe,F)=>f.jsxs("div",{style:{fontSize:11,padding:"4px 8px",borderRadius:6,width:"100%",textAlign:"center",background:fe.correct==="left"?"rgba(34,197,94,0.15)":"rgba(239,68,68,0.15)",color:fe.correct==="left"?"var(--green)":"var(--red)",border:`1px solid ${fe.correct==="left"?"rgba(34,197,94,0.3)":"rgba(239,68,68,0.3)"}`},children:[fe.correct==="left"?"":""," ",fe.text]},F))]}),f.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",minHeight:180},children:[p.length>2&&f.jsx("div",{style:{position:"absolute",width:"85%",height:"85%",borderRadius:16,background:"var(--surface2)",border:"1px solid var(--border)",transform:"scale(0.92)",opacity:.3}}),p.length>1&&f.jsx("div",{style:{position:"absolute",width:"90%",height:"90%",borderRadius:16,background:"var(--surface2)",border:"1px solid var(--border)",transform:"scale(0.96)",opacity:.5}}),N?f.jsxs("div",{ref:Q,onMouseDown:fe=>{fe.preventDefault(),z(fe.clientX,fe.clientY)},onMouseMove:fe=>q(fe.clientX),onMouseUp:D,onMouseLeave:()=>{I.current&&D()},onTouchStart:fe=>z(fe.touches[0].clientX,fe.touches[0].clientY),onTouchMove:fe=>q(fe.touches[0].clientX),onTouchEnd:D,style:{position:"relative",width:"90%",minHeight:140,padding:"24px 20px",background:"var(--surface)",border:"2px solid var(--border)",borderRadius:16,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:600,textAlign:"center",lineHeight:1.4,cursor:_?"grabbing":"grab",userSelect:"none",transform:`translateX(${x}px) rotate(${Re}deg)`,opacity:H,transition:_?"none":"transform 0.3s ease, opacity 0.3s ease",boxShadow:"0 8px 30px rgba(0,0,0,0.2)"},children:[x<-30&&f.jsxs("div",{style:{position:"absolute",top:12,left:12,padding:"4px 12px",borderRadius:8,fontSize:13,fontWeight:700,background:"rgba(239,68,68,0.15)",color:"var(--red)",border:"2px solid var(--red)",transform:"rotate(-12deg)"},children:[" ",a]}),x>30&&f.jsxs("div",{style:{position:"absolute",top:12,right:12,padding:"4px 12px",borderRadius:8,fontSize:13,fontWeight:700,background:"rgba(34,197,94,0.15)",color:"var(--green)",border:"2px solid var(--green)",transform:"rotate(12deg)"},children:[" ",l]}),N.text]}):ve&&!R?f.jsxs("div",{style:{textAlign:"center"},children:[f.jsx("div",{style:{fontSize:36,marginBottom:12},children:""}),f.jsx("div",{style:{fontSize:15,color:"var(--text2)",marginBottom:16},children:"All items sorted!"}),f.jsx("button",{className:"btn btn-primary",onClick:W,children:"Check Answers"})]}):R&&B?f.jsxs("div",{style:{textAlign:"center"},children:[f.jsx("div",{style:{fontSize:36,marginBottom:8},children:B.correct===B.total?"":B.correct>=B.total*.7?"":""}),f.jsxs("div",{style:{fontSize:28,fontWeight:700,fontFamily:"var(--font-display)",color:B.correct===B.total?"var(--green)":B.correct>=B.total*.7?"var(--amber)":"var(--red)",marginBottom:4},children:[B.correct," / ",B.total]}),f.jsx("div",{style:{fontSize:14,color:"var(--text2)",marginBottom:16},children:B.correct===B.total?"Perfect! ":B.correct>=B.total*.7?"Nice work!":"Try again!"}),f.jsx("button",{className:"btn btn-secondary",onClick:J,children:" Try Again"})]}):f.jsx("div",{style:{color:"var(--text3)",fontSize:14},children:"No items to sort"})]}),f.jsxs("div",{style:{flex:"0 0 90px",display:"flex",flexDirection:"column",alignItems:"center",gap:8,padding:"12px 8px",borderRadius:12,background:te>0?`rgba(34, 197, 94, ${te*.15})`:"var(--surface2)",border:`2px solid ${te>0?`rgba(34, 197, 94, ${te*.6})`:"transparent"}`,transition:te>0?"none":"all 0.3s ease"},children:[f.jsx("span",{style:{fontSize:13,fontWeight:700,color:"var(--text)",textAlign:"center",lineHeight:1.3},children:l}),f.jsx("div",{style:{fontSize:20,fontWeight:700,color:"var(--text3)"},children:h.length}),R&&h.map((fe,F)=>f.jsxs("div",{style:{fontSize:11,padding:"4px 8px",borderRadius:6,width:"100%",textAlign:"center",background:fe.correct==="right"?"rgba(34,197,94,0.15)":"rgba(239,68,68,0.15)",color:fe.correct==="right"?"var(--green)":"var(--red)",border:`1px solid ${fe.correct==="right"?"rgba(34,197,94,0.3)":"rgba(239,68,68,0.3)"}`},children:[fe.correct==="right"?"":""," ",fe.text]},F))]})]}),N&&f.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"center"},children:[f.jsxs("button",{onClick:()=>je("left"),style:{padding:"10px 24px",borderRadius:50,border:"2px solid var(--red)",background:"rgba(239,68,68,0.1)",color:"var(--red)",fontWeight:700,fontSize:14,cursor:"pointer",display:"flex",alignItems:"center",gap:6},children:[" ",a]}),f.jsxs("button",{onClick:()=>je("right"),style:{padding:"10px 24px",borderRadius:50,border:"2px solid var(--green)",background:"rgba(34,197,94,0.1)",color:"var(--green)",fontWeight:700,fontSize:14,cursor:"pointer",display:"flex",alignItems:"center",gap:6},children:[l," "]})]}),p.length>0&&f.jsxs("div",{style:{textAlign:"center",marginTop:12,fontSize:12,color:"var(--text3)"},children:[p.length," remaining"]})]})}function vk({lesson:e,studentData:t,chatLogs:n,courseId:s}){const{user:a}=un(),[l,i]=M.useState(null),[p,g]=M.useState(null),v=(e.blocks||[]).filter(Q=>Q.type==="question"),u=(e.blocks||[]).filter(Q=>Q.type==="section_header"),h=v.filter(Q=>t[Q.id]?.submitted).length,y=v.filter(Q=>Q.questionType==="multiple_choice"&&t[Q.id]?.submitted),x=y.filter(Q=>t[Q.id]?.correct).length,T=Object.values(n||{}).reduce((Q,K)=>Q+K.filter(k=>k.role==="user").length,0),_=u.map(Q=>Q.title),E=on(_),R=on(["Questions","Accuracy","AI Chats","messages sent","Sections"]),P=(Q,K)=>R?.[Q]??K;M.useEffect(()=>{a&&(ml(a.uid).then(i),s&&_h(s).then(Q=>{Q.activeMultiplier&&(Q.activeMultiplier.expiresAt?.toDate?.()?Q.activeMultiplier.expiresAt.toDate():new Date(Q.activeMultiplier.expiresAt))>new Date&&g(Q.activeMultiplier)}).catch(()=>{}))},[a,t,s]);const B=l?ls(l.totalXP):null,X=An(B?.current?.name);return f.jsxs("div",{className:"progress-sidebar",children:[f.jsx(cS,{activeMultiplier:p,compact:!0}),B&&f.jsxs("div",{className:"sidebar-section",children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:8},children:[f.jsx("div",{style:{width:34,height:34,borderRadius:"50%",background:"var(--amber-dim)",border:"2px solid var(--amber)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"var(--font-display)",fontWeight:700,fontSize:14,color:"var(--amber)"},children:B.current.level}),f.jsxs("div",{children:[f.jsx("div",{style:{fontWeight:600,fontSize:12},"data-translatable":!0,children:X||B.current.name}),f.jsxs("div",{style:{fontSize:11,color:"var(--text3)"},children:[l.totalXP," XP"]})]})]}),B.next&&f.jsx("div",{style:{width:"100%",height:4,background:"var(--surface2)",borderRadius:2},children:f.jsx("div",{style:{width:`${B.progress*100}%`,height:"100%",background:"var(--amber)",borderRadius:2,transition:"width 0.3s"}})})]}),l&&f.jsx("div",{className:"sidebar-section",children:f.jsx(lS,{currentStreak:l.currentStreak||0,longestStreak:l.longestStreak||0,streakFreezes:l.streakFreezes||0,compact:!0})}),f.jsxs("div",{className:"sidebar-section",children:[f.jsx("div",{className:"sidebar-label","data-translatable":!0,children:P(0,"Questions")}),f.jsxs("div",{className:"sidebar-progress-ring",children:[f.jsxs("svg",{viewBox:"0 0 36 36",className:"progress-ring-svg",children:[f.jsx("path",{className:"ring-bg",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"}),f.jsx("path",{className:"ring-fill",strokeDasharray:`${v.length?h/v.length*100:0}, 100`,d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"})]}),f.jsxs("div",{className:"ring-text",children:[h,"/",v.length]})]})]}),y.length>0&&f.jsxs("div",{className:"sidebar-section",children:[f.jsx("div",{className:"sidebar-label","data-translatable":!0,children:P(1,"Accuracy")}),f.jsxs("div",{className:"sidebar-stat",style:{color:x/y.length>=.7?"var(--green)":"var(--amber)"},children:[Math.round(x/y.length*100),"%"]})]}),f.jsxs("div",{className:"sidebar-section",children:[f.jsx("div",{className:"sidebar-label","data-translatable":!0,children:P(2,"AI Chats")}),f.jsxs("div",{style:{textAlign:"center"},children:[f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:28,fontWeight:700,color:"var(--cyan)"},children:T}),f.jsx("div",{style:{fontSize:11,color:"var(--text3)",marginTop:2},"data-translatable":!0,children:P(3,"messages sent")})]})]}),f.jsxs("div",{className:"sidebar-section",children:[f.jsx("div",{className:"sidebar-label","data-translatable":!0,children:P(4,"Sections")}),f.jsx("div",{className:"sidebar-nav",children:u.map((Q,K)=>f.jsxs("a",{className:"sidebar-nav-item",href:`#${Q.id}`,children:[f.jsx("span",{children:Q.icon}),f.jsx("span",{"data-translatable":!0,children:(E||_)[K]})]},Q.id))})]})]})}function yk(e,t={},n={}){const{isPreview:s,scenario:a,scenarioConfig:l}=ju(),i=M.useMemo(()=>{if(!s||!e)return null;const p=e.blocks||[],g=p.filter(u=>u.type==="question"),v=p.filter(u=>u.type==="chatbot");if(a==="new")return{studentData:{},chatLogs:{}};if(a==="midway"){const u={},h=Math.ceil(g.length/2);g.slice(0,h).forEach(x=>{if(x.questionType==="multiple_choice"||x.type==="multiple_choice"){const T=(x.options||[]).findIndex(_=>_.correct);u[x.id]={answer:T>=0?T:0,correct:T>=0,submitted:!0}}else u[x.id]={answer:"This is a sample student response for preview purposes.",submitted:!0}});const y={};return v.slice(0,1).forEach(x=>{y[x.id]={messages:[{role:"user",content:"Hi, can you help me understand this?"},{role:"assistant",content:"Of course! What specifically would you like to know more about?"},{role:"user",content:"How does this concept apply in real life?"}],messageCount:3}}),{studentData:u,chatLogs:y}}if(a==="complete"){const u={};g.forEach(y=>{if(y.questionType==="multiple_choice"||y.type==="multiple_choice"){const x=(y.options||[]).findIndex(T=>T.correct);u[y.id]={answer:x>=0?x:0,correct:x>=0,submitted:!0}}else u[y.id]={answer:"This is a complete sample student response demonstrating full progress.",submitted:!0}});const h={};return v.forEach(y=>{h[y.id]={messages:[{role:"user",content:"Can you explain this topic?"},{role:"assistant",content:"Sure! Let me walk you through it step by step."},{role:"user",content:"That makes sense. What about the second part?"},{role:"assistant",content:"Great question! The second part builds on what we just discussed..."},{role:"user",content:"Thank you, I understand now!"}],messageCount:5}}),{studentData:u,chatLogs:h}}return null},[s,a,e]);return!s||!i?{studentData:t,chatLogs:n,isPreviewActive:!1}:{studentData:i.studentData,chatLogs:i.chatLogs,isPreviewActive:!0}}function bk({compact:e=!1,sourceLocation:t=null}){const{enterPreview:n,scenarios:s,isPreview:a}=ju(),[l,i]=M.useState(!1);return a?null:e?f.jsx("button",{className:"preview-launch-btn compact",onClick:()=>n("new",t),title:"Preview as Student",children:" Preview"}):f.jsxs("div",{className:"preview-launcher",children:[f.jsxs("button",{className:"preview-launch-btn",onClick:()=>i(!l),children:[f.jsx("span",{className:"preview-launch-icon",children:""}),f.jsx("span",{children:"Preview as Student"})]}),l&&f.jsxs("div",{className:"preview-launch-panel",children:[f.jsx("div",{className:"preview-launch-title",children:"Choose a student scenario:"}),Object.entries(s).map(([p,g])=>f.jsxs("button",{className:"preview-launch-option",onClick:()=>{n(p,t),i(!1)},children:[f.jsx("span",{className:"preview-launch-opt-icon",children:g.icon}),f.jsxs("div",{children:[f.jsx("div",{className:"preview-launch-opt-label",children:g.label}),f.jsx("div",{className:"preview-launch-opt-desc",children:g.description})]})]},p))]})]})}function Sk(){const{courseId:e,lessonId:t}=_l(),n=ui(),{user:s,userRole:a,getToken:l}=un(),{isPreview:i}=ju(),[p,g]=M.useState(null),[v,u]=M.useState({}),[h,y]=M.useState({}),[x,T]=M.useState(!0),[_,E]=M.useState(!1),[R,P]=M.useState(!1);M.useEffect(()=>{window.scrollTo(0,0)},[i]);const{studentData:B,chatLogs:X,isPreviewActive:Q}=yk(p,v,h);M.useEffect(()=>{(async()=>{try{const q=Fe(be,"courses",e,"lessons",t),D=await Mt(q);if(D.exists()&&g({id:D.id,...D.data()}),s){const de=Fe(be,"progress",s.uid,"courses",e,"lessons",t),je=await Mt(de);je.exists()&&(u(je.data().answers||{}),je.data().completed&&P(!0))}}catch(q){console.error("Error fetching lesson:",q)}T(!1)})()},[e,t,s]);const K=M.useCallback(async(z,q)=>{if(Q){u(D=>({...D,[z]:q}));return}u(D=>{const de={...D,[z]:q};if(s){const je=Fe(be,"progress",s.uid,"courses",e,"lessons",t);At(je,{answers:de,lastUpdated:new Date},{merge:!0})}return de})},[s,e,t,Q]),k=M.useCallback((z,q)=>{Q||y(D=>({...D,[z]:q}))},[Q]),I=An(p?.title),N=An(p?.unit||p?.course);if(x)return f.jsx("div",{className:"page-container",style:{display:"flex",justifyContent:"center",paddingTop:120},children:f.jsx("div",{className:"spinner"})});if(!p)return f.jsxs("div",{className:"page-container",style:{textAlign:"center",paddingTop:120},children:[f.jsx("h2",{style:{fontFamily:"var(--font-display)"},children:"Lesson not found"}),f.jsx("p",{style:{color:"var(--text2)",marginTop:8},children:"This lesson may not exist or you may not have access."})]});const U=z=>{switch(z.type){case"section_header":return f.jsx(dk,{block:z},z.id);case"text":return f.jsx(JR,{block:z},z.id);case"video":return f.jsx(ek,{block:z},z.id);case"image":return f.jsx(fk,{block:z},z.id);case"definition":return f.jsx(ak,{block:z},z.id);case"callout":return f.jsx(ok,{block:z},z.id);case"objectives":return f.jsx(lk,{block:z},z.id);case"activity":return f.jsx(ck,{block:z},z.id);case"vocab_list":return f.jsx(uk,{block:z},z.id);case"checklist":return f.jsx(hk,{block:z},z.id);case"embed":return f.jsx(pk,{block:z},z.id);case"divider":return f.jsx(mk,{},z.id);case"sorting":return f.jsx(gk,{block:z},z.id);case"chatbot":return f.jsx(sk,{block:z,lessonId:t,courseId:e,getToken:l,onLog:k},z.id);case"question":return f.jsx(tk,{block:z,studentData:B,onAnswer:K,courseId:e,lessonCompleted:R},z.id);default:return null}};return f.jsxs("div",{className:"lesson-layout",children:[f.jsxs("div",{className:"lesson-content",children:[a!=="teacher"&&!i&&f.jsx(Xt,{to:`/course/${e}`,style:{display:"inline-flex",alignItems:"center",gap:6,fontSize:13,color:"var(--text3)",textDecoration:"none",marginBottom:16,fontWeight:600},children:" Back to Course"}),a==="teacher"&&!i&&f.jsx("div",{style:{marginBottom:24,display:"flex",justifyContent:"flex-end"},children:f.jsx(bk,{sourceLocation:{courseId:e,lessonId:t}})}),f.jsxs("div",{style:{marginBottom:48,paddingBottom:36,borderBottom:"1px solid var(--border)"},children:[f.jsx("div",{style:{fontSize:12,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.1em",color:"var(--amber)",marginBottom:10},children:N}),f.jsx("h1",{style:{fontFamily:"var(--font-display)",fontSize:40,fontWeight:700,lineHeight:1.15,letterSpacing:"-0.02em"},"data-translatable":!0,children:I})]}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:24},children:(p.blocks||[]).map(z=>{const q=U(z);return z.type==="section_header"?f.jsx("div",{id:z.id,children:q},z.id):q})}),a!=="teacher"&&!i&&(()=>{const z=p.blocks||[],q=z.filter(te=>te.type==="question"),D=z.filter(te=>te.type==="chatbot"),de=z.filter(te=>te.type==="checklist"),je=q.every(te=>B[te.id]?.submitted),W=D.every(te=>X[te.id]?.length>0),J=de.every(te=>{const fe=te.items||[];if(fe.length===0)return!0;const F=B[te.id]?.checked||{};return fe.every((O,xe)=>F[xe])}),ve=je&&W&&J,Se=[],Re=q.filter(te=>!B[te.id]?.submitted).length,H=D.filter(te=>!X[te.id]?.length).length,Z=de.filter(te=>{const fe=te.items||[];if(fe.length===0)return!1;const F=B[te.id]?.checked||{};return!fe.every((O,xe)=>F[xe])}).length;return Re&&Se.push(`${Re} question${Re>1?"s":""}`),H&&Se.push(`${H} chatbot${H>1?"s":""}`),Z&&Se.push(`${Z} checklist${Z>1?"s":""}`),f.jsxs("div",{style:{marginTop:48,paddingTop:32,borderTop:"1px solid var(--border)",display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[f.jsx("button",{onClick:async()=>{if(!(_||!ve)){E(!0);try{if(s){const te=Fe(be,"progress",s.uid,"courses",e,"lessons",t);await At(te,{completedAt:new Date,completed:!0},{merge:!0}),P(!0);try{await mm(s.uid,e,"lesson_complete",{lessonId:t})}catch(fe){console.warn("Could not award XP:",fe)}}n(`/course/${e}`)}catch(te){console.error("Failed to complete lesson:",te),E(!1)}}},disabled:_||!ve,style:{padding:"14px 48px",fontSize:16,fontWeight:700,fontFamily:"var(--font-display)",background:ve?_?"var(--surface2)":"var(--amber)":"var(--surface2)",color:ve?_?"var(--text3)":"#1a1a1a":"var(--text3)",border:"none",borderRadius:12,cursor:!ve||_?"default":"pointer",transition:"all 0.2s",opacity:ve?1:.5},children:_?"Completing...":ve?" Complete Lesson":" Complete Lesson"}),f.jsx("span",{style:{fontSize:12,color:"var(--text3)"},children:ve?"Mark this lesson as done and return to course":`Finish all activities first  ${Se.join(", ")} remaining`})]})})()]}),f.jsx(vk,{lesson:p,studentData:B,chatLogs:X,courseId:e})]})}const wk="modulepreload",_k=function(e){return"/"+e},r8={},xk=function(t,n,s){let a=Promise.resolve();if(n&&n.length>0){let v=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};var i=v;document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),g=p?.nonce||p?.getAttribute("nonce");a=v(n.map(u=>{if(u=_k(u),u in r8)return;r8[u]=!0;const h=u.endsWith(".css"),y=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${y}`))return;const x=document.createElement("link");if(x.rel=h?"stylesheet":wk,h||(x.as="script"),x.crossOrigin="",x.href=u,g&&x.setAttribute("nonce",g),document.head.appendChild(x),h)return new Promise((T,_)=>{x.addEventListener("load",T),x.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${u}`)))})}))}function l(p){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=p,window.dispatchEvent(g),!g.defaultPrevented)throw p}return a.then(p=>{for(const g of p||[])g.status==="rejected"&&l(g.reason);return t().catch(l)})},yS={},Ng="You are a student completing a classroom assignment. Answer the question directly and thoroughly. Write naturally as if you are a knowledgeable student  do not include disclaimers, caveats, or mention that you are an AI. Just answer the question.";async function Tk(e,t){try{const{sendChatMessage:n}=await xk(async()=>{const{sendChatMessage:l}=await Promise.resolve().then(()=>rk);return{sendChatMessage:l}},[]),s=await t();return{provider:"gemini",text:await n({authToken:s,courseId:"__baseline__",lessonId:"__baseline__",blockId:"__baseline__",systemPrompt:Ng,messages:[{role:"user",content:e}]})}}catch(n){return console.warn("Baseline generation via app API failed:",n.message),null}}async function Ek(e){const t=yS?.VITE_OPENAI_API_KEY;if(!t)return null;try{return{provider:"openai",text:(await(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:Ng},{role:"user",content:e}],max_tokens:1e3,temperature:.7})})).json()).choices?.[0]?.message?.content||""}}catch(n){return console.warn("OpenAI baseline failed:",n.message),null}}async function Ck(e){const t=yS?.VITE_ANTHROPIC_API_KEY;if(!t)return null;try{return{provider:"anthropic",text:(await(await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":t,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:1e3,system:Ng,messages:[{role:"user",content:e}]})})).json()).content?.[0]?.text||""}}catch(n){return console.warn("Anthropic baseline failed:",n.message),null}}async function Ak(e,t){return!e||e.trim().length<10?[]:(await Promise.all([Tk(e,t),Ek(e),Ck(e)])).filter(s=>s&&s.text&&s.text.length>20).map(s=>({...s,generatedAt:new Date().toISOString()}))}async function jk(e,t,n,s){if(!n||!Array.isArray(n))return n;let a=!1;const l=[...n];for(let i=0;i<l.length;i++){const p=l[i];if(p.type==="question"&&p.questionType==="short_answer"&&p.prompt&&(!p.aiBaselines||p.aiBaselines.length===0)){console.log(`Generating AI baselines for block "${p.prompt.slice(0,50)}..."`);const g=await Ak(p.prompt,s);g.length>0&&(l[i]={...p,aiBaselines:g},a=!0,console.log(`   Got ${g.length} baseline(s) from: ${g.map(v=>v.provider).join(", ")}`))}}if(a&&e&&t)try{const i=Fe(be,"courses",e,"lessons",t);await Eu(i,{blocks:l}),console.log("Baselines saved to Firestore.")}catch(i){console.error("Failed to save baselines:",i)}return l}function i8(e){const t=e.toLowerCase().match(/\b[a-z]{2,}\b/g)||[],n={};return t.forEach(s=>{n[s]=(n[s]||0)+1}),n}function Mk(e,t){const n=new Set([...Object.keys(e),...Object.keys(t)]);let s=0,a=0,l=0;for(const p of n){const g=e[p]||0,v=t[p]||0;s+=g*v,a+=g*g,l+=v*v}const i=Math.sqrt(a)*Math.sqrt(l);return i>0?s/i:0}function s8(e,t,n=3){const s=p=>{const g=p.toLowerCase().match(/\b[a-z]{2,}\b/g)||[],v=new Set;for(let u=0;u<=g.length-n;u++)v.add(g.slice(u,u+n).join(" "));return v},a=s(e),l=s(t);if(a.size===0||l.size===0)return 0;let i=0;for(const p of a)l.has(p)&&i++;return i/Math.min(a.size,l.size)}function Rk(e,t){if(!t||t.length===0||!e||e.length<20)return{score:0,bestMatch:null,details:[]};const n=i8(e),s=[];let a=0,l=null;for(const p of t){const g=i8(p.text),v=Mk(n,g),u=s8(e,p.text,3),h=s8(e,p.text,2),y=v*.4+u*.35+h*.25;s.push({provider:p.provider,cosine:Math.round(v*100)/100,trigram:Math.round(u*100)/100,bigram:Math.round(h*100)/100,combined:Math.round(y*100)/100}),y>a&&(a=y,l={provider:p.provider,similarity:Math.round(y*100)/100})}let i=0;return a>=.55?i=1:a>=.45?i=.8:a>=.35?i=.5:a>=.25&&(i=.2),{score:i,bestMatch:l,details:s}}const bS=[{type:"section_header",label:"Section Header",icon:""},{type:"text",label:"Text",icon:""},{type:"video",label:"Video",icon:""},{type:"image",label:"Image",icon:""},{type:"definition",label:"Definition",icon:""},{type:"callout",label:"Callout",icon:""},{type:"objectives",label:"Objectives",icon:""},{type:"checklist",label:"Checklist",icon:""},{type:"activity",label:"Activity",icon:""},{type:"vocab_list",label:"Vocab List",icon:""},{type:"embed",label:"Embed",icon:""},{type:"divider",label:"Divider",icon:""},{type:"chatbot",label:"AI Chatbot",icon:""},{type:"question",label:"Question (MC)",icon:"",questionType:"multiple_choice"},{type:"question",label:"Question (Written)",icon:"",questionType:"short_answer"},{type:"sorting",label:"Sorting (Swipe)",icon:""}];function kk(e){const t={id:bf(),type:e.type};switch(e.type){case"section_header":return{...t,icon:"",title:"",subtitle:""};case"text":return{...t,content:""};case"video":return{...t,url:"",caption:""};case"image":return{...t,url:"",caption:"",alt:""};case"definition":return{...t,term:"",definition:""};case"callout":return{...t,icon:"",style:"insight",content:""};case"objectives":return{...t,title:"Learning Objectives",items:[""]};case"checklist":return{...t,title:"",items:[""]};case"activity":return{...t,icon:"",title:"",instructions:""};case"vocab_list":return{...t,terms:[{term:"",definition:""}]};case"embed":return{...t,url:"",caption:"",height:400};case"divider":return{...t};case"chatbot":return{...t,icon:"",title:"",starterMessage:"Hi! I'm ready to chat.",systemPrompt:"",instructions:"",placeholder:"Type a message..."};case"question":return e.questionType==="multiple_choice"?{...t,questionType:"multiple_choice",prompt:"",options:["","","",""],correctIndex:0,explanation:""}:{...t,questionType:"short_answer",prompt:""};case"sorting":return{...t,icon:"",title:"Sort It!",instructions:"",leftLabel:"Category A",rightLabel:"Category B",items:[{text:"",correct:"left"}]};default:return t}}function Ik({block:e,onChange:t,onDelete:n,onMoveUp:s,onMoveDown:a,isFirst:l,isLast:i}){const p=(u,h)=>t({...e,[u]:h}),g=()=>{switch(e.type){case"section_header":return f.jsxs(f.Fragment,{children:[f.jsx(Et,{label:"Icon",value:e.icon,onChange:u=>p("icon",u),small:!0}),f.jsx(Et,{label:"Title",value:e.title,onChange:u=>p("title",u)}),f.jsx(Et,{label:"Subtitle (optional)",value:e.subtitle,onChange:u=>p("subtitle",u)})]});case"text":return f.jsx(Et,{label:"Content (supports **bold** and *italic*)",value:e.content,onChange:u=>p("content",u),multiline:!0});case"video":return f.jsxs(f.Fragment,{children:[f.jsx(Et,{label:"YouTube URL (any format  watch, share, or embed links all work)",value:e.url,onChange:u=>p("url",u),placeholder:"https://www.youtube.com/watch?v=..."}),f.jsx(Et,{label:"Caption (optional)",value:e.caption,onChange:u=>p("caption",u)})]});case"image":return f.jsxs(f.Fragment,{children:[f.jsx(Et,{label:"Image URL",value:e.url,onChange:u=>p("url",u),placeholder:"https://example.com/image.png"}),f.jsx(Et,{label:"Caption (optional)",value:e.caption,onChange:u=>p("caption",u)}),f.jsx(Et,{label:"Alt Text (for accessibility)",value:e.alt,onChange:u=>p("alt",u)})]});case"definition":return f.jsxs(f.Fragment,{children:[f.jsx(Et,{label:"Term",value:e.term,onChange:u=>p("term",u)}),f.jsx(Et,{label:"Definition",value:e.definition,onChange:u=>p("definition",u),multiline:!0})]});case"callout":return f.jsxs(f.Fragment,{children:[f.jsx(Et,{label:"Icon",value:e.icon,onChange:u=>p("icon",u),small:!0}),f.jsxs("div",{className:"editor-field",children:[f.jsx("label",{children:"Style"}),f.jsxs("select",{value:e.style,onChange:u=>p("style",u.target.value),className:"editor-select",children:[f.jsx("option",{value:"insight",children:" Insight"}),f.jsx("option",{value:"warning",children:" Warning"}),f.jsx("option",{value:"question",children:" Question"})]})]}),f.jsx(Et,{label:"Content",value:e.content,onChange:u=>p("content",u),multiline:!0})]});case"objectives":return f.jsxs(f.Fragment,{children:[f.jsx(Et,{label:"Title",value:e.title,onChange:u=>p("title",u)}),f.jsxs("div",{className:"editor-field",children:[f.jsx("label",{children:"Items"}),(e.items||[]).map((u,h)=>f.jsxs("div",{style:{display:"flex",gap:6,marginBottom:6},children:[f.jsx("input",{className:"editor-input",value:u,onChange:y=>{const x=[...e.items];x[h]=y.target.value,p("items",x)}}),f.jsx("button",{className:"editor-icon-btn",onClick:()=>{const y=e.items.filter((x,T)=>T!==h);p("items",y)},children:""})]},h)),f.jsx("button",{className:"editor-add-btn",onClick:()=>p("items",[...e.items||[],""]),children:"+ Add item"})]})]});case"activity":return f.jsxs(f.Fragment,{children:[f.jsx(Et,{label:"Icon",value:e.icon,onChange:u=>p("icon",u),small:!0}),f.jsx(Et,{label:"Title",value:e.title,onChange:u=>p("title",u)}),f.jsx(Et,{label:"Instructions (supports **bold** and *italic*)",value:e.instructions,onChange:u=>p("instructions",u),multiline:!0})]});case"vocab_list":return f.jsx(f.Fragment,{children:f.jsxs("div",{className:"editor-field",children:[f.jsx("label",{children:"Terms"}),(e.terms||[]).map((u,h)=>f.jsxs("div",{style:{display:"flex",gap:6,marginBottom:6},children:[f.jsx("input",{className:"editor-input",placeholder:"Term",value:u.term,style:{flex:"0 0 30%"},onChange:y=>{const x=[...e.terms];x[h]={...x[h],term:y.target.value},p("terms",x)}}),f.jsx("input",{className:"editor-input",placeholder:"Definition",value:u.definition,onChange:y=>{const x=[...e.terms];x[h]={...x[h],definition:y.target.value},p("terms",x)}}),f.jsx("button",{className:"editor-icon-btn",onClick:()=>{const y=e.terms.filter((x,T)=>T!==h);p("terms",y)},children:""})]},h)),f.jsx("button",{className:"editor-add-btn",onClick:()=>p("terms",[...e.terms||[],{term:"",definition:""}]),children:"+ Add term"})]})});case"chatbot":return f.jsxs(f.Fragment,{children:[f.jsx(Et,{label:"Icon",value:e.icon,onChange:u=>p("icon",u),small:!0}),f.jsx(Et,{label:"Title",value:e.title,onChange:u=>p("title",u)}),f.jsx(Et,{label:"Starter Message (what the AI says first)",value:e.starterMessage,onChange:u=>p("starterMessage",u),multiline:!0}),f.jsx(Et,{label:"System Prompt (hidden instructions for the AI)",value:e.systemPrompt,onChange:u=>p("systemPrompt",u),multiline:!0,rows:6}),f.jsx(Et,{label:"Student Instructions",value:e.instructions,onChange:u=>p("instructions",u),multiline:!0}),f.jsx(Et,{label:"Input Placeholder",value:e.placeholder,onChange:u=>p("placeholder",u)})]});case"question":return e.questionType==="multiple_choice"?f.jsxs(f.Fragment,{children:[f.jsx(Et,{label:"Question Prompt",value:e.prompt,onChange:u=>p("prompt",u),multiline:!0}),f.jsxs("div",{className:"editor-field",children:[f.jsx("label",{children:"Options"}),(e.options||[]).map((u,h)=>f.jsxs("div",{style:{display:"flex",gap:6,marginBottom:6,alignItems:"center"},children:[f.jsx("input",{type:"radio",name:`correct-${e.id}`,checked:e.correctIndex===h,onChange:()=>p("correctIndex",h),style:{accentColor:"var(--green)"}}),f.jsx("input",{className:"editor-input",value:u,placeholder:`Option ${String.fromCharCode(65+h)}`,onChange:y=>{const x=[...e.options];x[h]=y.target.value,p("options",x)}})]},h)),f.jsx("p",{style:{fontSize:11,color:"var(--text3)",marginTop:4},children:"Select the radio button next to the correct answer."})]}),f.jsx(Et,{label:"Explanation (shown after answering)",value:e.explanation,onChange:u=>p("explanation",u),multiline:!0})]}):f.jsx(Et,{label:"Question Prompt",value:e.prompt,onChange:u=>p("prompt",u),multiline:!0});case"checklist":return f.jsxs(f.Fragment,{children:[f.jsx(Et,{label:"Title (optional)",value:e.title,onChange:u=>p("title",u)}),f.jsxs("div",{className:"editor-field",children:[f.jsx("label",{children:"Steps"}),(e.items||[]).map((u,h)=>f.jsxs("div",{style:{display:"flex",gap:6,marginBottom:6},children:[f.jsxs("span",{style:{color:"var(--text3)",fontSize:13,padding:"6px 0",minWidth:20},children:[h+1,"."]}),f.jsx("input",{className:"editor-input",value:u,onChange:y=>{const x=[...e.items||[]];x[h]=y.target.value,p("items",x)}}),f.jsx("button",{className:"editor-icon-btn",onClick:()=>{const y=(e.items||[]).filter((x,T)=>T!==h);p("items",y)},children:""})]},h)),f.jsx("button",{className:"editor-add-btn",onClick:()=>p("items",[...e.items||[],""]),children:"+ Add step"})]})]});case"embed":return f.jsxs(f.Fragment,{children:[f.jsx(Et,{label:"Embed URL",value:e.url,onChange:u=>p("url",u),placeholder:"https://docs.google.com/forms/..."}),f.jsx(Et,{label:"Caption (optional)",value:e.caption,onChange:u=>p("caption",u)}),f.jsx(Et,{label:"Height (px)",value:e.height,onChange:u=>p("height",parseInt(u)||400),small:!0})]});case"divider":return f.jsx("p",{style:{color:"var(--text3)",fontSize:12,fontStyle:"italic"},children:"A horizontal divider line. No settings needed."});case"sorting":return f.jsxs(f.Fragment,{children:[f.jsx(Et,{label:"Icon",value:e.icon,onChange:u=>p("icon",u),small:!0}),f.jsx(Et,{label:"Title",value:e.title,onChange:u=>p("title",u)}),f.jsx(Et,{label:"Instructions (optional)",value:e.instructions,onChange:u=>p("instructions",u),multiline:!0}),f.jsxs("div",{style:{display:"flex",gap:12},children:[f.jsx("div",{style:{flex:1},children:f.jsx(Et,{label:" Left Category Label",value:e.leftLabel,onChange:u=>p("leftLabel",u)})}),f.jsx("div",{style:{flex:1},children:f.jsx(Et,{label:" Right Category Label",value:e.rightLabel,onChange:u=>p("rightLabel",u)})})]}),f.jsxs("div",{className:"editor-field",children:[f.jsx("label",{children:"Items (assign each to left or right)"}),(e.items||[]).map((u,h)=>f.jsxs("div",{style:{display:"flex",gap:6,marginBottom:6,alignItems:"center"},children:[f.jsx("input",{className:"editor-input",placeholder:"Item text",value:u.text,style:{flex:1},onChange:y=>{const x=[...e.items];x[h]={...x[h],text:y.target.value},p("items",x)}}),f.jsxs("select",{value:u.correct,className:"editor-select",style:{width:120},onChange:y=>{const x=[...e.items];x[h]={...x[h],correct:y.target.value},p("items",x)},children:[f.jsxs("option",{value:"left",children:[" ",e.leftLabel||"Left"]}),f.jsxs("option",{value:"right",children:[" ",e.rightLabel||"Right"]})]}),f.jsx("button",{className:"editor-icon-btn",onClick:()=>{const y=e.items.filter((x,T)=>T!==h);p("items",y)},children:""})]},h)),f.jsx("button",{className:"editor-add-btn",onClick:()=>p("items",[...e.items||[],{text:"",correct:"left"}]),children:"+ Add item"})]})]});default:return f.jsx("p",{style:{color:"var(--text3)"},children:"Unknown block type"})}},v=bS.find(u=>u.type===e.type&&(!u.questionType||u.questionType===e.questionType))?.label||e.type;return f.jsxs("div",{className:"block-editor-card",children:[f.jsxs("div",{className:"block-editor-header",children:[f.jsx("span",{className:"block-editor-type",children:v}),f.jsxs("div",{className:"block-editor-actions",children:[!l&&f.jsx("button",{className:"editor-icon-btn",onClick:s,title:"Move up",children:""}),!i&&f.jsx("button",{className:"editor-icon-btn",onClick:a,title:"Move down",children:""}),f.jsx("button",{className:"editor-icon-btn delete",onClick:n,title:"Delete block",children:""})]})]}),f.jsx("div",{className:"block-editor-body",children:g()})]})}function Et({label:e,value:t,onChange:n,multiline:s,rows:a,placeholder:l,small:i}){return f.jsxs("div",{className:"editor-field",children:[f.jsx("label",{children:e}),s?f.jsx("textarea",{className:"editor-input",rows:a||3,value:t||"",onChange:p=>n(p.target.value),placeholder:l}):f.jsx("input",{className:"editor-input",value:t||"",onChange:p=>n(p.target.value),placeholder:l,style:i?{maxWidth:80}:void 0})]})}function a8({onInsert:e}){const[t,n]=M.useState(!1);return f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:0,margin:"2px 0"},children:[f.jsx("div",{style:{flex:1,height:1,background:t?"var(--amber)":"transparent"}}),f.jsxs("div",{style:{position:"relative"},children:[f.jsx("button",{onClick:()=>n(!t),style:{width:26,height:26,borderRadius:"50%",border:"1px solid var(--border)",background:t?"var(--amber)":"var(--surface)",color:t?"#1a1a1a":"var(--text3)",cursor:"pointer",fontSize:16,lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s"},title:"Insert block here",children:t?"":"+"}),t&&f.jsx("div",{style:{position:"absolute",top:"calc(100% + 6px)",left:"50%",transform:"translateX(-50%)",background:"var(--surface)",border:"1px solid var(--border)",borderRadius:10,boxShadow:"0 8px 30px rgba(0,0,0,0.4)",padding:8,zIndex:50,width:220,display:"flex",flexWrap:"wrap",gap:4},children:bS.map((s,a)=>f.jsxs("button",{className:"btn btn-secondary",style:{fontSize:11,padding:"4px 8px",flex:"0 0 auto"},onClick:()=>{e(s),n(!1)},children:[s.icon," ",s.label]},a))})]}),f.jsx("div",{style:{flex:1,height:1,background:t?"var(--amber)":"transparent"}})]})}function Dk(){const{userRole:e,getToken:t}=un(),n=ui(),[s,a]=Dx(),[l,i]=M.useState([]),[p,g]=M.useState(s.get("course")||null),[v,u]=M.useState([]),[h,y]=M.useState(null),[x,T]=M.useState(s.get("lesson")||null),[_,E]=M.useState([]),[R,P]=M.useState(""),[B,X]=M.useState(""),[Q,K]=M.useState(""),[k,I]=M.useState(!0),[N,U]=M.useState(null),[z,q]=M.useState(!1),[D,de]=M.useState(!1),[je,W]=M.useState(!0),[J,ve]=M.useState({}),[Se,Re]=M.useState(!1),[H,Z]=M.useState("");M.useEffect(()=>{(async()=>{const ee=await ct(Kt(it(be,"courses"),Ln("order","asc")));i(ee.docs.map(ge=>({id:ge.id,...ge.data()}))),W(!1)})()},[]),M.useEffect(()=>{if(!p){u([]);return}(async()=>{const ee=await ct(Kt(it(be,"courses",p,"lessons"),Ln("order","asc")));u(ee.docs.map(ge=>({id:ge.id,...ge.data()})))})()},[p]),M.useEffect(()=>{if(!x||v.length===0)return;const $=v.find(ee=>ee.id===x);$&&(y($.id),P($.title||""),X($.unit||""),K($.dueDate||""),I($.visible!==!1),E($.blocks||[]),de(!1)),T(null),a({},{replace:!0})},[v,x]);const te=$=>{y($.id),P($.title||""),X($.unit||""),K($.dueDate||""),I($.visible!==!1),U($.order??null),E($.blocks||[]),de(!1)},fe=()=>{y("new-"+bf()),P("New Lesson"),X(""),K(""),I(!0),U(null),E([]),de(!1)},F=($,ee)=>{const ge=[..._];ge.splice(ee,0,kk($)),E(ge),de(!1)},O=($,ee)=>{const ge=[..._];ge[$]=ee,E(ge),de(!1)},xe=$=>{E(_.filter((ee,ge)=>ge!==$)),de(!1)},Le=($,ee)=>{const ge=[..._],me=ge[$];ge[$]=ge[$+ee],ge[$+ee]=me,E(ge),de(!1)},Oe=async()=>{if(!p||!h)return;q(!0);const $=h.startsWith("new-");try{const ee=$?bf():h,ge=Fe(be,"courses",p,"lessons",ee),me={title:R,unit:B,dueDate:Q||null,visible:k,blocks:_,updatedAt:new Date};$&&(me.order=v.length),await At(ge,me,{merge:!0}),$&&y(ee),de(!0);const we=await ct(Kt(it(be,"courses",p,"lessons"),Ln("order","asc")));u(we.docs.map(Te=>({id:Te.id,...Te.data()}))),_.some(Te=>Te.type==="question"&&Te.questionType==="short_answer"&&Te.prompt&&(!Te.aiBaselines||Te.aiBaselines.length===0))&&jk(p,ee,_,t).then(Te=>{Te!==_&&E(Te)}).catch(Te=>console.warn("Baseline generation failed (non-critical):",Te))}catch(ee){console.error("Save failed:",ee),alert("Failed to save. Check the console for details.")}q(!1)},De=()=>{!p||!h||h.startsWith("new-")||(window.scrollTo(0,0),n(`/course/${p}/lesson/${h}`))},re=async()=>{if(!(!p||!h||h.startsWith("new-"))&&confirm(`Delete "${R}"? This cannot be undone.`))try{await jg(Fe(be,"courses",p,"lessons",h)),y(null),E([]),P(""),X(""),K(""),I(!0);const $=await ct(Kt(it(be,"courses",p,"lessons"),Ln("order","asc")));u($.docs.map(ee=>({id:ee.id,...ee.data()})))}catch($){console.error("Delete failed:",$),alert("Failed to delete. Check the console for details.")}},Ie=()=>{try{const $=JSON.parse(H);let ee;if(Array.isArray($))ee=$;else if($.blocks&&Array.isArray($.blocks))ee=$.blocks,$.title&&!R&&P($.title),$.unit&&!B&&X($.unit);else{alert('Invalid format. Paste a JSON array of blocks, or an object with a "blocks" array.');return}if(ee.length===0){alert("No blocks found in the JSON.");return}if(ee=ee.map(me=>({...me,id:me.id||bf()})),!(_.length>0?confirm(`This will replace the current ${_.length} blocks with ${ee.length} imported blocks. Continue?`):!0))return;E(ee),de(!1),Re(!1),Z("")}catch($){alert("Invalid JSON: "+$.message)}},Xe=async($,ee)=>{const ge=v[$],me=v[ee];if(!(!ge||!me))try{const we=[...v];we[$]=me,we[ee]=ge;const Ce=[];for(let Pe=0;Pe<we.length;Pe++)we[Pe].order!==Pe&&Ce.push(At(Fe(be,"courses",p,"lessons",we[Pe].id),{order:Pe},{merge:!0}));Ce.length?await Promise.all(Ce):(await At(Fe(be,"courses",p,"lessons",ge.id),{order:ee},{merge:!0}),await At(Fe(be,"courses",p,"lessons",me.id),{order:$},{merge:!0}));const Te=await ct(Kt(it(be,"courses",p,"lessons"),Ln("order","asc")));u(Te.docs.map(Pe=>({id:Pe.id,...Pe.data()})))}catch(we){console.error("Reorder failed:",we)}},se=$=>{ve(ee=>({...ee,[$]:!ee[$]}))},Ue=(()=>{const $=[];let ee=null,ge=null;for(const me of v){const we=me.unit||"";we!==ee&&(ee=we,ge={unit:we,lessons:[]},$.push(ge)),ge.lessons.push(me)}return $})();return e!=="teacher"?f.jsx("div",{className:"page-container",style:{textAlign:"center",paddingTop:120},children:f.jsx("h2",{style:{fontFamily:"var(--font-display)"},children:"Teacher access only"})}):f.jsxs("div",{className:"page-container",style:{display:"flex",height:"calc(100vh - 62px)"},children:[f.jsxs("div",{style:{width:260,borderRight:"1px solid var(--border)",padding:20,overflowY:"auto",background:"var(--surface)",flexShrink:0},children:[f.jsx("h3",{style:{fontFamily:"var(--font-display)",fontSize:16,marginBottom:16},children:"Courses"}),je?f.jsx("div",{className:"spinner"}):l.length===0?f.jsx("p",{style:{color:"var(--text3)",fontSize:13},children:"No courses yet. Create one in Firestore to get started."}):f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:l.map($=>f.jsxs("button",{className:`top-nav-link ${p===$.id?"active":""}`,style:{textAlign:"left"},onClick:()=>{g($.id),y(null)},children:[$.icon||""," ",$.title]},$.id))}),p&&f.jsxs(f.Fragment,{children:[f.jsx("h3",{style:{fontFamily:"var(--font-display)",fontSize:16,marginTop:28,marginBottom:12},children:"Lessons"}),f.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[Ue.map($=>{const ee=$.unit.trim()!=="",ge=ee&&J[$.unit];return f.jsxs("div",{children:[ee&&f.jsxs("button",{onClick:()=>se($.unit),style:{display:"flex",alignItems:"center",gap:6,width:"100%",padding:"6px 8px",marginTop:8,marginBottom:2,background:"none",border:"none",cursor:"pointer",fontSize:11,fontWeight:700,color:"var(--amber)",textTransform:"uppercase",letterSpacing:"0.06em",textAlign:"left"},children:[f.jsx("span",{style:{transition:"transform 0.15s",transform:ge?"rotate(-90deg)":"rotate(0deg)",display:"inline-block",fontSize:10},children:""}),f.jsx("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:$.unit}),f.jsx("span",{style:{color:"var(--text3)",fontWeight:400,fontSize:10},children:$.lessons.length})]}),!ge&&$.lessons.map(me=>{const we=v.indexOf(me),Ce=me.dueDate&&new Date(me.dueDate+"T23:59:59")<new Date,Te=me.visible===!1;return f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:2,paddingLeft:ee?12:0,opacity:Te?.5:1},children:[f.jsxs("button",{className:`top-nav-link ${h===me.id?"active":""}`,style:{textAlign:"left",fontSize:12,flex:1},onClick:()=>te(me),children:[f.jsxs("span",{children:[Te?" ":"",me.title]}),me.dueDate&&f.jsxs("span",{style:{display:"block",fontSize:10,marginTop:1,color:Ce?"var(--red)":"var(--text3)"},children:["Due ",new Date(me.dueDate+"T00:00:00").toLocaleDateString(void 0,{month:"short",day:"numeric"})]})]}),f.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:0},children:[we>0&&f.jsx("button",{className:"editor-icon-btn",style:{fontSize:9,padding:"0 3px",lineHeight:1},title:"Move up",onClick:()=>Xe(we,we-1),children:""}),we<v.length-1&&f.jsx("button",{className:"editor-icon-btn",style:{fontSize:9,padding:"0 3px",lineHeight:1},title:"Move down",onClick:()=>Xe(we,we+1),children:""})]})]},me.id)})]},$.unit||"__no_unit__")}),f.jsx("button",{className:"editor-add-btn",style:{marginTop:8},onClick:fe,children:"+ New Lesson"})]})]})]}),f.jsx("div",{style:{flex:1,overflowY:"auto",padding:"32px 40px"},children:h?f.jsxs(f.Fragment,{children:[f.jsxs("div",{style:{marginBottom:16,display:"flex",gap:12,alignItems:"flex-end"},children:[f.jsxs("div",{style:{flex:1},children:[f.jsx("label",{style:{fontSize:12,color:"var(--text3)",display:"block",marginBottom:4},children:"Lesson Title"}),f.jsx("input",{className:"editor-input",value:R,onChange:$=>{P($.target.value),de(!1)},style:{fontSize:22,fontFamily:"var(--font-display)",fontWeight:700,padding:"8px 12px",border:"1.5px solid var(--amber)"}})]}),f.jsxs("div",{children:[f.jsx("label",{style:{fontSize:12,color:"var(--text3)",display:"block",marginBottom:4},children:"Unit / Section"}),f.jsx("input",{className:"editor-input",value:B,onChange:$=>{X($.target.value),de(!1)},style:{width:200,border:"1.5px solid var(--amber)"}})]}),f.jsxs("div",{children:[f.jsx("label",{style:{fontSize:12,color:"var(--text3)",display:"block",marginBottom:4},children:"Due Date"}),f.jsx("input",{type:"date",className:"editor-input",value:Q,onChange:$=>{K($.target.value),de(!1)},style:{width:150,border:"1.5px solid var(--amber)"}})]})]}),f.jsxs("div",{style:{marginBottom:32,display:"flex",gap:10,alignItems:"center"},children:[f.jsx("button",{className:"btn btn-primary",onClick:Oe,disabled:z,children:z?"Saving...":D?" Saved":"Save Lesson"}),f.jsx("button",{className:"btn btn-secondary",onClick:()=>{I(!k),de(!1)},title:k?"Lesson is visible to students  click to hide":"Lesson is hidden from students  click to show",style:{display:"flex",alignItems:"center",gap:6,color:k?"var(--green)":"var(--text3)",borderColor:k?"var(--green)":"var(--border)"},children:k?" Visible":" Hidden"}),h&&!h.startsWith("new-")&&f.jsx("button",{className:"btn btn-secondary",onClick:De,title:"Preview this lesson as a student",style:{display:"flex",alignItems:"center",gap:6},children:" Preview"}),f.jsx("button",{className:"btn btn-secondary",onClick:()=>Re(!0),title:"Import blocks from a JSON array",style:{display:"flex",alignItems:"center",gap:6},children:" Paste JSON"}),f.jsx("div",{style:{flex:1}}),h&&!h.startsWith("new-")&&f.jsx("button",{className:"btn btn-secondary",onClick:re,title:"Delete this lesson",style:{color:"var(--red)",borderColor:"var(--red)"},children:" Delete"})]}),f.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[f.jsx(a8,{onInsert:$=>F($,0)}),_.map(($,ee)=>f.jsxs("div",{children:[f.jsx(Ik,{block:$,onChange:ge=>O(ee,ge),onDelete:()=>xe(ee),onMoveUp:()=>Le(ee,-1),onMoveDown:()=>Le(ee,1),isFirst:ee===0,isLast:ee===_.length-1}),f.jsx(a8,{onInsert:ge=>F(ge,ee+1)})]},$.id))]})]}):f.jsx("div",{style:{textAlign:"center",paddingTop:100,color:"var(--text3)"},children:f.jsx("p",{style:{fontSize:18},children:"Select a course and lesson to edit, or create a new one."})})}),Se&&f.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",zIndex:999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>Re(!1),children:f.jsxs("div",{style:{background:"var(--surface)",border:"1px solid var(--border)",borderRadius:16,padding:28,width:600,maxHeight:"80vh",display:"flex",flexDirection:"column",gap:16,boxShadow:"0 20px 60px rgba(0,0,0,0.5)"},onClick:$=>$.stopPropagation(),children:[f.jsx("h3",{style:{fontFamily:"var(--font-display)",margin:0},children:" Import Blocks from JSON"}),f.jsxs("p",{style:{color:"var(--text2)",fontSize:13,margin:0},children:["Paste a JSON array of blocks, or an object with ",f.jsxs("code",{style:{background:"var(--surface2)",padding:"2px 6px",borderRadius:4},children:["{",' "title", "unit", "blocks": [...] ',"}"]}),". The title and unit will auto-fill if the current fields are empty."]}),f.jsx("textarea",{value:H,onChange:$=>Z($.target.value),placeholder:'[{"type":"section_header","icon":"","title":"My Section"}, ...]',style:{flex:1,minHeight:260,fontFamily:"monospace",fontSize:12,background:"var(--surface2)",color:"var(--text)",border:"1.5px solid var(--border)",borderRadius:10,padding:14,resize:"vertical"}}),f.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[f.jsx("button",{className:"btn btn-secondary",onClick:()=>{Re(!1),Z("")},children:"Cancel"}),f.jsxs("button",{className:"btn btn-primary",onClick:Ie,disabled:!H.trim(),children:["Import ",H.trim()?(()=>{try{const $=JSON.parse(H),ee=Array.isArray($)?$:$.blocks;return ee?`(${ee.length} blocks)`:""}catch{return""}})():""]})]})]})})]})}const Nk=["it's important to note that","it is important to note","it's worth noting that","it is worth mentioning","it should be noted","in today's world","in today's society","in today's digital age","in the realm of","in the world of","it's crucial to","it is essential to","it is important to understand","moreover","furthermore","additionally","in conclusion","to summarize","in summary","first and foremost","last but not least","on the other hand","having said that","a myriad of","a plethora of","a wide range of","a variety of factors","multifaceted","encompasses a wide","plays a crucial role","plays a vital role","serves as a testament","is a testament to","in this rapidly evolving","as we move forward","as technology continues to evolve","the landscape of","navigate the complexities","foster a deeper understanding","holistic approach","paradigm shift","leverage the power","delve into","tapestry","bustling","underscores the importance","crucial role in shaping","pivotal role","nuanced understanding","intricate interplay","ever-evolving landscape"],Lk=["however","therefore","consequently","nevertheless","significantly","ultimately","essentially","fundamentally","specifically","particularly"];function Pk(e){const t=e.toLowerCase(),n=Nk.filter(g=>t.includes(g)),s=Lk.filter(g=>{const v=new RegExp(`(?:^|\\. )${g}\\b`,"gi");return(t.match(v)||[]).length>=1}),a=e.split(/\s+/).length,l=n.length*3,i=s.length*.5,p=(l+i)/Math.max(a/50,1);return{score:Math.min(p/5,1),matches:[...n,...s.map(g=>`(${g})`)]}}function zk(e){const t=e.split(/[.!?]+/).map(g=>g.trim()).filter(g=>g.length>5);if(t.length<3)return{score:0,avgLength:0,stdDev:0};const n=t.map(g=>g.split(/\s+/).length),s=n.reduce((g,v)=>g+v,0)/n.length,a=n.reduce((g,v)=>g+(v-s)**2,0)/n.length,l=Math.sqrt(a),i=s>0?l/s:0;let p=0;return i<.2?p=.9:i<.3?p=.6:i<.4?p=.3:p=0,{score:p,avgLength:Math.round(s),stdDev:Math.round(l*10)/10}}function Ok(e){const t=e.toLowerCase().match(/\b[a-z]+\b/g)||[];if(t.length<20)return{score:0,uniqueRatio:0};const s=new Set(t).size/t.length;let a=0;return s>.75?a=.7:s>.68?a=.4:s>.63&&(a=.2),{score:a,uniqueRatio:Math.round(s*100)/100}}function Vk(e){const t=[],n=e.split(`
`).filter(v=>v.trim()),s=n.filter(v=>/^\s*\d+[\.\)]\s/.test(v));s.length>=3&&t.push(`${s.length} numbered items`);const a=n.filter(v=>/^\s*[-*]\s/.test(v));a.length>=3&&t.push(`${a.length} bullet points`);const l=n.filter(v=>/^#{1,3}\s|^[A-Z][A-Za-z\s]+:$/.test(v.trim()));l.length>=2&&t.push(`${l.length} headers/sections`);const i=e.split(/\s+/).length;i>300&&t.push(`${i} words (unusually long)`);const p=e.split(/\n\s*\n/).filter(v=>v.trim().length>20);if(p.length>=3){const v=p.map(y=>y.split(/\s+/).length),u=v.reduce((y,x)=>y+x,0)/v.length,h=Math.sqrt(v.reduce((y,x)=>y+(x-u)**2,0)/v.length);u>0&&h/u<.25&&t.push("uniform paragraph lengths")}return{score:Math.min(t.length/3,1),signals:t}}function Bk(e,t,n){const s=[];let a=0;const l=e.split(/\s+/).length;if(t&&n){const i=(new Date(t)-new Date(n))/1e3,p=l/Math.max(i,1);p>5&&l>30?(s.push(`submitted ${l} words in ${Math.round(i)}s (likely pasted)`),a+=.5):p>2&&l>50&&(s.push("fast submission speed"),a+=.3)}return l>250&&(s.push(`${l} words (above typical student range)`),a+=.2),{score:Math.min(a,1),signals:s}}function Uk(e,t){if(!t||t.length<2)return{score:0,signals:[]};const n=[];let s=0;const a=e.split(/\s+/).length,i=new Set(e.toLowerCase().match(/\b[a-z]+\b/g)||[]).size/Math.max(a,1),p=t.map(u=>{const h=u.split(/\s+/).length,y=new Set(u.toLowerCase().match(/\b[a-z]+\b/g)||[]).size;return{words:h,ratio:y/Math.max(h,1)}}),g=p.reduce((u,h)=>u+h.words,0)/p.length,v=p.reduce((u,h)=>u+h.ratio,0)/p.length;return a>g*3&&a>50&&(n.push(`${a} words vs avg ${Math.round(g)} (${Math.round(a/g)}x longer)`),s+=.4),i>v*1.3&&i>.6&&(n.push("vocabulary complexity jump"),s+=.3),{score:Math.min(s,1),signals:n}}function qk(e,t={}){if(!e||e.trim().length<20)return{overallScore:0,risk:"none",label:"",color:"",details:[],flags:[]};const n=Pk(e),s=zk(e),a=Ok(e),l=Vk(e),i=Bk(e,t.submittedAt,t.startedAt),p=Uk(e,t.previousResponses);let g={score:0,bestMatch:null,details:[]};t.aiBaselines&&t.aiBaselines.length>0&&t.compareToBaselines&&(g=t.compareToBaselines(e,t.aiBaselines));const v=g.score>0,u=v?{phrases:.15,uniformity:.1,vocab:.05,structure:.1,behavior:.1,history:.1,baseline:.4}:{phrases:.3,uniformity:.15,vocab:.1,structure:.15,behavior:.15,history:.15,baseline:0},h=n.score*u.phrases+s.score*u.uniformity+a.score*u.vocab+l.score*u.structure+i.score*u.behavior+p.score*u.history+g.score*u.baseline,y=[];g.bestMatch&&g.score>.2&&y.push(`${Math.round(g.bestMatch.similarity*100)}% match to ${g.bestMatch.provider} baseline`),n.matches.length>0&&y.push(...n.matches.slice(0,5).map(R=>`AI phrase: "${R}"`)),s.score>.5&&y.push(`Uniform sentence length (avg ${s.avgLength} words, =${s.stdDev})`),a.score>.3&&y.push(`High vocabulary diversity (${a.uniqueRatio})`),l.signals.length>0&&y.push(...l.signals.map(R=>`Structure: ${R}`)),i.signals.length>0&&y.push(...i.signals),p.signals.length>0&&y.push(...p.signals.map(R=>`vs history: ${R}`));let x,T,_;h>=.6?(x="high",T=" Likely AI-generated",_="var(--red)"):h>=.35?(x="medium",T=" Some AI indicators",_="var(--amber)"):h>=.15?(x="low",T=" Minor flags",_="var(--text3)"):(x="none",T="",_="");const E=[{name:"AI Phrases",score:n.score,weight:u.phrases},{name:"Sentence Uniformity",score:s.score,weight:u.uniformity},{name:"Vocabulary",score:a.score,weight:u.vocab},{name:"Structure",score:l.score,weight:u.structure},{name:"Behavior",score:i.score,weight:u.behavior},{name:"vs History",score:p.score,weight:u.history}];return v&&E.unshift({name:"AI Baseline Match",score:g.score,weight:u.baseline}),{overallScore:Math.round(h*100)/100,risk:x,label:T,color:_,details:E,flags:y,baselineDetails:g.details}}function Hk(){const{userRole:e}=un(),[t,n]=M.useState([]),[s,a]=M.useState([]),[l,i]=M.useState({}),[p,g]=M.useState({}),[v,u]=M.useState(!0),[h,y]=M.useState("written"),[x,T]=M.useState(null),[_,E]=M.useState(""),[R,P]=M.useState("recent"),[B,X]=M.useState([]),[Q,K]=M.useState(null),[k,I]=M.useState(null),[N,U]=M.useState(null),[z,q]=M.useState(null);if(M.useEffect(()=>{if(e!=="teacher")return;(async()=>{try{const Ue=await ct(it(be,"users")),$={};Ue.forEach(Pe=>{const Ge=Pe.data();$[Pe.id]={displayName:Ge.displayName||Ge.email||Pe.id,email:Ge.email||"",photoURL:Ge.photoURL||""}}),i($);const ee=await ct(it(be,"courses")),ge=ee.docs.map(Pe=>({id:Pe.id,...Pe.data()}));X(ge),ge.length>0&&!Q&&K(ge[0].id);const me={};for(const Pe of ee.docs){const Ge=Pe.data();(await ct(Kt(it(be,"courses",Pe.id,"lessons"),Ln("order","asc")))).forEach(ze=>{const Je=ze.data();me[ze.id]={title:Je.title||ze.id,courseTitle:Ge.title||Pe.id,blocks:Je.blocks||[]}})}g(me);const we=await ct(Rj(be,"lessons")),Ce=[];we.forEach(Pe=>{const Ge=Pe.data();Ge.answers&&Object.entries(Ge.answers).forEach(([ce,ze])=>{if(ze.needsGrading&&ze.submitted){const Je=Pe.ref.path.split("/"),dt=Je.indexOf("courses"),nt=dt>=0?Je[dt+1]:"";Ce.push({id:`${Pe.ref.path}-${ce}`,studentId:Pe.ref.parent.parent.parent.parent.id,lessonId:Pe.id,courseId:nt,blockId:ce,answer:ze.answer,submittedAt:ze.submittedAt,path:Pe.ref.path})}})}),n(Ce);const Te=[];for(const Pe of ee.docs){const Ge=Pe.id;let ce;try{ce=await ct(it(be,"courses",Ge,"chatLogs"))}catch{continue}for(const ze of ce.docs){const Je=ze.id,nt=(me[Je]?.blocks||[]).filter(Vt=>Vt.type==="chatbot");for(const Vt of nt){const nn=Vt.id;let Wn;try{Wn=await ct(it(be,"courses",Ge,"chatLogs",Je,nn))}catch{continue}Wn.forEach(Ft=>{const Ne=Ft.data();Ne.messages&&Ne.messages.length>0&&Te.push({id:`${Ge}-${Je}-${nn}-${Ft.id}`,studentId:Ft.id,courseId:Ge,lessonId:Je,blockId:nn,blockTitle:Vt.title||nn,messages:Ne.messages,messageCount:Ne.messageCount||Ne.messages.filter(ke=>ke.role==="user").length,lastUpdated:Ne.lastUpdated?.toDate?.()||new Date})})}}}a(Te)}catch(Ue){console.error("Error fetching grading data:",Ue)}u(!1)})()},[e]),e!=="teacher")return f.jsxs("div",{className:"page-container",style:{textAlign:"center",paddingTop:120},children:[f.jsx("h2",{style:{fontFamily:"var(--font-display)"},children:"Teacher access only"}),f.jsx("p",{style:{color:"var(--text2)",marginTop:8},children:"This page is only available to teachers."})]});const D=se=>l[se]?.displayName||se.slice(0,8)+"...",de=se=>l[se]?.email||"",je=se=>l[se]?.photoURL||"",W=se=>p[se]?.title||se,J=(se,Ue)=>{const ee=(p[se]?.blocks||[]).find(ge=>ge.id===Ue);return ee?.prompt||ee?.title||Ue},ve=se=>{if(!se)return"";const $=new Date-se;return $<6e4?"just now":$<36e5?`${Math.floor($/6e4)}m ago`:$<864e5?`${Math.floor($/36e5)}h ago`:se.toLocaleDateString("en-US",{month:"short",day:"numeric"})},Se=t.filter(se=>se.courseId===Q),Re=s.filter(se=>se.courseId===Q),H=[...new Set([...Se.map(se=>se.lessonId),...Re.map(se=>se.lessonId)])],Z=Se.length,te=Re.length,fe=Re.reduce((se,Ue)=>se+Ue.messageCount,0),F=se=>[...se.filter($=>{if(!_)return!0;const ee=_.toLowerCase(),ge=D($.studentId).toLowerCase(),me=de($.studentId).toLowerCase(),we=W($.lessonId).toLowerCase(),Ce=$.blockTitle.toLowerCase(),Te=$.messages.some(Pe=>Pe.content.toLowerCase().includes(ee));return ge.includes(ee)||me.includes(ee)||we.includes(ee)||Ce.includes(ee)||Te})].sort(($,ee)=>R==="recent"?ee.lastUpdated-$.lastUpdated:R==="messages"?ee.messageCount-$.messageCount:R==="student"?D($.studentId).localeCompare(D(ee.studentId)):0),O=B.find(se=>se.id===Q),xe=k?W(k):null,Le=N?D(N):null,Oe=N?"student":k?"lesson":"course",De=()=>f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,color:"var(--text3)",marginBottom:20,flexWrap:"wrap"},children:[f.jsxs("button",{onClick:()=>{I(null),U(null)},style:{background:"none",border:"none",color:Oe==="course"?"var(--text)":"var(--amber)",cursor:"pointer",fontFamily:"var(--font-body)",fontSize:13,padding:0,fontWeight:600},children:[O?.icon," ",O?.title||"Course"]}),k&&f.jsxs(f.Fragment,{children:[f.jsx("span",{style:{color:"var(--text3)"},children:""}),f.jsx("button",{onClick:()=>{U(null)},style:{background:"none",border:"none",color:Oe==="lesson"?"var(--text)":"var(--amber)",cursor:"pointer",fontFamily:"var(--font-body)",fontSize:13,padding:0,fontWeight:600},children:xe})]}),N&&f.jsxs(f.Fragment,{children:[f.jsx("span",{style:{color:"var(--text3)"},children:""}),f.jsx("span",{style:{color:"var(--text)",fontWeight:600},children:Le})]})]}),re=se=>{const Ue=x===se.id,$=je(se.studentId),ee=[...se.messages].reverse().find(ge=>ge.role==="user");return f.jsxs("div",{className:"card",style:{padding:0,overflow:"hidden",borderColor:Ue?"rgba(245,166,35,0.3)":void 0},children:[f.jsxs("div",{onClick:()=>T(Ue?null:se.id),style:{display:"flex",alignItems:"center",gap:14,padding:"16px 20px",cursor:"pointer",transition:"background 0.15s"},onMouseEnter:ge=>ge.currentTarget.style.background="var(--surface2)",onMouseLeave:ge=>ge.currentTarget.style.background="transparent",children:[$?f.jsx("img",{src:$,alt:"",style:{width:36,height:36,borderRadius:"50%",border:"2px solid var(--border)",flexShrink:0}}):f.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:"var(--surface2)",border:"2px solid var(--border)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,color:"var(--text3)",flexShrink:0},children:""}),f.jsxs("div",{style:{flex:1,minWidth:0},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:2},children:[f.jsx("span",{style:{fontWeight:600,fontSize:14},children:D(se.studentId)}),f.jsxs("span",{style:{fontSize:11,color:"var(--text3)",padding:"1px 8px",background:"var(--surface2)",borderRadius:4},children:[se.messageCount," ",se.messageCount===1?"message":"messages"]})]}),f.jsxs("div",{style:{fontSize:12,color:"var(--text3)",display:"flex",gap:6,flexWrap:"wrap"},children:[f.jsx("span",{children:W(se.lessonId)}),f.jsx("span",{style:{color:"var(--border)"},children:""}),f.jsx("span",{style:{color:"var(--cyan)"},children:se.blockTitle})]}),!Ue&&ee&&f.jsxs("div",{style:{fontSize:13,color:"var(--text2)",marginTop:6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:['"',ee.content,'"']})]}),f.jsxs("div",{style:{textAlign:"right",flexShrink:0},children:[f.jsx("div",{style:{fontSize:12,color:"var(--text3)"},children:ve(se.lastUpdated)}),f.jsx("div",{style:{fontSize:16,color:"var(--text3)",marginTop:4,transition:"transform 0.2s",transform:Ue?"rotate(180deg)":"rotate(0deg)"},children:""})]})]}),Ue&&f.jsxs("div",{style:{borderTop:"1px solid var(--border)",background:"var(--bg)"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 20px",borderBottom:"1px solid var(--border)",fontSize:12,color:"var(--text3)"},children:[f.jsxs("span",{children:[de(se.studentId),"  ",se.messages.length," total messages"]}),f.jsxs("span",{children:["Last active: ",se.lastUpdated?.toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]})]}),f.jsx("div",{style:{padding:"16px 20px",maxHeight:500,overflowY:"auto",display:"flex",flexDirection:"column",gap:14},children:se.messages.map((ge,me)=>f.jsxs("div",{style:{display:"flex",flexDirection:ge.role==="user"?"row-reverse":"row",gap:10},children:[f.jsx("div",{style:{fontSize:16,flexShrink:0,marginTop:4},children:ge.role==="assistant"?"":""}),f.jsxs("div",{style:{maxWidth:"80%",padding:"10px 14px",borderRadius:12,fontSize:14,lineHeight:1.65,background:ge.role==="user"?"var(--amber-dim)":"var(--surface)",border:ge.role==="user"?"1px solid rgba(245,166,35,0.15)":"1px solid var(--border)"},children:[f.jsx("div",{style:{fontSize:10,fontWeight:700,color:"var(--text3)",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:3},children:ge.role==="assistant"?"AI":D(se.studentId)}),f.jsx("div",{className:"chat-text",dangerouslySetInnerHTML:{__html:typeof ro=="function"?ro(ge.content):ge.content}})]})]},me))})]})]},se.id)},Ie=(se,Ue)=>t.filter($=>$.studentId===se&&$.id!==Ue&&$.answer).map($=>$.answer),Xe=se=>{const Ue=Ie(se.studentId,se.id),ge=(p[se.lessonId]?.blocks||[]).find(Ce=>Ce.id===se.blockId)?.aiBaselines||[],me=qk(se.answer,{submittedAt:se.submittedAt,previousResponses:Ue,aiBaselines:ge,compareToBaselines:Rk}),we=z===se.id;return f.jsxs("div",{className:"card",style:{padding:"16px 20px",borderColor:me.risk==="high"?"rgba(239,68,68,0.25)":me.risk==="medium"?"rgba(245,166,35,0.25)":void 0},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[je(se.studentId)?f.jsx("img",{src:je(se.studentId),alt:"",style:{width:28,height:28,borderRadius:"50%",border:"1px solid var(--border)"}}):f.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:"var(--surface2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"var(--text3)"},children:""}),f.jsxs("div",{children:[f.jsx("span",{style:{fontWeight:600,fontSize:14,cursor:"pointer",color:"var(--text)"},onClick:()=>{U(se.studentId),k||I(se.lessonId)},children:D(se.studentId)}),f.jsx("div",{style:{fontSize:11,color:"var(--text3)"},children:de(se.studentId)})]})]}),f.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[me.risk!=="none"&&f.jsx("span",{onClick:Ce=>{Ce.stopPropagation(),q(we?null:se.id)},style:{fontSize:11,padding:"2px 10px",borderRadius:4,fontWeight:600,cursor:"pointer",background:me.risk==="high"?"var(--red-dim)":me.risk==="medium"?"var(--amber-dim)":"var(--surface2)",color:me.color,transition:"opacity 0.15s"},title:"Click for details",children:me.label}),f.jsx("span",{style:{fontSize:11,padding:"2px 10px",borderRadius:4,background:"var(--blue-dim)",color:"var(--blue)",fontWeight:600},children:"Needs review"})]})]}),we&&me.risk!=="none"&&f.jsxs("div",{style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:"12px 16px",marginBottom:12},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[f.jsx("span",{style:{fontSize:12,fontWeight:700,color:"var(--text2)"},children:"AI Detection Analysis"}),f.jsxs("span",{style:{fontSize:11,color:"var(--text3)"},children:["Confidence: ",Math.round(me.overallScore*100),"%"]})]}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6,marginBottom:12},children:me.details.filter(Ce=>Ce.score>0).map(Ce=>f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[f.jsx("span",{style:{fontSize:11,color:"var(--text3)",width:130,flexShrink:0},children:Ce.name}),f.jsx("div",{style:{flex:1,height:6,background:"var(--surface2)",borderRadius:3,overflow:"hidden"},children:f.jsx("div",{style:{width:`${Ce.score*100}%`,height:"100%",borderRadius:3,background:Ce.score>.6?"var(--red)":Ce.score>.3?"var(--amber)":"var(--text3)",transition:"width 0.3s"}})}),f.jsx("span",{style:{fontSize:10,color:"var(--text3)",width:28,textAlign:"right"},children:Math.round(Ce.score*100)})]},Ce.name))}),me.flags.length>0&&f.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4},children:me.flags.map((Ce,Te)=>f.jsx("span",{style:{fontSize:10,padding:"2px 8px",borderRadius:4,background:"var(--surface2)",color:"var(--text2)",border:"1px solid var(--border)"},children:Ce},Te))}),f.jsxs("div",{style:{marginTop:10,display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:10,color:"var(--text3)",fontStyle:"italic"},children:[f.jsx("span",{children:"Heuristic analysis only  not definitive. Use as a starting point for conversation with the student."}),ge.length>0?f.jsxs("span",{style:{fontStyle:"normal",color:"var(--green)",fontWeight:600},children:[" AI baselines active (",ge.map(Ce=>Ce.provider).join(", "),")"]}):f.jsx("span",{style:{fontStyle:"normal",color:"var(--text3)"},children:" No AI baselines  re-save lesson to generate"})]})]}),f.jsx("div",{style:{fontSize:12,color:"var(--text3)",marginBottom:8},children:J(se.lessonId,se.blockId)}),f.jsx("div",{style:{background:"var(--bg)",borderRadius:8,padding:14,fontSize:15,lineHeight:1.6,marginBottom:12,border:"1px solid var(--border)"},children:se.answer}),se.submittedAt&&f.jsxs("div",{style:{fontSize:11,color:"var(--text3)"},children:["Submitted ",new Date(se.submittedAt).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]})]},se.id)};return f.jsx("div",{className:"page-container",style:{padding:"48px 40px"},children:f.jsxs("div",{style:{maxWidth:1100,margin:"0 auto"},children:[f.jsx("h1",{style:{fontFamily:"var(--font-display)",fontSize:32,fontWeight:700,marginBottom:8},children:"Grading Dashboard"}),f.jsx("p",{style:{color:"var(--text2)",fontSize:15,marginBottom:28},children:"Review student written responses and AI chat activity."}),v?f.jsx("div",{style:{display:"flex",justifyContent:"center",padding:60},children:f.jsx("div",{className:"spinner"})}):f.jsxs(f.Fragment,{children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:12,marginBottom:24},children:[f.jsx("div",{style:{display:"flex",gap:4,background:"var(--bg)",borderRadius:8,padding:3,width:"fit-content"},children:B.map(se=>f.jsxs("button",{className:`top-nav-link ${Q===se.id?"active":""}`,onClick:()=>{K(se.id),I(null),U(null)},children:[se.icon," ",se.title]},se.id))}),f.jsxs("div",{style:{display:"flex",gap:4,background:"var(--bg)",borderRadius:8,padding:3,width:"fit-content"},children:[f.jsxs("button",{className:`top-nav-link ${h==="written"?"active":""}`,onClick:()=>{y("written"),I(null),U(null)},children:[" Written (",Z,")"]}),f.jsxs("button",{className:`top-nav-link ${h==="chats"?"active":""}`,onClick:()=>{y("chats"),I(null),U(null)},children:[" Chats (",te,")"]})]})]}),(k||N)&&De(),Oe==="student"?(()=>{const se=Se.filter(ee=>ee.studentId===N),Ue=Re.filter(ee=>ee.studentId===N),$=je(N);return f.jsxs("div",{children:[f.jsxs("div",{className:"card",style:{display:"flex",alignItems:"center",gap:16,padding:"20px 24px",marginBottom:24},children:[$?f.jsx("img",{src:$,alt:"",style:{width:48,height:48,borderRadius:"50%",border:"2px solid var(--border)"}}):f.jsx("div",{style:{width:48,height:48,borderRadius:"50%",background:"var(--surface2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,color:"var(--text3)"},children:""}),f.jsxs("div",{style:{flex:1},children:[f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:20,fontWeight:700},children:Le}),f.jsx("div",{style:{fontSize:13,color:"var(--text3)"},children:de(N)})]}),f.jsxs("div",{style:{display:"flex",gap:20,textAlign:"center"},children:[f.jsxs("div",{children:[f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:22,fontWeight:700,color:"var(--amber)"},children:se.length}),f.jsx("div",{style:{fontSize:10,color:"var(--text3)",textTransform:"uppercase",fontWeight:600},children:"Written"})]}),f.jsxs("div",{children:[f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:22,fontWeight:700,color:"var(--cyan)"},children:Ue.length}),f.jsx("div",{style:{fontSize:10,color:"var(--text3)",textTransform:"uppercase",fontWeight:600},children:"Chats"})]})]})]}),h==="written"?f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:se.length===0?f.jsx("div",{className:"card",style:{textAlign:"center",padding:40,color:"var(--text3)"},children:"No written responses from this student"}):se.map(Xe)}):f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Ue.length===0?f.jsx("div",{className:"card",style:{textAlign:"center",padding:40,color:"var(--text3)"},children:"No chat conversations from this student"}):Ue.map(re)})]})})():Oe==="lesson"?(()=>{const se=Se.filter(ee=>ee.lessonId===k),Ue=Re.filter(ee=>ee.lessonId===k),$=[...new Set([...se.map(ee=>ee.studentId),...Ue.map(ee=>ee.studentId)])];return f.jsxs("div",{children:[f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12,marginBottom:24},children:[{label:"Written Responses",value:se.length,color:"var(--amber)"},{label:"Chat Conversations",value:Ue.length,color:"var(--cyan)"},{label:"Students",value:$.length,color:"var(--green)"}].map(ee=>f.jsxs("div",{className:"card",style:{textAlign:"center",padding:"16px 12px"},children:[f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:24,fontWeight:700,color:ee.color},children:ee.value}),f.jsx("div",{style:{fontSize:10,fontWeight:600,color:"var(--text3)",textTransform:"uppercase",letterSpacing:"0.08em",marginTop:2},children:ee.label})]},ee.label))}),f.jsx("h3",{style:{fontFamily:"var(--font-display)",fontSize:16,fontWeight:600,color:"var(--text2)",marginBottom:12},children:"Students"}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6,marginBottom:24},children:$.map(ee=>{const ge=se.filter(Ce=>Ce.studentId===ee).length,me=Ue.filter(Ce=>Ce.studentId===ee).length,we=je(ee);return f.jsxs("div",{className:"card",style:{display:"flex",alignItems:"center",gap:14,padding:"12px 20px",cursor:"pointer"},onClick:()=>U(ee),onMouseEnter:Ce=>Ce.currentTarget.style.borderColor="var(--amber)",onMouseLeave:Ce=>Ce.currentTarget.style.borderColor="var(--border)",children:[we?f.jsx("img",{src:we,alt:"",style:{width:32,height:32,borderRadius:"50%",border:"1px solid var(--border)"}}):f.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"var(--surface2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,color:"var(--text3)"},children:""}),f.jsxs("div",{style:{flex:1},children:[f.jsx("div",{style:{fontWeight:600,fontSize:14},children:D(ee)}),f.jsx("div",{style:{fontSize:11,color:"var(--text3)"},children:de(ee)})]}),f.jsxs("div",{style:{display:"flex",gap:16,fontSize:12},children:[ge>0&&f.jsxs("span",{style:{color:"var(--amber)",fontWeight:600},children:[" ",ge]}),me>0&&f.jsxs("span",{style:{color:"var(--cyan)",fontWeight:600},children:[" ",me]})]})]},ee)})}),h==="written"?f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:se.length===0?f.jsx("div",{className:"card",style:{textAlign:"center",padding:40,color:"var(--text3)"},children:"No written responses for this lesson"}):se.map(Xe)}):f.jsxs("div",{children:[f.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16,alignItems:"center"},children:[f.jsxs("div",{style:{flex:1,minWidth:200,position:"relative"},children:[f.jsx("span",{style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:"var(--text3)",fontSize:14,pointerEvents:"none"},children:""}),f.jsx("input",{type:"text",placeholder:"Search conversations...",value:_,onChange:ee=>E(ee.target.value),style:{width:"100%",padding:"10px 14px 10px 36px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:14,outline:"none"},onFocus:ee=>ee.target.style.borderColor="var(--amber)",onBlur:ee=>ee.target.style.borderColor="var(--border)"})]}),f.jsxs("select",{value:R,onChange:ee=>P(ee.target.value),style:{padding:"10px 14px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:13},children:[f.jsx("option",{value:"recent",children:"Most Recent"}),f.jsx("option",{value:"messages",children:"Most Messages"}),f.jsx("option",{value:"student",children:"Student Name"})]})]}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:F(Ue).length===0?f.jsx("div",{className:"card",style:{textAlign:"center",padding:40,color:"var(--text3)"},children:"No chat conversations for this lesson"}):F(Ue).map(re)})]})]})})():f.jsxs("div",{children:[f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12,marginBottom:28},children:[{label:"Written Responses",value:Z,color:"var(--amber)",icon:""},{label:"Chat Conversations",value:te,color:"var(--cyan)",icon:""},{label:"Student Messages",value:fe,color:"var(--green)",icon:""}].map(se=>f.jsxs("div",{className:"card",style:{textAlign:"center",padding:"16px 12px"},children:[f.jsx("div",{style:{fontSize:18,marginBottom:4},children:se.icon}),f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:24,fontWeight:700,color:se.color},children:se.value}),f.jsx("div",{style:{fontSize:10,fontWeight:600,color:"var(--text3)",textTransform:"uppercase",letterSpacing:"0.08em",marginTop:2},children:se.label})]},se.label))}),f.jsx("h3",{style:{fontFamily:"var(--font-display)",fontSize:18,fontWeight:600,color:"var(--text2)",marginBottom:12},children:" Lessons"}),H.length===0?f.jsx("div",{className:"card",style:{textAlign:"center",padding:40,color:"var(--text3)",marginBottom:28},children:"No student submissions yet for this course"}):f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:10,marginBottom:28},children:H.map(se=>{const Ue=Se.filter(ee=>ee.lessonId===se).length,$=Re.filter(ee=>ee.lessonId===se).length;return f.jsxs("div",{className:"card",style:{cursor:"pointer",padding:"14px 16px",transition:"border-color 0.2s"},onClick:()=>I(se),onMouseEnter:ee=>ee.currentTarget.style.borderColor="var(--amber)",onMouseLeave:ee=>ee.currentTarget.style.borderColor="var(--border)",children:[f.jsx("div",{style:{fontWeight:600,fontSize:14,marginBottom:10},children:W(se)}),f.jsxs("div",{style:{display:"flex",gap:16,fontSize:12},children:[Ue>0&&f.jsxs("span",{style:{color:"var(--amber)",fontWeight:600},children:[" ",Ue," written"]}),$>0&&f.jsxs("span",{style:{color:"var(--cyan)",fontWeight:600},children:[" ",$," chats"]})]})]},se)})}),f.jsx("h3",{style:{fontFamily:"var(--font-display)",fontSize:18,fontWeight:600,color:"var(--text2)",marginBottom:12},children:h==="written"?" Written Responses":" Recent Conversations"}),h==="written"?f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:Se.length===0?f.jsx("div",{className:"card",style:{textAlign:"center",padding:40,color:"var(--text3)"},children:"No written responses to review yet"}):Se.map(Xe)}):f.jsxs("div",{children:[f.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16,alignItems:"center"},children:[f.jsxs("div",{style:{flex:1,minWidth:200,position:"relative"},children:[f.jsx("span",{style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:"var(--text3)",fontSize:14,pointerEvents:"none"},children:""}),f.jsx("input",{type:"text",placeholder:"Search by student, lesson, or message content...",value:_,onChange:se=>E(se.target.value),style:{width:"100%",padding:"10px 14px 10px 36px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:14,outline:"none"},onFocus:se=>se.target.style.borderColor="var(--amber)",onBlur:se=>se.target.style.borderColor="var(--border)"})]}),f.jsxs("select",{value:R,onChange:se=>P(se.target.value),style:{padding:"10px 14px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:13},children:[f.jsx("option",{value:"recent",children:"Most Recent"}),f.jsx("option",{value:"messages",children:"Most Messages"}),f.jsx("option",{value:"student",children:"Student Name"})]})]}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:F(Re).length===0?f.jsx("div",{className:"card",style:{textAlign:"center",padding:40,color:"var(--text3)"},children:"No chat conversations yet"}):F(Re).map(re)})]})]})]})]})})}function Fk(){const{userRole:e}=un(),[t,n]=M.useState([]),[s,a]=M.useState(""),[l,i]=M.useState(!0),[p,g]=M.useState(!1),[v,u]=M.useState(null),[h,y]=M.useState(null),[x,T]=M.useState(null),[_,E]=M.useState({email:"",firstName:"",lastName:"",section:""}),[R,P]=M.useState([]),B=M.useRef(null),[X,Q]=M.useState(0),[K,k]=M.useState([]),[I,N]=M.useState([]),[U,z]=M.useState("all"),[q,D]=M.useState(""),[de,je]=M.useState(null),[W,J]=M.useState(!1),[ve,Se]=M.useState(""),[Re,H]=M.useState(""),[Z,te]=M.useState(""),[fe,F]=M.useState(""),[O,xe]=M.useState(!1);M.useEffect(()=>{if(e!=="teacher")return;(async()=>{try{const ee=Kt(it(be,"courses"),Ln("order","asc")),me=(await ct(ee)).docs.map(we=>({id:we.id,...we.data()}));n(me),me.length>0&&a(me[0].id)}catch(ee){console.error("Error loading courses:",ee)}i(!1)})()},[e]),M.useEffect(()=>{if(!s)return;(async()=>{const ee=await ct(it(be,"enrollments"));let ge=0;const me=new Set,we=[];ee.forEach(Ce=>{const Te=Ce.data();Te.courseId===s&&(ge++,Te.section&&me.add(Te.section),we.push({docId:Ce.id,...Te}))}),we.sort((Ce,Te)=>Ce.section!==Te.section?(Ce.section||"").localeCompare(Te.section||""):(Ce.name||Ce.email||"").localeCompare(Te.name||Te.email||"")),Q(ge),k([...me].sort()),N(we)})()},[s,v]);const Le=$=>{const ee=$.split(/\r?\n/).filter(we=>we.trim());if(ee.length<2)return null;const ge=ee[0].split(",").map(we=>we.trim().replace(/^["']|["']$/g,"")),me=[];for(let we=1;we<ee.length;we++){const Ce=[];let Te="",Pe=!1;for(const Ge of ee[we])Ge==='"'?Pe=!Pe:Ge===","&&!Pe?(Ce.push(Te.trim()),Te=""):Te+=Ge;if(Ce.push(Te.trim()),Ce.length>=1){const Ge={};ge.forEach((ce,ze)=>{Ge[ce]=Ce[ze]||""}),me.push(Ge)}}return{headers:ge,rows:me}},Oe=$=>{y(null),u(null);const ee=$.target.files[0];if(!ee)return;const ge=new FileReader;ge.onload=me=>{const we=Le(me.target.result);if(!we||we.rows.length===0){y("Could not parse CSV. Make sure it has a header row and at least one data row.");return}T(we),P(we.rows.slice(0,5));const Ce=we.headers.map(Pe=>Pe.toLowerCase()),Te={email:"",firstName:"",lastName:"",section:""};Ce.forEach((Pe,Ge)=>{Pe.includes("email")||Pe.includes("e-mail")?Te.email=we.headers[Ge]:Pe==="first"||Pe==="first name"||Pe==="firstname"||Pe==="first_name"?Te.firstName=we.headers[Ge]:Pe==="last"||Pe==="last name"||Pe==="lastname"||Pe==="last_name"?Te.lastName=we.headers[Ge]:(Pe.includes("section")||Pe.includes("period")||Pe.includes("class"))&&(Te.section=we.headers[Ge])}),E(Te)},ge.readAsText(ee)},De=async()=>{if(!x||!_.email||!s){y("Please select a course, upload a CSV, and map the email column.");return}g(!0),u(null),y(null);try{const $=await ct(it(be,"users")),ee={};$.forEach(ce=>{const ze=ce.data().email?.toLowerCase();ze&&(ee[ze]=ce.id)});let ge=0,me=0;const we=new Set;let Ce=Vp(be),Te=0;for(const ce of x.rows){const ze=(ce[_.email]||"").trim().toLowerCase();if(!ze||!ze.includes("@")){me++;continue}const Je=_.firstName?(ce[_.firstName]||"").trim():"",dt=_.lastName?(ce[_.lastName]||"").trim():"",nt=[Je,dt].filter(Boolean).join(" ")||ze.split("@")[0],Vt=_.section?(ce[_.section]||"").trim():"";Vt&&we.add(Vt);const nn=ee[ze]||null,Wn=ze.replace(/[^a-z0-9]/g,"_"),Ft=`${s}_${Wn}`;Ce.set(Fe(be,"enrollments",Ft),{courseId:s,email:ze,name:nt,firstName:Je,lastName:dt,section:Vt,uid:nn,studentUid:nn,enrolledAt:new Date},{merge:!0}),ge++,Te++,Te>=450&&(await Ce.commit(),Ce=Vp(be),Te=0)}Te>0&&await Ce.commit();try{const ce=await ct(it(be,"enrollments")),ze=new Set;ce.forEach(Je=>{const dt=Je.data();dt.courseId===s&&dt.uid&&ze.add(dt.uid)});for(const Je of ze)try{const dt=Fe(be,"users",Je),nt=await Mt(dt);if(!nt.exists())continue;const Vt=nt.data().enrolledCourses||{},nn=Array.isArray(Vt)?Vt.reduce((Wn,Ft)=>({...Wn,[Ft]:!0}),{}):Vt;nn[s]||await At(dt,{enrolledCourses:{...nn,[s]:!0}},{merge:!0})}catch(dt){console.warn("Could not update enrolledCourses for",Je,dt)}}catch(ce){console.warn("enrolledCourses batch update skipped:",ce)}await new Promise(ce=>setTimeout(ce,1e3));const Pe=await ct(it(be,"enrollments"));let Ge=0;Pe.forEach(ce=>{ce.data().courseId===s&&Ge++}),u({students:ge,skipped:me,sections:we.size,sectionNames:[...we],savedCount:Ge}),T(null),P([]),B.current&&(B.current.value="")}catch($){console.error("Sync error:",$),y("Sync failed: "+($.message||"Unknown error")+($.code?` (${$.code})`:""))}g(!1)},re=async()=>{const $=ve.trim().toLowerCase();if(!$||!$.includes("@")){y("Please enter a valid email address.");return}if(I.some(ge=>ge.email?.toLowerCase()===$)){y(`${$} is already enrolled in this course.`);return}xe(!0),y(null);try{const ge=await ct(it(be,"users"));let me=null;ge.forEach(ze=>{ze.data().email?.toLowerCase()===$&&(me=ze.id)});const we=Re.trim(),Ce=Z.trim(),Te=[we,Ce].filter(Boolean).join(" ")||$.split("@")[0],Pe=fe.trim(),Ge=$.replace(/[^a-z0-9]/g,"_"),ce=`${s}_${Ge}`;try{await At(Fe(be,"enrollments",ce),{courseId:s,email:$,name:Te,firstName:we,lastName:Ce,section:Pe,uid:me,studentUid:me,enrolledAt:new Date},{merge:!0})}catch(ze){throw new Error(`Enrollment write failed: ${ze.message}`)}if(me)try{const ze=Fe(be,"users",me),Je=await Mt(ze),dt=Je.exists()?Je.data().enrolledCourses||{}:{},nt=Array.isArray(dt)?dt.reduce((Vt,nn)=>({...Vt,[nn]:!0}),{}):dt;nt[s]||await At(ze,{enrolledCourses:{...nt,[s]:!0}},{merge:!0})}catch(ze){console.warn("Could not update enrolledCourses for",me,ze)}u({manual:!0}),Se(""),H(""),te(""),F(""),J(!1)}catch(ge){console.error("Add student error:",ge),y("Failed to add student: "+ge.message)}xe(!1)},Ie=async $=>{if(confirm(`Remove ${$.name||$.email} from ${Ue}?`)){je($.docId);try{const ee=await ct(it(be,"enrollments")),ge=[];ee.forEach(we=>{const Ce=we.data();if(Ce.courseId!==s)return;const Te=$.uid&&(Ce.uid===$.uid||Ce.studentUid===$.uid),Pe=$.email&&Ce.email?.toLowerCase()===$.email.toLowerCase();(Te||Pe)&&ge.push(we.id)});for(const we of ge)await jg(Fe(be,"enrollments",we));const me=$.uid||$.studentUid;if(me)try{const we=Fe(be,"users",me),Ce=await Mt(we);if(Ce.exists()){const Te=Ce.data().enrolledCourses;if(Te&&typeof Te=="object"&&!Array.isArray(Te)){const Pe={...Te};delete Pe[s];for(const Ge of Object.keys(Pe))isNaN(Ge)||delete Pe[Ge];await At(we,{enrolledCourses:Pe},{merge:!0})}}}catch(we){console.warn("Could not update enrolledCourses after unenroll:",we)}N(we=>we.filter(Ce=>Ce.docId!==$.docId)),Q(we=>we-1)}catch(ee){console.error("Remove failed:",ee),y("Failed to remove student: "+ee.message)}je(null)}},Xe=async $=>{const ee=I.filter(ge=>ge.section===$);if(confirm(`Remove all ${ee.length} students in ${$} from ${Ue}?`)){je($);try{const ge=new Set,me=new Set;ee.forEach(Te=>{Te.email&&ge.add(Te.email.toLowerCase()),Te.uid&&me.add(Te.uid),Te.studentUid&&me.add(Te.studentUid)});const we=await ct(it(be,"enrollments")),Ce=Vp(be);we.forEach(Te=>{const Pe=Te.data();if(Pe.courseId!==s)return;const Ge=Pe.uid&&me.has(Pe.uid)||Pe.studentUid&&me.has(Pe.studentUid),ce=Pe.email&&ge.has(Pe.email.toLowerCase());(Ge||ce)&&Ce.delete(Te.ref)}),await Ce.commit();for(const Te of me)try{const Pe=Fe(be,"users",Te),Ge=await Mt(Pe);if(Ge.exists()){const ce=Ge.data().enrolledCourses;if(ce&&typeof ce=="object"&&!Array.isArray(ce)){const ze={...ce};delete ze[s];for(const Je of Object.keys(ze))isNaN(Je)||delete ze[Je];await At(Pe,{enrolledCourses:ze},{merge:!0})}}}catch(Pe){console.warn("Could not update enrolledCourses for",Te,Pe)}N(Te=>Te.filter(Pe=>Pe.section!==$)),Q(Te=>Te-ee.length)}catch(ge){console.error("Remove section failed:",ge),y("Failed to remove section: "+ge.message)}je(null)}},se=I.filter($=>{if(U!=="all"&&$.section!==U)return!1;if(q){const ee=q.toLowerCase();return($.name||"").toLowerCase().includes(ee)||($.email||"").toLowerCase().includes(ee)}return!0});if(e!=="teacher")return f.jsx("div",{className:"page-container",style:{textAlign:"center",paddingTop:120},children:f.jsx("h2",{style:{fontFamily:"var(--font-display)"},children:"Teacher access only"})});const Ue=t.find($=>$.id===s)?.title||"";return f.jsx("div",{className:"page-container",style:{padding:"48px 40px"},children:f.jsxs("div",{style:{maxWidth:900,margin:"0 auto"},children:[f.jsx("h1",{style:{fontFamily:"var(--font-display)",fontSize:32,fontWeight:700,marginBottom:8},children:"Roster"}),f.jsx("p",{style:{color:"var(--text2)",fontSize:15,marginBottom:32},children:"Manage student enrollment by CSV import or add students individually."}),h&&f.jsx("div",{style:{background:"var(--red-dim)",border:"1px solid rgba(248,113,113,0.3)",borderRadius:10,padding:"14px 20px",marginBottom:20,fontSize:14,color:"var(--red)"},children:h}),v&&!v.manual&&f.jsxs("div",{style:{background:"var(--green-dim)",border:"1px solid rgba(45,212,160,0.3)",borderRadius:10,padding:"14px 20px",marginBottom:20,fontSize:14,color:"var(--green)"},children:[" Enrolled ",v.savedCount," students in ",Ue,v.sections>0&&` across ${v.sections} sections (${v.sectionNames.join(", ")})`,v.skipped>0&&f.jsxs("span",{style:{display:"block",fontSize:12,marginTop:4,opacity:.8},children:[v.skipped," rows skipped (missing/invalid email)"]})]}),f.jsxs("div",{className:"card",style:{padding:"20px 24px",marginBottom:16},children:[f.jsx("div",{style:{fontSize:11,fontWeight:700,color:"var(--amber)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:10},children:"Select Course"}),f.jsx("select",{value:s,onChange:$=>a($.target.value),style:{width:"100%",padding:"10px 14px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:14},children:t.map($=>f.jsxs("option",{value:$.id,children:[$.icon," ",$.title]},$.id))}),X>0&&f.jsxs("div",{style:{fontSize:12,color:"var(--text3)",marginTop:8},children:["Currently enrolled: ",X," students",K.length>0&&`  Sections: ${K.join(", ")}`]})]}),f.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16},children:[f.jsx("button",{onClick:()=>J(!W),className:"btn btn-primary",style:{fontSize:13},children:W?"Cancel":" Add Student"}),f.jsx("button",{onClick:()=>{T(null),B.current&&(B.current.value="",B.current.click())},className:"btn btn-secondary",style:{fontSize:13},children:" Import CSV"}),f.jsx("input",{ref:B,type:"file",accept:".csv,.txt",onChange:Oe,style:{display:"none"}})]}),W&&f.jsxs("div",{className:"card",style:{padding:"20px 24px",marginBottom:16},children:[f.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:12},children:" Add Single Student"}),f.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:12},children:[f.jsxs("div",{children:[f.jsx("label",{style:{fontSize:11,fontWeight:600,color:"var(--text3)",display:"block",marginBottom:4},children:"Email *"}),f.jsx("input",{type:"email",placeholder:"student@paps.net",value:ve,onChange:$=>Se($.target.value),style:{width:"100%",padding:"8px 12px",borderRadius:8,border:`1px solid ${!ve.includes("@")&&ve?"var(--red)":"var(--border)"}`,background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:13}})]}),f.jsxs("div",{children:[f.jsx("label",{style:{fontSize:11,fontWeight:600,color:"var(--text3)",display:"block",marginBottom:4},children:"Section / Period"}),f.jsx("input",{type:"text",placeholder:"e.g. Period 3",value:fe,onChange:$=>F($.target.value),list:"existing-sections",style:{width:"100%",padding:"8px 12px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:13}}),K.length>0&&f.jsx("datalist",{id:"existing-sections",children:K.map($=>f.jsx("option",{value:$},$))})]}),f.jsxs("div",{children:[f.jsx("label",{style:{fontSize:11,fontWeight:600,color:"var(--text3)",display:"block",marginBottom:4},children:"First Name"}),f.jsx("input",{type:"text",placeholder:"John",value:Re,onChange:$=>H($.target.value),style:{width:"100%",padding:"8px 12px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:13}})]}),f.jsxs("div",{children:[f.jsx("label",{style:{fontSize:11,fontWeight:600,color:"var(--text3)",display:"block",marginBottom:4},children:"Last Name"}),f.jsx("input",{type:"text",placeholder:"Smith",value:Z,onChange:$=>te($.target.value),style:{width:"100%",padding:"8px 12px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:13}})]})]}),f.jsx("button",{onClick:re,disabled:O||!ve.includes("@"),className:"btn btn-primary",style:{fontSize:13,opacity:ve.includes("@")?1:.5},children:O?"Adding...":`Add to ${Ue}`})]}),x&&f.jsxs("div",{className:"card",style:{padding:"20px 24px",marginBottom:16},children:[f.jsx("div",{style:{fontSize:11,fontWeight:700,color:"var(--amber)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:10},children:"Map CSV Columns"}),f.jsxs("p",{style:{fontSize:13,color:"var(--text3)",marginBottom:14},children:["Found ",x.rows.length," rows and ",x.headers.length," columns. Map each field:"]}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:10,marginBottom:20},children:[{key:"email",label:"Email *",required:!0},{key:"firstName",label:"First Name"},{key:"lastName",label:"Last Name"},{key:"section",label:"Section / Period"}].map(({key:$,label:ee,required:ge})=>f.jsxs("div",{children:[f.jsx("label",{style:{fontSize:12,fontWeight:600,color:ge?"var(--text)":"var(--text3)",marginBottom:4,display:"block"},children:ee}),f.jsxs("select",{value:_[$],onChange:me=>E(we=>({...we,[$]:me.target.value})),style:{width:"100%",padding:"8px 12px",borderRadius:8,border:`1px solid ${ge&&!_[$]?"var(--red)":"var(--border)"}`,background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:13},children:[f.jsx("option",{value:"",children:" not mapped "}),x.headers.map(me=>f.jsx("option",{value:me,children:me},me))]})]},$))}),f.jsxs("div",{style:{fontSize:11,fontWeight:700,color:"var(--text3)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:8},children:["Preview (first ",R.length," rows)"]}),f.jsx("div",{style:{overflowX:"auto",borderRadius:8,border:"1px solid var(--border)"},children:f.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[f.jsx("thead",{children:f.jsxs("tr",{style:{background:"var(--surface)",borderBottom:"1px solid var(--border)"},children:[f.jsx("th",{style:{textAlign:"left",padding:"8px 12px",color:"var(--text2)"},children:"Email"}),f.jsx("th",{style:{textAlign:"left",padding:"8px 12px",color:"var(--text2)"},children:"Name"}),f.jsx("th",{style:{textAlign:"left",padding:"8px 12px",color:"var(--text2)"},children:"Section"})]})}),f.jsx("tbody",{children:R.map(($,ee)=>{const ge=_.email?$[_.email]:"",me=_.firstName?$[_.firstName]:"",we=_.lastName?$[_.lastName]:"",Ce=_.section?$[_.section]:"",Te=ge&&ge.includes("@");return f.jsxs("tr",{style:{borderBottom:"1px solid var(--border)",opacity:Te?1:.4},children:[f.jsx("td",{style:{padding:"6px 12px",color:Te?"var(--cyan)":"var(--red)"},children:ge||""}),f.jsx("td",{style:{padding:"6px 12px"},children:[me,we].filter(Boolean).join(" ")||""}),f.jsx("td",{style:{padding:"6px 12px",color:"var(--text3)"},children:Ce||""})]},ee)})})]})}),x.rows.length>5&&f.jsxs("div",{style:{fontSize:11,color:"var(--text3)",marginTop:6},children:["...and ",x.rows.length-5," more rows"]})]}),x&&f.jsx("button",{className:"btn btn-primary",onClick:De,disabled:p||!_.email||!s,style:{fontSize:15,padding:"12px 28px",marginBottom:32},children:p?f.jsxs("span",{style:{display:"flex",alignItems:"center",gap:8},children:[f.jsx("div",{className:"spinner",style:{width:16,height:16,borderWidth:2}})," Enrolling students..."]}):` Enroll ${x.rows.length} Students in ${Ue}`}),I.length>0&&f.jsxs("div",{style:{marginTop:x?0:32},children:[f.jsxs("h2",{style:{fontFamily:"var(--font-display)",fontSize:22,fontWeight:700,marginBottom:6},children:["Current Roster  ",Ue]}),f.jsxs("p",{style:{color:"var(--text3)",fontSize:13,marginBottom:16},children:[X," students enrolled",K.length>0&&` across ${K.length} sections`]}),f.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[f.jsxs("div",{style:{flex:1,minWidth:180,position:"relative"},children:[f.jsx("span",{style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:"var(--text3)",fontSize:14,pointerEvents:"none"},children:""}),f.jsx("input",{type:"text",placeholder:"Search by name or email...",value:q,onChange:$=>D($.target.value),style:{width:"100%",padding:"8px 14px 8px 34px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:13,outline:"none"}})]}),K.length>1&&f.jsxs("select",{value:U,onChange:$=>z($.target.value),style:{padding:"8px 14px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:13},children:[f.jsxs("option",{value:"all",children:["All sections (",X,")"]}),K.map($=>f.jsxs("option",{value:$,children:[$," (",I.filter(ee=>ee.section===$).length,")"]},$))]})]}),U!=="all"&&f.jsx("div",{style:{marginBottom:12},children:f.jsx("button",{className:"btn btn-secondary",onClick:()=>Xe(U),disabled:de===U,style:{fontSize:12,padding:"6px 14px",color:"var(--red)",borderColor:"rgba(248,113,113,0.3)"},children:de===U?"Removing...":` Remove all ${U} students`})}),f.jsx("div",{style:{overflowX:"auto",borderRadius:12,border:"1px solid var(--border)"},children:f.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[f.jsx("thead",{children:f.jsxs("tr",{style:{background:"var(--surface)",borderBottom:"2px solid var(--border)"},children:[f.jsx("th",{style:{textAlign:"left",padding:"10px 16px",fontWeight:600,color:"var(--text2)",fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em"},children:"Student"}),f.jsx("th",{style:{textAlign:"left",padding:"10px 12px",fontWeight:600,color:"var(--text2)",fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em"},children:"Email"}),f.jsx("th",{style:{textAlign:"center",padding:"10px 12px",fontWeight:600,color:"var(--text2)",fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em"},children:"Section"}),f.jsx("th",{style:{textAlign:"center",padding:"10px 12px",fontWeight:600,color:"var(--text2)",fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em",width:80},children:"Status"}),f.jsx("th",{style:{textAlign:"center",padding:"10px 12px",width:60}})]})}),f.jsx("tbody",{children:se.map(($,ee)=>f.jsxs("tr",{style:{borderBottom:ee<se.length-1?"1px solid var(--border)":"none",background:ee%2===0?"transparent":"var(--surface)",opacity:de===$.docId?.4:1},children:[f.jsx("td",{style:{padding:"8px 16px",fontWeight:500},children:$.name||$.email?.split("@")[0]||""}),f.jsx("td",{style:{padding:"8px 12px",color:"var(--cyan)",fontSize:12},children:$.email}),f.jsx("td",{style:{textAlign:"center",padding:"8px 12px",fontSize:12,color:"var(--text3)"},children:$.section||""}),f.jsx("td",{style:{textAlign:"center",padding:"8px 12px"},children:f.jsx("span",{style:{fontSize:10,fontWeight:600,padding:"2px 8px",borderRadius:4,background:$.uid?"var(--green-dim)":"var(--surface2)",color:$.uid?"var(--green)":"var(--text3)",textTransform:"uppercase",letterSpacing:"0.04em"},children:$.uid?"Active":"Pending"})}),f.jsx("td",{style:{textAlign:"center",padding:"8px 12px"},children:f.jsx("button",{onClick:()=>Ie($),disabled:de===$.docId,style:{background:"none",border:"none",cursor:"pointer",color:"var(--text3)",fontSize:14,padding:"4px 8px",borderRadius:4},onMouseEnter:ge=>{ge.currentTarget.style.color="var(--red)",ge.currentTarget.style.background="var(--red-dim)"},onMouseLeave:ge=>{ge.currentTarget.style.color="var(--text3)",ge.currentTarget.style.background="none"},title:`Remove ${$.name||$.email}`,children:""})})]},$.docId))})]})}),se.length===0&&q&&f.jsxs("div",{style:{textAlign:"center",padding:20,color:"var(--text3)",fontSize:13},children:['No students match "',q,'"']})]})]})})}function $k(){const{userRole:e}=un(),[t,n]=M.useState([]),[s,a]=M.useState(null),[l,i]=M.useState([]),[p,g]=M.useState([]),[v,u]=M.useState({}),[h,y]=M.useState({}),[x,T]=M.useState({}),[_,E]=M.useState(!0),[R,P]=M.useState(!1),[B,X]=M.useState("overview"),[Q,K]=M.useState(null),[k,I]=M.useState(null),[N,U]=M.useState("all");if(M.useEffect(()=>{if(e!=="teacher")return;(async()=>{const xe=Kt(it(be,"courses"),Ln("order","asc")),Oe=(await ct(xe)).docs.map(De=>({id:De.id,...De.data()}));n(Oe),Oe.length>0&&a(Oe[0].id),E(!1)})()},[e]),M.useEffect(()=>{if(!s)return;(async()=>{P(!0);try{const Le=(await ct(Kt(it(be,"courses",s,"lessons"),Ln("order","asc")))).docs.map(Ce=>({id:Ce.id,...Ce.data()}));i(Le);const Oe=await ct(it(be,"users")),De={};Oe.forEach(Ce=>{const Te=Ce.data();De[Ce.id]={uid:Ce.id,...Te},Te.email&&(De[Te.email.toLowerCase()]={uid:Ce.id,...Te})});const re=await ct(it(be,"enrollments")),Ie={},Xe=[];re.forEach(Ce=>{const Te=Ce.data();if(Te.courseId===s){const Pe=Te.uid||Te.email;Ie[Pe]=Te;const Ge=Te.uid?De[Te.uid]:De[Te.email?.toLowerCase()];Xe.push({uid:Ge?.uid||Te.uid||Te.email?.replace(/[.@]/g,"_"),displayName:Ge?.displayName||Te.name||Te.email||"Unknown",email:Te.email||Ge?.email||"",photoURL:Ge?.photoURL||Te.photoUrl||"",section:Te.section||"",firstName:Te.firstName||"",lastName:Te.lastName||"",hasLoggedIn:!!Ge})}}),T(Ie);const se=Xe.length>0?Xe:Object.values(De).filter(Ce=>Ce.role==="student"&&Ce.uid),Ue=new Set,$=se.filter(Ce=>Ue.has(Ce.uid)?!1:(Ue.add(Ce.uid),!0));g($);const ee={},ge=[];for(const Ce of $)if(ee[Ce.uid]={},!!Ce.hasLoggedIn)for(const Te of Le)ge.push(Mt(Fe(be,"progress",Ce.uid,"courses",s,"lessons",Te.id)).then(Pe=>{ee[Ce.uid][Te.id]=Pe.exists()?Pe.data().answers||{}:{}}).catch(()=>{ee[Ce.uid][Te.id]={}}));await Promise.all(ge),u(ee);const me={},we=[];for(const Ce of $){if(!Ce.hasLoggedIn){me[Ce.uid]={};continue}we.push(Mt(Fe(be,"gamification",Ce.uid)).then(Te=>{me[Ce.uid]=Te.exists()?Te.data():{}}).catch(()=>{me[Ce.uid]={}}))}await Promise.all(we),y(me)}catch(xe){console.error("Error fetching progress data:",xe)}P(!1)})()},[s]),e!=="teacher")return f.jsx("div",{className:"page-container",style:{textAlign:"center",paddingTop:120},children:f.jsx("h2",{style:{fontFamily:"var(--font-display)"},children:"Teacher access only"})});const z=O=>(O.blocks||[]).filter(xe=>xe.type==="question"),q=O=>z(O).filter(xe=>xe.questionType==="multiple_choice"),D=O=>z(O).filter(xe=>xe.questionType==="short_answer"),de=(O,xe)=>{const Le=v[O]?.[xe]||{},Oe=l.find(Xe=>Xe.id===xe);if(!Oe)return null;const De=q(Oe);if(De.length===0)return null;let re=0,Ie=0;return De.forEach(Xe=>{Le[Xe.id]?.submitted&&(re++,Le[Xe.id]?.correct&&Ie++)}),re===0?null:{answered:re,correct:Ie,total:De.length,grade:Math.round(Ie/re*100)}},je=O=>{let xe=0,Le=0,Oe=0;return l.forEach(De=>{const re=q(De);xe+=re.length;const Ie=v[O]?.[De.id]||{};re.forEach(Xe=>{Ie[Xe.id]?.submitted&&(Le++,Ie[Xe.id]?.correct&&Oe++)})}),Le===0?null:{totalMC:xe,answered:Le,correct:Oe,grade:Math.round(Oe/Le*100)}},W=O=>O.section?O.section:(x[O.uid]||x[O.email?.toLowerCase()])?.section||"",J=O=>O==null?"var(--text3)":O>=80?"var(--green)":O>=60?"var(--amber)":"var(--red)",ve=[...new Set(p.map(O=>W(O)).filter(O=>O!==""))],Se=N==="all"?p:p.filter(O=>W(O)===N),Re=t.find(O=>O.id===s),H=l.find(O=>O.id===k),Z=p.find(O=>O.uid===Q),te=()=>f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,color:"var(--text3)",marginBottom:20,flexWrap:"wrap"},children:[f.jsxs("button",{onClick:()=>{X("overview"),K(null),I(null)},style:{background:"none",border:"none",color:B==="overview"?"var(--text)":"var(--amber)",cursor:"pointer",fontFamily:"var(--font-body)",fontSize:13,padding:0,fontWeight:600},children:[Re?.icon," ",Re?.title||"Course"]}),(B==="lesson"||B==="student"&&k)&&H&&f.jsxs(f.Fragment,{children:[f.jsx("span",{style:{color:"var(--text3)"},children:""}),f.jsx("button",{onClick:()=>{X("lesson"),K(null)},style:{background:"none",border:"none",color:B==="lesson"&&!Q?"var(--text)":"var(--amber)",cursor:"pointer",fontFamily:"var(--font-body)",fontSize:13,padding:0,fontWeight:600},children:H.title})]}),B==="student"&&Z&&f.jsxs(f.Fragment,{children:[f.jsx("span",{style:{color:"var(--text3)"},children:""}),f.jsx("span",{style:{color:"var(--text)",fontWeight:600},children:Z.displayName})]})]}),fe=()=>{const O=p.find(re=>re.uid===Q);if(!O)return null;const xe=je(O.uid),Le=h[O.uid]||{},Oe=ls(Le.totalXP||0),De=Gf.filter(re=>(Le.badges||[]).includes(re.id));return f.jsxs("div",{children:[te(),f.jsxs("div",{className:"card",style:{display:"flex",alignItems:"center",gap:16,padding:"20px 24px",marginBottom:20},children:[O.photoURL?f.jsx("img",{src:O.photoURL,alt:"",style:{width:52,height:52,borderRadius:"50%",border:"2px solid var(--border)"}}):f.jsx("div",{style:{width:52,height:52,borderRadius:"50%",background:"var(--surface2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,color:"var(--text3)"},children:""}),f.jsxs("div",{style:{flex:1},children:[f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:22,fontWeight:700},children:O.displayName}),f.jsxs("div",{style:{fontSize:13,color:"var(--text3)"},children:[O.email,"  ",W(O)]})]}),f.jsxs("div",{style:{display:"flex",gap:20,textAlign:"center"},children:[f.jsxs("div",{children:[f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:24,fontWeight:700,color:xe?J(xe.grade):"var(--text3)"},children:xe?`${xe.grade}%`:""}),f.jsx("div",{style:{fontSize:10,color:"var(--text3)",textTransform:"uppercase",fontWeight:600,letterSpacing:"0.06em"},children:"Overall"})]}),f.jsxs("div",{children:[f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:24,fontWeight:700,color:"var(--amber)"},children:Le.totalXP||0}),f.jsx("div",{style:{fontSize:10,color:"var(--text3)",textTransform:"uppercase",fontWeight:600,letterSpacing:"0.06em"},children:"XP"})]}),f.jsxs("div",{children:[f.jsxs("div",{style:{fontFamily:"var(--font-display)",fontSize:24,fontWeight:700,color:"var(--red)"},children:[Le.currentStreak||0,"d"]}),f.jsx("div",{style:{fontSize:10,color:"var(--text3)",textTransform:"uppercase",fontWeight:600,letterSpacing:"0.06em"},children:"Streak"})]}),f.jsxs("div",{children:[f.jsxs("div",{style:{fontFamily:"var(--font-display)",fontSize:24,fontWeight:700,color:"var(--cyan)"},children:["Lv",Oe.current.level]}),f.jsx("div",{style:{fontSize:10,color:"var(--text3)",textTransform:"uppercase",fontWeight:600,letterSpacing:"0.06em"},children:Oe.current.name})]})]})]}),De.length>0&&f.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginBottom:20},children:De.map(re=>f.jsxs("span",{title:re.description,style:{background:"var(--surface)",border:"1px solid var(--amber)",borderRadius:8,padding:"6px 10px",fontSize:12,display:"flex",alignItems:"center",gap:6},children:[f.jsx("span",{style:{fontSize:16},children:re.icon})," ",re.name]},re.id))}),f.jsx("h3",{style:{fontFamily:"var(--font-display)",fontSize:18,fontWeight:600,color:"var(--text2)",marginBottom:12},children:"Lesson Grades"}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:l.map(re=>{const Ie=de(O.uid,re.id),Xe=v[O.uid]?.[re.id]||{},se=q(re),Ue=D(re),$=Ue.filter(ee=>Xe[ee.id]?.submitted).length;return f.jsxs("div",{className:"card",style:{padding:"14px 20px",cursor:"pointer"},onClick:()=>{I(re.id),X("lesson")},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[f.jsx("div",{style:{fontWeight:600,fontSize:15},children:re.title}),f.jsx("div",{style:{fontFamily:"var(--font-display)",fontWeight:700,fontSize:18,color:Ie?J(Ie.grade):"var(--text3)"},children:Ie?`${Ie.grade}%`:""})]}),se.length>0&&f.jsx("div",{style:{marginBottom:8},children:f.jsx("div",{style:{height:6,background:"var(--surface2)",borderRadius:3},children:f.jsx("div",{style:{width:`${Ie?Ie.answered/Ie.total*100:0}%`,height:"100%",background:Ie?J(Ie.grade):"var(--surface2)",borderRadius:3,transition:"width 0.3s"}})})}),f.jsxs("div",{style:{display:"flex",gap:16,fontSize:12,color:"var(--text3)",flexWrap:"wrap"},children:[se.length>0&&f.jsxs("span",{children:["MC: ",Ie?`${Ie.correct}/${Ie.answered} correct`:"not started"," (of ",se.length,")"]}),Ue.length>0&&f.jsxs("span",{children:["Written: ",$,"/",Ue.length," submitted"]})]}),Ie&&f.jsx("div",{style:{display:"flex",gap:4,marginTop:10,flexWrap:"wrap"},children:se.map((ee,ge)=>{const me=Xe[ee.id];return me?.submitted?f.jsx("div",{title:`Q${ge+1}: ${me.correct?"Correct":"Incorrect"}`,style:{width:28,height:28,borderRadius:6,background:me.correct?"var(--green-dim)":"var(--red-dim)",border:`1px solid ${me.correct?"var(--green)":"var(--red)"}`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:700,color:me.correct?"var(--green)":"var(--red)"},children:me.correct?"":""},ee.id):f.jsx("div",{title:`Q${ge+1}: Not answered`,style:{width:28,height:28,borderRadius:6,background:"var(--surface2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,color:"var(--text3)",fontWeight:600},children:ge+1},ee.id)})}),Ue.map(ee=>{const ge=Xe[ee.id];return ge?.submitted?f.jsxs("div",{style:{marginTop:10,background:"var(--bg)",borderRadius:8,padding:"10px 14px",border:"1px solid var(--border)"},onClick:me=>me.stopPropagation(),children:[f.jsxs("div",{style:{fontSize:11,fontWeight:600,color:"var(--text3)",marginBottom:4},children:["Written Response: ",ee.prompt?.slice(0,60),ee.prompt?.length>60?"...":""]}),f.jsx("div",{style:{fontSize:13,lineHeight:1.6,color:"var(--text2)"},children:ge.answer})]},ee.id):null})]},re.id)})})]})},F=()=>{const O=l.find(De=>De.id===k);if(!O)return null;const xe=q(O),Le=D(O),Oe=xe.map((De,re)=>{let Ie=0,Xe=0;return Se.forEach(se=>{const Ue=v[se.uid]?.[O.id]?.[De.id];Ue?.submitted&&(Ie++,Ue.correct&&Xe++)}),{...De,index:re,attempted:Ie,correct:Xe,accuracy:Ie>0?Math.round(Xe/Ie*100):null}});return f.jsxs("div",{children:[te(),f.jsx("h2",{style:{fontFamily:"var(--font-display)",fontSize:22,fontWeight:700,marginBottom:6},children:O.title}),f.jsxs("p",{style:{color:"var(--text3)",fontSize:13,marginBottom:24},children:[xe.length," multiple choice  ",Le.length," written response  ",Se.length," students"]}),xe.length>0&&f.jsxs("div",{style:{marginBottom:28},children:[f.jsx("h3",{style:{fontFamily:"var(--font-display)",fontSize:16,fontWeight:600,color:"var(--text2)",marginBottom:12},children:"Question Performance"}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Oe.map(De=>f.jsxs("div",{className:"card",style:{padding:"12px 18px"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:16,marginBottom:8},children:[f.jsxs("div",{style:{flex:1},children:[f.jsxs("div",{style:{fontSize:11,fontWeight:600,color:"var(--text3)",marginBottom:4},children:["Q",De.index+1]}),f.jsx("div",{style:{fontSize:14,lineHeight:1.5},children:De.prompt})]}),f.jsxs("div",{style:{textAlign:"center",flexShrink:0},children:[f.jsx("div",{style:{fontFamily:"var(--font-display)",fontWeight:700,fontSize:22,color:J(De.accuracy)},children:De.accuracy!==null?`${De.accuracy}%`:""}),f.jsxs("div",{style:{fontSize:10,color:"var(--text3)"},children:[De.correct,"/",De.attempted," correct"]})]})]}),f.jsxs("div",{style:{height:8,background:"var(--surface2)",borderRadius:4,overflow:"hidden",display:"flex"},children:[f.jsx("div",{style:{width:`${De.attempted>0?De.correct/Se.length*100:0}%`,background:"var(--green)",transition:"width 0.3s"}}),f.jsx("div",{style:{width:`${De.attempted>0?(De.attempted-De.correct)/Se.length*100:0}%`,background:"var(--red)",transition:"width 0.3s"}})]}),f.jsxs("div",{style:{display:"flex",gap:12,fontSize:11,color:"var(--text3)",marginTop:4},children:[f.jsx("span",{style:{color:"var(--green)"},children:" Correct"}),f.jsx("span",{style:{color:"var(--red)"},children:" Incorrect"}),f.jsxs("span",{children:[" Not attempted: ",Se.length-De.attempted]})]})]},De.id))})]}),f.jsx("h3",{style:{fontFamily:"var(--font-display)",fontSize:16,fontWeight:600,color:"var(--text2)",marginBottom:12},children:"Student Results"}),f.jsx("div",{style:{overflowX:"auto",borderRadius:12,border:"1px solid var(--border)"},children:f.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[f.jsx("thead",{children:f.jsxs("tr",{style:{background:"var(--surface)",borderBottom:"2px solid var(--border)"},children:[f.jsx("th",{style:{textAlign:"left",padding:"10px 16px",fontWeight:600,color:"var(--text2)",fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em"},children:"Student"}),f.jsx("th",{style:{textAlign:"center",padding:"10px 8px",fontWeight:600,color:"var(--text2)",fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em"},children:"Grade"}),xe.map((De,re)=>f.jsxs("th",{style:{textAlign:"center",padding:"10px 8px",fontWeight:600,color:"var(--text3)",fontSize:11},children:["Q",re+1]},De.id)),Le.length>0&&f.jsx("th",{style:{textAlign:"center",padding:"10px 8px",fontWeight:600,color:"var(--text3)",fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em"},children:"Written"})]})}),f.jsx("tbody",{children:[...Se].sort((De,re)=>{const Ie=(De.lastName||De.displayName?.split(" ").pop()||"").toLowerCase(),Xe=(re.lastName||re.displayName?.split(" ").pop()||"").toLowerCase();return Ie.localeCompare(Xe)}).map((De,re)=>{const Ie=de(De.uid,O.id),Xe=v[De.uid]?.[O.id]||{},se=Le.filter(Ue=>Xe[Ue.id]?.submitted).length;return f.jsxs("tr",{style:{borderBottom:re<Se.length-1?"1px solid var(--border)":"none",background:re%2===0?"transparent":"var(--surface)",cursor:"pointer"},onClick:()=>{K(De.uid),X("student")},children:[f.jsx("td",{style:{padding:"8px 16px"},children:f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[De.photoURL?f.jsx("img",{src:De.photoURL,alt:"",style:{width:24,height:24,borderRadius:"50%",border:"1px solid var(--border)"}}):f.jsx("div",{style:{width:24,height:24,borderRadius:"50%",background:"var(--surface2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"var(--text3)"},children:""}),f.jsx("span",{style:{fontWeight:500},children:De.displayName})]})}),f.jsx("td",{style:{textAlign:"center",padding:"8px",fontFamily:"var(--font-display)",fontWeight:700,color:Ie?J(Ie.grade):"var(--text3)"},children:Ie?`${Ie.grade}%`:""}),xe.map(Ue=>{const $=Xe[Ue.id];return f.jsx("td",{style:{textAlign:"center",padding:"8px"},children:$?.submitted?f.jsx("span",{style:{fontWeight:700,color:$.correct?"var(--green)":"var(--red)"},children:$.correct?"":""}):f.jsx("span",{style:{color:"var(--text3)"},children:""})},Ue.id)}),Le.length>0&&f.jsxs("td",{style:{textAlign:"center",padding:"8px",fontSize:12,color:se>0?"var(--cyan)":"var(--text3)"},children:[se,"/",Le.length]})]},De.uid)})})]})})]})};return f.jsx("div",{className:"page-container",style:{padding:"48px 40px"},children:f.jsxs("div",{style:{maxWidth:1100,margin:"0 auto"},children:[f.jsx("h1",{style:{fontFamily:"var(--font-display)",fontSize:32,fontWeight:700,marginBottom:8},children:"Student Progress"}),f.jsx("p",{style:{color:"var(--text2)",fontSize:15,marginBottom:28},children:"Track grades, question performance, and student engagement."}),_?f.jsx("div",{style:{display:"flex",justifyContent:"center",padding:60},children:f.jsx("div",{className:"spinner"})}):f.jsxs(f.Fragment,{children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:12,marginBottom:24},children:[f.jsx("div",{style:{display:"flex",gap:4,background:"var(--bg)",borderRadius:8,padding:3,width:"fit-content"},children:t.map(O=>f.jsxs("button",{className:`top-nav-link ${s===O.id?"active":""}`,onClick:()=>{a(O.id),X("overview"),K(null),I(null)},children:[O.icon," ",O.title]},O.id))}),ve.length>0&&f.jsxs("select",{value:N,onChange:O=>U(O.target.value),style:{padding:"8px 12px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text)",fontFamily:"var(--font-body)",fontSize:13},children:[f.jsx("option",{value:"all",children:"All sections"}),ve.map(O=>f.jsx("option",{value:O,children:O},O))]})]}),R?f.jsx("div",{style:{display:"flex",justifyContent:"center",padding:60},children:f.jsx("div",{className:"spinner"})}):B==="student"?fe():B==="lesson"?F():f.jsxs("div",{children:[f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12,marginBottom:28},children:(()=>{let O=0,xe=0;Se.forEach(De=>{const re=je(De.uid);re&&(O++,xe+=re.grade)});const Le=O>0?Math.round(xe/O):null,Oe=Se.length>0?Math.round(Se.reduce((De,re)=>De+(h[re.uid]?.totalXP||0),0)/Se.length):0;return[{label:"Students",value:Se.length,color:"var(--cyan)",icon:""},{label:"Class Average",value:Le!==null?`${Le}%`:"",color:Le!==null?J(Le):"var(--text3)",icon:""},{label:"Lessons",value:l.length,color:"var(--amber)",icon:""},{label:"Avg XP",value:Oe,color:"var(--amber)",icon:""}].map(De=>f.jsxs("div",{className:"card",style:{textAlign:"center",padding:"16px 12px"},children:[f.jsx("div",{style:{fontSize:18,marginBottom:4},children:De.icon}),f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:22,fontWeight:700,color:De.color},children:De.value}),f.jsx("div",{style:{fontSize:10,fontWeight:600,color:"var(--text3)",textTransform:"uppercase",letterSpacing:"0.08em",marginTop:2},children:De.label})]},De.label))})()}),f.jsx("h3",{style:{fontFamily:"var(--font-display)",fontSize:18,fontWeight:600,color:"var(--text2)",marginBottom:12},children:" Lessons"}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:10,marginBottom:28},children:l.map(O=>{const xe=q(O);let Le=0;Se.forEach(De=>{de(De.uid,O.id)&&Le++});const Oe=Le>0?Math.round(Se.reduce((De,re)=>{const Ie=de(re.uid,O.id);return De+(Ie?Ie.grade:0)},0)/Le):null;return f.jsxs("div",{className:"card",style:{cursor:"pointer",padding:"14px 16px",transition:"border-color 0.2s"},onClick:()=>{I(O.id),X("lesson")},onMouseEnter:De=>De.currentTarget.style.borderColor="var(--amber)",onMouseLeave:De=>De.currentTarget.style.borderColor="var(--border)",children:[f.jsx("div",{style:{fontWeight:600,fontSize:14,marginBottom:6},children:O.title}),f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:22,fontWeight:700,color:Oe!==null?J(Oe):"var(--text3)",marginBottom:4},children:Oe!==null?`${Oe}%`:""}),f.jsxs("div",{style:{fontSize:11,color:"var(--text3)"},children:[xe.length," questions  ",Le,"/",Se.length," attempted"]})]},O.id)})}),f.jsx("h3",{style:{fontFamily:"var(--font-display)",fontSize:18,fontWeight:600,color:"var(--text2)",marginBottom:12},children:" Students"}),Se.length===0?f.jsxs("div",{className:"card",style:{textAlign:"center",padding:40},children:[f.jsx("p",{children:"No students found"}),f.jsx("p",{style:{color:"var(--text2)",fontSize:13,marginTop:6},children:"Sync rosters from Google Classroom to see students here."})]}):f.jsx("div",{style:{overflowX:"auto",borderRadius:12,border:"1px solid var(--border)"},children:f.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[f.jsx("thead",{children:f.jsxs("tr",{style:{background:"var(--surface)",borderBottom:"2px solid var(--border)"},children:[f.jsx("th",{style:{textAlign:"left",padding:"10px 16px",fontWeight:600,color:"var(--text2)",fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em"},children:"Student"}),f.jsx("th",{style:{textAlign:"center",padding:"10px 8px",fontWeight:600,color:"var(--text2)",fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em"},children:"Section"}),f.jsx("th",{style:{textAlign:"center",padding:"10px 8px",fontWeight:600,color:"var(--text2)",fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em"},children:"Overall"}),l.map(O=>f.jsx("th",{style:{textAlign:"center",padding:"10px 8px",fontWeight:600,color:"var(--text3)",fontSize:10,textTransform:"uppercase",letterSpacing:"0.04em",maxWidth:70,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",cursor:"pointer"},onClick:()=>{I(O.id),X("lesson")},children:O.title?.length>10?O.title.slice(0,10)+"":O.title},O.id)),f.jsx("th",{style:{textAlign:"center",padding:"10px 8px",fontWeight:600,color:"var(--text2)",fontSize:11,textTransform:"uppercase"},children:"XP"}),f.jsx("th",{style:{textAlign:"center",padding:"10px 8px",fontWeight:600,color:"var(--text2)",fontSize:11,textTransform:"uppercase"},children:""})]})}),f.jsx("tbody",{children:Se.sort((O,xe)=>{const Le=(O.lastName||O.displayName?.split(" ").pop()||"").toLowerCase(),Oe=(xe.lastName||xe.displayName?.split(" ").pop()||"").toLowerCase();return Le.localeCompare(Oe)}).map((O,xe)=>{const Le=je(O.uid),Oe=h[O.uid]||{};return f.jsxs("tr",{style:{borderBottom:xe<Se.length-1?"1px solid var(--border)":"none",background:xe%2===0?"transparent":"var(--surface)",cursor:"pointer"},onClick:()=>{K(O.uid),X("student")},children:[f.jsx("td",{style:{padding:"10px 16px"},children:f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[O.photoURL?f.jsx("img",{src:O.photoURL,alt:"",style:{width:28,height:28,borderRadius:"50%",border:"1px solid var(--border)"}}):f.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:"var(--surface2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,color:"var(--text3)"},children:""}),f.jsxs("div",{children:[f.jsx("div",{style:{fontWeight:600},children:O.displayName}),f.jsx("div",{style:{fontSize:11,color:"var(--text3)"},children:O.email})]})]})}),f.jsx("td",{style:{textAlign:"center",padding:"10px 8px",fontSize:12,color:"var(--text3)"},children:W(O)}),f.jsx("td",{style:{textAlign:"center",padding:"10px 8px",fontFamily:"var(--font-display)",fontWeight:700,fontSize:15,color:Le?J(Le.grade):"var(--text3)"},children:Le?`${Le.grade}%`:""}),l.map(De=>{const re=de(O.uid,De.id);return f.jsx("td",{style:{textAlign:"center",padding:"10px 8px",fontSize:12,fontWeight:600,color:re?J(re.grade):"var(--text3)"},children:re?`${re.grade}%`:""},De.id)}),f.jsx("td",{style:{textAlign:"center",padding:"10px 8px",fontFamily:"var(--font-display)",fontWeight:700,fontSize:13,color:"var(--amber)"},children:Oe.totalXP||0}),f.jsx("td",{style:{textAlign:"center",padding:"10px 8px",fontSize:12,color:(Oe.currentStreak||0)>0?"var(--red)":"var(--text3)"},children:(Oe.currentStreak||0)>0?Oe.currentStreak:""})]},O.uid)})})]})})]})]})]})})}const Wk={mc_correct:{label:"Multiple Choice  Correct",icon:""},mc_incorrect:{label:"Multiple Choice  Incorrect (participation)",icon:""},short_answer:{label:"Written Response Submitted",icon:""},chat_message:{label:"Chat Message Sent",icon:""},lesson_complete:{label:"Lesson Completed",icon:""},perfect_lesson:{label:"Perfect Lesson (100%)",icon:""},streak_bonus:{label:"Daily Streak Bonus (per day)",icon:""}};function Gk(){const{courseId:e}=_l(),{userRole:t}=un(),n=ui(),[s,a]=M.useState(!0),[l,i]=M.useState(!1),[p,g]=M.useState(!1),[v,u]=M.useState({...au}),[h,y]=M.useState([...$f]),[x,T]=M.useState({...Wf}),[_,E]=M.useState([...Qo]),[R,P]=M.useState(null),[B,X]=M.useState({label:"",xp:10,icon:""}),[Q,K]=M.useState(2),[k,I]=M.useState(60),[N,U]=M.useState("Double XP Hour");M.useEffect(()=>{if(t!=="teacher"){n("/");return}z()},[e,t]);async function z(){a(!0);const re=await _h(e);u(re.xpValues),y(re.behaviorRewards),T(re.multiplierConfig),E(re.levelThresholds),P(re.activeMultiplier),a(!1)}async function q(){i(!0),await cM(e,{xpValues:v,behaviorRewards:h,multiplierConfig:x,levelThresholds:_}),i(!1),g(!0),setTimeout(()=>g(!1),2e3)}async function D(){confirm("Reset all XP values to defaults? This won't affect student XP already earned.")&&(u({...au}),y([...$f]),T({...Wf}),E([...Qo]))}function de(re,Ie){u(Xe=>({...Xe,[re]:Math.max(0,parseInt(Ie)||0)}))}function je(){if(!B.label.trim())return;const re=B.label.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"");y(Ie=>[...Ie,{...B,id:re}]),X({label:"",xp:10,icon:""})}function W(re){y(Ie=>Ie.filter(Xe=>Xe.id!==re))}function J(re,Ie){y(Xe=>Xe.map(se=>se.id===re?{...se,xp:Math.max(0,parseInt(Ie)||0)}:se))}async function ve(){await dM(e,Q,k,N),await z()}async function Se(){await fM(e),P(null)}function Re(){return R?(R.expiresAt?.toDate?.()?R.expiresAt.toDate():new Date(R.expiresAt))>new Date:!1}const H={padding:"32px 24px",maxWidth:800,margin:"0 auto",fontFamily:"var(--font-body, -apple-system, BlinkMacSystemFont, sans-serif)",color:"var(--text1, #e8e8e8)"},Z={background:"var(--surface1, #1e1e2e)",borderRadius:12,padding:"24px",marginBottom:24,border:"1px solid var(--border, #2a2a3a)"},te={fontSize:18,fontWeight:700,marginBottom:16,display:"flex",alignItems:"center",gap:8},fe={display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 0",borderBottom:"1px solid var(--border, #2a2a3a)"},F={display:"flex",alignItems:"center",gap:8,fontSize:14,flex:1},O={width:80,padding:"6px 10px",borderRadius:8,border:"1px solid var(--border, #2a2a3a)",background:"var(--surface2, #252535)",color:"var(--text1, #e8e8e8)",fontSize:14,textAlign:"center"},xe={padding:"10px 20px",borderRadius:8,border:"none",background:"var(--accent, #6c5ce7)",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:14},Le={padding:"8px 16px",borderRadius:8,border:"1px solid var(--border, #2a2a3a)",background:"transparent",color:"var(--text2, #aaa)",cursor:"pointer",fontSize:13},Oe={padding:"4px 10px",borderRadius:6,border:"none",background:"#e74c3c33",color:"#e74c3c",cursor:"pointer",fontSize:12},De={background:"linear-gradient(135deg, #f39c12, #e74c3c)",borderRadius:12,padding:"16px 20px",marginBottom:24,display:"flex",alignItems:"center",justifyContent:"space-between",color:"#fff"};return s?f.jsx("div",{style:H,children:f.jsx("div",{style:{display:"flex",justifyContent:"center",padding:60},children:f.jsx("div",{className:"spinner"})})}):f.jsxs("div",{style:H,children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:28},children:[f.jsxs("div",{children:[f.jsx("button",{onClick:()=>n(-1),style:{...Le,marginBottom:8},children:" Back"}),f.jsx("h1",{style:{fontSize:26,fontWeight:700,fontFamily:"var(--font-display, var(--font-body))"},children:" XP Controls"}),f.jsx("p",{style:{color:"var(--text2, #aaa)",fontSize:14,marginTop:4},children:"Configure XP rewards, behavior bonuses, and multiplier events for this course."})]}),f.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[f.jsx("button",{onClick:D,style:Le,children:"Reset Defaults"}),f.jsx("button",{onClick:q,disabled:l,style:{...xe,opacity:l?.6:1},children:l?"Saving...":p?" Saved!":"Save Changes"})]})]}),Re()&&f.jsxs("div",{style:De,children:[f.jsxs("div",{children:[f.jsxs("div",{style:{fontWeight:700,fontSize:16},children:[" ",R.label," Active!"]}),f.jsxs("div",{style:{fontSize:13,opacity:.9},children:["Expires: ",new Date(R.expiresAt?.toDate?.()?R.expiresAt.toDate():R.expiresAt).toLocaleTimeString()]})]}),f.jsx("button",{onClick:Se,style:{...Le,color:"#fff",borderColor:"#fff6"},children:"End Event"})]}),f.jsxs("div",{style:Z,children:[f.jsx("div",{style:te,children:" Activity XP Values"}),f.jsx("p",{style:{color:"var(--text2, #aaa)",fontSize:13,marginBottom:16},children:"Set how much XP students earn for each type of activity. Changes apply to future actions only."}),Object.entries(Wk).map(([re,{label:Ie,icon:Xe}])=>f.jsxs("div",{style:fe,children:[f.jsxs("div",{style:F,children:[f.jsx("span",{children:Xe}),f.jsx("span",{children:Ie})]}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[f.jsx("input",{type:"number",min:0,value:v[re],onChange:se=>de(re,se.target.value),style:O}),f.jsx("span",{style:{color:"var(--text2, #aaa)",fontSize:12},children:"XP"})]})]},re))]}),f.jsxs("div",{style:Z,children:[f.jsx("div",{style:te,children:" Level Thresholds"}),f.jsx("p",{style:{color:"var(--text2, #aaa)",fontSize:13,marginBottom:16},children:"Set the total XP required to reach each level. Level 1 always starts at 0 XP. Each level must require more XP than the previous."}),_.map((re,Ie)=>{const Xe=Ys[Ie]?.name||`Level ${re.level}`,se=Ie>0?_[Ie-1].xpRequired:0,Ue=re.xpRequired-se;return f.jsxs("div",{style:fe,children:[f.jsxs("div",{style:F,children:[f.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:6,background:Ie<3?"#2a3a2a":Ie<6?"#2a2a4a":Ie<8?"#3a2a3a":"#3a2a1a",fontSize:12,fontWeight:800,color:Ie<3?"#2ecc71":Ie<6?"#3498db":Ie<8?"#9b59b6":"#f39c12"},children:re.level}),f.jsx("span",{children:Xe}),Ie>0&&f.jsxs("span",{style:{fontSize:11,color:"var(--text2, #aaa)",marginLeft:4},children:["(+",Ue.toLocaleString()," from Lv",re.level-1,")"]})]}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[Ie===0?f.jsx("span",{style:{...O,opacity:.5,display:"inline-block",background:"transparent",border:"1px solid transparent"},children:"0"}):f.jsx("input",{type:"number",min:se+1,value:re.xpRequired,onChange:$=>{const ee=Math.max(se+1,parseInt($.target.value)||0);E(ge=>{const me=[...ge];me[Ie]={...me[Ie],xpRequired:ee};for(let we=Ie+1;we<me.length;we++)me[we].xpRequired<=me[we-1].xpRequired&&(me[we]={...me[we],xpRequired:me[we-1].xpRequired+100});return me})},style:O}),f.jsx("span",{style:{color:"var(--text2, #aaa)",fontSize:12},children:"XP"})]})]},re.level)}),f.jsxs("div",{style:{marginTop:16,display:"flex",gap:8,flexWrap:"wrap"},children:[f.jsx("span",{style:{fontSize:12,color:"var(--text2, #aaa)",alignSelf:"center"},children:"Presets:"}),f.jsx("button",{onClick:()=>E([...Qo]),style:{...Le,fontSize:12,padding:"4px 12px"},children:"Default"}),f.jsx("button",{onClick:()=>E(Qo.map(re=>({...re,xpRequired:Math.round(re.xpRequired*.5)}))),style:{...Le,fontSize:12,padding:"4px 12px"},children:"Easy (50%)"}),f.jsx("button",{onClick:()=>E(Qo.map(re=>({...re,xpRequired:Math.round(re.xpRequired*1.5)}))),style:{...Le,fontSize:12,padding:"4px 12px"},children:"Hard (150%)"}),f.jsx("button",{onClick:()=>{const re=Qo.map((Ie,Xe)=>({...Ie,xpRequired:Xe*200}));E(re)},style:{...Le,fontSize:12,padding:"4px 12px"},children:"Linear (200/lvl)"})]})]}),f.jsxs("div",{style:Z,children:[f.jsx("div",{style:te,children:" Behavior Rewards"}),f.jsx("p",{style:{color:"var(--text2, #aaa)",fontSize:13,marginBottom:16},children:"Quick-award XP from the class roster for positive behaviors. Customize the list below."}),h.map(re=>f.jsxs("div",{style:fe,children:[f.jsxs("div",{style:F,children:[f.jsx("span",{style:{fontSize:18},children:re.icon}),f.jsx("span",{children:re.label})]}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[f.jsx("input",{type:"number",min:0,value:re.xp,onChange:Ie=>J(re.id,Ie.target.value),style:{...O,width:60}}),f.jsx("span",{style:{color:"var(--text2, #aaa)",fontSize:12},children:"XP"}),f.jsx("button",{onClick:()=>W(re.id),style:Oe,children:""})]})]},re.id)),f.jsxs("div",{style:{marginTop:16,padding:"16px",background:"var(--surface2, #252535)",borderRadius:8},children:[f.jsx("div",{style:{fontSize:13,fontWeight:600,marginBottom:10,color:"var(--text2, #aaa)"},children:"+ Add Custom Behavior"}),f.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[f.jsx("input",{type:"text",placeholder:"Icon",value:B.icon,onChange:re=>X(Ie=>({...Ie,icon:re.target.value})),style:{...O,width:50}}),f.jsx("input",{type:"text",placeholder:"Behavior name...",value:B.label,onChange:re=>X(Ie=>({...Ie,label:re.target.value})),style:{...O,width:200,textAlign:"left"}}),f.jsx("input",{type:"number",min:0,value:B.xp,onChange:re=>X(Ie=>({...Ie,xp:parseInt(re.target.value)||0})),style:{...O,width:60}}),f.jsx("span",{style:{color:"var(--text2, #aaa)",fontSize:12},children:"XP"}),f.jsx("button",{onClick:je,disabled:!B.label.trim(),style:{...xe,padding:"6px 14px",fontSize:13,opacity:B.label.trim()?1:.5},children:"Add"})]})]})]}),f.jsxs("div",{style:Z,children:[f.jsx("div",{style:te,children:" Streak Multipliers"}),f.jsx("p",{style:{color:"var(--text2, #aaa)",fontSize:13,marginBottom:16},children:"Students with active streaks earn bonus XP. Configure the multiplier for each streak milestone."}),Object.entries(x.streakMultipliers||{}).map(([re,Ie])=>f.jsxs("div",{style:fe,children:[f.jsxs("div",{style:F,children:[f.jsx("span",{children:""}),f.jsxs("span",{children:[re,"-day streak"]})]}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[f.jsx("input",{type:"number",min:1,max:5,step:.25,value:Ie,onChange:Xe=>T(se=>({...se,streakMultipliers:{...se.streakMultipliers,[re]:parseFloat(Xe.target.value)||1}})),style:{...O,width:70}}),f.jsx("span",{style:{color:"var(--text2, #aaa)",fontSize:12},children:""})]})]},re))]}),f.jsxs("div",{style:Z,children:[f.jsx("div",{style:te,children:" XP Multiplier Events"}),f.jsx("p",{style:{color:"var(--text2, #aaa)",fontSize:13,marginBottom:16},children:"Trigger a class-wide XP boost. Great for review days or rewarding good behavior."}),Re()?f.jsxs("div",{style:{textAlign:"center",padding:20},children:[f.jsx("div",{style:{fontSize:36,marginBottom:8},children:""}),f.jsxs("div",{style:{fontSize:18,fontWeight:700},children:[R.label," is active!"]}),f.jsxs("div",{style:{color:"var(--text2, #aaa)",fontSize:13,marginTop:4},children:["Expires at ",new Date(R.expiresAt?.toDate?.()?R.expiresAt.toDate():R.expiresAt).toLocaleTimeString()]}),f.jsx("button",{onClick:Se,style:{...Oe,marginTop:12,padding:"8px 20px"},children:"End Event Early"})]}):f.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-end",flexWrap:"wrap"},children:[f.jsxs("div",{children:[f.jsx("label",{style:{fontSize:12,color:"var(--text2, #aaa)",display:"block",marginBottom:4},children:"Event Name"}),f.jsx("input",{type:"text",value:N,onChange:re=>U(re.target.value),style:{...O,width:180,textAlign:"left"}})]}),f.jsxs("div",{children:[f.jsx("label",{style:{fontSize:12,color:"var(--text2, #aaa)",display:"block",marginBottom:4},children:"Multiplier"}),f.jsxs("select",{value:Q,onChange:re=>K(parseFloat(re.target.value)),style:{...O,width:80},children:[f.jsx("option",{value:1.5,children:"1.5"}),f.jsx("option",{value:2,children:"2"}),f.jsx("option",{value:3,children:"3"}),f.jsx("option",{value:5,children:"5"})]})]}),f.jsxs("div",{children:[f.jsx("label",{style:{fontSize:12,color:"var(--text2, #aaa)",display:"block",marginBottom:4},children:"Duration"}),f.jsxs("select",{value:k,onChange:re=>I(parseInt(re.target.value)),style:{...O,width:120},children:[f.jsx("option",{value:15,children:"15 minutes"}),f.jsx("option",{value:30,children:"30 minutes"}),f.jsx("option",{value:45,children:"45 minutes"}),f.jsx("option",{value:60,children:"1 hour"}),f.jsx("option",{value:120,children:"2 hours"}),f.jsx("option",{value:480,children:"Full day (8h)"})]})]}),f.jsx("button",{onClick:ve,style:xe,children:" Start Event"})]})]}),f.jsxs("div",{style:Z,children:[f.jsx("div",{style:te,children:" Quality Multipliers"}),f.jsx("p",{style:{color:"var(--text2, #aaa)",fontSize:13,marginBottom:16},children:"When you grade written responses, apply a quality multiplier to the base XP. (Coming soon: auto-apply from grading dashboard.)"}),Object.entries(x.qualityMultipliers||{}).map(([re,Ie])=>f.jsxs("div",{style:fe,children:[f.jsxs("div",{style:F,children:[f.jsx("span",{children:re==="satisfactory"?"":re==="proficient"?"":""}),f.jsx("span",{style:{textTransform:"capitalize"},children:re})]}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[f.jsx("input",{type:"number",min:.5,max:5,step:.25,value:Ie,onChange:Xe=>T(se=>({...se,qualityMultipliers:{...se.qualityMultipliers,[re]:parseFloat(Xe.target.value)||1}})),style:{...O,width:70}}),f.jsx("span",{style:{color:"var(--text2, #aaa)",fontSize:12},children:""})]})]},re))]})]})}function Qk(){const{courseId:e}=_l(),{userRole:t}=un(),n=ui(),[s,a]=M.useState(!0),[l,i]=M.useState(null),[p,g]=M.useState([]),[v,u]=M.useState([]),[h,y]=M.useState({enabled:!1,teamSize:4,draftMode:!1,xpSharePercent:25}),[x,T]=M.useState(!1),[_,E]=M.useState(!1),[R,P]=M.useState(""),[B,X]=M.useState("red"),[Q,K]=M.useState(!1),[k,I]=M.useState("all"),[N,U]=M.useState(null),[z,q]=M.useState(null),[D,de]=M.useState(null),[je,W]=M.useState(null),[J,ve]=M.useState("");M.useEffect(()=>{if(t!=="teacher"){n("/");return}Se()},[e,t]);async function Se(){a(!0);try{const ce=await Mt(Fe(be,"courses",e));ce.exists()&&i({id:ce.id,...ce.data()});const ze=await ct(it(be,"users")),Je={},dt={};ze.forEach(Ne=>{const ke=Ne.data();Je[Ne.id]=ke,ke.email&&(dt[ke.email.toLowerCase()]={uid:Ne.id,...ke})});const nt=await Au(e);for(const Ne of nt)Ne.members=Ne.members.map(ke=>{const $e=Je[ke.uid];return{...ke,nickname:$e?.nickname||null}});g(nt);const Vt=await Ig(e);y(Vt);const nn=await ct(it(be,"enrollments")),Wn=[];nn.forEach(Ne=>{const ke=Ne.data();ke.courseId===e&&Wn.push(ke)});const Ft=[];for(const Ne of Wn){const ke=(Ne.email||"").toLowerCase(),$e=Ne.uid&&Je[Ne.uid]?{uid:Ne.uid,...Je[Ne.uid]}:dt[ke]||null;Ft.push({uid:$e?.uid||Ne.uid||ke.replace(/[^a-z0-9]/g,"_"),displayName:$e?.displayName||Ne.name||ke.split("@")[0],email:Ne.email||$e?.email||"",photoURL:$e?.photoURL||"",section:Ne.section||"",nickname:$e?.nickname||null})}u(Ft)}catch(ce){console.error("Error loading team data:",ce)}a(!1)}const Re=new Set(p.flatMap(ce=>ce.members.map(ze=>ze.uid))),H=v.filter(ce=>!Re.has(ce.uid)),Z=[...new Set(v.map(ce=>ce.section).filter(Boolean))].sort(),te=k==="all"?v:v.filter(ce=>ce.section===k),fe=k==="all"?p:p.filter(ce=>ce.section===k||!ce.section&&ce.members.some(ze=>v.find(dt=>dt.uid===ze.uid)?.section===k)),F=k==="all"?H:H.filter(ce=>ce.section===k);async function O(){if(!R.trim())return;const ce=k!=="all"?k:"";await hS(e,{name:R.trim(),color:B,section:ce}),P(""),E(!1),await Se()}async function xe(ce){confirm("Delete this team? Members will become unassigned.")&&(await n8(e,ce),await Se())}async function Le(ce){const ze=J.trim();ze&&(await pS(e,ce,{name:ze}),W(null),ve(""),await Se())}async function Oe(ce,ze){const Je=p.find(dt=>dt.members.some(nt=>nt.uid===ze.uid));Je&&await bm(e,Je.id,ze.uid),await mS(e,ce,ze),await Se()}async function De(ce,ze){await bm(e,ce,ze),await Se()}async function re(){const ce=k==="all"?v:te,ze=k==="all"?p:fe,Je=k!=="all"?k:"";if(ze.length>0){const dt=k==="all"?"This will delete ALL existing teams and create new ones. Continue?":`This will delete existing ${k} teams and create new ones. Continue?`;if(!confirm(dt))return;for(const nt of ze)await n8(e,nt.id)}await GR(e,ce,h.teamSize,null,Je),K(!1),await Se()}async function Ie(ce){const ze={...h,...ce};y(ze),await $R(e,ze)}function Xe(ce){return Ni.find(ze=>ze.id===ce)||Ni[0]}function se(ce,ze){U(ce),q(ze)}function Ue(){U(null),q(null),de(null)}function $(ce,ze){ce.preventDefault(),de(ze)}function ee(){de(null)}async function ge(ce,ze){ce.preventDefault(),de(null),N&&(ze==="unassigned"?z&&z!=="unassigned"&&await De(z,N.uid):await Oe(ze,N),U(null),q(null))}const me={padding:"32px 24px",maxWidth:900,margin:"0 auto",color:"var(--text1, #e8e8e8)"},we={background:"var(--surface, #1e1e2e)",borderRadius:12,padding:"20px",marginBottom:16,border:"1px solid var(--border, #2a2a3a)"},Ce={padding:"8px 16px",borderRadius:8,border:"none",background:"var(--accent, #6c5ce7)",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:13},Te={padding:"8px 16px",borderRadius:8,border:"1px solid var(--border, #2a2a3a)",background:"transparent",color:"var(--text2, #aaa)",cursor:"pointer",fontSize:13},Pe={padding:"4px 10px",borderRadius:6,border:"none",background:"#e74c3c33",color:"#e74c3c",cursor:"pointer",fontSize:12},Ge={display:"inline-flex",alignItems:"center",gap:6,padding:"5px 10px",borderRadius:20,fontSize:12,background:"var(--surface2, #252535)",border:"1px solid var(--border, #2a2a3a)"};return s?f.jsx("div",{style:me,children:f.jsx("div",{style:{display:"flex",justifyContent:"center",padding:60},children:f.jsx("div",{className:"spinner"})})}):f.jsxs("div",{style:me,children:[f.jsx("button",{onClick:()=>n(-1),style:{...Te,marginBottom:12},children:" Back"}),f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:24,flexWrap:"wrap",gap:12},children:[f.jsxs("div",{children:[f.jsx("h1",{style:{fontSize:26,fontWeight:700,fontFamily:"var(--font-display)"},children:" Team Manager"}),f.jsxs("p",{style:{color:"var(--text2, #aaa)",fontSize:14,marginTop:4},children:[l?.title,"  ",te.length," students, ",fe.length," teams",k!=="all"&&` (${k})`]})]}),f.jsxs("div",{style:{display:"flex",gap:8},children:[f.jsx("button",{onClick:()=>K(!0),style:Te,children:" Auto-Assign"}),f.jsx("button",{onClick:()=>E(!0),style:Ce,children:"+ New Team"})]})]}),Z.length>0&&f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:16},children:[f.jsx("span",{style:{fontSize:13,color:"var(--text2)",fontWeight:600},children:"Filter by period:"}),f.jsxs("select",{value:k,onChange:ce=>I(ce.target.value),style:{padding:"6px 12px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface2, #252535)",color:"var(--text1)",fontSize:13,fontFamily:"var(--font-body)"},children:[f.jsxs("option",{value:"all",children:["All Students (",v.length,")  ",p.length," teams"]}),Z.map(ce=>{const ze=p.filter(Je=>Je.section===ce||!Je.section&&Je.members.some(dt=>v.find(Vt=>Vt.uid===dt.uid)?.section===ce)).length;return f.jsxs("option",{value:ce,children:[ce," (",v.filter(Je=>Je.section===ce).length," students  ",ze," teams)"]},ce)})]}),k!=="all"&&f.jsxs("span",{style:{fontSize:12,color:"var(--text3)"},children:[F.length," unassigned in ",k]})]}),f.jsxs("div",{style:we,children:[f.jsx("div",{style:{fontSize:15,fontWeight:700,marginBottom:12},children:" Team Settings"}),f.jsxs("div",{style:{display:"flex",gap:24,flexWrap:"wrap",alignItems:"center"},children:[f.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:13},children:[f.jsx("input",{type:"checkbox",checked:h.enabled,onChange:ce=>Ie({enabled:ce.target.checked}),style:{accentColor:"var(--accent, #6c5ce7)"}}),"Teams enabled"]}),f.jsxs("label",{style:{fontSize:13,display:"flex",alignItems:"center",gap:6},children:["Team size:",f.jsxs("select",{value:h.teamSize,onChange:ce=>Ie({teamSize:parseInt(ce.target.value)}),style:{padding:"4px 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--surface2)",color:"var(--text1)",fontSize:13},children:[f.jsx("option",{value:3,children:"3"}),f.jsx("option",{value:4,children:"4"}),f.jsx("option",{value:5,children:"5"})]})]}),f.jsxs("label",{style:{fontSize:13,display:"flex",alignItems:"center",gap:6},children:["XP share:",f.jsxs("select",{value:h.xpSharePercent,onChange:ce=>Ie({xpSharePercent:parseInt(ce.target.value)}),style:{padding:"4px 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--surface2)",color:"var(--text1)",fontSize:13},children:[f.jsx("option",{value:10,children:"10%"}),f.jsx("option",{value:15,children:"15%"}),f.jsx("option",{value:20,children:"20%"}),f.jsx("option",{value:25,children:"25%"}),f.jsx("option",{value:33,children:"33%"}),f.jsx("option",{value:50,children:"50%"})]})]}),f.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:13},children:[f.jsx("input",{type:"checkbox",checked:h.draftMode,onChange:ce=>Ie({draftMode:ce.target.checked}),style:{accentColor:"var(--accent, #6c5ce7)"}}),"Student draft mode"]})]})]}),Q&&f.jsxs("div",{style:we,children:[f.jsx("div",{style:{fontSize:15,fontWeight:700,marginBottom:8},children:" Auto-Assign Teams"}),f.jsxs("p",{style:{fontSize:13,color:"var(--text2)",marginBottom:12},children:["Randomly shuffle ",k==="all"?`all ${v.length}`:`${te.length} ${k}`," students into balanced teams of ",h.teamSize,".",p.length>0&&f.jsx("span",{style:{color:"#e74c3c"},children:" This will replace existing teams."})]}),f.jsxs("div",{style:{display:"flex",gap:8},children:[f.jsx("button",{onClick:re,style:Ce,children:"Shuffle & Create"}),f.jsx("button",{onClick:()=>K(!1),style:Te,children:"Cancel"})]})]}),_&&f.jsxs("div",{style:we,children:[f.jsxs("div",{style:{fontSize:15,fontWeight:700,marginBottom:12},children:["+ New Team",k!=="all"&&f.jsxs("span",{style:{fontWeight:400,fontSize:13,color:"var(--text2)"},children:["  ",k]})]}),f.jsxs("div",{style:{display:"flex",gap:10,alignItems:"flex-end",flexWrap:"wrap"},children:[f.jsxs("div",{children:[f.jsx("label",{style:{fontSize:12,color:"var(--text2)",display:"block",marginBottom:4},children:"Team Name"}),f.jsx("input",{type:"text",value:R,placeholder:"e.g. Alpha, Bravo...",onChange:ce=>P(ce.target.value),style:{padding:"8px 12px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface2)",color:"var(--text1)",fontSize:14,width:180}})]}),f.jsxs("div",{children:[f.jsx("label",{style:{fontSize:12,color:"var(--text2)",display:"block",marginBottom:4},children:"Color"}),f.jsx("div",{style:{display:"flex",gap:4},children:Ni.map(ce=>f.jsx("button",{onClick:()=>X(ce.id),style:{width:28,height:28,borderRadius:6,border:B===ce.id?"2px solid #fff":"2px solid transparent",background:ce.hex,cursor:"pointer"},title:ce.label},ce.id))})]}),f.jsx("button",{onClick:O,disabled:!R.trim(),style:{...Ce,opacity:R.trim()?1:.5},children:"Create"}),f.jsx("button",{onClick:()=>E(!1),style:Te,children:"Cancel"})]})]}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:16,marginBottom:24},children:fe.map(ce=>{const ze=Xe(ce.color),Je=D===ce.id,dt=ce.members.length>h.teamSize;return f.jsxs("div",{onDragOver:nt=>$(nt,ce.id),onDragLeave:ee,onDrop:nt=>ge(nt,ce.id),style:{...we,marginBottom:0,borderColor:Je?ze.hex:ze.hex+"44",borderTop:`3px solid ${ze.hex}`,boxShadow:Je?`0 0 16px ${ze.hex}33`:"none",transition:"box-shadow 0.2s, border-color 0.2s"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},children:[f.jsx("div",{style:{width:12,height:12,borderRadius:3,background:ze.hex,flexShrink:0}}),je===ce.id?f.jsx("input",{type:"text",value:J,autoFocus:!0,onChange:nt=>ve(nt.target.value),onKeyDown:nt=>{nt.key==="Enter"&&Le(ce.id),nt.key==="Escape"&&W(null)},onBlur:()=>Le(ce.id),style:{fontWeight:700,fontSize:16,padding:"2px 6px",borderRadius:4,border:`1px solid ${ze.hex}`,background:"var(--surface2)",color:"var(--text1)",width:120,fontFamily:"inherit"}}):f.jsx("span",{onDoubleClick:()=>{W(ce.id),ve(ce.name)},style:{fontWeight:700,fontSize:16,cursor:"text"},title:"Double-click to rename",children:ce.name}),f.jsxs("span",{style:{fontSize:11,color:dt?"var(--amber)":"var(--text3)"},children:[ce.members.length,"/",h.teamSize]}),ce.section&&k==="all"&&f.jsx("span",{style:{fontSize:10,padding:"1px 6px",borderRadius:4,background:"var(--surface2)",color:"var(--text3)",border:"1px solid var(--border)",whiteSpace:"nowrap"},children:ce.section})]}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[f.jsxs("span",{style:{fontSize:12,color:"var(--amber)",fontWeight:600},children:[ce.teamXP||0," XP"]}),f.jsx("button",{onClick:()=>xe(ce.id),style:Pe,title:"Delete team",children:""})]})]}),f.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,marginBottom:12,minHeight:40},children:[ce.members.length===0&&!Je&&f.jsx("div",{style:{fontSize:12,color:"var(--text3)",fontStyle:"italic",padding:8,textAlign:"center"},children:"Drop students here"}),Je&&ce.members.length===0&&f.jsxs("div",{style:{fontSize:12,color:ze.hex,fontStyle:"italic",padding:8,textAlign:"center",background:ze.dim,borderRadius:8},children:["Drop to add to ",ce.name]}),ce.members.map(nt=>f.jsxs("div",{draggable:!0,onDragStart:()=>se(nt,ce.id),onDragEnd:Ue,style:{display:"flex",alignItems:"center",gap:8,padding:"6px 8px",background:"var(--surface2, #252535)",borderRadius:8,cursor:"grab",userSelect:"none"},children:[f.jsx("span",{style:{fontSize:10,color:"var(--text3)",cursor:"grab"},children:""}),nt.photoURL?f.jsx("img",{src:nt.photoURL,style:{width:24,height:24,borderRadius:"50%"},alt:"",referrerPolicy:"no-referrer"}):f.jsx("div",{style:{width:24,height:24,borderRadius:"50%",background:"var(--border)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10},children:""}),f.jsx("span",{style:{fontSize:13,flex:1},children:Ff({displayName:nt.displayName,nickname:nt.nickname,isTeacherViewing:!0})}),f.jsx("button",{onClick:()=>De(ce.id,nt.uid),style:{...Pe,padding:"2px 6px",fontSize:10},children:""})]},nt.uid))]}),dt&&f.jsxs("div",{style:{fontSize:10,color:"var(--amber)",textAlign:"center",marginBottom:6},children:[" Over team size (",ce.members.length,"/",h.teamSize,")"]}),F.length>0&&f.jsxs("select",{defaultValue:"",onChange:nt=>{const Vt=F.find(nn=>nn.uid===nt.target.value);Vt&&Oe(ce.id,Vt),nt.target.value=""},style:{width:"100%",padding:"6px 10px",borderRadius:8,border:"1px dashed var(--border)",background:"transparent",color:"var(--text2)",fontSize:12,cursor:"pointer"},children:[f.jsx("option",{value:"",disabled:!0,children:"+ Add student..."}),F.map(nt=>f.jsxs("option",{value:nt.uid,children:[tS({displayName:nt.displayName,nickname:nt.nickname,isTeacherViewing:!0}),nt.section?` (${nt.section})`:""]},nt.uid))]})]},ce.id)})}),F.length>0&&f.jsxs("div",{onDragOver:ce=>$(ce,"unassigned"),onDragLeave:ee,onDrop:ce=>ge(ce,"unassigned"),style:{...we,borderColor:D==="unassigned"?"var(--amber)":"var(--border)",boxShadow:D==="unassigned"?"0 0 16px rgba(245,166,35,0.15)":"none",transition:"box-shadow 0.2s, border-color 0.2s"},children:[f.jsxs("div",{style:{fontSize:15,fontWeight:700,marginBottom:12},children:[" Unassigned (",F.length,k!=="all"?` in ${k}`:"",")"]}),f.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:F.map(ce=>f.jsxs("div",{draggable:!0,onDragStart:()=>se(ce,"unassigned"),onDragEnd:Ue,style:{...Ge,cursor:"grab",userSelect:"none"},children:[f.jsx("span",{style:{fontSize:10,color:"var(--text3)",cursor:"grab"},children:""}),ce.photoURL?f.jsx("img",{src:ce.photoURL,style:{width:18,height:18,borderRadius:"50%"},alt:"",referrerPolicy:"no-referrer"}):f.jsx("span",{style:{fontSize:12},children:""}),f.jsxs("span",{children:[Ff({displayName:ce.displayName,nickname:ce.nickname,isTeacherViewing:!0}),ce.section&&k==="all"?`  ${ce.section}`:""]})]},ce.uid))})]})]})}function Xk(){const{courseId:e}=_l(),{userRole:t}=un(),n=ui(),[s,a]=M.useState(!0),[l,i]=M.useState(null),[p,g]=M.useState([]),[v,u]=M.useState(null),[h,y]=M.useState(null),[x,T]=M.useState(5),[_,E]=M.useState(""),[R,P]=M.useState(!1),[B,X]=M.useState(!1),[Q,K]=M.useState({name:"",description:"",cost:25,icon:""});M.useEffect(()=>{if(t!=="teacher"){n("/");return}k()},[e,t]),M.useEffect(()=>{v&&I()},[v]);async function k(){a(!0);try{const O=await Mt(Fe(be,"courses",e));if(O.exists()){const xe={id:O.id,...O.data()};i(xe);const Le=yM(xe).sort((Oe,De)=>{const re=parseInt(Oe.name.replace(/\D/g,""))||0,Ie=parseInt(De.name.replace(/\D/g,""))||0;return re-Ie});g(Le),Le.length>0&&u(Le[0].id)}}catch(O){console.error("Error loading course:",O)}a(!1)}async function I(){if(v)try{const O=await Fr(e,v);y(O)}catch(O){console.error("Error loading mana:",O)}}async function N(){const O={...h,enabled:!h.enabled};y(O),await xr(e,v,O)}async function U(){_.trim()&&(R?await ym(e,v,x,_.trim()):await t8(e,v,x,_.trim(),"teacher"),E(""),await I())}async function z(O,xe){O>0?await t8(e,v,O,xe,"teacher"):await ym(e,v,Math.abs(O),xe),await I()}async function q(O){try{await NR(e,v,O),await I()}catch(xe){alert(xe.message)}}async function D(O){await PR(e,v,O),await I()}async function de(){await OR(e,v),await I()}async function je(){const O=await LR(e,v);O.decayed?alert(`Decayed ${O.decayAmount} MP  ${O.newMP} MP remaining`):alert("No decay needed (below threshold or already applied this week)"),await I()}async function W(){Q.name.trim()&&(await VR(e,v,Q),K({name:"",description:"",cost:25,icon:""}),X(!1),await I())}async function J(O){confirm("Remove this power?")&&(await BR(e,v,O),await I())}async function ve(){if(!confirm("Reset powers to defaults? Custom powers will be lost."))return;const O={...h,powers:uS};await xr(e,v,O),await I()}if(s)return f.jsx("div",{className:"page-container",style:{display:"flex",justifyContent:"center",paddingTop:120},children:f.jsx("div",{className:"spinner"})});if(p.length===0)return f.jsx("div",{className:"page-container",style:{padding:"48px 40px"},children:f.jsxs("div",{style:{maxWidth:800,margin:"0 auto",textAlign:"center",paddingTop:60},children:[f.jsx("p",{style:{fontSize:40,marginBottom:12},children:""}),f.jsx("h2",{style:{fontFamily:"var(--font-display)",marginBottom:8},children:"No Sections Found"}),f.jsx("p",{style:{color:"var(--text2)",marginBottom:20},children:"Mana pools are per-section. Add sections to your course first (via enroll codes)."}),f.jsx("button",{onClick:()=>n(`/course/${e}`),className:"btn btn-primary",children:" Back to Course"})]})});const Se=h?Math.min(h.currentMP/Ya*100,100):0,Re=Se<20?"#8b5cf6":Se>70?"#06b6d4":"#a78bfa",H={background:"var(--surface)",border:"1px solid var(--border)",borderRadius:12,padding:"18px 22px",marginBottom:16},Z={padding:"8px 16px",borderRadius:8,border:"none",fontWeight:600,fontSize:13,cursor:"pointer",background:Re,color:"#fff"},te={padding:"8px 16px",borderRadius:8,border:"1px solid var(--border)",fontWeight:600,fontSize:13,cursor:"pointer",background:"transparent",color:"var(--text2)"},fe={padding:"4px 10px",borderRadius:6,border:"1px solid var(--border)",background:"transparent",color:"var(--red)",cursor:"pointer",fontSize:12,fontWeight:600},F=p.find(O=>O.id===v)?.name||v;return f.jsx("div",{className:"page-container",style:{padding:"48px 40px"},children:f.jsxs("div",{style:{maxWidth:800,margin:"0 auto"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14,marginBottom:8},children:[f.jsx("button",{onClick:()=>n(`/course/${e}`),style:{...te,padding:"6px 12px"},children:" Back"}),f.jsx("h1",{style:{fontFamily:"var(--font-display)",fontSize:26,fontWeight:700},children:" Mana Pool"})]}),f.jsxs("p",{style:{color:"var(--text2)",fontSize:14,marginBottom:20},children:[l?.title,"  Manage mana per section"]}),f.jsxs("div",{style:{...H,display:"flex",alignItems:"center",gap:14,background:`${Re}08`,borderColor:`${Re}33`},children:[f.jsx("span",{style:{fontSize:14,fontWeight:600,color:"var(--text2)"},children:"Section:"}),f.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:p.map(O=>f.jsx("button",{onClick:()=>u(O.id),style:{padding:"8px 18px",borderRadius:8,border:"none",fontWeight:600,fontSize:14,cursor:"pointer",background:v===O.id?Re:"var(--surface2)",color:v===O.id?"#fff":"var(--text2)",transition:"all 0.15s"},children:O.name},O.id))})]}),h?f.jsxs(f.Fragment,{children:[f.jsxs("div",{style:H,children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14},children:[f.jsxs("label",{style:{display:"flex",alignItems:"center",gap:10,fontSize:15,fontWeight:600},children:[f.jsx("input",{type:"checkbox",checked:h?.enabled||!1,onChange:N,style:{accentColor:Re,width:18,height:18}}),"Mana Pool Enabled  ",F]}),f.jsxs("div",{style:{fontFamily:"var(--font-display)",fontSize:28,fontWeight:700,color:Re},children:[h.currentMP,f.jsxs("span",{style:{fontSize:14,color:"var(--text3)",fontWeight:400},children:["/",Ya," MP"]})]})]}),f.jsx("div",{style:{height:14,background:"var(--surface2)",borderRadius:7,overflow:"hidden",marginBottom:16},children:f.jsx("div",{style:{width:`${Se}%`,height:"100%",background:`linear-gradient(90deg, #8b5cf6, ${Re})`,borderRadius:7,transition:"width 0.6s ease",boxShadow:`0 0 12px ${Re}44`}})}),f.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginBottom:14},children:[{label:"+5 Good Behavior",amount:5,reason:"Good class behavior"},{label:"+5 Quiz Scores",amount:5,reason:"Strong quiz scores"},{label:"+15 Attendance",amount:15,reason:"Perfect attendance day"},{label:"+10 Participation",amount:10,reason:"Great participation"},{label:"5 Disruption",amount:-5,reason:"Class disruption"}].map(O=>f.jsx("button",{onClick:()=>z(O.amount,O.reason),style:{padding:"6px 12px",borderRadius:6,border:`1px solid ${O.amount>0?"var(--green)":"var(--red)"}33`,background:`${O.amount>0?"var(--green)":"var(--red)"}11`,color:O.amount>0?"var(--green)":"var(--red)",fontSize:12,fontWeight:600,cursor:"pointer"},children:O.label},O.label))}),f.jsxs("div",{style:{display:"flex",gap:8,alignItems:"flex-end",flexWrap:"wrap"},children:[f.jsxs("div",{children:[f.jsxs("label",{style:{fontSize:11,color:"var(--text3)",display:"block",marginBottom:3},children:[R?"Deduct":"Award"," Amount"]}),f.jsx("input",{type:"number",min:1,max:Ya,value:x,onChange:O=>T(parseInt(O.target.value)||0),style:{width:60,padding:"6px 10px",borderRadius:6,border:"1px solid var(--border)",background:"var(--surface2)",color:"var(--text1)",fontSize:13,textAlign:"center"}})]}),f.jsxs("div",{style:{flex:1},children:[f.jsx("label",{style:{fontSize:11,color:"var(--text3)",display:"block",marginBottom:3},children:"Reason"}),f.jsx("input",{type:"text",value:_,placeholder:"e.g. Great lab behavior",onChange:O=>E(O.target.value),onKeyDown:O=>O.key==="Enter"&&U(),style:{width:"100%",padding:"6px 10px",borderRadius:6,border:"1px solid var(--border)",background:"var(--surface2)",color:"var(--text1)",fontSize:13}})]}),f.jsx("button",{onClick:U,disabled:!_.trim(),style:{...Z,opacity:_.trim()?1:.5},children:R?"Deduct":"Award"}),f.jsx("button",{onClick:()=>P(!R),style:te,children:R?"Switch to Award":"Switch to Deduct"})]})]}),f.jsxs("div",{style:H,children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14},children:[f.jsx("div",{style:{fontSize:16,fontWeight:700},children:" Powers"}),f.jsxs("div",{style:{display:"flex",gap:6},children:[f.jsx("button",{onClick:()=>X(!0),style:Z,children:"+ Add Power"}),f.jsx("button",{onClick:ve,style:te,children:"Reset Defaults"})]})]}),B&&f.jsxs("div",{style:{background:"var(--surface2)",borderRadius:8,padding:14,marginBottom:12},children:[f.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:8},children:[f.jsx("input",{type:"text",placeholder:"Power name",value:Q.name,onChange:O=>K({...Q,name:O.target.value}),style:{flex:1,minWidth:120,padding:"6px 10px",borderRadius:6,border:"1px solid var(--border)",background:"var(--bg)",color:"var(--text1)",fontSize:13}}),f.jsx("input",{type:"text",placeholder:"Icon",value:Q.icon,maxLength:4,onChange:O=>K({...Q,icon:O.target.value}),style:{width:50,padding:"6px 10px",borderRadius:6,border:"1px solid var(--border)",background:"var(--bg)",color:"var(--text1)",fontSize:13,textAlign:"center"}}),f.jsx("input",{type:"number",min:5,max:100,value:Q.cost,onChange:O=>K({...Q,cost:parseInt(O.target.value)||5}),style:{width:60,padding:"6px 10px",borderRadius:6,border:"1px solid var(--border)",background:"var(--bg)",color:"var(--text1)",fontSize:13,textAlign:"center"}}),f.jsx("span",{style:{fontSize:12,color:"var(--text3)",alignSelf:"center"},children:"MP"})]}),f.jsx("input",{type:"text",placeholder:"Description",value:Q.description,onChange:O=>K({...Q,description:O.target.value}),style:{width:"100%",padding:"6px 10px",borderRadius:6,border:"1px solid var(--border)",background:"var(--bg)",color:"var(--text1)",fontSize:13,marginBottom:8}}),f.jsxs("div",{style:{display:"flex",gap:6},children:[f.jsx("button",{onClick:W,disabled:!Q.name.trim(),style:{...Z,opacity:Q.name.trim()?1:.5},children:"Create"}),f.jsx("button",{onClick:()=>X(!1),style:te,children:"Cancel"})]})]}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:(h?.powers||[]).map(O=>{const xe=(h?.currentMP||0)>=O.cost,Le=h?.activeVote===O.id,Oe=h?.votes?.[O.id]||[],De=Oe.filter(Ie=>Ie.vote===!0).length,re=Oe.filter(Ie=>Ie.vote===!1).length;return f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 14px",borderRadius:8,background:Le?`${Re}11`:"var(--surface2)",border:Le?`1px solid ${Re}44`:"1px solid transparent"},children:[f.jsx("span",{style:{fontSize:20},children:O.icon||""}),f.jsxs("div",{style:{flex:1},children:[f.jsx("div",{style:{fontWeight:600,fontSize:14},children:O.name}),f.jsx("div",{style:{fontSize:12,color:"var(--text3)"},children:O.description}),Le&&f.jsxs("div",{style:{fontSize:11,color:Re,marginTop:4},children:[" Voting: ",De," yes, ",re," no (",De+re," total)"]})]}),f.jsxs("span",{style:{fontSize:13,fontWeight:700,color:xe?Re:"var(--text3)"},children:[O.cost," MP"]}),f.jsxs("div",{style:{display:"flex",gap:4},children:[Le?f.jsx("button",{onClick:de,style:te,children:"End Vote"}):f.jsx("button",{onClick:()=>D(O.id),style:te,children:"Start Vote"}),f.jsx("button",{onClick:()=>q(O.id),disabled:!xe,style:{...Z,opacity:xe?1:.4},children:"Activate"}),f.jsx("button",{onClick:()=>J(O.id),style:fe,children:""})]})]},O.id)})})]}),f.jsxs("div",{style:H,children:[f.jsx("div",{style:{fontSize:16,fontWeight:700,marginBottom:10},children:" Maintenance"}),f.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[f.jsx("button",{onClick:je,style:te,children:"Apply Weekly Decay (10% above 50 MP)"}),f.jsx("button",{onClick:async()=>{confirm(`Reset ${F} mana to 0? History will be cleared.`)&&(await xr(e,v,{...h,currentMP:0,history:[],votes:{},activeVote:null}),await I())},style:{...te,color:"var(--red)",borderColor:"var(--red)"},children:"Reset Pool to 0"})]})]}),(h?.history||[]).length>0&&f.jsxs("div",{style:H,children:[f.jsxs("div",{style:{fontSize:16,fontWeight:700,marginBottom:12},children:[" History  ",F]}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:(h.history||[]).slice(0,20).map((O,xe)=>f.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",padding:"6px 0",borderBottom:xe<Math.min((h.history||[]).length,20)-1?"1px solid var(--border)":"none"},children:[f.jsxs("span",{style:{fontSize:13,fontWeight:700,minWidth:60,color:O.type==="gain"?"var(--green)":O.type==="decay"?"var(--text3)":"var(--red)"},children:[O.type==="gain"?"+":"",O.amount," MP"]}),f.jsx("span",{style:{fontSize:13,color:"var(--text2)",flex:1},children:O.reason}),f.jsx("span",{style:{fontSize:11,color:"var(--text3)"},children:O.timestamp?new Date(O.timestamp).toLocaleDateString():""})]},xe))})]})]}):f.jsx("div",{style:{textAlign:"center",padding:40,color:"var(--text3)"},children:"Loading mana state..."})]})})}function yl(e){return Array.isArray(e)?e.map(yl):e!==null&&typeof e=="object"&&!(e instanceof Date)?Object.fromEntries(Object.entries(e).filter(([t,n])=>n!==void 0).map(([t,n])=>[t,yl(n)])):e}const Yf=[{id:"dragon",name:"The Review Dragon",icon:"",baseHP:10,description:"A fearsome dragon that guards the knowledge vault"},{id:"golem",name:"The Quiz Golem",icon:"",baseHP:12,description:"An ancient stone construct powered by unanswered questions"},{id:"hydra",name:"The Concept Hydra",icon:"",baseHP:8,description:"Cut one head, two more grow  unless you answer correctly"},{id:"phantom",name:"The Exam Phantom",icon:"",baseHP:10,description:"A ghostly specter that feeds on test anxiety"},{id:"kraken",name:"The Knowledge Kraken",icon:"",baseHP:14,description:"Lurks in the deep, grasping at half-remembered facts"},{id:"chimera",name:"The Final Chimera",icon:"",baseHP:16,description:"Part lion, part eagle, part serpent  all challenge"}],Yk={hint:{id:"hint",name:"Hint",icon:"",description:"Spend 5 mana to eliminate one wrong answer",manaCost:5},shield:{id:"shield",name:"Shield",icon:"",description:"Block damage to class HP on your next wrong answer",cooldownQuestions:3},criticalHit:{id:"criticalHit",name:"Critical Hit",icon:"",description:"Double damage on your next correct answer",cooldownQuestions:4}},o8=[{id:"time-drain",name:"Time Drain",icon:"",description:"Your next answer timer is shorter",classDamage:1},{id:"confusion",name:"Confusion",icon:"",description:"Options shuffled on your next question",classDamage:1},{id:"rage",name:"Boss Rage",icon:"",description:"Boss heals 1 HP",classDamage:1,bossHeal:1},{id:"poison",name:"Poison",icon:"",description:"Class takes extra damage",classDamage:2}];function Kk(e,t,n=4){const s=t*n;return Math.max(e.baseHP,Math.round(s*1.5))}function Jk(e,t=4){const n=e*t;return Math.max(10,Math.round(n*1.2))}function Zk(e="normal"){return{easy:1,normal:2,hard:3}[e]||2}async function eI(e,{bossId:t,questions:n,teamIds:s,teamNames:a,teamColors:l}){const i=Yf.find(x=>x.id===t)||Yf[0],p=Kk(i,s.length),g=Jk(s.length),v=`battle-${Date.now().toString(36)}`,u={};s.forEach((x,T)=>{const _=n.map((E,R)=>R);for(let E=_.length-1;E>0;E--){const R=Math.floor(Math.random()*(E+1));[_[E],_[R]]=[_[R],_[E]]}u[x]={name:a?.[T]||`Team ${T+1}`,color:l?.[T]||"#888",questionOrder:_,currentIndex:0,correctCount:0,wrongCount:0,damage:0,shieldActive:!1,criticalHitActive:!1,shieldCooldown:0,critCooldown:0,finished:!1}});const h=yl({id:v,courseId:e,boss:{id:i.id,name:i.name,icon:i.icon,description:i.description||"",baseHP:i.baseHP,maxHP:p,currentHP:p},classHP:{max:g,current:g},status:"active",questions:n.map(x=>({prompt:x.prompt||"",options:x.options||[],correctIndex:x.correctIndex??0,explanation:x.explanation||"",difficulty:x.difficulty||"normal",source:x.source||""})),teamProgress:u,log:[],createdAt:new Date().toISOString()}),y=Fe(be,"courses",e,"bossBattles",v);return await At(y,h),h}function tI(e,t,n){const s=Fe(be,"courses",e,"bossBattles",t);return Hf(s,a=>{a.exists()&&n(a.data())})}async function nI(e,t,n,s){const a=Fe(be,"courses",e,"bossBattles",t);return Xb(be,async l=>{const i=await l.get(a);if(!i.exists())throw new Error("Battle not found");const p=i.data();if(p.status!=="active")return{battle:p,result:null};const g=p.teamProgress[n];if(!g||g.finished)return{battle:p,result:null};const v=g.questionOrder[g.currentIndex],u=p.questions[v];if(!u)return{battle:p,result:null};const h=s===u.correctIndex,y={correct:h,team:g.name,teamColor:g.color,teamId:n,questionPrompt:u.prompt,timestamp:new Date().toISOString()};if(h){let x=Zk(u.difficulty);g.criticalHitActive&&(x*=2,g.criticalHitActive=!1,y.criticalHit=!0),p.boss.currentHP=Math.max(0,p.boss.currentHP-x),g.damage+=x,g.correctCount++,y.damage=x,y.type="attack"}else{g.wrongCount++,y.type="miss";const x=o8[Math.floor(Math.random()*o8.length)];if(y.counterattack=x,g.shieldActive)g.shieldActive=!1,y.shielded=!0;else{const T=x.classDamage||1;p.classHP.current=Math.max(0,p.classHP.current-T),y.classDamage=T,x.bossHeal&&(p.boss.currentHP=Math.min(p.boss.maxHP,p.boss.currentHP+x.bossHeal),y.bossHeal=x.bossHeal)}}return g.currentIndex++,g.currentIndex>=g.questionOrder.length&&(g.finished=!0),g.shieldCooldown>0&&g.shieldCooldown--,g.critCooldown>0&&g.critCooldown--,p.boss.currentHP<=0?(p.status="victory",y.victory=!0):(p.classHP.current<=0||Object.values(p.teamProgress).every(T=>T.finished))&&(p.status="defeat",y.defeat=!0),p.log=[y,...p.log||[]].slice(0,50),p.teamProgress[n]=g,p.lastUpdated=new Date().toISOString(),l.set(a,yl(p)),{battle:p,result:y}})}async function rI(e,t,n,s){const a=Fe(be,"courses",e,"bossBattles",t);return Xb(be,async l=>{const i=await l.get(a);if(!i.exists())throw new Error("Battle not found");const p=i.data(),g=p.teamProgress[n];if(!g)return{error:"Team not found"};const v=Yk[s];if(!v)return{error:"Unknown ability"};if(s==="shield"){if(g.shieldActive)return{error:"Shield already active"};if(g.shieldCooldown>0)return{error:`Shield on cooldown (${g.shieldCooldown} questions)`};g.shieldActive=!0,g.shieldCooldown=v.cooldownQuestions}else if(s==="criticalHit"){if(g.criticalHitActive)return{error:"Critical hit already charged"};if(g.critCooldown>0)return{error:`Crit on cooldown (${g.critCooldown} questions)`};g.criticalHitActive=!0,g.critCooldown=v.cooldownQuestions}const u={type:"ability",team:g.name,teamColor:g.color,teamId:n,ability:v.name,abilityIcon:v.icon,timestamp:new Date().toISOString()};return p.log=[u,...p.log||[]].slice(0,50),p.teamProgress[n]=g,p.lastUpdated=new Date().toISOString(),l.set(a,yl(p)),{error:null}})}async function l8(e,t,n="defeat"){const s=Fe(be,"courses",e,"bossBattles",t),a=await Mt(s);if(!a.exists())return;const l=a.data();l.status=n,l.lastUpdated=new Date().toISOString(),await At(s,yl(l))}async function iI(e){return(await ct(it(be,"courses",e,"bossBattles"))).docs.map(n=>n.data()).sort((n,s)=>(s.createdAt||"").localeCompare(n.createdAt||""))}function Up(e){return(e.blocks||[]).filter(t=>t.type!=="question"?!1:!!(t.questionType==="multiple_choice"||Array.isArray(t.options)&&t.options.length>=2&&t.correctIndex!=null)).map(t=>({prompt:t.prompt||"",options:t.options||[],correctIndex:t.correctIndex??0,explanation:t.explanation||"",difficulty:"normal",source:e.title||""}))}const Kf=128;function le(e,t,n,s){t<0||t>=Kf||n<0||n>=Kf||(e.fillStyle=s,e.fillRect(t,n,1,1))}function Tr(e,t,n,s,a){const l=s*s;for(let i=-s;i<=s;i++)for(let p=-s;p<=s;p++)p*p+i*i<=l&&le(e,Math.round(t+p),Math.round(n+i),a)}function Lg(e,t,n,s,a,l){for(let i=-a;i<=a;i++)for(let p=-s;p<=s;p++)p*p/(s*s)+i*i/(a*a)<=1&&le(e,Math.round(t+p),Math.round(n+i),l)}function c8(e,t){const n=t%4<2?0:1;Lg(e,64,120+n,44,7,"rgba(0,0,0,0.3)");const a=t%10<5?10:3;for(let u=-1;u<=1;u+=2){for(let h=18;h<=72;h++){const y=(h-18)/54,x=Math.floor(Math.sin(y*Math.PI)*(20+a));for(let T=0;T<=x;T++){const _=64+u*(22+T);if(_<0||_>=128)continue;const E=T/(x||1),R=Math.sin(T*.5+h*.2)>.5;let P;E>.9?P="#0e3818":R?P="#1a5828":E>.6?P="#28703880":P="#30884890",le(e,_,h+n,P)}}for(let h=22;h<=65;h++)le(e,64+u*22,h+n,"#1a4828"),le(e,64+u*23,h+n,"#0e3018");le(e,64+u*22,20+n,"#c8b870"),le(e,64+u*23,19+n,"#d8c880"),le(e,64+u*22,19+n,"#b8a860")}for(let u=0;u<24;u++){const h=u/23,y=82+u*2.5+Math.round(Math.sin(t*.08+u*.3)*3),x=90+Math.round(Math.sin(h*Math.PI*.7)*-10)+n;if(y>=0&&y<128&&x>=0&&x<128){const T=Math.max(1,5-Math.floor(h*4));for(let _=-T;_<=T;_++){const E=Math.abs(_)/(T||1);let R;E>.7?R="#0e3818":_>0&&E>.3?R="#70c870":R="#28944a",y+_>=0&&y+_<128&&le(e,y+_,x,R)}u%3===0&&T>2&&(le(e,Math.round(y),x-T-1,"#c8a020"),le(e,Math.round(y),x-T,"#e8d040"))}}const l=Math.min(126,142+Math.round(Math.sin(t*.08+7.2)*3)),i=80+n;if(l<126)for(let u=0;u<5;u++)le(e,l+u,i-u,"#28944a"),le(e,l+u,i+u,"#28944a"),le(e,l+u+1,i-u,"#1a5828"),le(e,l+u+1,i+u,"#1a5828");for(let u=34;u<=100;u++){const h=(u-34)/66,y=Math.floor(20+Math.sin(h*Math.PI*.7)*14);for(let x=-y;x<=y;x++){const T=Math.abs(x)/y,_=((64+x)*5+u*7)%6;let E;T>.9?E="#0e3818":T>.75?E="#165c28":T>.5?E="#28944a":T>.25?E="#3cba60":E="#48c868",_===0&&T<.85&&(E="#60e078"),x>0&&T>.2&&T<.65&&h>.2&&h<.8&&(E="#b8d868"),le(e,64+x,u+n,E)}}for(let u=48;u<=92;u+=4)for(let h=3;h<=14;h++)le(e,64+h,u+n,"#d8f098"),le(e,64+h,u+1+n,"#c8e088");for(let u=0;u<2;u++){const h=u===0?44:78;for(let y=86;y<=112;y++){const x=(y-86)/26,T=5+Math.floor((1-x*.4)*4);for(let _=-T;_<=T;_++){const E=Math.abs(_)/T;let R;E>.8?R="#0e3818":E>.5?R="#1a5828":R="#28944a",le(e,h+_,y+n,R)}}for(let y=0;y<3;y++){const x=h-4+y*4;le(e,x,113+n,"#d8c880"),le(e,x,114+n,"#c8b870"),le(e,x,115+n,"#b8a860"),le(e,x+1,113+n,"#c8b870")}}for(let u=14;u<=44;u++){const h=(u-14)/30,y=58+Math.round(Math.sin(h*.8)*3),x=10+Math.floor(h*6);for(let T=-x;T<=x;T++){const _=Math.abs(T)/x;let E;_>.88?E="#0e3818":_>.7?E="#165c28":_>.4?E="#28944a":E="#3cba60",T>0&&_>.2&&_<.65&&(E="#a0c868"),le(e,y+T,u+n,E)}u%3===0&&(le(e,y-x+1,u+n,"#c8a020"),le(e,y-x,u+n,"#e8d040"))}const p=58+Math.round(Math.sin(t*.05)*2);for(let u=4;u<=24;u++){const h=(u-4)/20,y=Math.floor(14+Math.sin(h*Math.PI*.6)*4-h*4);for(let x=-y;x<=y;x++){const T=Math.abs(x)/(y||1);let _;T>.9?_="#0e3818":T>.7?_="#165c28":h>.7?_="#1a5828":T>.4?_="#28944a":_="#38b058",le(e,p+x,u+n,_)}}for(let u=0;u<2;u++){const h=u===0?-1:1;for(let y=0;y<12;y++){const x=y/11,T=p+h*(10+x*8),_=6-x*6+n,E=Math.max(1,3-Math.floor(x*2.5)),R=x<.3?"#8a7830":x<.6?"#c8b040":"#e8d860";for(let P=-E;P<=E;P++)Math.abs(P)<=E&&le(e,Math.round(T)+P,Math.round(_),R)}}for(let u=-14;u<=14;u++){const h=Math.abs(u)<8?3:2;for(let y=0;y<h;y++)le(e,p+u,9+y+n,"#0e3818")}const g=t%8<4;for(let u=0;u<2;u++){const h=p+(u===0?-7:7),y=12+n;for(let x=-3;x<=3;x++)for(let T=-4;T<=4;T++)Math.sqrt((T*.8)**2+x**2)<=3.5&&le(e,h+T,y+x,"#0a1808");Tr(e,h,y,3,g?"#ff9030":"#e87020"),Tr(e,h,y,2,g?"#ffe060":"#ffb040"),le(e,h,y,"#1a0808"),le(e,h,y-1,"#1a0808"),le(e,h,y+1,"#1a0808"),le(e,h-1,y-1,"#fff8");for(let x=-5;x<=5;x++)for(let T=-6;T<=6;T++){const _=Math.sqrt(T*T+x*x);if(_>4&&_<=6){const E=.12-(_-4)*.06;E>0&&le(e,h+T,y+x,`rgba(255,144,48,${E})`)}}}le(e,p-4,19+n,"#0a1808"),le(e,p-3,19+n,"#0a1808"),le(e,p+3,19+n,"#0a1808"),le(e,p+4,19+n,"#0a1808"),t%6<3&&(le(e,p-5,18+n,"rgba(180,180,180,0.3)"),le(e,p+5,17+n,"rgba(180,180,180,0.25)"));for(let u=-10;u<=10;u++)le(e,p+u,22+n,"#0e3818"),Math.abs(u)<8&&le(e,p+u,23+n,"#0a1808");le(e,p-7,23+n,"#f0ece0"),le(e,p-7,24+n,"#e0dcd0"),le(e,p+7,23+n,"#f0ece0"),le(e,p+7,24+n,"#e0dcd0"),le(e,p-4,24+n,"#f0ece0"),le(e,p+4,24+n,"#f0ece0");const v=t%20;if(v<10){const u=Math.sin(v/10*Math.PI),h=Math.floor(u*18);for(let y=0;y<h;y++){const x=y/(h||1),T=Math.floor((1-x*.6)*5*u),_=p+Math.round(Math.sin(t*.4+y*.3)*x*3),E=25+y+n;for(let R=-T;R<=T;R++){const P=Math.abs(R)/(T||1);let B;P<.3?B=x<.3?"#fff8e0":"#ffed4a":P<.6?B=x<.4?"#ffb830":"#f39c12":B=x<.5?"#e67e22":"#c0501880",_+R>=0&&_+R<128&&E>=0&&E<128&&le(e,_+R,E,B)}}for(let y=0;y<4;y++){const x=p+Math.round(Math.sin(t*.3+y*2)*6),T=26+h+y*2+n;T<128&&le(e,x,T,y%2===0?"#ffed4a60":"#f39c1240")}}for(let u=0;u<8;u++){const h=52-u*1,y=36+u*5+n;le(e,h,y-2,"#e8d040"),le(e,h,y-1,"#c8a020"),le(e,h+1,y-2,"#f8e870")}for(let u=0;u<3;u++)if((t+u*7)%14<5){const h=40+(t*3+u*23)%48,y=20+(t*2+u*17)%30;le(e,h,y+n,"#f39c1230")}}function sI(e,t){const n=t%4<2?0:1;Lg(e,64,118+n,38,6,"rgba(0,0,0,0.3)");for(let v=0;v<2;v++){const u=v===0?44:84;for(let h=88;h<=114;h++){const y=(h-88)/26,x=6+Math.floor(y*4);for(let T=-x;T<=x;T++){const _=Math.abs(T)/x,E=((u+T)*7+h*11)%7,R=65+Math.floor((1-_)*30)+E*2;le(e,u+T,h+n,`rgb(${R},${Math.floor(R*.95)},${Math.floor(R*.85)})`)}}for(let h=-10;h<=10;h++)for(let y=0;y<5;y++){const x=60+Math.abs(h)+y*3;le(e,u+h,114+y+n,`rgb(${x},${Math.floor(x*.95)},${Math.floor(x*.85)})`)}}for(let v=30;v<=95;v++){const u=(v-30)/65,h=Math.floor(24+Math.sin(u*Math.PI*.7)*12);for(let y=-h;y<=h;y++){const x=Math.abs(y)/h,T=((64+y)*7+v*13)%9,E=(x>.85?50:x>.6?65:x>.3?78:88)+T*2;le(e,64+y,v+n,`rgb(${Math.floor(E*.6)},${Math.floor(E*.58)},${Math.floor(E*.52)})`)}}[[50,48,6,.4],[78,55,8,-.3],[58,72,5,.5],[72,80,7,-.2]].forEach(([v,u,h,y])=>{for(let x=0;x<h;x++){const T=Math.round(v+Math.cos(y)*x*2),_=Math.round(u+Math.sin(y)*x*2)+n;le(e,T,_,"#2a2820"),le(e,T,_+1,"#35332a")}});for(let v=8;v<=36;v++){const u=(v-8)/28,h=Math.floor(16+Math.sin(u*Math.PI*.85)*8);for(let y=-h;y<=h;y++){const x=Math.abs(y)/h,T=((64+y)*5+v*9)%7,E=(x>.85?55:x>.5?70:85)+T*2;le(e,64+y,v+n,`rgb(${Math.floor(E*.6)},${Math.floor(E*.58)},${Math.floor(E*.52)})`)}}for(let v=-18;v<=18;v++){const u=Math.abs(v)<6?3:2;for(let h=0;h<u;h++)le(e,64+v,16+h+n,"#403a30")}const a=t%8<4?["#50ff70","#40e060","#30c050"]:["#40e060","#30c050","#20a040"];for(let v=0;v<2;v++){const u=v===0?52:76;for(let h=-4;h<=4;h++)for(let y=-5;y<=5;y++)Math.sqrt(y*y+h*h*1.4)<=5&&le(e,u+y,22+h+n,"#1a1a15");for(let h=-3;h<=3;h++)for(let y=-3;y<=3;y++){const x=Math.sqrt(y*y+h*h);x<=3&&le(e,u+y,22+h+n,x<1.2?a[0]:x<2.2?a[1]:a[2])}for(let h=-6;h<=6;h++)for(let y=-7;y<=7;y++){const x=Math.sqrt(y*y+h*h);if(x>4&&x<=7){const T=.15-(x-4)*.05;T>0&&le(e,u+y,22+h+n,`rgba(80,255,112,${T})`)}}}for(let v=-10;v<=10;v++){const u=30+(v%3===0?1:0);le(e,64+v,u+n,"#2a2820"),v%4===0&&le(e,64+v,u+1+n,"#2a2820")}for(let v=0;v<2;v++){const h=64+(v===0?-1:1)*36,y=Math.sin(t*.05+v*Math.PI)*2;for(let _=36;_<=90;_++){const E=(_-36)/54,R=7+Math.floor(Math.sin(E*Math.PI*.6)*5);for(let P=-R;P<=R;P++){const B=Math.abs(P)/R,X=((h+P)*7+_*11)%6,Q=60+Math.floor((1-B)*30)+X*2;le(e,h+P+Math.round(y*E),_+n,`rgb(${Q},${Math.floor(Q*.95)},${Math.floor(Q*.85)})`)}}const x=88+n+Math.round(y),T=h+Math.round(y*.8);for(let _=-5;_<=8;_++)for(let E=-9;E<=9;E++){const R=Math.sqrt((E*.7)**2+_**2);if(R<=8){const P=70+Math.floor((1-R/8)*25);le(e,T+E,x+_,`rgb(${P},${Math.floor(P*.95)},${Math.floor(P*.85)})`)}}}for(let v=0;v<2;v++){const u=v===0?34:94;Tr(e,u,34+n,10,"#5a5848"),Tr(e,u,34+n,8,"#6a6858"),Tr(e,u,33+n,5,"#787668")}const l=40+Math.sin(t*.15)*25,i=`hsl(140, 85%, ${l}%)`,p=64,g=58+n;for(let v=-6;v<=6;v++)le(e,p+v,g,i),le(e,p,g+v,i);for(let v=0;v<16;v++){const u=v/16*Math.PI*2;le(e,p+Math.round(Math.cos(u)*8),g+Math.round(Math.sin(u)*8),i)}for(let v=0;v<2;v++){const u=v===0?30:98;le(e,u,55+n,i),le(e,u-1,56+n,i),le(e,u+1,56+n,i),le(e,u,57+n,i)}le(e,64,12+n,i),le(e,63,13+n,i),le(e,65,13+n,i),le(e,64,14+n,i);for(let v=-12;v<=12;v++)for(let u=-12;u<=12;u++){const h=Math.sqrt(u*u+v*v);if(h>8&&h<=12){const y=.08-(h-8)*.02;y>0&&le(e,p+u,g+v,`hsla(140, 85%, ${l}%, ${y})`)}}}function aI(e,t){const n=t%4<2?0:1;for(let a=102;a<128;a++){const l=Math.sin(t*.04+a*.15)*3;for(let i=0;i<128;i++){const g=.2+Math.sin(i*.1+t*.06+a*.05)*.15-(a-102)*.005;g>.02&&le(e,i+Math.round(l),a,`rgba(20,80,50,${g})`)}}for(let a=68;a<=108;a++){const l=(a-68)/40,i=Math.floor(22+Math.sin(l*Math.PI)*12);for(let p=-i;p<=i;p++){const g=Math.abs(p)/i,v=((64+p)*5+a*7)%5;let u;g>.88?u="#0e3018":g>.7?u="#1a4a2a":g>.4?u="#247838":u="#2c9848",v===0&&g<.85&&(u="#38b458"),le(e,64+p,a+n,u)}}for(let a=75;a<=100;a+=4)for(let l=-8;l<=8;l++)le(e,64+l,a+n,"#70c870"),le(e,64+l,a+1+n,"#60b060");[{cx:30,ty:12,sw:Math.sin(t*.09)*5},{cx:64,ty:6,sw:Math.sin(t*.08+1.2)*3},{cx:98,ty:12,sw:Math.sin(t*.09+2.4)*5}].forEach((a,l)=>{const i=a.cx+Math.round(a.sw);for(let g=a.ty+18;g<=76;g++){const v=(g-(a.ty+18))/(76-a.ty-18),u=Math.round(i+(64-i)*v*v),h=4+Math.floor(v*5);for(let y=-h;y<=h;y++){const x=Math.abs(y)/h;let T;x>.85?T="#0e3018":x>.6?T="#1a5a2a":T="#28a048",y>0&&x>.3&&x<.7&&(T="#60b868"),le(e,u+y,g+n,T)}}for(let g=-8;g<=8;g++){const v=12-(g+8)*.25;for(let u=-Math.floor(v);u<=Math.floor(v);u++){const h=Math.abs(u)/v;let y;h>.9?y="#0e3018":h>.6?y="#1a5a2a":g>2?y="#60b868":y="#30b050",le(e,i+u,a.ty+g+n,y)}}const p=(t+l*5)%10<5;for(let g=0;g<2;g++){const v=i+(g===0?-5:5),u=a.ty-2+n;if(Tr(e,v,u,3,"#1a0505"),Tr(e,v,u,2,p?"#ff5050":"#cc2828"),le(e,v,u,p?"#ff8888":"#ff4444"),p)for(let h=0;h<8;h++){const y=h/8*Math.PI*2;le(e,v+Math.round(Math.cos(y)*4),u+Math.round(Math.sin(y)*4),"rgba(255,50,50,0.15)")}}if(le(e,i-4,a.ty+7+n,"#e8e0d0"),le(e,i-3,a.ty+9+n,"#e8e0d0"),le(e,i+4,a.ty+7+n,"#e8e0d0"),le(e,i+3,a.ty+9+n,"#e8e0d0"),(t+l*4)%12<6){const g=a.ty+10+n;le(e,i,g,"#d04050"),le(e,i,g+1,"#d04050"),le(e,i-1,g+2,"#d04050"),le(e,i+1,g+2,"#d04050"),le(e,i-2,g+3,"#c03040"),le(e,i+2,g+3,"#c03040")}for(let g=0;g<3;g++){const v=i-3+g*3;le(e,v,a.ty-8+n,"#50c060"),le(e,v,a.ty-9+n,"#40a050"),le(e,v,a.ty-10+n,"#308040")}});for(let a=0;a<4;a++){const l=30+(t*3+a*31)%68,i=100+(t*2+a*17)%20;(t+a*7)%8<4&&le(e,l,i+n,"#50ff7060")}}function oI(e,t){const n=Math.sin(t*.07)*4,s=Math.round(n);for(let l=95;l<=122;l++){const i=(l-95)/27;for(let p=30;p<=98;p++){const g=Math.sin(t*.06+p*.12+l*.08)*6,v=p+Math.round(g);if(v>=0&&v<128){const u=(.4-i*.4)*(1-Math.abs(p-64)/40);u>.02&&le(e,v,l+s,`rgba(140,100,220,${u})`)}}}for(let l=28;l<=100;l++){const i=(l-28)/72,p=14+Math.sin(i*Math.PI*.7)*14,g=i>.6?Math.sin(l*.15+t*.08)*(i-.6)*20:0,v=Math.floor(p+g);for(let u=-v;u<=v+Math.floor(g*.3);u++){const h=64+u;if(h<0||h>=128)continue;const y=Math.abs(u)/(v||1),x=i>.85?1-(i-.85)/.15:1;let T,_;y>.85?(T=60,_=x*.7):y>.6?(T=80,_=x*.85):y>.3?(T=100,_=x*.95):(T=115,_=x),le(e,h,l+s,`rgba(${T},${Math.floor(T*.65)},${Math.floor(T*1.6)},${_})`)}}for(let l=8;l<=38;l++){const i=(l-8)/30,p=Math.floor(14+Math.sin(i*Math.PI*.85)*12);for(let g=-p;g<=p;g++){const v=Math.abs(g)/p;let u;v>.9?u=40:v>.7?u=50:i<.3?u=65:u=55,le(e,64+g,l+s,`rgb(${Math.floor(u*.65)},${Math.floor(u*.45)},${Math.floor(u*1.1)})`)}}for(let l=16;l<=34;l++){const i=Math.floor(8+Math.sin((l-16)/18*Math.PI)*6);for(let p=-i;p<=i;p++)le(e,64+p,l+s,"#08030f")}const a=t%8<4;for(let l=0;l<2;l++){const i=l===0?54:74,p=24+s;for(let g=-5;g<=5;g++)for(let v=-5;v<=5;v++){const u=Math.sqrt(v*v+g*g);if(u>3&&u<=5){const h=.2-(u-3)*.1;le(e,i+v,p+g,`rgba(255,60,60,${h})`)}}Tr(e,i,p,3,a?"#ff5050":"#cc2828"),Tr(e,i,p,2,a?"#ff8888":"#ff4444"),le(e,i,p,"#ffcccc")}for(let l=0;l<2;l++){const i=l===0?-1:1,p=64+i*32,g=Math.sin(t*.06+l*Math.PI)*4;for(let v=0;v<10;v++){const u=v/9,h=Math.round(p+i*(v*2+g*u)),y=Math.round(56+Math.sin(u*Math.PI)*-8)+s,x=.6-u*.4;Tr(e,h,y,Math.max(1,3-Math.floor(u*2)),`rgba(140,100,200,${x})`)}for(let v=0;v<3;v++){const u=p+i*(18+Math.round(g)),h=50+v*3+s;for(let y=0;y<4;y++)le(e,u+i*y,h+(v-1)*y,`rgba(200,180,240,${.5-y*.1})`)}}for(let l=0;l<6;l++){const i=t*.04+l*Math.PI*2/6,p=30+Math.sin(t*.03+l)*10,g=Math.round(64+Math.cos(i)*p),v=Math.round(50+Math.sin(i)*p*.6)+s;(t+l*5)%10<6&&g>=0&&g<128&&v>=0&&v<128&&(le(e,g,v,"#c0a0f060"),le(e,g+1,v,"#c0a0f030"))}}function lI(e,t){const n=t%4<2?0:1;for(let s=0;s<8;s++){const a=30+s*10,l=(s-3.5)*.15;for(let p=0;p<28;p++){const g=p/28,v=Math.sin(t*.07+s*1+p*.25)*(6+g*10),u=Math.floor(a+v+l*p*3),h=72+p*2+n;if(u<0||u>=128||h>=128)continue;const y=Math.max(1,Math.floor(4-g*3));for(let x=-y;x<=y;x++){const _=Math.abs(x)/(y||1)>.6?"#6a1818":g>.7?"#982828":"#b83030";u+x>=0&&u+x<128&&le(e,u+x,h,_)}p%4===0&&y>1&&le(e,u,h,"#d06060")}const i=Math.floor(a+Math.sin(t*.07+s*1+7)*16+l*84);i>=0&&i<128&&le(e,i,Math.min(127,126+n),"#d06060")}for(let s=10;s<=78;s++){const a=(s-10)/68,l=Math.floor(20+Math.sin(a*Math.PI*.75)*18);for(let i=-l;i<=l;i++){const p=Math.abs(i)/l;let g;p>.9?g="#4a0e0e":p>.75?g="#6a1818":p>.5?g="#8a2424":p>.25?g="#b03030":g="#c83838",((64+i)*7+s*11)%11<1&&p<.8&&(g="#d84848"),le(e,64+i,s+n,g)}}[[50,35],[78,35],[45,50],[83,50],[55,62],[73,62],[64,44]].forEach(([s,a])=>{const l=Math.sin(t*.1+s*.1+a*.1)*.5+.5;Tr(e,s,a+n,2,`rgba(255,200,100,${.2+l*.4})`),le(e,s,a+n,`rgba(255,240,180,${.3+l*.5})`)});for(let s=0;s<2;s++){const a=s===0?48:80,l=38+n;for(let i=-7;i<=7;i++)for(let p=-8;p<=8;p++){const g=Math.sqrt((p*.85)**2+i**2);g<=7&&le(e,a+p,l+i,g>5.5?"#1a0808":"#ffed4a")}for(let i=-5;i<=5;i++){const p=Math.max(1,2-Math.abs(i));for(let g=-p;g<=p;g++)le(e,a+g,l+i,"#1a0505")}for(let i=0;i<20;i++){const p=i/20*Math.PI*2;le(e,a+Math.round(Math.cos(p)*5),l+Math.round(Math.sin(p)*5),"#d4a020")}for(let i=-10;i<=10;i++)for(let p=-11;p<=11;p++){const g=Math.sqrt(p**2+i**2);if(g>8&&g<=11){const v=.1-(g-8)*.03;v>0&&le(e,a+p,l+i,`rgba(255,237,74,${v})`)}}}for(let s=50;s<=62;s++){const a=Math.max(0,6-Math.floor((s-50)*.4));for(let l=-a;l<=a;l++)le(e,64+l,s+n,Math.abs(l)/(a||1)>.5?"#1a0808":"#2a1010")}le(e,64,63+n,"#e8e0d0"),le(e,63,62+n,"#e8e0d0"),le(e,65,62+n,"#e8e0d0");for(let s=0;s<5;s++)if((t+s*6)%12<5){const a=20+(t*5+s*23)%88,l=90+(t*3+s*11)%30;le(e,a,l+n,"#4090c050")}}function cI(e,t){const n=t%4<2?0:1;Lg(e,64,120+n,42,7,"rgba(0,0,0,0.25)");const a=t%10<5?8:2;for(let g=-1;g<=1;g+=2){for(let v=28;v<=62;v++){const u=(v-28)/34,h=Math.floor(Math.sin(u*Math.PI)*(16+a));for(let y=0;y<=h;y++){const x=64+g*(24+y);if(x<0||x>=128)continue;const T=y/(h||1),_=Math.sin(y*.4+v*.3)>0;let E;T>.85?E="#6a4010":_?E="#a87830":E="#c09040",le(e,x,v+n,E)}}for(let v=30;v<=56;v++)le(e,64+g*24,v+n,"#5a3810")}for(let g=0;g<22;g++){const v=g/21,u=92+g*3+Math.round(Math.sin(t*.1+g*.35)*4),h=72-g+Math.round(Math.cos(t*.08+g*.3)*3)+n;if(u>=0&&u<128&&h>=0&&h<128){const y=Math.max(1,4-Math.floor(v*3));for(let x=-y;x<=y;x++){const T=v>.7?"#1a6a2a":"#28943a";u+x>=0&&u+x<128&&le(e,u+x,h,T)}}}const l=Math.min(126,158+Math.round(Math.sin(t*.1+7.7)*4)),i=50+Math.round(Math.cos(t*.08+6.6)*3)+n;l<126&&i>0&&i<126&&(Tr(e,l,i,3,"#30a848"),le(e,l-1,i-1,"#ff4040"),le(e,l+1,i-1,"#ff4040"),t%8<4&&(le(e,l+3,i,"#d04050"),le(e,l+4,i-1,"#c03040"),le(e,l+4,i+1,"#c03040")));for(let g=44;g<=96;g++){const v=(g-44)/52,u=Math.floor(20+Math.sin(v*Math.PI*.7)*12);for(let h=-u;h<=u;h++){const y=Math.abs(h)/u;let x;y>.88?x="#7a4a1a":y>.65?x="#a06820":y>.35?x="#c48838":x="#d8a050",((64+h)*3+g*7)%6<1&&y<.8&&(x="#e0b060"),le(e,64+h,g+n,x)}}for(let g=12;g<=50;g++){const v=(g-12)/38,u=Math.floor(20+Math.sin(v*Math.PI)*14);for(let h=-u;h<=u;h++){const y=Math.abs(h)/u;if(!(Math.sin(h*.7+t*.15+g*.2)>.2)&&y>.6)continue;let T;y>.8?T="#8a5010":y>.5?T="#c07820":T="#d89030",le(e,64+h,g+n,T)}}for(let g=18;g<=44;g++){const v=(g-18)/26,u=Math.floor(12+Math.sin(v*Math.PI)*6);for(let h=-u;h<=u;h++){const y=Math.abs(h)/u;let x;y>.85?x="#a06820":y>.5?x="#d0a048":x="#e0b860",le(e,64+h,g+n,x)}}const p=t%6<3;for(let g=0;g<2;g++){const v=g===0?54:74,u=28+n;for(let h=-3;h<=3;h++)for(let y=-4;y<=4;y++)Math.sqrt((y*.8)**2+h**2)<=3.5&&le(e,v+y,u+h,"#1a0808");Tr(e,v,u,3,p?"#ff9920":"#e08010"),le(e,v,u,"#1a0808"),le(e,v-1,u-1,"#fff8")}le(e,63,36+n,"#4a2810"),le(e,64,36+n,"#4a2810"),le(e,65,36+n,"#4a2810");for(let g=-6;g<=6;g++)le(e,64+g,39+n,"#3a1808");le(e,58,40+n,"#f0e8d0"),le(e,59,41+n,"#f0e8d0"),le(e,70,40+n,"#f0e8d0"),le(e,69,41+n,"#f0e8d0");for(let g=0;g<6;g++)le(e,63+(g<3?-1:1),19-g+n,g<2?"#f0d860":"#d4a040"),le(e,64,19-g+n,"#e8c848"),le(e,65+(g<3?1:-1),19-g+n,g<2?"#f0d860":"#d4a040");for(let g=0;g<2;g++){const v=g===0?46:82;for(let u=88;u<=114;u++){const h=(u-88)/26,y=4+Math.floor((1-h)*3);for(let x=-y;x<=y;x++){const T=Math.abs(x)/y;le(e,v+x,u+n,T>.6?"#7a4a1a":"#a06820")}}for(let u=0;u<3;u++){const h=v-3+u*3;le(e,h,115+n,"#e0d0b0"),le(e,h,116+n,"#d0c0a0"),le(e,h,117+n,"#c0b090")}}if(t%6<3)for(let g=0;g<3;g++){const v=78+g*4+Math.round(Math.sin(t*.3+g)*2),u=36+g*2+n;le(e,v,u,"#f39c12"),le(e,v+1,u,"#ffed4a60")}}function uI(e,t,n){e.clearRect(0,0,Kf,Kf),t==="dragon"?c8(e,n):t==="golem"?sI(e,n):t==="hydra"?aI(e,n):t==="phantom"?oI(e,n):t==="kraken"?lI(e,n):t==="chimera"?cI(e,n):c8(e,n)}function dI({bossId:e="dragon",size:t=200,hit:n=!1,lowHP:s=!1}){const a=M.useRef(null),l=M.useRef(0),i=M.useRef(null);return M.useEffect(()=>{const p=a.current;if(!p)return;const g=p.getContext("2d");g.imageSmoothingEnabled=!1;let v=!0;function u(){v&&(l.current++,uI(g,e,l.current),i.current=setTimeout(()=>requestAnimationFrame(u),120))}return u(),()=>{v=!1,i.current&&clearTimeout(i.current)}},[e]),f.jsx("canvas",{ref:a,width:128,height:128,style:{width:t,height:t,imageRendering:"pixelated",animation:n?"bossHit 0.6s ease":void 0,filter:s?"hue-rotate(15deg) saturate(1.5) brightness(0.9)":"none",transition:"filter 0.5s"}})}const Br={red:{icon:"",name:"Warrior",sprite:"",color:"#e74c3c"},blue:{icon:"",name:"Mage",sprite:"",color:"#3498db"},green:{icon:"",name:"Ranger",sprite:"",color:"#2ecc71"},purple:{icon:"",name:"Sorcerer",sprite:"",color:"#9b59b6"},orange:{icon:"",name:"Paladin",sprite:"",color:"#f39c12"},cyan:{icon:"",name:"Rogue",sprite:"",color:"#00cec9"},pink:{icon:"",name:"Cleric",sprite:"",color:"#fd79a8"},yellow:{icon:"",name:"Monk",sprite:"",color:"#fdcb6e"}},tl={dragon:{bg:"radial-gradient(ellipse at 50% 120%, #4a1a0a 0%, #1a0505 50%, #0a0a0f 100%)",particles:["","","",""],particleColor:"#f39c12",glowColor:"#e74c3c",ambientAnim:"dragonFlicker",art:`<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="dg" cx="50%" cy="50%"><stop offset="0%" stop-color="#ff6b35"/><stop offset="100%" stop-color="#c0392b"/></radialGradient>
        <filter id="dglow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <ellipse cx="100" cy="130" rx="60" ry="35" fill="#1a0505" opacity="0.5"/>
      <path d="M60 120 Q40 80 55 50 Q65 70 75 60 Q80 40 100 35 Q120 40 125 60 Q135 70 145 50 Q160 80 140 120 Z" fill="url(#dg)" filter="url(#dglow)"/>
      <path d="M55 50 Q45 30 35 40" stroke="#ff6b35" stroke-width="3" fill="none"/>
      <path d="M145 50 Q155 30 165 40" stroke="#ff6b35" stroke-width="3" fill="none"/>
      <circle cx="85" cy="75" r="6" fill="#ffed4a"/>
      <circle cx="115" cy="75" r="6" fill="#ffed4a"/>
      <circle cx="85" cy="75" r="3" fill="#1a0505"/>
      <circle cx="115" cy="75" r="3" fill="#1a0505"/>
      <path d="M85 100 Q100 115 115 100" stroke="#ffed4a" stroke-width="2" fill="none"/>
      <path d="M88 100 L92 108 L96 100 L100 108 L104 100 L108 108 L112 100" stroke="#fff" stroke-width="1.5" fill="none"/>
      <path d="M40 110 Q20 90 30 70 Q35 85 45 95 Z" fill="#c0392b" opacity="0.8"/>
      <path d="M160 110 Q180 90 170 70 Q165 85 155 95 Z" fill="#c0392b" opacity="0.8"/>
    </svg>`},golem:{bg:"radial-gradient(ellipse at 50% 120%, #2a2a1a 0%, #111108 50%, #0a0a0f 100%)",particles:["","","",""],particleColor:"#95a5a6",glowColor:"#7f8c8d",ambientAnim:"golemPulse",art:`<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="gg" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#7f8c8d"/><stop offset="100%" stop-color="#4a4a3a"/></linearGradient>
        <filter id="gglow"><feGaussianBlur stdDeviation="2" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <ellipse cx="100" cy="155" rx="55" ry="20" fill="#111108" opacity="0.5"/>
      <rect x="60" y="60" width="80" height="90" rx="8" fill="url(#gg)" filter="url(#gglow)"/>
      <rect x="70" y="45" width="60" height="25" rx="6" fill="#6a6a5a"/>
      <rect x="55" y="80" width="15" height="50" rx="4" fill="#5a5a4a"/>
      <rect x="130" y="80" width="15" height="50" rx="4" fill="#5a5a4a"/>
      <rect x="80" cy="68" r="8" fill="#2ecc71"/>
      <circle cx="82" cy="58" r="7" fill="#2ecc71" filter="url(#gglow)"/>
      <circle cx="118" cy="58" r="7" fill="#2ecc71" filter="url(#gglow)"/>
      <circle cx="82" cy="58" r="3" fill="#0a3a0a"/>
      <circle cx="118" cy="58" r="3" fill="#0a3a0a"/>
      <line x1="85" y1="100" x2="115" y2="100" stroke="#4a4a3a" stroke-width="3" stroke-linecap="round"/>
      <path d="M65 105 L70 115 L75 105" stroke="#555" stroke-width="1" fill="none"/>
      <path d="M125 105 L130 115 L135 105" stroke="#555" stroke-width="1" fill="none"/>
    </svg>`},hydra:{bg:"radial-gradient(ellipse at 50% 120%, #0a2a1a 0%, #051510 50%, #0a0a0f 100%)",particles:["","","",""],particleColor:"#2ecc71",glowColor:"#27ae60",ambientAnim:"hydraSlither",art:`<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="hg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#27ae60"/><stop offset="100%" stop-color="#1a5a2a"/></linearGradient>
        <filter id="hglow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <ellipse cx="100" cy="160" rx="50" ry="15" fill="#051510" opacity="0.5"/>
      <path d="M80 140 Q60 100 50 60 Q55 50 65 55 Q60 80 80 110 Z" fill="url(#hg)" filter="url(#hglow)"/>
      <path d="M100 140 Q100 90 100 50 Q110 45 115 50 Q110 90 110 140 Z" fill="url(#hg)" filter="url(#hglow)"/>
      <path d="M120 140 Q140 100 150 60 Q145 50 135 55 Q140 80 120 110 Z" fill="url(#hg)" filter="url(#hglow)"/>
      <circle cx="55" cy="55" r="5" fill="#ff4444"/>
      <circle cx="105" cy="48" r="5" fill="#ff4444"/>
      <circle cx="145" cy="55" r="5" fill="#ff4444"/>
      <circle cx="55" cy="55" r="2" fill="#1a0505"/>
      <circle cx="105" cy="48" r="2" fill="#1a0505"/>
      <circle cx="145" cy="55" r="2" fill="#1a0505"/>
      <ellipse cx="100" cy="150" rx="35" ry="20" fill="#1a5a2a"/>
    </svg>`},phantom:{bg:"radial-gradient(ellipse at 50% 120%, #1a1a2a 0%, #0a0a15 50%, #050510 100%)",particles:["","","",""],particleColor:"#9b59b6",glowColor:"#8e44ad",ambientAnim:"phantomFloat",art:`<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="pg" cx="50%" cy="40%"><stop offset="0%" stop-color="#bb88ee" stop-opacity="0.9"/><stop offset="100%" stop-color="#6a3a9a" stop-opacity="0.4"/></radialGradient>
        <filter id="pglow"><feGaussianBlur stdDeviation="5" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <path d="M60 160 Q60 60 100 40 Q140 60 140 160 L130 145 L120 160 L110 145 L100 160 L90 145 L80 160 L70 145 Z" fill="url(#pg)" filter="url(#pglow)"/>
      <ellipse cx="82" cy="85" rx="12" ry="15" fill="#0a0a15"/>
      <ellipse cx="118" cy="85" rx="12" ry="15" fill="#0a0a15"/>
      <circle cx="82" cy="85" r="5" fill="#ff4444" opacity="0.8"/>
      <circle cx="118" cy="85" r="5" fill="#ff4444" opacity="0.8"/>
      <ellipse cx="100" cy="110" rx="8" ry="12" fill="#0a0a15"/>
    </svg>`},kraken:{bg:"radial-gradient(ellipse at 50% 120%, #0a1a2a 0%, #050f1a 50%, #020810 100%)",particles:["","","",""],particleColor:"#3498db",glowColor:"#2980b9",ambientAnim:"krakenWave",art:`<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="kg" cx="50%" cy="50%"><stop offset="0%" stop-color="#e74c3c"/><stop offset="100%" stop-color="#8b1a1a"/></radialGradient>
        <filter id="kglow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <ellipse cx="100" cy="80" rx="40" ry="35" fill="url(#kg)" filter="url(#kglow)"/>
      <circle cx="85" cy="72" r="8" fill="#ffed4a"/>
      <circle cx="115" cy="72" r="8" fill="#ffed4a"/>
      <circle cx="85" cy="72" r="4" fill="#1a0505"/>
      <circle cx="115" cy="72" r="4" fill="#1a0505"/>
      <path d="M60 100 Q40 140 30 170" stroke="#c0392b" stroke-width="8" fill="none" stroke-linecap="round"/>
      <path d="M70 105 Q55 145 50 170" stroke="#c0392b" stroke-width="7" fill="none" stroke-linecap="round"/>
      <path d="M130 105 Q145 145 150 170" stroke="#c0392b" stroke-width="7" fill="none" stroke-linecap="round"/>
      <path d="M140 100 Q160 140 170 170" stroke="#c0392b" stroke-width="8" fill="none" stroke-linecap="round"/>
      <path d="M85 95 Q100 110 115 95" stroke="#8b1a1a" stroke-width="2" fill="none"/>
    </svg>`},chimera:{bg:"radial-gradient(ellipse at 50% 120%, #2a1a0a 0%, #150a05 50%, #0a0a0f 100%)",particles:["","","",""],particleColor:"#f39c12",glowColor:"#d35400",ambientAnim:"chimeraRoar",art:`<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="cg" cx="50%" cy="50%"><stop offset="0%" stop-color="#f39c12"/><stop offset="100%" stop-color="#d35400"/></radialGradient>
        <filter id="cglow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <ellipse cx="100" cy="155" rx="55" ry="18" fill="#150a05" opacity="0.5"/>
      <ellipse cx="100" cy="95" rx="35" ry="30" fill="url(#cg)" filter="url(#cglow)"/>
      <path d="M65 85 Q50 50 40 60 Q55 55 65 75 Z" fill="#f39c12"/>
      <path d="M135 85 Q150 50 160 60 Q145 55 135 75 Z" fill="#f39c12"/>
      <path d="M70 70 Q60 40 75 45 Q70 55 75 65 Z" fill="#e67e22"/>
      <path d="M130 70 Q140 40 125 45 Q130 55 125 65 Z" fill="#e67e22"/>
      <path d="M80 65 Q85 35 95 50 Z" fill="#d35400"/>
      <path d="M120 65 Q115 35 105 50 Z" fill="#d35400"/>
      <circle cx="88" cy="88" r="6" fill="#fff"/>
      <circle cx="112" cy="88" r="6" fill="#fff"/>
      <circle cx="88" cy="88" r="3" fill="#1a0505"/>
      <circle cx="112" cy="88" r="3" fill="#1a0505"/>
      <path d="M90 108 Q100 118 110 108" stroke="#1a0505" stroke-width="2" fill="none"/>
      <path d="M92 108 L96 114 L100 108 L104 114 L108 108" stroke="#fff" stroke-width="1.5" fill="none"/>
      <path d="M75 130 Q70 155 65 165" stroke="#d35400" stroke-width="5" fill="none" stroke-linecap="round"/>
      <path d="M125 130 Q130 155 135 165" stroke="#d35400" stroke-width="5" fill="none" stroke-linecap="round"/>
    </svg>`}};function fI({amount:e,x:t,y:n,isCrit:s,type:a="damage"}){const[l,i]=M.useState(!0),p=An("CRIT!");if(M.useEffect(()=>{const u=setTimeout(()=>i(!1),1500);return()=>clearTimeout(u)},[]),!l)return null;const g=a==="damage"?s?"#ffed4a":"#e74c3c":a==="heal"?"#2ecc71":"#ff6b6b",v=a==="damage"?"-":"+";return f.jsxs("div",{style:{position:"absolute",left:t,top:n,pointerEvents:"none",zIndex:100,animation:"damageFloat 1.5s ease-out forwards",fontFamily:"var(--font-display)",fontSize:s?42:32,fontWeight:900,color:g,textShadow:`0 0 20px ${g}, 0 2px 4px rgba(0,0,0,0.8)`},children:[v,e,s&&f.jsx("span",{style:{fontSize:18,marginLeft:4},children:p||"CRIT!"})]})}function u8({particles:e=[""],count:t=15,speed:n=1,color:s="#fff"}){const a=M.useRef(Array.from({length:t},(l,i)=>({id:i,x:Math.random()*100,y:Math.random()*100,size:8+Math.random()*14,duration:3+Math.random()*4*(1/n),delay:Math.random()*5,char:e[Math.floor(Math.random()*e.length)],opacity:.15+Math.random()*.35}))).current;return f.jsx("div",{style:{position:"absolute",inset:0,overflow:"hidden",pointerEvents:"none",zIndex:1},children:a.map(l=>f.jsx("div",{style:{position:"absolute",left:`${l.x}%`,fontSize:l.size,opacity:l.opacity,animation:`particleRise ${l.duration}s linear ${l.delay}s infinite`},children:l.char},l.id))})}function hI({active:e,x:t="50%",y:n="50%",color:s="#e74c3c"}){return e?f.jsxs("div",{style:{position:"absolute",left:t,top:n,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:50},children:[Array.from({length:8}).map((a,l)=>f.jsx("div",{style:{position:"absolute",width:6,height:6,borderRadius:"50%",background:s,animation:"explodeParticle 0.6s ease-out forwards",transform:`rotate(${l*45}deg) translateY(-20px)`,opacity:0,animationDelay:`${l*.03}s`}},l)),f.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:`radial-gradient(circle, ${s}88, transparent)`,animation:"explodeRing 0.5s ease-out forwards",transform:"translate(-50%, -50%)"}})]}):null}function pI({active:e,color:t="#e74c3c"}){return e?f.jsx("div",{style:{position:"fixed",inset:0,background:t,opacity:0,zIndex:200,animation:"screenFlash 0.3s ease-out forwards",pointerEvents:"none"}}):null}function d8({bossId:e,size:t=160,hit:n=!1,lowHP:s=!1}){const a=tl[e]||tl.dragon;return f.jsxs("div",{style:{width:t,height:t,position:"relative"},children:[f.jsx("div",{style:{position:"absolute",inset:-20,borderRadius:"50%",background:`radial-gradient(circle, ${a.glowColor}44, transparent)`,animation:`${a.ambientAnim} 3s ease-in-out infinite`}}),f.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%"},children:f.jsx(dI,{bossId:e,size:t,hit:n,lowHP:s})})]})}const qp=`
  @keyframes damageFloat {
    0% { opacity: 1; transform: translateY(0) scale(0.5); }
    20% { opacity: 1; transform: translateY(-10px) scale(1.2); }
    100% { opacity: 0; transform: translateY(-80px) scale(0.8); }
  }
  @keyframes particleRise {
    0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
    10% { opacity: var(--particle-opacity, 0.3); }
    90% { opacity: var(--particle-opacity, 0.3); }
    100% { transform: translateY(-20px) rotate(360deg); opacity: 0; }
  }
  @keyframes explodeParticle {
    0% { opacity: 1; transform: rotate(var(--angle)) translateY(0) scale(1); }
    100% { opacity: 0; transform: rotate(var(--angle)) translateY(-60px) scale(0); }
  }
  @keyframes explodeRing {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 0.8; }
    100% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
  }
  @keyframes screenFlash {
    0% { opacity: 0.4; }
    100% { opacity: 0; }
  }
  @keyframes shieldPulse {
    0%, 100% { transform: scale(1); opacity: 0.4; }
    50% { transform: scale(1.05); opacity: 0.7; }
  }
  @keyframes bossIdle {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }
  @keyframes bossHit {
    0% { transform: scale(1) rotate(0); filter: brightness(1); }
    15% { transform: scale(0.85) rotate(-8deg); filter: brightness(3); }
    30% { transform: scale(1.15) rotate(5deg); filter: brightness(0.6); }
    50% { transform: scale(0.95) rotate(-3deg); filter: brightness(1.5); }
    100% { transform: scale(1) rotate(0); filter: brightness(1); }
  }
  @keyframes screenShake {
    0%, 100% { transform: translateX(0) translateY(0); }
    10% { transform: translateX(-10px) translateY(-5px); }
    20% { transform: translateX(10px) translateY(3px); }
    30% { transform: translateX(-8px) translateY(-3px); }
    40% { transform: translateX(8px) translateY(5px); }
    50% { transform: translateX(-5px) translateY(-2px); }
    60% { transform: translateX(5px) translateY(2px); }
    80% { transform: translateX(-2px) translateY(-1px); }
  }
  @keyframes dragonFlicker {
    0%, 100% { opacity: 0.5; transform: scale(1); }
    25% { opacity: 0.7; transform: scale(1.05); }
    50% { opacity: 0.4; transform: scale(0.98); }
    75% { opacity: 0.65; transform: scale(1.03); }
  }
  @keyframes golemPulse {
    0%, 100% { opacity: 0.4; transform: scale(1); }
    50% { opacity: 0.6; transform: scale(1.02); }
  }
  @keyframes hydraSlither {
    0%, 100% { opacity: 0.5; transform: translateX(0); }
    33% { opacity: 0.6; transform: translateX(-5px); }
    66% { opacity: 0.4; transform: translateX(5px); }
  }
  @keyframes phantomFloat {
    0%, 100% { opacity: 0.3; transform: translateY(0) scale(1); }
    50% { opacity: 0.6; transform: translateY(-8px) scale(1.05); }
  }
  @keyframes krakenWave {
    0%, 100% { opacity: 0.4; transform: scale(1) rotate(0); }
    50% { opacity: 0.6; transform: scale(1.03) rotate(1deg); }
  }
  @keyframes chimeraRoar {
    0%, 100% { opacity: 0.5; transform: scale(1); }
    30% { opacity: 0.7; transform: scale(1.06); }
    60% { opacity: 0.4; transform: scale(0.97); }
  }
  @keyframes teamBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-4px); }
  }
  @keyframes victoryBurst {
    0% { transform: scale(0) rotate(-180deg); opacity: 0; }
    50% { transform: scale(1.3) rotate(10deg); opacity: 1; }
    100% { transform: scale(1) rotate(0); opacity: 1; }
  }
  @keyframes defeatSink {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(20px) scale(0.9); opacity: 0.6; }
  }
  @keyframes hpDrain {
    0% { filter: brightness(1); }
    50% { filter: brightness(1.5); }
    100% { filter: brightness(1); }
  }
`,Oc={background:"var(--surface)",border:"1px solid var(--border)",borderRadius:12,padding:"18px 22px",marginBottom:16},is=(e="#e74c3c")=>({padding:"8px 16px",borderRadius:8,border:"none",fontWeight:700,fontSize:13,cursor:"pointer",background:e,color:"#fff"}),sf={padding:"8px 16px",borderRadius:8,border:"1px solid var(--border)",fontWeight:600,fontSize:13,cursor:"pointer",background:"transparent",color:"var(--text2)"};function mI(){const{courseId:e}=_l(),{user:t,userRole:n}=un(),s=ui(),a=n==="teacher",l=on(a?[]:["BOSS HP","CLASS HP","Attack!","Hint","Shield","Crit","Shield Active","Crit Ready","Damage!","Shield Blocked!","Miss!","Class takes","damage!","Correct:","Next Question ","All Questions Answered!","You dealt","total damage.","Watching your classmates finish the fight...","Spectating","You're not on a team in this battle. Watch the action unfold!","Team Damage","Live","VICTORY!","DEFEATED","The class united to slay","overwhelmed the class...","survives with","HP...","Team Rankings","Total Damage","Correct","Class HP Left","Back to Course","No Active Battle","Your teacher hasn't started a boss battle yet.","Not enough class mana (need 5 MP)"]),i=(Ne,ke)=>l?.[Ne]??ke,[p,g]=M.useState("setup"),[v,u]=M.useState(null),[h,y]=M.useState([]),[x,T]=M.useState([]),[_,E]=M.useState(null),[R,P]=M.useState(!0),[B,X]=M.useState([]),[Q,K]=M.useState(Yf[0].id),[k,I]=M.useState([]),[N,U]=M.useState([]),[z,q]=M.useState(!1),[D,de]=M.useState({prompt:"",options:["","","",""],correctIndex:0}),[je,W]=M.useState("all"),[J,ve]=M.useState(null),[Se,Re]=M.useState(null),[H,Z]=M.useState(!1),[te,fe]=M.useState(null),[F,O]=M.useState(!1),[xe,Le]=M.useState(null),[Oe,De]=M.useState(!1),[re,Ie]=M.useState(null),[Xe,se]=M.useState(!1),[Ue,$]=M.useState(!1),[ee,ge]=M.useState([]),[me,we]=M.useState(!1),[Ce,Te]=M.useState("#e74c3c"),[Pe,Ge]=M.useState(!1),ce=M.useRef(null),ze=M.useRef(null),Je=M.useRef(null);M.useEffect(()=>(dt(),()=>{Je.current&&Je.current()}),[e]);async function dt(){P(!0);try{const Ne=await Mt(Fe(be,"courses",e));Ne.exists()&&u({id:Ne.id,...Ne.data()});const ke=await ct(Kt(it(be,"courses",e,"lessons"),Ln("order","asc")));y(ke.docs.map(qe=>({id:qe.id,...qe.data()})));const $e=await Au(e);if(T($e),t&&!a){for(const qe of $e)if((qe.members||[]).some(xt=>xt.uid===t.uid)){ve(qe.id);break}}const Ye=await iI(e);X(Ye);const Ze=Ye.find(qe=>qe.status==="active");Ze&&(nt(Ze.id),g("battle"));try{Ie(await Fr(e))}catch{}}catch(Ne){console.error("Error loading boss battle data:",Ne)}P(!1)}function nt(Ne){Je.current&&Je.current(),Je.current=tI(e,Ne,ke=>{if(ce.current!==null&&ke.boss.currentHP<ce.current){se(!0),Ge(!0);const $e=ce.current-ke.boss.currentHP;ge(Ye=>[...Ye,{id:Date.now(),amount:$e,isCrit:$e>=4,x:`${40+Math.random()*20}%`,y:`${15+Math.random()*10}%`}]),setTimeout(()=>{se(!1),Ge(!1)},700),setTimeout(()=>ge(Ye=>Ye.filter(Ze=>Date.now()-Ze.id<1500)),2e3)}ze.current!==null&&ke.classHP.current<ze.current&&($(!0),setTimeout(()=>$(!1),600)),ce.current=ke.boss.currentHP,ze.current=ke.classHP.current,E(ke),(ke.status==="victory"||ke.status==="defeat")&&g("results")})}async function Vt(){try{let Ne=[];for(const qe of k){const xt=h.find(Pn=>Pn.id===qe);xt&&Ne.push(...Up(xt))}if(Ne.push(...N),Ne.length<3){alert(`Need at least 3 MC questions (found ${Ne.length})`);return}const ke=je==="all"?x:x.filter(qe=>qe.section===je);if(ke.length<2){alert(`Need at least 2 teams (found ${ke.length})`);return}Ne=Ne.sort(()=>Math.random()-.5);const $e=ke.map(qe=>Ni.find(Pn=>Pn.id===qe.color)?.hex||"#888"),Ye=ke.map(qe=>je==="all"&&qe.section?`${qe.name} (${qe.section})`:qe.name),Ze=await eI(e,{bossId:Q,questions:Ne,teamIds:ke.map(qe=>qe.id),teamNames:Ye,teamColors:$e});nt(Ze.id),g("battle")}catch(Ne){console.error("Boss battle launch error:",Ne),alert("Error launching battle: "+Ne.message)}}async function nn(){if(!(!_||!J||Se===null||Oe)){De(!0);try{const{result:Ne}=await nI(e,_.id,J,Se);Ne&&(fe(Ne),Z(!0),Ne.correct?(we(!0),Te(Ne.criticalHit?"#ffed4a":"#e74c3c"),setTimeout(()=>we(!1),400)):Ne.counterattack&&!Ne.shielded&&(we(!0),Te("#8b1a1a"),setTimeout(()=>we(!1),400)))}catch(Ne){console.error("Submit error:",Ne),alert("Error submitting answer: "+Ne.message)}De(!1)}}function Wn(){Re(null),Z(!1),fe(null),O(!1),Le(null)}async function Ft(Ne){if(!_||!J)return;if(Ne==="hint"){if(!re?.enabled||(re?.currentMP||0)<5){alert(i(36,"Not enough class mana (need 5 MP)"));return}await ym(e,5,"Boss Battle: Hint used"),Ie({...re,currentMP:re.currentMP-5});const $e=_.teamProgress[J];if($e){const Ye=$e.questionOrder[$e.currentIndex],Ze=_.questions[Ye];if(Ze){const qe=Ze.options.map((xt,Pn)=>Pn).filter(xt=>xt!==Ze.correctIndex&&xt!==xe);qe.length>0&&(Le(qe[Math.floor(Math.random()*qe.length)]),O(!0))}}return}const{error:ke}=await rI(e,_.id,J,Ne);ke&&alert(ke)}if(R)return f.jsx("div",{className:"page-container",style:{display:"flex",justifyContent:"center",paddingTop:120},children:f.jsx("div",{className:"spinner"})});if(p==="setup"&&a){const Ne=k.reduce((ke,$e)=>{const Ye=h.find(Ze=>Ze.id===$e);return ke+(Ye?Up(Ye).length:0)},0)+N.length;return f.jsx("div",{className:"page-container",style:{padding:"48px 40px"},children:f.jsxs("div",{style:{maxWidth:800,margin:"0 auto"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14,marginBottom:8},children:[f.jsx("button",{onClick:()=>s(`/course/${e}`),style:sf,children:" Back"}),f.jsx("h1",{style:{fontFamily:"var(--font-display)",fontSize:26,fontWeight:700},children:" Boss Battle Setup"})]}),f.jsxs("p",{style:{color:"var(--text2)",fontSize:14,marginBottom:28},children:[v?.title,"  Co-op raid: all teams fight simultaneously!"]}),f.jsxs("div",{style:Oc,children:[f.jsx("div",{style:{fontSize:16,fontWeight:700,marginBottom:12},children:"Choose a Boss"}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:10},children:Yf.map(ke=>f.jsxs("button",{onClick:()=>K(ke.id),style:{...Oc,marginBottom:0,cursor:"pointer",textAlign:"left",border:Q===ke.id?"2px solid var(--red)":"1px solid var(--border)",background:Q===ke.id?"rgba(231,76,60,0.08)":"var(--surface)"},children:[f.jsx("div",{style:{fontSize:32,marginBottom:6},children:ke.icon}),f.jsx("div",{style:{fontWeight:700,fontSize:14,color:"var(--text)"},children:ke.name}),f.jsx("div",{style:{fontSize:11,color:"var(--text3)",marginTop:2},children:ke.description})]},ke.id))})]}),f.jsxs("div",{style:Oc,children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[f.jsxs("div",{style:{fontSize:16,fontWeight:700},children:["Questions (",Ne,")"]}),f.jsx("button",{onClick:()=>q(!0),style:is("#8b5cf6"),children:"+ Custom Question"})]}),f.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text3)",marginBottom:8},children:"Pull from lessons:"}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6,marginBottom:12},children:h.map(ke=>{const $e=Up(ke).length;if($e===0)return null;const Ye=k.includes(ke.id);return f.jsxs("label",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 12px",borderRadius:8,background:Ye?"rgba(231,76,60,0.08)":"var(--surface2)",border:Ye?"1px solid var(--red)":"1px solid transparent",cursor:"pointer",fontSize:14},children:[f.jsx("input",{type:"checkbox",checked:Ye,onChange:()=>I(Ye?k.filter(Ze=>Ze!==ke.id):[...k,ke.id]),style:{accentColor:"var(--red)"}}),f.jsx("span",{style:{fontWeight:500},children:ke.title}),f.jsxs("span",{style:{color:"var(--text3)",fontSize:12,marginLeft:"auto"},children:[$e," MC questions"]})]},ke.id)})}),N.length>0&&f.jsxs("div",{style:{marginTop:12},children:[f.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text3)",marginBottom:6},children:"Custom questions:"}),N.map((ke,$e)=>f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:13,padding:"4px 0"},children:[f.jsx("span",{children:""}),f.jsxs("span",{style:{flex:1},children:[ke.prompt.substring(0,60),ke.prompt.length>60?"...":""]}),f.jsx("button",{onClick:()=>U(N.filter((Ye,Ze)=>Ze!==$e)),style:{background:"none",border:"none",color:"var(--red)",cursor:"pointer",fontSize:13},children:""})]},$e))]}),z&&f.jsxs("div",{style:{background:"var(--surface2)",borderRadius:8,padding:14,marginTop:12},children:[f.jsx("input",{type:"text",placeholder:"Question prompt",value:D.prompt,onChange:ke=>de({...D,prompt:ke.target.value}),style:{width:"100%",padding:"8px 12px",borderRadius:6,border:"1px solid var(--border)",background:"var(--bg)",color:"var(--text)",fontSize:14,marginBottom:8}}),D.options.map((ke,$e)=>f.jsxs("div",{style:{display:"flex",gap:8,marginBottom:6,alignItems:"center"},children:[f.jsx("input",{type:"radio",name:"correct",checked:D.correctIndex===$e,onChange:()=>de({...D,correctIndex:$e}),style:{accentColor:"var(--green)"}}),f.jsx("input",{type:"text",placeholder:`Option ${String.fromCharCode(65+$e)}`,value:ke,onChange:Ye=>{const Ze=[...D.options];Ze[$e]=Ye.target.value,de({...D,options:Ze})},style:{flex:1,padding:"6px 10px",borderRadius:6,border:"1px solid var(--border)",background:"var(--bg)",color:"var(--text)",fontSize:13}})]},$e)),f.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[f.jsx("button",{onClick:()=>{!D.prompt.trim()||D.options.some(ke=>!ke.trim())||(U([...N,{...D,difficulty:"normal",source:"Custom"}]),de({prompt:"",options:["","","",""],correctIndex:0}),q(!1))},style:is("#8b5cf6"),children:"Add"}),f.jsx("button",{onClick:()=>q(!1),style:sf,children:"Cancel"})]})]})]}),f.jsx("div",{style:Oc,children:(()=>{const ke=[...new Set(x.map(Ze=>Ze.section).filter(Boolean))].sort(),$e=je==="all",Ye=$e?x:x.filter(Ze=>Ze.section===je);return f.jsxs(f.Fragment,{children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:8},children:[f.jsxs("div",{style:{fontSize:16,fontWeight:700},children:["Teams (",Ye.length,")",$e&&Ye.length>0&&f.jsx("span",{style:{fontSize:12,fontWeight:400,color:"var(--text3)",marginLeft:8},children:" Global"})]}),ke.length>0&&f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[f.jsx("label",{style:{fontSize:12,color:"var(--text3)",fontWeight:600},children:"Period:"}),f.jsxs("select",{value:je,onChange:Ze=>W(Ze.target.value),style:{padding:"6px 12px",borderRadius:8,border:"1px solid var(--border)",background:"var(--surface2)",color:"var(--text)",fontSize:13,cursor:"pointer"},children:[f.jsx("option",{value:"all",children:" Global (All Periods)"}),ke.map(Ze=>f.jsx("option",{value:Ze,children:Ze},Ze))]})]})]}),Ye.length<2?f.jsxs("p",{style:{color:"var(--text3)",fontSize:13},children:["Need at least 2 teams. ",f.jsx("a",{href:`/teams/${e}`,style:{color:"var(--amber)"},children:"Set up teams "})]}):f.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:Ye.map(Ze=>{const qe=Ni.find(xt=>xt.id===Ze.color);return f.jsxs("div",{style:{padding:"6px 14px",borderRadius:8,background:qe?.dim||"#88888822",border:`1px solid ${qe?.hex||"#888"}44`,fontSize:13,fontWeight:600,color:qe?.hex||"#888",display:"flex",alignItems:"center",gap:6},children:[Ze.name," (",(Ze.members||[]).length,")",$e&&Ze.section&&f.jsx("span",{style:{fontSize:10,fontWeight:400,color:"var(--text3)",background:"var(--surface2)",padding:"1px 6px",borderRadius:4},children:Ze.section})]},Ze.id)})})]})})()}),(()=>{const ke=je==="all"?x:x.filter($e=>$e.section===je);return f.jsxs("button",{onClick:Vt,disabled:Ne<3||ke.length<2,style:{...is(),width:"100%",padding:"14px",fontSize:18,opacity:Ne>=3&&ke.length>=2?1:.4},children:[" Launch ",je==="all"?"Global ":"","Raid (",Ne," questions, ",ke.length," teams)"]})})(),B.filter(ke=>ke.status==="victory"||ke.status==="defeat").length>0&&f.jsxs("div",{style:{...Oc,marginTop:24},children:[f.jsx("div",{style:{fontSize:16,fontWeight:700,marginBottom:12},children:"Past Battles"}),B.filter(ke=>ke.status==="victory"||ke.status==="defeat").slice(0,5).map(ke=>f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"6px 0",fontSize:13},children:[f.jsx("span",{children:ke.boss?.icon}),f.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:ke.boss?.name}),f.jsx("span",{style:{color:ke.status==="victory"?"var(--green)":"var(--red)",fontWeight:700},children:ke.status==="victory"?" Victory":" Defeat"}),f.jsx("span",{style:{color:"var(--text3)",marginLeft:"auto"},children:ke.createdAt?new Date(ke.createdAt).toLocaleDateString():""})]},ke.id))]})]})})}if(p==="battle"&&_){const Ne=_.boss,ke=Ne.currentHP/Ne.maxHP*100,$e=_.classHP.current/_.classHP.max*100,Ye=tl[Ne.id]||tl.dragon,Ze=Object.entries(_.teamProgress||{}).map(([He,Nt])=>({id:He,...Nt})).sort((He,Nt)=>Nt.damage-He.damage),qe=J?_.teamProgress[J]:null,xt=qe&&!qe.finished?_.questions[qe.questionOrder[qe.currentIndex]]:null,Pn=qe?qe.currentIndex+1:0,rn=qe?qe.questionOrder.length:0;return f.jsxs("div",{style:{minHeight:"100vh",background:Ye.bg,animation:Ue?"screenShake 0.6s ease":"none",position:"relative",overflow:"hidden"},children:[f.jsx(pI,{active:me,color:Ce}),f.jsx(u8,{particles:Ye.particles,count:18,speed:.6,color:Ye.particleColor}),f.jsx("style",{children:qp}),ee.map(He=>f.jsx(fI,{amount:He.amount,x:He.x,y:He.y,isCrit:He.isCrit},He.id)),f.jsxs("div",{style:{maxWidth:900,margin:"0 auto",padding:"74px 30px 24px",position:"relative",zIndex:5},children:[f.jsxs("div",{style:{textAlign:"center",marginBottom:16,padding:"22px 20px 16px",background:"rgba(0,0,0,0.45)",border:`1px solid ${Ye.glowColor}33`,borderRadius:16,position:"relative",backdropFilter:"blur(10px)"},children:[f.jsx(hI,{active:Pe,color:Ye.glowColor}),f.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:8},children:f.jsx(d8,{bossId:Ne.id,size:320,hit:Xe,lowHP:ke<25})}),f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:22,fontWeight:800,color:"#fff",textShadow:`0 0 16px ${Ye.glowColor}88`,marginBottom:10},children:Ne.name}),f.jsxs("div",{style:{maxWidth:460,margin:"0 auto 10px"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,fontWeight:700,marginBottom:3},children:[f.jsxs("span",{style:{color:"#e74c3c"},"data-translatable":!0,children:[" ",i(0,"BOSS HP")]}),f.jsxs("span",{style:{color:ke<25?"#e74c3c":"rgba(255,255,255,0.6)"},children:[Ne.currentHP,"/",Ne.maxHP]})]}),f.jsx("div",{style:{height:18,background:"rgba(0,0,0,0.5)",borderRadius:9,overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)"},children:f.jsx("div",{style:{width:`${ke}%`,height:"100%",background:ke>50?"linear-gradient(90deg, #e74c3c, #c0392b)":ke>25?"linear-gradient(90deg, #f39c12, #e74c3c)":"linear-gradient(90deg, #c0392b, #7f1d1d)",borderRadius:9,transition:"width 0.6s ease",boxShadow:Xe?"0 0 16px #e74c3c88":"none"},children:f.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(180deg, rgba(255,255,255,0.15) 0%, transparent 50%)",borderRadius:9}})})})]}),f.jsxs("div",{style:{maxWidth:460,margin:"0 auto"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,fontWeight:700,marginBottom:3},children:[f.jsxs("span",{style:{color:"#2ecc71"},"data-translatable":!0,children:[" ",i(1,"CLASS HP")]}),f.jsxs("span",{style:{color:$e<25?"#e74c3c":"rgba(255,255,255,0.6)"},children:[_.classHP.current,"/",_.classHP.max]})]}),f.jsx("div",{style:{height:14,background:"rgba(0,0,0,0.5)",borderRadius:7,overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)"},children:f.jsx("div",{style:{width:`${$e}%`,height:"100%",background:$e>50?"linear-gradient(90deg, #2ecc71, #27ae60)":$e>25?"linear-gradient(90deg, #f39c12, #e67e22)":"linear-gradient(90deg, #e74c3c, #c0392b)",borderRadius:7,transition:"width 0.6s ease"}})})]})]}),f.jsxs("div",{style:{display:"grid",gridTemplateColumns:a?"1fr":"1fr 280px",gap:14},children:[f.jsxs("div",{children:[!a&&qe&&!qe.finished&&xt&&!H&&f.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:14,padding:"20px 24px",marginBottom:14,backdropFilter:"blur(10px)"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:10},children:[f.jsxs("span",{style:{fontSize:12,color:"rgba(255,255,255,0.3)"},children:["Q ",Pn,"/",rn]}),xt.source&&f.jsx("span",{style:{fontSize:11,color:"rgba(255,255,255,0.25)"},children:xt.source})]}),f.jsx("div",{style:{fontSize:17,fontWeight:600,marginBottom:18,lineHeight:1.65,color:"#fff"},children:xt.prompt}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:9},children:xt.options.map((He,Nt)=>{const Jt=xe===Nt,ur=Se===Nt,Oi=qe.color||"#888";return f.jsxs("button",{onClick:()=>!Jt&&Re(Nt),disabled:Jt,style:{display:"flex",alignItems:"center",gap:14,padding:"13px 16px",background:Jt?"rgba(255,255,255,0.02)":ur?`${Oi}33`:"rgba(255,255,255,0.06)",border:ur?`2px solid ${Oi}`:"1.5px solid rgba(255,255,255,0.1)",borderRadius:10,cursor:Jt?"default":"pointer",fontSize:15,textAlign:"left",color:Jt?"rgba(255,255,255,0.2)":"#fff",opacity:Jt?.3:1,textDecoration:Jt?"line-through":"none",transition:"all 0.2s"},children:[f.jsx("span",{style:{width:32,height:32,borderRadius:8,background:ur?Oi:"rgba(255,255,255,0.08)",color:ur?"#fff":"rgba(255,255,255,0.5)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:13,flexShrink:0,boxShadow:ur?`0 0 12px ${Oi}66`:"none"},children:String.fromCharCode(65+Nt)}),f.jsx("span",{children:He})]},Nt)})}),f.jsxs("div",{style:{display:"flex",gap:8,marginTop:16,flexWrap:"wrap"},children:[f.jsxs("button",{onClick:nn,disabled:Se===null||Oe,style:{...is(),padding:"10px 24px",fontSize:15,opacity:Se!==null?1:.4,boxShadow:Se!==null?"0 0 16px rgba(231,76,60,0.4)":"none"},"data-translatable":!0,children:[" ",Oe?"...":i(2,"Attack!")]}),f.jsxs("button",{onClick:()=>Ft("hint"),disabled:F||!re?.enabled,style:{padding:"8px 14px",borderRadius:8,border:"1px solid rgba(139,92,246,0.4)",background:"rgba(139,92,246,0.15)",color:"#bb88ee",fontWeight:700,fontSize:12,cursor:F||!re?.enabled?"default":"pointer",opacity:F||!re?.enabled?.3:1},"data-translatable":!0,children:[" ",i(3,"Hint")," ",re?.enabled?"(5MP)":""]}),f.jsxs("button",{onClick:()=>Ft("shield"),disabled:qe.shieldActive||qe.shieldCooldown>0,style:{padding:"8px 14px",borderRadius:8,border:"1px solid rgba(52,152,219,0.4)",background:"rgba(52,152,219,0.15)",color:"#66b3ff",fontWeight:700,fontSize:12,cursor:qe.shieldActive||qe.shieldCooldown>0?"default":"pointer",opacity:qe.shieldActive||qe.shieldCooldown>0?.3:1},"data-translatable":!0,children:[" ",i(4,"Shield")," ",qe.shieldCooldown>0?`(${qe.shieldCooldown})`:""]}),f.jsxs("button",{onClick:()=>Ft("criticalHit"),disabled:qe.criticalHitActive||qe.critCooldown>0,style:{padding:"8px 14px",borderRadius:8,border:"1px solid rgba(231,76,60,0.4)",background:"rgba(231,76,60,0.15)",color:"#ff8888",fontWeight:700,fontSize:12,cursor:qe.criticalHitActive||qe.critCooldown>0?"default":"pointer",opacity:qe.criticalHitActive||qe.critCooldown>0?.3:1},"data-translatable":!0,children:[" ",i(5,"Crit")," ",qe.critCooldown>0?`(${qe.critCooldown})`:""]})]}),(qe.shieldActive||qe.criticalHitActive)&&f.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[qe.shieldActive&&f.jsxs("span",{style:{fontSize:12,color:"#66b3ff",background:"rgba(52,152,219,0.15)",padding:"3px 10px",borderRadius:6},"data-translatable":!0,children:[" ",i(6,"Shield Active")]}),qe.criticalHitActive&&f.jsxs("span",{style:{fontSize:12,color:"#ffed4a",background:"rgba(255,237,74,0.1)",padding:"3px 10px",borderRadius:6},"data-translatable":!0,children:[" ",i(7,"Crit Ready")]})]})]}),!a&&H&&te&&f.jsxs("div",{style:{background:te.correct?"rgba(46,204,113,0.15)":"rgba(231,76,60,0.15)",border:te.correct?"2px solid rgba(46,204,113,0.5)":"2px solid rgba(231,76,60,0.5)",borderRadius:14,padding:"24px 26px",marginBottom:14,textAlign:"center",backdropFilter:"blur(10px)"},children:[f.jsx("div",{style:{fontSize:52,marginBottom:8,animation:te.correct?"victoryBurst 0.5s ease-out":"defeatSink 0.4s ease"},children:te.correct?te.criticalHit?"":"":te.shielded?"":""}),f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:26,fontWeight:900,color:"#fff",marginBottom:8},"data-translatable":!0,children:te.correct?`${te.criticalHit?"CRIT! ":""}${te.damage} ${i(8,"Damage!")}`:te.shielded?i(9,"Shield Blocked!"):i(10,"Miss!")}),!te.correct&&te.counterattack&&!te.shielded&&f.jsxs("div",{style:{padding:"8px 14px",borderRadius:8,background:"rgba(139,26,26,0.3)",border:"1px solid rgba(231,76,60,0.3)",marginBottom:10,fontSize:13,color:"#ff8888"},"data-translatable":!0,children:[te.counterattack.icon," ",f.jsx("strong",{children:te.counterattack.name}),"  ",i(11,"Class takes")," ",te.classDamage," ",i(12,"damage!")]}),!te.correct&&xt&&f.jsxs("div",{style:{fontSize:13,color:"rgba(255,255,255,0.5)",marginBottom:10},"data-translatable":!0,children:[i(13,"Correct:")," ",f.jsx("strong",{style:{color:"#2ecc71"},children:xt.options[xt.correctIndex]})]}),xt?.explanation&&f.jsxs("div",{style:{fontSize:12,color:"rgba(255,255,255,0.4)",padding:"8px 12px",background:"rgba(255,255,255,0.05)",borderRadius:8,marginBottom:12,textAlign:"left"},children:[" ",xt.explanation]}),qe&&!qe.finished&&_.status==="active"&&f.jsx("button",{onClick:Wn,style:{...is("#2ecc71"),padding:"10px 24px",fontSize:15},"data-translatable":!0,children:i(14,"Next Question ")}),qe?.finished&&_.status==="active"&&f.jsxs("div",{style:{fontSize:14,color:"rgba(255,255,255,0.5)",marginTop:8},"data-translatable":!0,children:[" ",i(15,"All Questions Answered!")]})]}),!a&&qe?.finished&&!H&&_.status==="active"&&f.jsxs("div",{style:{background:"rgba(0,0,0,0.4)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:14,padding:"30px 24px",textAlign:"center",backdropFilter:"blur(10px)"},children:[f.jsx("div",{style:{fontSize:48,marginBottom:10},children:""}),f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:20,fontWeight:700,color:"#fff",marginBottom:6},"data-translatable":!0,children:i(15,"All Questions Answered!")}),f.jsxs("div",{style:{fontSize:14,color:"rgba(255,255,255,0.5)"},"data-translatable":!0,children:[i(16,"You dealt")," ",f.jsx("strong",{style:{color:qe.color},children:qe.damage})," ",i(17,"total damage.")," ",i(18,"Watching your classmates finish the fight...")]})]}),!a&&!J&&f.jsxs("div",{style:{background:"rgba(0,0,0,0.4)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:14,padding:"30px 24px",textAlign:"center",backdropFilter:"blur(10px)"},children:[f.jsx("div",{style:{fontSize:48,marginBottom:10},children:""}),f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:20,fontWeight:700,color:"#fff",marginBottom:6},"data-translatable":!0,children:i(19,"Spectating")}),f.jsx("div",{style:{fontSize:14,color:"rgba(255,255,255,0.5)"},"data-translatable":!0,children:i(20,"You're not on a team in this battle. Watch the action unfold!")})]}),a&&f.jsxs("div",{style:{background:"rgba(0,0,0,0.4)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:14,padding:"18px 22px",backdropFilter:"blur(10px)"},children:[f.jsx("div",{style:{fontSize:14,fontWeight:700,color:"rgba(255,255,255,0.5)",marginBottom:10},children:" Live Battle Feed"}),f.jsxs("div",{style:{maxHeight:300,overflowY:"auto"},children:[(_.log||[]).slice(0,20).map((He,Nt)=>f.jsxs("div",{style:{fontSize:12,padding:"4px 0",borderBottom:"1px solid rgba(255,255,255,0.04)",display:"flex",gap:8,color:"rgba(255,255,255,0.6)"},children:[f.jsx("span",{style:{color:He.teamColor,fontWeight:700,minWidth:80},children:He.team}),He.type==="attack"&&f.jsxs("span",{children:[" ",f.jsx("strong",{style:{color:"#e74c3c"},children:He.damage})," dmg",He.criticalHit?"  CRIT":""]}),He.type==="miss"&&f.jsxs("span",{children:[" Miss",He.shielded?" ":"",He.counterattack&&!He.shielded?` ${He.counterattack.icon} -${He.classDamage} class HP`:""]}),He.type==="ability"&&f.jsxs("span",{children:[He.abilityIcon," ",He.ability]})]},Nt)),(_.log||[]).length===0&&f.jsx("div",{style:{fontSize:13,color:"rgba(255,255,255,0.3)",textAlign:"center",padding:16},children:"Waiting for teams to start answering..."})]})]})]}),!a&&f.jsxs("div",{children:[f.jsxs("div",{style:{background:"rgba(0,0,0,0.4)",border:"1px solid rgba(255,255,255,0.06)",borderRadius:12,padding:"14px 16px",backdropFilter:"blur(5px)"},children:[f.jsxs("div",{style:{fontSize:12,fontWeight:700,color:"rgba(255,255,255,0.4)",marginBottom:10},"data-translatable":!0,children:[" ",i(21,"Team Damage")]}),Ze.map(He=>{const Nt=He.id===J,Jt=Br[Object.keys(Br).find(ur=>Br[ur].color===He.color)]||Br.red;return f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 8px",marginBottom:4,borderRadius:8,background:Nt?`${He.color}22`:"transparent",border:Nt?`1px solid ${He.color}44`:"1px solid transparent"},children:[f.jsx("span",{style:{fontSize:16},children:Jt.sprite}),f.jsxs("div",{style:{flex:1},children:[f.jsxs("div",{style:{fontSize:12,fontWeight:700,color:He.color},children:[He.name,Nt?" ":""]}),f.jsxs("div",{style:{fontSize:10,color:"rgba(255,255,255,0.3)"},children:[He.correctCount," ",He.wrongCount,"",He.finished?" ":""]})]}),f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:16,fontWeight:900,color:"#fff"},children:He.damage})]},He.id)})]}),f.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.04)",borderRadius:12,padding:"12px 14px",marginTop:10,backdropFilter:"blur(5px)"},children:[f.jsxs("div",{style:{fontSize:11,fontWeight:700,color:"rgba(255,255,255,0.3)",marginBottom:6},"data-translatable":!0,children:[" ",i(22,"Live")]}),f.jsx("div",{style:{maxHeight:140,overflowY:"auto"},children:(_.log||[]).slice(0,8).map((He,Nt)=>f.jsxs("div",{style:{fontSize:11,padding:"2px 0",color:"rgba(255,255,255,0.5)"},children:[f.jsx("span",{style:{color:He.teamColor,fontWeight:700},children:He.team})," ",He.type==="attack"?` ${He.damage}${He.criticalHit?"":""}`:He.type==="miss"?`${He.shielded?"":""}`:`${He.abilityIcon||""}`]},Nt))})]})]})]}),a&&f.jsxs(f.Fragment,{children:[f.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${Math.min(Ze.length,6)}, 1fr)`,gap:8,marginTop:14},children:Ze.map(He=>{const Nt=Br[Object.keys(Br).find(ur=>Br[ur].color===He.color)]||Br.red,Jt=rn>0?Math.round(He.currentIndex/(He.questionOrder?.length||1)*100):0;return f.jsxs("div",{style:{padding:"10px 12px",borderRadius:10,textAlign:"center",background:"rgba(0,0,0,0.3)",border:`1px solid ${He.color}44`,backdropFilter:"blur(5px)",position:"relative"},children:[f.jsx("div",{style:{fontSize:20,marginBottom:2},children:Nt.sprite}),f.jsx("div",{style:{fontWeight:700,fontSize:11,color:He.color},children:He.name}),f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:20,fontWeight:900,color:"#fff"},children:He.damage}),f.jsxs("div",{style:{fontSize:10,color:"rgba(255,255,255,0.4)"},children:[He.correctCount," ",He.wrongCount,""]}),f.jsx("div",{style:{height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,marginTop:6},children:f.jsx("div",{style:{width:`${Jt}%`,height:"100%",background:He.color,borderRadius:2,transition:"width 0.5s"}})}),f.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.3)",marginTop:2},children:He.finished?" Done":`${Jt}%`})]},He.id)})}),f.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center",marginTop:14},children:[f.jsx("button",{onClick:()=>l8(e,_.id,"victory"),style:{...is("#2ecc71"),opacity:.7},children:"Force Victory"}),f.jsx("button",{onClick:()=>l8(e,_.id,"defeat"),style:{...is("#e74c3c"),opacity:.7},children:"End Battle"})]})]})]})]})}if(p==="results"&&_){const Ne=_.status==="victory",ke=Object.entries(_.teamProgress||{}).map(([Ye,Ze])=>({id:Ye,...Ze})).sort((Ye,Ze)=>Ze.damage-Ye.damage),$e=tl[_.boss?.id]||tl.dragon;return f.jsxs("div",{style:{minHeight:"100vh",background:Ne?"radial-gradient(ellipse at 50% 80%, #1a3a1a 0%, #0a150a 50%, #0a0a0f 100%)":$e.bg,position:"relative",overflow:"hidden"},children:[f.jsx(u8,{particles:Ne?["","","",""]:["","",""],count:25,speed:.5,color:Ne?"#ffed4a":"#e74c3c"}),f.jsx("style",{children:qp}),f.jsxs("div",{style:{maxWidth:600,margin:"0 auto",padding:"60px 40px",position:"relative",zIndex:5,textAlign:"center"},children:[f.jsx("div",{style:{marginBottom:20,animation:Ne?"victoryBurst 1s ease-out":"bossIdle 3s ease-in-out infinite",filter:Ne?"grayscale(0.6) opacity(0.5)":"none"},children:Ne?f.jsx("div",{style:{fontSize:90},children:""}):f.jsx("div",{style:{display:"flex",justifyContent:"center"},children:f.jsx(d8,{bossId:_.boss?.id||"dragon",size:320})})}),f.jsx("h1",{style:{fontFamily:"var(--font-display)",fontSize:44,fontWeight:900,marginBottom:8,color:Ne?"#2ecc71":"#e74c3c",textShadow:Ne?"0 0 30px rgba(46,204,113,0.5)":"0 0 30px rgba(231,76,60,0.5)"},"data-translatable":!0,children:Ne?i(23,"VICTORY!"):i(24,"DEFEATED")}),f.jsx("p",{style:{color:"rgba(255,255,255,0.5)",fontSize:16,marginBottom:32},"data-translatable":!0,children:Ne?`${i(25,"The class united to slay")} ${_.boss?.name}!`:_.classHP?.current<=0?`${_.boss?.name} ${i(26,"overwhelmed the class...")}`:`${_.boss?.name} ${i(27,"survives with")} ${_.boss?.currentHP} ${i(28,"HP...")}`}),f.jsxs("div",{style:{background:"rgba(0,0,0,0.4)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:14,padding:"20px 22px",marginBottom:20,backdropFilter:"blur(10px)"},children:[f.jsxs("div",{style:{fontSize:18,fontWeight:800,color:"#fff",marginBottom:16},"data-translatable":!0,children:[" ",i(29,"Team Rankings")]}),ke.map((Ye,Ze)=>{const qe=Br[Object.keys(Br).find(Pn=>Br[Pn].color===Ye.color)]||Br.red,xt=["","",""];return f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14,padding:"12px 16px",borderRadius:10,marginBottom:8,background:Ze===0?`${Ye.color}22`:"rgba(255,255,255,0.03)",border:Ze===0?`2px solid ${Ye.color}66`:"1px solid rgba(255,255,255,0.05)"},children:[f.jsx("span",{style:{fontSize:22},children:xt[Ze]||`${Ze+1}.`}),f.jsx("span",{style:{fontSize:20},children:qe.sprite}),f.jsxs("div",{style:{flex:1,textAlign:"left"},children:[f.jsx("div",{style:{fontWeight:700,fontSize:15,color:Ye.color},children:Ye.name}),f.jsxs("div",{style:{fontSize:11,color:"rgba(255,255,255,0.4)"},children:[Ye.correctCount,"  ",Ye.wrongCount,""]})]}),f.jsxs("div",{style:{fontFamily:"var(--font-display)",fontSize:24,fontWeight:900,color:"#fff",textShadow:`0 0 8px ${Ye.color}44`},children:[Ye.damage," ",f.jsx("span",{style:{fontSize:12,fontWeight:400,color:"rgba(255,255,255,0.4)"},children:"dmg"})]})]},Ye.id)})]}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12,marginBottom:28},children:[{label:i(30,"Total Damage"),value:ke.reduce((Ye,Ze)=>Ye+Ze.damage,0),color:"#e74c3c"},{label:i(31,"Correct"),value:ke.reduce((Ye,Ze)=>Ye+Ze.correctCount,0),color:"#2ecc71"},{label:i(32,"Class HP Left"),value:`${_.classHP?.current||0}/${_.classHP?.max||0}`,color:"#3498db"}].map(Ye=>f.jsxs("div",{style:{padding:"14px 10px",borderRadius:10,textAlign:"center",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.06)"},children:[f.jsx("div",{style:{fontFamily:"var(--font-display)",fontSize:28,fontWeight:900,color:Ye.color,textShadow:`0 0 12px ${Ye.color}44`},children:Ye.value}),f.jsx("div",{style:{fontSize:11,color:"rgba(255,255,255,0.4)"},"data-translatable":!0,children:Ye.label})]},Ye.label))}),f.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"center"},children:[a&&f.jsx("button",{onClick:()=>{g("setup"),E(null),Je.current&&Je.current()},style:{...is("#8b5cf6"),padding:"12px 24px",boxShadow:"0 0 16px rgba(139,92,246,0.3)"},children:" New Battle"}),f.jsx("button",{onClick:()=>s(`/course/${e}`),style:{...sf,color:"rgba(255,255,255,0.6)",borderColor:"rgba(255,255,255,0.2)"},"data-translatable":!0,children:i(33,"Back to Course")})]})]})]})}return f.jsxs("div",{style:{minHeight:"100vh",background:"radial-gradient(ellipse at 50% 80%, #1a1a2a, #0a0a0f)",display:"flex",alignItems:"center",justifyContent:"center"},children:[f.jsxs("div",{style:{textAlign:"center",maxWidth:400},children:[f.jsx("div",{style:{fontSize:80,marginBottom:16,animation:"bossIdle 3s ease-in-out infinite"},children:""}),f.jsx("h2",{style:{fontFamily:"var(--font-display)",color:"#fff",marginBottom:8},"data-translatable":!0,children:i(34,"No Active Battle")}),f.jsx("p",{style:{color:"rgba(255,255,255,0.5)",fontSize:14,marginBottom:20},"data-translatable":!0,children:a?"Set up a boss battle to begin!":i(35,"Your teacher hasn't started a boss battle yet.")}),a?f.jsx("button",{onClick:()=>g("setup"),style:is("#8b5cf6"),children:" Set Up Battle"}):f.jsxs("button",{onClick:()=>s(`/course/${e}`),style:{...sf,color:"rgba(255,255,255,0.6)",borderColor:"rgba(255,255,255,0.2)"},"data-translatable":!0,children:[" ",i(33,"Back to Course")]})]}),f.jsx("style",{children:qp})]})}function gI(){const{user:e}=un(),[t,n]=M.useState({...MR}),[s,a]=M.useState(0),[l,i]=M.useState(null),[p,g]=M.useState(!1),[v,u]=M.useState(!1),[h,y]=M.useState(!1),[x,T]=M.useState(null),_=on(["Character Creator","Level","PREVIEW  Unlocks at higher level","Tier:","Class Abilities","PREVIEWING","Passive","Active","Saving...","Saved!","Save Character","Class","Skin Tone","Hair Color","Eye Color","Companion Pet","Accessory","Special Power","Level Progression","Loading avatar..."]),E=(F,O)=>_?.[F]??O,R=M.useMemo(()=>Object.values(qr).sort((F,O)=>F.unlockLevel-O.unlockLevel),[]),P=M.useMemo(()=>[...ou].sort((F,O)=>F.unlockLevel-O.unlockLevel),[]),B=M.useMemo(()=>Xc.filter(F=>F.slot==="accessory").sort((F,O)=>F.unlockLevel-O.unlockLevel),[]),X=M.useMemo(()=>Xc.filter(F=>F.slot==="power").sort((F,O)=>F.unlockLevel-O.unlockLevel),[]),Q=M.useMemo(()=>{const F=[];return R.forEach(O=>{F.push(O.name),F.push(O.abilities.passive),F.push(O.abilities.active)}),P.forEach(O=>F.push(O.name)),B.forEach(O=>F.push(O.name)),X.forEach(O=>F.push(O.name)),el.forEach(O=>F.push(O.name)),F},[R,P,B,X]),K=on(Q),k=M.useMemo(()=>{if(!K)return null;let F=0;const O={};R.forEach(re=>{O[re.id]={name:K[F++]||re.name,passive:K[F++]||re.abilities.passive,active:K[F++]||re.abilities.active}});const xe={};P.forEach(re=>{xe[re.id]=K[F++]||re.name});const Le={};B.forEach(re=>{Le[re.id]=K[F++]||re.name});const Oe={};X.forEach(re=>{Oe[re.id]=K[F++]||re.name});const De={};return el.forEach(re=>{De[re.name]=K[F++]||re.name}),{classMap:O,petMap:xe,accMap:Le,powerMap:Oe,tierMap:De}},[K,R,P,B,X]),I=F=>k?.classMap[F]?.name||(qr[F]?.name??F),N=F=>k?.classMap[F]?.passive||qr[F]?.abilities?.passive||"",U=F=>k?.classMap[F]?.active||qr[F]?.abilities?.active||"",z=F=>k?.petMap[F]||ou.find(O=>O.id===F)?.name||F,q=F=>k?.accMap[F]||k?.powerMap[F]||Xc.find(O=>O.id===F)?.name||F,D=F=>k?.tierMap[F]||F;M.useEffect(()=>{e&&(async()=>{const[F,O]=await Promise.all([iS(e.uid),ml(e.uid)]),xe=O.totalXP||0;a(xe),i(sS(xe)),F&&n(F),y(!0)})()},[e]);const de=ls(s),je=de.current.level,W=(F,O)=>{n(xe=>({...xe,[F]:O})),u(!1)},J=x?{...t,[x.key]:x.value}:t,ve=(F,O)=>T({key:F,value:O}),Se=()=>T(null),Re=async()=>{e&&(g(!0),await RR(e.uid,t),g(!1),u(!0),setTimeout(()=>u(!1),2e3))};if(!h)return f.jsx("div",{style:at.page,children:f.jsx("div",{style:at.loading,"data-translatable":!0,children:E(19,"Loading avatar...")})});const H=qr[t.classId]||qr.mage,Z=qr[J.classId]||H,te=x?.key==="classId"&&Z.id!==H.id,fe=el.filter(F=>je>=F.minLevel).pop()?.name;return f.jsx("div",{style:at.page,children:f.jsxs("div",{style:at.container,children:[f.jsxs("div",{style:at.header,children:[f.jsxs("h1",{style:at.title,"data-translatable":!0,children:[" ",E(0,"Character Creator")]}),f.jsxs("p",{style:at.subtitle,"data-translatable":!0,children:[E(1,"Level")," ",je,"  ",de.current.name,"  ",s," XP"]})]}),f.jsxs("div",{style:at.grid,children:[f.jsxs("div",{style:at.preview,children:[f.jsxs("div",{style:{...at.previewStage,position:"relative"},children:[f.jsx(oS,{avatar:J,level:je,charSize:240,petSize:156,animate:!0,gap:16}),x&&f.jsxs("div",{style:at.previewBadge,"data-translatable":!0,children:[" ",E(2,"PREVIEW  Unlocks at higher level")]})]}),f.jsxs("div",{style:at.previewInfo,children:[f.jsxs("span",{style:{color:Z.color.accent,fontWeight:800},"data-translatable":!0,children:[Z.icon," ",I(Z.id)]}),f.jsxs("span",{style:{color:"#9896a8"},"data-translatable":!0,children:[" "," ",E(3,"Tier:")," ",D(fe)]})]}),f.jsxs("div",{style:{...at.abilityBox,border:te?"1px solid rgba(243,156,18,0.3)":"1px solid #2a2e42"},children:[f.jsxs("div",{style:at.abilityLabel,"data-translatable":!0,children:[E(4,"Class Abilities"),te&&f.jsxs("span",{style:{color:"#f39c12",marginLeft:8,fontSize:9},"data-translatable":!0,children:[" ",E(5,"PREVIEWING")," ",I(Z.id).toUpperCase()]})]}),f.jsxs("div",{style:at.abilityRow,children:[f.jsx("span",{style:at.abilityTag,"data-translatable":!0,children:E(6,"Passive")}),f.jsx("span",{style:at.abilityText,"data-translatable":!0,children:N(Z.id)})]}),f.jsxs("div",{style:at.abilityRow,children:[f.jsx("span",{style:{...at.abilityTag,background:"rgba(139,92,246,0.15)",color:"#8b5cf6"},"data-translatable":!0,children:E(7,"Active")}),f.jsx("span",{style:at.abilityText,"data-translatable":!0,children:U(Z.id)})]})]}),f.jsx("button",{onClick:Re,disabled:p,style:{...at.saveBtn,opacity:p?.6:1,background:v?"#2ecc71":"#8b5cf6"},"data-translatable":!0,children:p?E(8,"Saving..."):v?` ${E(9,"Saved!")}`:` ${E(10,"Save Character")}`})]}),f.jsxs("div",{style:at.options,children:[f.jsx(Xs,{title:E(11,"Class"),children:f.jsx("div",{style:at.optGrid,children:R.map(F=>{const O=je<F.unlockLevel;return f.jsxs(af,{selected:t.classId===F.id,locked:O,lockLevel:F.unlockLevel,onClick:()=>!O&&W("classId",F.id),accent:F.color.accent,onHover:()=>ve("classId",F.id),onUnhover:Se,children:[f.jsx("div",{style:at.optIcon,children:F.icon}),f.jsx("div",{style:at.optName,"data-translatable":!0,children:I(F.id)}),O&&f.jsxs("div",{style:at.lockBadge,children:["Lv ",F.unlockLevel]})]},F.id)})})}),f.jsx(Xs,{title:E(12,"Skin Tone"),children:f.jsx("div",{style:at.colorRow,children:Qf.map(F=>f.jsx("button",{onClick:()=>W("skinTone",F.id),style:{...at.colorSwatch,background:F.base,border:t.skinTone===F.id?"3px solid #8b5cf6":"3px solid transparent",boxShadow:t.skinTone===F.id?"0 0 8px #8b5cf644":"none"}},F.id))})}),f.jsx(Xs,{title:E(13,"Hair Color"),children:f.jsx("div",{style:at.colorRow,children:[...gl].sort((F,O)=>(F.unlockLevel||1)-(O.unlockLevel||1)).map(F=>{const O=je<(F.unlockLevel||1);return f.jsx("button",{onClick:()=>!O&&W("hairColor",F.id),onMouseEnter:()=>O?ve("hairColor",F.id):void 0,onMouseLeave:Se,style:{...at.colorSwatch,background:F.base,border:t.hairColor===F.id?"3px solid #8b5cf6":"3px solid transparent",opacity:O?.3:1,cursor:O?"not-allowed":"pointer",position:"relative"},title:O?`Unlocks at Lv ${F.unlockLevel}`:F.label,children:O&&f.jsx("span",{style:at.swatchLock,children:""})},F.id)})})}),f.jsx(Xs,{title:E(14,"Eye Color"),children:f.jsx("div",{style:at.colorRow,children:[...vl].sort((F,O)=>(F.unlockLevel||1)-(O.unlockLevel||1)).map(F=>{const O=je<(F.unlockLevel||1);return f.jsx("button",{onClick:()=>!O&&W("eyeColor",F.id),onMouseEnter:()=>O?ve("eyeColor",F.id):void 0,onMouseLeave:Se,style:{...at.colorSwatch,background:F.iris,border:t.eyeColor===F.id?"3px solid #8b5cf6":"3px solid transparent",opacity:O?.3:1,cursor:O?"not-allowed":"pointer"},title:O?`Unlocks at Lv ${F.unlockLevel}`:F.label,children:O&&f.jsx("span",{style:at.swatchLock,children:""})},F.id)})})}),f.jsx(Xs,{title:E(15,"Companion Pet"),children:f.jsx("div",{style:at.optGrid,children:P.map(F=>{const O=je<F.unlockLevel;return f.jsxs(af,{selected:t.petId===F.id,locked:O,lockLevel:F.unlockLevel,onClick:()=>!O&&W("petId",F.id),onHover:()=>ve("petId",F.id),onUnhover:Se,children:[f.jsx("div",{style:at.optIcon,children:F.icon}),f.jsx("div",{style:at.optName,"data-translatable":!0,children:z(F.id)}),O&&f.jsxs("div",{style:at.lockBadge,children:["Lv ",F.unlockLevel]})]},F.id)})})}),f.jsx(Xs,{title:E(16,"Accessory"),children:f.jsx("div",{style:at.optGrid,children:B.map(F=>{const O=je<F.unlockLevel;return f.jsxs(af,{selected:t.accessory===F.id,locked:O,lockLevel:F.unlockLevel,onClick:()=>!O&&W("accessory",F.id),onHover:()=>ve("accessory",F.id),onUnhover:Se,children:[f.jsx("div",{style:at.optIcon,children:F.icon}),f.jsx("div",{style:at.optName,"data-translatable":!0,children:q(F.id)}),O&&f.jsxs("div",{style:at.lockBadge,children:["Lv ",F.unlockLevel]})]},F.id)})})}),f.jsx(Xs,{title:E(17,"Special Power"),children:f.jsx("div",{style:at.optGrid,children:X.map(F=>{const O=je<F.unlockLevel;return f.jsxs(af,{selected:t.specialPower===F.id,locked:O,lockLevel:F.unlockLevel,onClick:()=>!O&&W("specialPower",F.id),onHover:()=>ve("specialPower",F.id),onUnhover:Se,children:[f.jsx("div",{style:at.optIcon,children:F.icon}),f.jsx("div",{style:at.optName,"data-translatable":!0,children:q(F.id)}),O&&f.jsxs("div",{style:at.lockBadge,children:["Lv ",F.unlockLevel]})]},F.id)})})}),f.jsx(Xs,{title:E(18,"Level Progression"),children:f.jsx("div",{style:{display:"flex",gap:10,overflowX:"auto",paddingBottom:8},children:[1,6,11,16,21,26,31,35].map(F=>{const O=el.filter(xe=>F>=xe.minLevel).pop()?.name;return f.jsxs("div",{style:at.progCard,children:[f.jsxs("div",{style:{fontSize:9,fontWeight:800,color:je>=F?"#f39c12":"#5c5a6e",marginBottom:6},children:["LV ",F]}),f.jsx(aS,{avatar:t,level:F,size:96,animate:!1,style:{opacity:je>=F?1:.35}}),f.jsx("div",{style:{fontSize:9,color:"#5c5a6e",marginTop:4},"data-translatable":!0,children:D(O)})]},F)})})})]})]})]})})}function Xs({title:e,children:t}){return f.jsxs("div",{style:at.section,children:[f.jsx("h3",{style:at.sectionTitle,"data-translatable":!0,children:e}),t]})}function af({children:e,selected:t,locked:n,lockLevel:s,onClick:a,accent:l,onHover:i,onUnhover:p}){return f.jsx("button",{onClick:a,onMouseEnter:n&&i?i:void 0,onMouseLeave:p||void 0,style:{...at.optCard,border:t?"2px solid #8b5cf6":"2px solid #2a2e42",background:t?"rgba(139,92,246,0.1)":"#1e2235",opacity:n?.5:1,cursor:n?"default":"pointer",boxShadow:t?"0 0 12px #8b5cf633":"none",transition:"all 0.15s, opacity 0.15s"},children:e})}const at={page:{minHeight:"100vh",background:"#0c0e14",color:"#e8e6f0",fontFamily:"'Nunito', sans-serif",padding:"20px"},container:{maxWidth:1100,margin:"0 auto"},loading:{textAlign:"center",padding:60,color:"#5c5a6e"},previewBadge:{position:"absolute",top:-15,left:"50%",transform:"translateX(-50%)",padding:"4px 14px",borderRadius:6,background:"rgba(243,156,18,0.2)",border:"1px solid rgba(243,156,18,0.4)",color:"#f39c12",fontSize:11,fontWeight:800,whiteSpace:"nowrap",pointerEvents:"none"},header:{textAlign:"center",marginBottom:24},title:{fontSize:24,fontWeight:900,color:"#8b5cf6",marginBottom:4},subtitle:{fontSize:14,color:"#9896a8"},grid:{display:"grid",gridTemplateColumns:"440px 1fr",gap:20,alignItems:"start",maxWidth:1200,margin:"0 auto"},preview:{background:"#161926",border:"1px solid #2a2e42",borderRadius:14,padding:20,position:"sticky",top:80,maxHeight:"calc(100vh - 100px)",overflowY:"auto",overflowX:"hidden"},previewStage:{display:"flex",justifyContent:"center",padding:"31px 0 16px 0",background:"radial-gradient(ellipse at 50% 80%, #1a153080, transparent)",borderRadius:10,marginBottom:12,overflow:"visible"},previewInfo:{textAlign:"center",fontSize:14,marginBottom:12},abilityBox:{background:"#1e2235",border:"1px solid #2a2e42",borderRadius:10,padding:12,marginBottom:14},abilityLabel:{fontSize:11,fontWeight:800,color:"#5c5a6e",marginBottom:8,textTransform:"uppercase"},abilityRow:{display:"flex",gap:8,alignItems:"flex-start",marginBottom:6},abilityTag:{padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:800,background:"rgba(46,204,113,0.15)",color:"#2ecc71",whiteSpace:"nowrap",flexShrink:0},abilityText:{fontSize:12,color:"#9896a8",lineHeight:1.4},saveBtn:{width:"100%",padding:14,border:"none",borderRadius:10,fontSize:16,fontWeight:800,color:"#fff",cursor:"pointer",transition:"all 0.2s",fontFamily:"'Nunito', sans-serif"},options:{display:"flex",flexDirection:"column",gap:4,minWidth:0},section:{background:"#161926",border:"1px solid #2a2e42",borderRadius:12,padding:16},sectionTitle:{fontSize:13,fontWeight:800,color:"#8b5cf6",marginBottom:10,textTransform:"uppercase",letterSpacing:.5},optGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(80px, 1fr))",gap:6},optCard:{padding:10,borderRadius:8,textAlign:"center",position:"relative",fontFamily:"'Nunito', sans-serif",transition:"all 0.15s"},optIcon:{fontSize:24,marginBottom:2},optName:{fontSize:11,fontWeight:700,color:"#e8e6f0"},lockBadge:{position:"absolute",top:4,right:4,fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:4,background:"rgba(243,156,18,0.2)",color:"#f39c12"},colorRow:{display:"flex",gap:8,flexWrap:"wrap"},colorSwatch:{width:36,height:36,borderRadius:8,cursor:"pointer",transition:"all 0.15s",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},swatchLock:{fontSize:10},progCard:{textAlign:"center",background:"#1e2235",border:"1px solid #2a2e42",borderRadius:8,padding:8,minWidth:100,flexShrink:0}};function vI(){const{isPreview:e,scenario:t,scenarios:n,switchScenario:s,exitPreview:a,sourceLocation:l}=ju(),[i,p]=M.useState(!1),g=ui();if(!e)return null;const v=n[t],u=()=>{a();const h=new URLSearchParams;l?.courseId&&h.set("course",l.courseId),l?.lessonId&&h.set("lesson",l.lessonId);const y=h.toString();g(y?`/editor?${y}`:"/editor")};return f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"preview-banner",children:f.jsxs("div",{className:"preview-banner-inner",children:[f.jsxs("div",{className:"preview-banner-left",children:[f.jsx("span",{className:"preview-banner-eye",children:""}),f.jsx("span",{className:"preview-banner-label",children:"Previewing as Student"})]}),f.jsxs("div",{className:"preview-scenario-picker",children:[f.jsxs("button",{className:"preview-scenario-btn",onClick:()=>p(!i),children:[f.jsx("span",{children:v.icon}),f.jsx("span",{children:v.label}),f.jsx("span",{className:"preview-chevron",children:i?"":""})]}),i&&f.jsx("div",{className:"preview-scenario-dropdown",children:Object.entries(n).map(([h,y])=>f.jsxs("button",{className:`preview-scenario-option ${h===t?"active":""}`,onClick:()=>{s(h),p(!1)},children:[f.jsx("span",{className:"scenario-opt-icon",children:y.icon}),f.jsxs("div",{children:[f.jsx("div",{className:"scenario-opt-label",children:y.label}),f.jsx("div",{className:"scenario-opt-desc",children:y.description})]})]},h))})]}),f.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[f.jsx("button",{className:"preview-exit-btn",onClick:u,children:" Back to Editor"}),f.jsx("button",{className:"preview-exit-btn",onClick:a,children:" Exit Preview"})]})]})}),f.jsx("div",{style:{height:52}})]})}function yI({chats:e,onSelect:t,onNew:n,user:s,unreadMap:a}){return f.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[f.jsxs("div",{style:{padding:"14px 16px",borderBottom:"1px solid var(--border, #2a2f3d)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[f.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:700,fontSize:15,color:"var(--text, #e0e0e0)"},children:" Messages"}),f.jsx("button",{onClick:n,style:{background:"var(--amber, #f59e0b)",color:"#1a1a1a",border:"none",borderRadius:8,padding:"5px 10px",fontSize:12,fontWeight:700,cursor:"pointer"},children:"+ New"})]}),f.jsx("div",{style:{padding:"8px 16px",background:"rgba(245, 158, 11, 0.08)",borderBottom:"1px solid var(--border, #2a2f3d)",fontSize:10,color:"var(--amber, #f59e0b)",textAlign:"center",fontWeight:600,letterSpacing:"0.03em"},children:" All messages are logged and visible to Mr. McCarthy"}),f.jsxs("div",{style:{flex:1,overflowY:"auto"},children:[e.length===0&&f.jsx("p",{style:{color:"var(--text3, #888)",fontSize:13,textAlign:"center",padding:24},children:"No conversations yet. Start one!"}),e.map(l=>{const i=a[l.id],p=SS(l,s.uid);return f.jsxs("button",{onClick:()=>t(l),style:{display:"flex",alignItems:"center",gap:10,width:"100%",padding:"12px 16px",border:"none",borderBottom:"1px solid var(--border, #2a2f3d)",background:i?"rgba(245, 158, 11, 0.06)":"transparent",cursor:"pointer",textAlign:"left"},children:[f.jsx("span",{style:{fontSize:20},children:l.type==="dm"?"":l.type==="team"?"":""}),f.jsxs("div",{style:{flex:1,minWidth:0},children:[f.jsx("div",{style:{fontSize:13,fontWeight:i?700:500,color:"var(--text, #e0e0e0)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:p}),l.lastMessage&&f.jsx("div",{style:{fontSize:11,color:"var(--text3, #888)",marginTop:2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l.lastMessage})]}),i&&f.jsx("span",{style:{width:8,height:8,borderRadius:"50%",background:"var(--amber, #f59e0b)",flexShrink:0}})]},l.id)})]})]})}function bI({chat:e,user:t,courseId:n,onBack:s}){const[a,l]=M.useState([]),[i,p]=M.useState(""),[g,v]=M.useState(!1),u=M.useRef(null),h=M.useRef(!1);M.useEffect(()=>{if(!e?.id)return;const T=Kt(it(be,"courses",n,"chats",e.id,"messages"),Ln("createdAt","asc"),Uj(200)),_=Hf(T,R=>{l(R.docs.map(P=>({id:P.id,...P.data()})))}),E=Fe(be,"courses",n,"chats",e.id,"readBy",t.uid);return At(E,{readAt:Ga()},{merge:!0}),_},[e?.id,n,t.uid]),M.useEffect(()=>{a.length>0&&(u.current?.scrollIntoView({behavior:h.current?"smooth":"auto"}),h.current=!0)},[a]);const y=async()=>{if(!i.trim()||g)return;v(!0);const T=i.trim();p("");try{await Yb(it(be,"courses",n,"chats",e.id,"messages"),{text:T,senderId:t.uid,senderName:t.displayName||"Anonymous",createdAt:Ga()}),await At(Fe(be,"courses",n,"chats",e.id),{lastMessage:T,lastMessageAt:Ga()},{merge:!0}),await At(Fe(be,"courses",n,"chats",e.id,"readBy",t.uid),{readAt:Ga()},{merge:!0})}catch(_){console.error("Send failed:",_)}v(!1)},x=SS(e,t.uid);return f.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[f.jsxs("div",{style:{padding:"10px 14px",borderBottom:"1px solid var(--border, #2a2f3d)",display:"flex",alignItems:"center",gap:8},children:[f.jsx("button",{onClick:s,style:{background:"none",border:"none",color:"var(--text3, #888)",cursor:"pointer",fontSize:18,padding:"0 4px"},children:""}),f.jsx("span",{style:{fontSize:16},children:e.type==="dm"?"":e.type==="team"?"":""}),f.jsx("span",{style:{fontWeight:700,fontSize:14,color:"var(--text, #e0e0e0)",flex:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:x})]}),f.jsx("div",{style:{padding:"6px 14px",background:"rgba(245, 158, 11, 0.06)",fontSize:10,color:"var(--amber, #f59e0b)",textAlign:"center",fontWeight:600},children:" Messages are logged and visible to Mr. McCarthy"}),f.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"12px 14px",display:"flex",flexDirection:"column",gap:6},children:[a.map(T=>{const _=T.senderId===t.uid;return f.jsxs("div",{style:{alignSelf:_?"flex-end":"flex-start",maxWidth:"80%"},children:[!_&&f.jsx("div",{style:{fontSize:10,color:"var(--text3, #888)",marginBottom:2,paddingLeft:2},children:T.senderName}),f.jsx("div",{style:{padding:"8px 12px",borderRadius:_?"12px 12px 4px 12px":"12px 12px 12px 4px",background:_?"var(--amber, #f59e0b)":"var(--surface, #1e2132)",color:_?"#1a1a1a":"var(--text, #e0e0e0)",fontSize:13,lineHeight:1.45,wordBreak:"break-word",border:_?"none":"1px solid var(--border, #2a2f3d)"},children:T.text}),f.jsx("div",{style:{fontSize:9,color:"var(--text3, #888)",marginTop:2,textAlign:_?"right":"left",paddingLeft:2,paddingRight:2},children:T.createdAt?.toDate?.()?.toLocaleTimeString?.([],{hour:"numeric",minute:"2-digit"})||""})]},T.id)}),f.jsx("div",{ref:u})]}),f.jsxs("div",{style:{padding:"10px 14px",borderTop:"1px solid var(--border, #2a2f3d)",display:"flex",gap:8},children:[f.jsx("input",{value:i,onChange:T=>p(T.target.value),onKeyDown:T=>T.key==="Enter"&&!T.shiftKey&&y(),placeholder:"Type a message...",style:{flex:1,padding:"8px 12px",borderRadius:8,border:"1px solid var(--border, #2a2f3d)",background:"var(--bg, #141622)",color:"var(--text, #e0e0e0)",fontSize:13,outline:"none"}}),f.jsx("button",{onClick:y,disabled:g||!i.trim(),style:{background:"var(--amber, #f59e0b)",color:"#1a1a1a",border:"none",borderRadius:8,padding:"8px 14px",fontSize:13,fontWeight:700,cursor:"pointer",opacity:!i.trim()||g?.5:1},children:"Send"})]})]})}function SI({courseId:e,user:t,userRole:n,onCreated:s,onBack:a}){const[l,i]=M.useState([]),[p,g]=M.useState([]),[v,u]=M.useState(""),[h,y]=M.useState(!0);M.useEffect(()=>{(async()=>{try{const R=(await ct(it(be,"users"))).docs.map(X=>({uid:X.id,...X.data()}));let P=R.filter(X=>{if(X.uid===t.uid||X.role==="teacher")return!1;const Q=X.enrolledCourses;return Array.isArray(Q)?Q.includes(e):Q&&typeof Q=="object"?e in Q:!1});if(P.length===0){const X=await ct(Kt(it(be,"enrollments"),us("courseId","==",e))),Q=new Set;X.docs.forEach(K=>{const k=K.data();k.uid&&Q.add(k.uid),k.studentUid&&Q.add(k.studentUid)}),Q.delete(t.uid),P=R.filter(K=>Q.has(K.uid)&&K.role!=="teacher")}const B=[...P];if(n!=="teacher"){const X=R.filter(K=>K.role==="teacher"&&K.uid!==t.uid),Q=new Set(B.map(K=>K.uid));X.forEach(K=>{Q.has(K.uid)||B.push(K)})}i(B)}catch(E){console.error("Failed to fetch students:",E)}y(!1)})()},[e,t.uid,n]);const x=async()=>{if(p.length===0)return;const _=[t.uid,...p],E=p.length===1;if(E){const X=await wI(e,t.uid,p[0]);if(X){s(X);return}}const R={[t.uid]:t.displayName||"Anonymous"};p.forEach(X=>{const Q=l.find(K=>K.uid===X);Q&&(R[X]=Q.displayName||Q.name||"Student")});const P={type:E?"dm":"group",name:E?"":v||"Group Chat",members:_,memberNames:R,createdBy:t.uid,createdAt:Ga(),lastMessage:"",lastMessageAt:Ga()},B=await Yb(it(be,"courses",e,"chats"),P);s({id:B.id,...P})},T=_=>{g(E=>E.includes(_)?E.filter(R=>R!==_):[...E,_])};return f.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[f.jsxs("div",{style:{padding:"10px 14px",borderBottom:"1px solid var(--border, #2a2f3d)",display:"flex",alignItems:"center",gap:8},children:[f.jsx("button",{onClick:a,style:{background:"none",border:"none",color:"var(--text3, #888)",cursor:"pointer",fontSize:18,padding:"0 4px"},children:""}),f.jsx("span",{style:{fontWeight:700,fontSize:14,color:"var(--text, #e0e0e0)"},children:"New Conversation"})]}),p.length>1&&f.jsx("div",{style:{padding:"10px 14px",borderBottom:"1px solid var(--border, #2a2f3d)"},children:f.jsx("input",{value:v,onChange:_=>u(_.target.value),placeholder:"Group name (optional)",style:{width:"100%",padding:"7px 10px",borderRadius:8,border:"1px solid var(--border, #2a2f3d)",background:"var(--bg, #141622)",color:"var(--text, #e0e0e0)",fontSize:13,outline:"none"}})}),f.jsx("div",{style:{flex:1,overflowY:"auto"},children:h?f.jsx("p",{style:{color:"var(--text3)",textAlign:"center",padding:24,fontSize:13},children:"Loading..."}):l.length===0?f.jsx("p",{style:{color:"var(--text3)",textAlign:"center",padding:24,fontSize:13},children:"No students enrolled yet."}):l.map(_=>f.jsxs("button",{onClick:()=>T(_.uid),style:{display:"flex",alignItems:"center",gap:10,width:"100%",padding:"10px 16px",border:"none",borderBottom:"1px solid var(--border, #2a2f3d)",background:p.includes(_.uid)?"rgba(245, 158, 11, 0.1)":"transparent",cursor:"pointer",textAlign:"left"},children:[f.jsx("span",{style:{width:20,height:20,borderRadius:6,border:p.includes(_.uid)?"2px solid var(--amber, #f59e0b)":"2px solid var(--border, #2a2f3d)",background:p.includes(_.uid)?"var(--amber, #f59e0b)":"transparent",display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,color:"#1a1a1a"},children:p.includes(_.uid)?"":""}),f.jsx("span",{style:{fontSize:13,color:"var(--text, #e0e0e0)"},children:_.displayName||_.name||"Student"}),_.role==="teacher"&&f.jsx("span",{style:{fontSize:10,color:"var(--amber, #f59e0b)",fontWeight:700,background:"rgba(245, 158, 11, 0.1)",padding:"2px 6px",borderRadius:4},children:"TEACHER"})]},_.uid))}),p.length>0&&f.jsx("div",{style:{padding:"12px 14px",borderTop:"1px solid var(--border, #2a2f3d)"},children:f.jsx("button",{onClick:x,style:{width:"100%",padding:"10px 0",borderRadius:8,border:"none",background:"var(--amber, #f59e0b)",color:"#1a1a1a",fontWeight:700,fontSize:13,cursor:"pointer"},children:p.length===1?"Start Direct Message":`Create Group Chat (${p.length+1} members)`})})]})}function SS(e,t){if(e.type==="team")return e.name||"Team Chat";if(e.type==="group")return e.name||"Group Chat";if(e.memberNames){const n=(e.members||[]).find(s=>s!==t);return e.memberNames[n]||"Direct Message"}return"Direct Message"}async function wI(e,t,n){const s=Kt(it(be,"courses",e,"chats"),us("type","==","dm"),us("members","array-contains",t)),a=await ct(s);for(const l of a.docs){const i=l.data();if(i.members?.includes(n)&&i.members?.length===2)return{id:l.id,...i}}return null}function _I(){const{user:e,userRole:t}=un(),[n,s]=M.useState(!1),[a,l]=M.useState("list"),[i,p]=M.useState([]),[g,v]=M.useState(null),[u,h]=M.useState({}),[y,x]=M.useState(null),[T,_]=M.useState([]),[E,R]=M.useState(!0);if(M.useEffect(()=>{if(!e)return;(async()=>{const Q=(await ct(it(be,"courses"))).docs.map(K=>({id:K.id,...K.data()}));if(t==="teacher")_(Q),Q.length>0&&x(Q[0].id);else{const K=await Mt(Fe(be,"users",e.uid)),k=K.exists()?K.data().enrolledCourses:null;let I=new Set;k&&typeof k=="object"&&!Array.isArray(k)?Object.entries(k).forEach(([U,z])=>{z===!0&&isNaN(U)?I.add(U):typeof z=="string"&&z&&I.add(z)}):Array.isArray(k)&&(I=new Set(k)),I.size===0&&(await ct(Kt(it(be,"enrollments"),us("email","==",e.email?.toLowerCase())))).forEach(z=>I.add(z.data().courseId));const N=Q.filter(U=>I.has(U.id));_(N),N.length>0&&x(N[0].id)}})()},[e,t]),M.useEffect(()=>y?Hf(Fe(be,"courses",y),X=>{const Q=X.data();R(Q?.chatEnabled!==!1)}):void 0,[y]),M.useEffect(()=>{if(!y||!e)return;let B;return t==="teacher"?B=Kt(it(be,"courses",y,"chats"),Ln("lastMessageAt","desc")):B=Kt(it(be,"courses",y,"chats"),us("members","array-contains",e.uid),Ln("lastMessageAt","desc")),Hf(B,Q=>{p(Q.docs.map(K=>({id:K.id,...K.data()})))})},[y,e,t]),M.useEffect(()=>{if(!y||!e||i.length===0)return;(async()=>{const X={};for(const Q of i)try{const K=await Mt(Fe(be,"courses",y,"chats",Q.id,"readBy",e.uid));if(!K.exists())Q.lastMessage&&(X[Q.id]=!0);else{const k=K.data()?.readAt?.toDate?.(),I=Q.lastMessageAt?.toDate?.();k&&I&&I>k&&(X[Q.id]=!0)}}catch{}h(X)})()},[i,y,e]),!e||!y||!E&&t!=="teacher")return null;const P=Object.values(u).filter(Boolean).length;return f.jsxs(f.Fragment,{children:[f.jsxs("button",{onClick:()=>s(!n),style:{position:"fixed",bottom:24,right:24,zIndex:9e3,width:56,height:56,borderRadius:"50%",background:"var(--amber, #f59e0b)",border:"none",boxShadow:"0 4px 20px rgba(245, 158, 11, 0.35)",cursor:"pointer",fontSize:24,display:"flex",alignItems:"center",justifyContent:"center",transition:"transform 0.15s",transform:n?"scale(0.9)":"scale(1)"},children:[n?"":"",P>0&&!n&&f.jsx("span",{style:{position:"absolute",top:-2,right:-2,background:"#ef4444",color:"#fff",fontSize:11,fontWeight:700,width:20,height:20,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:P})]}),n&&f.jsxs("div",{style:{position:"fixed",bottom:92,right:24,zIndex:9e3,width:360,height:520,background:"var(--bg, #141622)",border:"1px solid var(--border, #2a2f3d)",borderRadius:16,boxShadow:"0 12px 48px rgba(0, 0, 0, 0.5)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[T.length>1&&f.jsx("div",{style:{padding:"8px 14px",borderBottom:"1px solid var(--border, #2a2f3d)",display:"flex",gap:4,overflowX:"auto"},children:T.map(B=>f.jsxs("button",{onClick:()=>{x(B.id),l("list"),v(null)},style:{padding:"4px 10px",borderRadius:6,border:"none",fontSize:11,fontWeight:600,cursor:"pointer",whiteSpace:"nowrap",background:y===B.id?"var(--amber, #f59e0b)":"var(--surface, #1e2132)",color:y===B.id?"#1a1a1a":"var(--text3, #888)"},children:[B.icon||""," ",B.title]},B.id))}),!E&&t==="teacher"&&f.jsx("div",{style:{padding:"8px 14px",background:"rgba(239, 68, 68, 0.08)",fontSize:11,color:"#ef4444",textAlign:"center",fontWeight:600},children:"Chat is disabled for students in this course"}),f.jsxs("div",{style:{flex:1,overflow:"hidden"},children:[a==="list"&&f.jsx(yI,{chats:i,user:e,unreadMap:u,onSelect:B=>{v(B),l("chat")},onNew:()=>l("new")}),a==="chat"&&g&&f.jsx(bI,{chat:g,user:e,courseId:y,onBack:()=>{l("list"),v(null)}}),a==="new"&&f.jsx(SI,{courseId:y,user:e,userRole:t,onBack:()=>l("list"),onCreated:B=>{v(B),l("chat")}})]})]})]})}const xI="https://us-central1-pantherprep-a5a73.cloudfunctions.net/translateText";function Ur({children:e}){const{user:t,loading:n}=un();return n?f.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg)"},children:f.jsx("div",{className:"spinner"})}):t?e:f.jsx(E8,{to:"/login"})}function TI(){const{pathname:e}=ci();return M.useEffect(()=>{window.scrollTo(0,0),document.documentElement.scrollTop=0,document.body.scrollTop=0,document.querySelectorAll('[style*="overflow"]').forEach(t=>{t.scrollTop=0})},[e]),null}function EI(){const{user:e,loading:t}=un();return t?f.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg)"},children:f.jsx("div",{className:"spinner"})}):f.jsxs(ik,{children:[f.jsx(TI,{}),f.jsx(vI,{}),f.jsxs(rx,{children:[f.jsx(lr,{path:"/login",element:e?f.jsx(E8,{to:"/"}):f.jsx(iM,{})}),f.jsx(lr,{path:"/",element:f.jsxs(Ur,{children:[f.jsx(Vr,{}),f.jsx(FR,{})]})}),f.jsx(lr,{path:"/course/:courseId",element:f.jsxs(Ur,{children:[f.jsx(Vr,{}),f.jsx(KR,{})]})}),f.jsx(lr,{path:"/course/:courseId/lesson/:lessonId",element:f.jsxs(Ur,{children:[f.jsx(Vr,{}),f.jsx(Sk,{})]})}),f.jsx(lr,{path:"/editor",element:f.jsxs(Ur,{children:[f.jsx(Vr,{}),f.jsx(Dk,{})]})}),f.jsx(lr,{path:"/grading",element:f.jsxs(Ur,{children:[f.jsx(Vr,{}),f.jsx(Hk,{})]})}),f.jsx(lr,{path:"/rosters",element:f.jsxs(Ur,{children:[f.jsx(Vr,{}),f.jsx(Fk,{})]})}),f.jsx(lr,{path:"/progress",element:f.jsxs(Ur,{children:[f.jsx(Vr,{}),f.jsx($k,{})]})}),f.jsx(lr,{path:"/xp-controls/:courseId",element:f.jsxs(Ur,{children:[f.jsx(Vr,{}),f.jsx(Gk,{})]})}),f.jsx(lr,{path:"/teams/:courseId",element:f.jsxs(Ur,{children:[f.jsx(Vr,{}),f.jsx(Qk,{})]})}),f.jsx(lr,{path:"/mana/:courseId",element:f.jsxs(Ur,{children:[f.jsx(Vr,{}),f.jsx(Xk,{})]})}),f.jsx(lr,{path:"/boss-battle/:courseId",element:f.jsxs(Ur,{children:[f.jsx(Vr,{}),f.jsx(mI,{})]})}),f.jsx(lr,{path:"/avatar",element:f.jsxs(Ur,{children:[f.jsx(Vr,{}),f.jsx(gI,{})]})})]}),e&&f.jsx(_I,{})]})}function CI(){return M.useEffect(()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual")},[]),f.jsx(jx,{children:f.jsx(eM,{children:f.jsx(nM,{cloudFunctionUrl:xI,children:f.jsx(EI,{})})})})}a_.createRoot(document.getElementById("root")).render(f.jsx(M.StrictMode,{children:f.jsx(CI,{})}));
